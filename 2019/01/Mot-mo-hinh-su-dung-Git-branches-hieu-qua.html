<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title> Một mô hình sử dụng Git branches hiệu quả · Learn and Share</title><meta name="description" content="Một mô hình sử dụng Git branches hiệu quả - Hung Tan Nguyen"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="rk-Nc1c8xi1CdZ0ZQIVV-ifsndGrHanIuSHI-yTHZYE"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="Một mô hình sử dụng Git branches hiệu quả"><meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*AAU1VCV8LMHvVPBYxMBsxg.png"><meta property="og:description" content="Mới đầu mình tính viết về git-flow - một tool đơn giản dùng để quản lý Git branches, xong thấy bài viết này về một ví dụ sử dụng Git branches hay quá, nên quyết định dịch luôn.
Mở đầuNgay bây giờ, tôi sẽ giới thiệu với các bạn mô hình sử dụng Git mà tôi đã và đang sử dụng trong các dự án khoảng một năm trở lại đây. Đó là một mô hình thực sự thành công, nhưng mãi đến giờ tôi mới có cơ hội để có thể viết về nó và chia sẻ với các bạn. Tôi sẽ không đi vào chi tiết dự án, mà chỉ xoay quanh chiến lược quản lý các phân nhánh mà thôi."></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nthung2112" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item search-form-input"><div class="search-icon"><div class="search-icon__circle"></div><div class="search-icon__rectangle"></div></div></li></ul><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" placeholder="Type something..." class="ins-search-input"><span class="ins-close ins-selectable"><div class="close-icon"><div class="close-icon__x"></div><div class="close-icon__y"></div></div></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>var rootUrl = "/";
var contentUrl = '/content.json';
(function (window) {
  var INSIGHT_CONFIG = {
  TRANSLATION: {
      POSTS:'Posts',
      PAGES: 'Pages',
      CATEGORIES: 'Categories',
      TAGS: 'Tags',
      UNTITLED: '(Untitled)'
    },
    ROOT_URL: rootUrl,
    CONTENT_URL: contentUrl,
  };
  window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);</script></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">Một mô hình sử dụng Git branches hiệu quả</h1><h2 class="post-subtitle"></h2><header class="post-info">Jan 6, 2019<div class="tags"><a href="/tags/git" class="tag-link">#git</a><a href="/tags/gitflow" class="tag-link">#gitflow</a></div><div class="fb-ir-time"><time datetime="2019-01-06T16:24:00.000Z" class="op-modified"></time><time datetime="2019-01-06T16:24:00.000Z" class="op-published"></time></div></header></div><div class="post-banner"><img src="https://cdn-images-1.medium.com/max/800/1*AAU1VCV8LMHvVPBYxMBsxg.png"></div><div class="wrap"><div class="post-content"><p>Mới đầu mình tính viết về <a href="https://github.com/nvie/gitflow" target="_blank" rel="noopener">git-flow</a> - một tool đơn giản dùng để quản lý Git branches, xong thấy bài viết <a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener">này</a> về một ví dụ sử dụng Git branches hay quá, nên quyết định dịch luôn.</p>
<h2 id="Mo-dau"><a href="#Mo-dau" class="headerlink" title="Mở đầu"></a>Mở đầu</h2><p>Ngay bây giờ, tôi sẽ giới thiệu với các bạn mô hình sử dụng Git mà tôi đã và đang sử dụng trong các dự án khoảng một năm trở lại đây. Đó là một mô hình thực sự thành công, nhưng mãi đến giờ tôi mới có cơ hội để có thể viết về nó và chia sẻ với các bạn. Tôi sẽ không đi vào chi tiết dự án, mà chỉ xoay quanh chiến lược quản lý các phân nhánh mà thôi.<br><a id="more"></a><br><img src="http://nvie.com/img/git-model@2x.png" alt=""></p>
<p>Trong bài viết dưới đây, tôi sử dụng Git để quản lý version cho toàn bộ source code. Nếu các bạn có hứng thú với việc phân tích dữ liệu thời gian thực dựa vào hoạt động trên Git, có thể tham khảo phần mềm mà <a href="http://gitprime.com/" target="_blank" rel="noopener">GitPrime</a> mà công ty tôi phát triển.</p>
<h2 id="Tai-sao-lai-chon-Git"><a href="#Tai-sao-lai-chon-Git" class="headerlink" title="Tại sao lại chọn Git?"></a>Tại sao lại chọn Git?</h2><p>Đã có quá nhiều cuộc chiến nổ ra khi bàn về ưu điểm nhược điểm của Git so với các công cụ quản lý source code tập trung khác (như CVS, SVN). Là một developer, tôi cảm thấy yêu thích Git hơn. Git thực sự đã thay đổi cách suy nghĩ về merging và branching. Những ai đã từng làm việc với CVS/Subversion đều hiểu merging/branching không hề đơn giản, trong <a href="http://svnbook.red-bean.com/" target="_blank" rel="noopener">tài liệu về CVS/Subversion</a> branching và merging chỉ được nhắc đến ở chapter cuối, dành cho các users có kinh nghiệm. Còn với Git, branching/merging là một phần trong workflow hàng ngày của bạn, được mô tả ở những phần đầu tiên trong <a href="http://book.git-scm.com/" target="_blank" rel="noopener">Git book</a>.</p>
<h2 id="Phan-tan-nhung-tap-trung"><a href="#Phan-tan-nhung-tap-trung" class="headerlink" title="Phân tán, nhưng tập trung"></a>Phân tán, nhưng tập trung</h2><p>Mô hình Git mà tôi sử dụng hoạt động xoay quanh một repo trung tâm. Nên nhớ đó “chỉ được xem như” là repo trung tâm, chứ về mặt kỹ thuật thì GIT không hề có cái gì gọi là repo trung tâm cả. Ví dụ như repo origin ở hình bên dưới.</p>
<p><img src="http://nvie.com/img/centr-decentr@2x.png" alt=""></p>
<p>Mỗi developer sẽ pull và push với origin. Bên cạnh đó, mỗi người có thể pull những thay đổi từ những người khác để tạo thành các sub teams. Điều này sẽ thực sự có ích khi phải làm việc nhóm 2-3 người trở lên để hoàn thành một feature lớn, mà không phải đẩy source code vẫn đang dở dang lên origin. Ở hình vẽ bên trên, các subteams là Alice-Bob, Alice-David, Clair-David.</p>
<p>Về mặt kỹ thuật, đơn giản là Alice định nghĩa một Git remote là bob, trỏ đến repo của Bob, và ngược lại.</p>
<h2 id="Nhung-branches-chinh"><a href="#Nhung-branches-chinh" class="headerlink" title="Những branches chính"></a>Những branches chính</h2><p>Repo trung tâm sẽ chứa hai branches chính hoạt động mãi mãi:</p>
<ul>
<li>master</li>
<li>develop</li>
</ul>
<p>Nhánh master tại origin là nhánh quen thuộc với tất cả các Git users. Song song là nhánh develop.</p>
<p><img src="http://nvie.com/img/main-branches@2x.png" alt=""></p>
<p>origin/master được coi là nhánh chính với HEAD phản ánh trạng thái production-ready.</p>
<p>origin/develop được coi là nhánh chính với HEAD phản ánh trạng thái thay đổi mới nhất trong quá trình phát triển, chuẩn bị cho release tiếp theo.</p>
<p>Khi source code bên develop đạt đến một mức độ ổn định nào đó và sẵn sàng để release thì sẽ được merge sang bên master và đánh dấu với release number.</p>
<p>Như vậy, theo định nghĩa về nhánh master, chúng ta mặc định hiểu rằng khi có thay đổi được merge vào master thì tức là sẽ có một phiên bản production mới được release. Nhờ đó chúng ta có thể sử dụng script để tự động build lên production server mỗi khi có commit ở master.</p>
<h2 id="Nhung-branches-phu"><a href="#Nhung-branches-phu" class="headerlink" title="Những branches phụ"></a>Những branches phụ</h2><p>Bên cạnh hai branches chính master và develop, mô hình mà tôi đang sử dụng còn có thêm rất nhiều những branches phụ để giúp các team members có thể phát triển song song, dễ dàng tracking theo features, chuẩn bị cho release hoặc fix nhanh các vấn đề production. Khác với hai branches chính kia, các branches phụ này chỉ tồn tại trong một khoảng thời gian ngắn, rồi sẽ bị xoá đi.</p>
<ul>
<li>Feature branches</li>
<li>Release branches</li>
<li>Hotfix branches</li>
</ul>
<p>Phía trên là các loại branches khác nhau tôi hay sử dụng. Mỗi loại branches lại có một nhiệm vụ riêng, và cách xử lý riêng. Tôi sẽ đi sâu vào phân tích ở đoạn sau.</p>
<p>Về mặt kỹ thuật, chả có branch nào là “đặc biệt” so với các branches khác cả. Tất cả chỉ là Git branches thông thường, chúng chỉ được phân loại bằng cách ta sử dụng ra sao thôi.</p>
<h3 id="Feature-branches"><a href="#Feature-branches" class="headerlink" title="Feature branches"></a>Feature branches</h3><ul>
<li>Tách từ: develop</li>
<li>Merge vào: develop</li>
<li>Naming convention: tự do, ngoại trừ master, develop, release-<em>, hotfix-</em></li>
</ul>
<p><img src="http://nvie.com/img/fb@2x.png" alt=""></p>
<p>Feature branches (hay còn gọi là topic branches) được sử dụng để phát triển các feature mới phục vụ cho release sau này. Khi bắt đầu phát triển một chức năng, có thể chưa rõ được thời điểm chức năng đó được tích hợp vào hệ thống và release. Feature branch sẽ tồn tại trong quá trình chức năng được phát triển, cuối cùng sẽ được merge lại vào develop (khi quyết định lần release tới bao gồm chức năng đó) hoặc bị bỏ đi (khi thấy chức năng không còn cần thiết).</p>
<p>Về cơ bản thì feature branches chỉ tồn tại ở repos của developers, chứ ko phải ở origin.</p>
<h4 id="Tao-feature-branch"><a href="#Tao-feature-branch" class="headerlink" title="Tạo feature branch"></a>Tạo feature branch</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b myfeature develop</span><br></pre></td></tr></table></figure>
<h4 id="Merge-vao-develop"><a href="#Merge-vao-develop" class="headerlink" title="Merge vào develop"></a>Merge vào develop</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout develop</span><br><span class="line">$ git merge --no--ff myfeature</span><br><span class="line">$ git branch -d myfeature</span><br><span class="line">$ git push origin develop</span><br></pre></td></tr></table></figure>
<p>–no-ff giúp thao tác merge luôn tạo ra một commit mới, ngay cả khi có thể merge theo fast-forward. Flag này giúp chúng ta không bị mất thông tin liên quan đến lịch sử các commits của feature branch.</p>
<p><img src="http://nvie.com/img/merge-without-ff@2x.png" alt=""></p>
<p>Ở trường hợp bên phải, không thể nhận biết được những commits nào phát triển cùng chức năng nếu không ngồi đọc log message của từng commit. Khi dấy, nếu muốn revert lại cả feature (phải revert nhiều commits liên quan) thì thực sự là đau đầu. Và đó là lý do mà –no-ff được sử dụng.</p>
<p>Đương nhiên, nó sẽ tạo ra thêm vài commit, nhưng chả có vấn đề gì cả.</p>
<h3 id="Release-branches"><a href="#Release-branches" class="headerlink" title="Release branches"></a>Release branches</h3><ul>
<li>Tách từ: develop</li>
<li>Merge vào: develop và master</li>
<li>Naming convention: release-*</li>
</ul>
<p>Release branches được sử dụng để chuẩn bị cho release bản production mới. Tất cả các công việc cuối cùng trước khi release sẽ được thực hiện ở đây, ngoài ra còn để fix nốt các bugs lẻ tẻ, chuẩn bị meta-data (version number, build dates, etc..). Nhờ việc tách nhánh ra khỏi develop, chúng ta có thể tiếp tục phát triển các features cho đợt release khác một cách bình thường.</p>
<p>Thời điểm được lựa chọn để tách nhánh từ develop là khi develop phản ánh được trạng thái mong muốn cho việc release mới. Ít nhất lúc đó tất cả các features dành cho đợt release phải được merge vào develop rồi. Những features nhắm đến các lần release sau thì chưa được merge vào, phải đợi sau khi tách nhánh.</p>
<p>Chúng ta sẽ tiến hành đánh version theo rule của dự án ngay sau khi tạo release branch.</p>
<h4 id="Tao-release-branch"><a href="#Tao-release-branch" class="headerlink" title="Tạo release branch"></a>Tạo release branch</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b release-1.2 develop</span><br><span class="line">$ ./bump-version.sh 1.2</span><br><span class="line">$ git commit -a -m &quot;Bumped version number to 1.2&quot;</span><br></pre></td></tr></table></figure>
<p>Ở ví dụ trên, bump-version.sh tượng trưng cho một script thay đổi một vài files trong source code để phản ánh version mới. Sau khi tạo branch mới và chuyển sang branch đó, chúng ta sẽ thực hiện nâng version, rồi commit thao tác đó.</p>
<p>Branch mới này sẽ tồn tại cho đến khi việc release được thực hiện gọn ghẽ. Trong khoảng thời gian đó, có thể thực hiện fix bugs ở branch này, tuy nhiên nghiêm cấm việc bổ sung feature mới lên đó. Tốt nhất nếu có features mới thì hãy merge vào develop, và đợi đợt release sau.</p>
<h4 id="Ket-thuc-release-branch"><a href="#Ket-thuc-release-branch" class="headerlink" title="Kết thúc release branch"></a>Kết thúc release branch</h4><p>Khi source code trên release branch sẵn sàng để release, đầu tiên, phải merge vào master, sau đó phải đc merge lại vào develop để những lần release sau cũng chứa những thay đổi ở lần này.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge --no-ff release-1.2</span><br><span class="line">$ git tag -a 1.2</span><br></pre></td></tr></table></figure>
<p>Vậy là source code đã được release lên master, và đã được tag để tiện sau này tham chiếu.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout develop</span><br><span class="line">$ git merge --no-ff release-1.2</span><br></pre></td></tr></table></figure>
<p>Ở bước này, rất có thể sẽ có confict, nên hãy fix nó rồi commit nhé.</p>
<p>Bây giờ thì việc release đã hoàn thành, và chúng ta ko cần đến branch này nữa.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d release-1.2</span><br></pre></td></tr></table></figure>
<h3 id="Hotfix-branches"><a href="#Hotfix-branches" class="headerlink" title="Hotfix branches"></a>Hotfix branches</h3><ul>
<li>Tách từ: master</li>
<li>Merge vào: develop và master</li>
<li>Naming convention: hotfix-*</li>
</ul>
<p><img src="http://nvie.com/img/hotfix-branches@2x.png" alt=""></p>
<p>Hotfix branches cũng giống release branches ở chỗ được sử dụng để chuẩn bị cho việc release production mới, chỉ khác ở chỗ là ko có plan từ trước. Khi có một bug nghiêm trọng trên bản production cần được giải quyết ngay lập tức, một hotfix branch sẽ được tách ra từ master và được đánh version để nhận biết.</p>
<p>Ưu điểm của việc tách nhánh này ở chỗ các team members khác có thể tiếp tục công việc ở develop trong khi những người khác có thể tập trung vào fix bug của production.</p>
<h4 id="Tao-hotfix-branch"><a href="#Tao-hotfix-branch" class="headerlink" title="Tạo hotfix branch"></a>Tạo hotfix branch</h4><p>Hotfix branch được tạo ra từ master. Ví dụ hiện tại version 1.2 là phiên bản production đang chạy và xuất hiện lỗi nghiêm trọng. Tuy nhiên source code trên develop vẫn chưa ổn định, vì thế chúng ta phải tách nhánh hotfix và tiến hành sửa lỗi.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b hotfix-1.2.1 master</span><br><span class="line">$ ./bump-version.sh 1.2.1</span><br><span class="line">$ git commit -a -m &quot;Bumped version number to 1.2.1&quot;</span><br></pre></td></tr></table></figure>
<p>Sau khi tách nhánh phải tiến hành up version luôn nhé!</p>
<p>Sau khi sửa lỗi, hãy thực hiện commit.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &quot;Fixed severe production problem&quot;</span><br></pre></td></tr></table></figure>
<h4 id="Ket-thuc-hotfix-branch"><a href="#Ket-thuc-hotfix-branch" class="headerlink" title="Kết thúc hotfix branch"></a>Kết thúc hotfix branch</h4><p>Sau khi kết thúc sửa lỗi, những thay đổi phải được merge lại master, đồng thời cũng phải merge vào develop để ngăn lỗi xảy ra ở những lần release sau. Nghe rất giống với xử lý trên release branch phải không.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge --no-ff hotfix-1.2.1</span><br><span class="line">$ git tag -a 1.2.1</span><br><span class="line"></span><br><span class="line">$ git checkout develop</span><br><span class="line">$ git merge --no-ff hotfix-1.2.1</span><br></pre></td></tr></table></figure>
<p>Tuy nhiên, có một điểm cần lưu ý rằng: <strong>khi đang tồn tại một release branch thì cần phải merge hotfix vào release branch đó, thay cho develop</strong>. Khi release branch được merge vào develop thì cuối cùng những thay đổi trong hotfix cũng được merge vào develop, nên không có vấn đề gì cả. Trừ khi thực sự công việc ở develop cần phần hotfix ngay lập tức và ko thể đợi release branch được merge, thì cần cẩn thận merge hotfix vào develop.</p>
<p>Cuối cùng, chúng ta cũng ko cần đến branch này nữa:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d hotfix-1.2.1</span><br></pre></td></tr></table></figure><span>Source: </span><a href="https://nvie.com/posts/a-successful-git-branching-model/" target="_blank" title="https://nvie.com/posts/a-successful-git-branching-model/" class="post-from">https://nvie.com/posts/a-successful-git-branching-model/</a></div></div></article></div></section><div class="wrap"><footer><div class="paginator"><a href="/2019/01/Web-Architecture-101.html" class="prev">NEXT</a><a href="/2019/01/Gioi-thieu-ve-Atomic-CSS.html" class="next">PREV</a></div><div class="copyright"><p>© 2017 - 2019 <a href="http://nthung2112.github.io">Hung Tan Nguyen</a>, unless otherwise noted.</p></div></footer></div><script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-41935289-1",'auto');ga('send','pageview');</script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/js/zoom.js"></script><script src="/js/insight.js"></script></body></html>
<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title> Giải thích keyword 'new' trong Javascript · Learn and Share</title><meta name="description" content="Giải thích keyword 'new' trong Javascript - Hung Tan Nguyen"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="rk-Nc1c8xi1CdZ0ZQIVV-ifsndGrHanIuSHI-yTHZYE"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="Giải thích keyword 'new' trong Javascript"><meta property="og:image"><meta property="og:description" content="Normal Function CallTo explain what new does, let’s start with just a normal function, called without new. We want to write a function that will create “person” objects. It’ll give these objects name and age properties based on parameters that it takes in."></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nthung2112" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item search-form-input"><div class="search-icon"><div class="search-icon__circle"></div><div class="search-icon__rectangle"></div></div></li></ul><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" placeholder="Type something..." class="ins-search-input"><span class="ins-close ins-selectable"><div class="close-icon"><div class="close-icon__x"></div><div class="close-icon__y"></div></div></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>var rootUrl = "/";
var contentUrl = '/content.json';
(function (window) {
  var INSIGHT_CONFIG = {
  TRANSLATION: {
      POSTS:'Posts',
      PAGES: 'Pages',
      CATEGORIES: 'Categories',
      TAGS: 'Tags',
      UNTITLED: '(Untitled)'
    },
    ROOT_URL: rootUrl,
    CONTENT_URL: contentUrl,
  };
  window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);</script></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">Giải thích keyword 'new' trong Javascript</h1><h2 class="post-subtitle"></h2><header class="post-info">Aug 20, 2017<div class="tags"><a href="/tags/javascript" class="tag-link">#javascript</a></div><div class="fb-ir-time"><time datetime="2017-08-20T15:21:52.000Z" class="op-modified"></time><time datetime="2017-08-20T15:21:52.000Z" class="op-published"></time></div></header></div><div class="wrap"><div class="post-content"><p><img src="https://cdn-images-1.medium.com/max/2000/1*5_r4-hkl9k9ERVyPI56x1Q.png" alt=""></p>
<h4 id="Normal-Function-Call"><a href="#Normal-Function-Call" class="headerlink" title="Normal Function Call"></a>Normal Function Call</h4><p>To explain what <code>new</code> does, let’s start with just a normal function, called without <code>new</code>. We want to write a function that will create “person” objects. It’ll give these objects <code>name</code> and <code>age</code> properties based on parameters that it takes in.<br><a id="more"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFn</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> personObj = &#123;&#125;;</span><br><span class="line">    personObj.name = name;</span><br><span class="line">    personObj.age = age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> personObj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> alex = personFn(<span class="string">'Alex'</span>, <span class="number">30</span>);</span><br><span class="line"><span class="comment">// -&gt; &#123; name: 'Alex', age: 30 &#125;</span></span><br></pre></td></tr></table></figure>
<p>Simple enough. We create an object, add the properties to it, and return it at the end.</p>
<h4 id="new"><a href="#new" class="headerlink" title="new"></a><code>new</code></h4><p><img src="https://cdn-images-1.medium.com/max/1600/1*HFlvxchL2IMFERwQsQClRw.png" alt="">Object-oriented programming</p>
<p>Let’s create a function that does the same thing, but we want it to be invoked using <code>new</code>. This function will create the same object as the one above. Common practice is to make functions that are meant to be invoked with <code>new</code> start with a capital letter. These functions are also referred to as <strong>constructors</strong>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PersonConstructor</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> alex = <span class="keyword">new</span> PersonConstructor(<span class="string">'Alex'</span>, <span class="number">30</span>);</span><br><span class="line"><span class="comment">// -&gt; &#123; name: 'Alex', age: 30 &#125;</span></span><br></pre></td></tr></table></figure>
<p>Invoking <code>personFn</code> normally and invoking <code>PersonConstructor</code> with <code>new</code> both result in the same object being created. What’s going on?</p>
<p>The <code>new</code> keyword invokes a function in a special way. It adds some implicit code that we don’t see. Let’s expand the above function to show everything that’s happening. The commented lines are pseudocode representing functionality that is implicitly added by the JS engine when using <code>new</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PersonConstructor</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// this = &#123;&#125;;</span></span><br><span class="line">    <span class="comment">// this.__proto__ = PersonConstructor.prototype;</span></span><br><span class="line">    <span class="comment">// Set up logic such that: if</span></span><br><span class="line">    <span class="comment">// there is a return statement</span></span><br><span class="line">    <span class="comment">// in the function body that</span></span><br><span class="line">    <span class="comment">// returns anything EXCEPT an</span></span><br><span class="line">    <span class="comment">// object, array, or function:</span></span><br><span class="line">    <span class="comment">//     return 'this' (the newly</span></span><br><span class="line">    <span class="comment">//     constructed object)</span></span><br><span class="line">    <span class="comment">//     instead of that item at</span></span><br><span class="line">    <span class="comment">//     the return statement;</span></span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="comment">// return this;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Let’s break it down. <code>new</code>:</p>
<ol>
<li>Creates a new object and binds it to the <code>this</code> keyword.</li>
<li>Sets the object’s internal [<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto" target="_blank" rel="noopener">[Prototype]]</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto" target="_blank" rel="noopener">property</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto" target="_blank" rel="noopener">&#95;&#95;proto&#95;&#95;</a>, to be the prototype of the constructing function. This also makes it so the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor" target="_blank" rel="noopener">constructor</a> of the new object is prototypically inherited.</li>
<li>Sets up logic such that if a variable of any type other than <code>object</code>, <code>array</code>, or <code>function</code> is returned in the function body, return <code>this</code>, the newly constructed object, instead of what the function says to return.</li>
<li>At the end of the function, returns <code>this</code> if there is no return statement in the function body.</li>
</ol>
<p>Let’s show that these statements are valid, one by one.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.value = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*1*/</span> <span class="keyword">var</span> demo = <span class="keyword">new</span> Demo(); <span class="comment">// -&gt; &#123;&#125;</span></span><br><span class="line"><span class="comment">/*2*/</span> <span class="built_in">console</span>.log(demo.__proto__ === Demo.prototype); <span class="comment">// -&gt; true</span></span><br><span class="line">      <span class="built_in">console</span>.log(demo.constructor === Demo); <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="comment">/*3*/</span> <span class="built_in">console</span>.log(demo); <span class="comment">// -&gt; &#123; value: 5 &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SecondDemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.val = <span class="string">'2nd demo'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*4*/</span> <span class="built_in">console</span>.log(<span class="keyword">new</span> SecondDemo()); <span class="comment">// -&gt; &#123; val: '2nd demo' &#125;</span></span><br></pre></td></tr></table></figure>
<p>If you aren’t familiar with constructors or prototypes, don’t worry about it too much. You’ll run into them as you continue to learn Javascript. For now, just understand that the new object implicitly returned by the constructor function will be able to inherit properties and methods.</p>
<h4 id="Calling-a-non-constructor-with-new"><a href="#Calling-a-non-constructor-with-new" class="headerlink" title="Calling a non-constructor with new"></a>Calling a non-constructor with new</h4><p>What happens if we invoke a normal function like <code>personFn</code> using <code>new</code>? Nothing special. The same rules apply. in the case of <code>personFn</code>, we see nothing explicitly happening.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> alex = <span class="keyword">new</span> personFn(<span class="string">'Alex'</span>, <span class="number">30</span>);</span><br><span class="line"><span class="comment">// -&gt; &#123; name: 'Alex', age: 30 &#125;</span></span><br></pre></td></tr></table></figure>
<p>Why? Let’s add our implicit code in to <code>personFn</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFn</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// this = &#123;&#125;;</span></span><br><span class="line">    <span class="comment">// this.constructor = PersonConstructor;</span></span><br><span class="line">    <span class="comment">// this.__proto__ = PersonConstructor.prototype;</span></span><br><span class="line">    <span class="comment">// Set up logic such that: if</span></span><br><span class="line">    <span class="comment">// there is a return statement</span></span><br><span class="line">    <span class="comment">// in the function body that</span></span><br><span class="line">    <span class="comment">// returns anything EXCEPT an</span></span><br><span class="line">    <span class="comment">// object, array, or function:</span></span><br><span class="line">    <span class="comment">//     return this (the newly</span></span><br><span class="line">    <span class="comment">//     constructed object)</span></span><br><span class="line">    <span class="comment">//     instead of that item at</span></span><br><span class="line">    <span class="comment">//     the return statement;</span></span><br><span class="line">    <span class="keyword">var</span> personObj = &#123;&#125;;</span><br><span class="line">    personObj.name = name;</span><br><span class="line">    personObj.age = age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> personObj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return this;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The implicit code is still added in:</p>
<ul>
<li>It binds <code>this</code> to a new object and sets its constructor and prototype.</li>
<li>It adds logic that will return <code>this</code> instead of a non-object.</li>
<li>It adds an implicit <code>return this</code> statement at the end.</li>
</ul>
<p>This doesn’t affect our code, since we don’t use the <code>this</code> keyword in our code. We also explicitly return an object, <code>personObj</code>, so the returning logic and the <code>return this</code> line have no use. Effectively, using <code>new</code> to invoke our function here has no effect on the output. If we were using <code>this</code> or if we weren’t returning an object, the function would have different effects when invoked with and without <code>new</code>.</p>
<h4 id="That’s-it-Go-write-some-code"><a href="#That’s-it-Go-write-some-code" class="headerlink" title="That’s it. Go write some code."></a>That’s it. Go write some code.</h4><span>Source: </span><a href="https://codeburst.io/javascripts-new-keyword-explained-as-simply-as-possible-fec0d87b2741" target="_blank" title="https://codeburst.io/javascripts-new-keyword-explained-as-simply-as-possible-fec0d87b2741" class="post-from">https://codeburst.io/javascripts-new-keyword-explained-as-simply-as-possible-fec0d87b2741</a></div></div></article></div></section><div class="wrap"><footer><div class="paginator"><a href="/2017/08/Master-the-JavaScript-Interview.html" class="prev">NEXT</a><a href="/2017/08/A-Jade-Tutorial-for-Beginners.html" class="next">PREV</a></div><div class="copyright"><p>© 2017 - 2018 <a href="http://nthung2112.github.io">Hung Tan Nguyen</a>, unless otherwise noted.</p></div></footer></div><script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-41935289-1",'auto');ga('send','pageview');</script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/js/zoom.js"></script><script src="/js/insight.js"></script></body></html>
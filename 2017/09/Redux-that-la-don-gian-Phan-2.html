<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title> Redux thật là đơn giản (Phần 2) · Learn and Share</title><meta name="description" content="Redux thật là đơn giản (Phần 2) - Hung Tan Nguyen"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="rk-Nc1c8xi1CdZ0ZQIVV-ifsndGrHanIuSHI-yTHZYE"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="Redux thật là đơn giản (Phần 2)"><meta property="og:image"><meta property="og:description" content="Redux với React Native
Bài trước Nguyên Lý của Redux các bạn đã nắm được cơ bản phần lý thuyết về Redux và dùng cho việc gì, sau đây chúng ta sẽ đi vào áp dụng nó với React hoặc React Native, ở đây mình chọn React Native vì nó vẫn đang còn khá HOT :D (Thực ra React hay React Native thì đều dùng Redux là y hệt nhau)"></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nthung2112" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item search-form-input"><div class="search-icon"><div class="search-icon__circle"></div><div class="search-icon__rectangle"></div></div></li></ul><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" placeholder="Type something..." class="ins-search-input"><span class="ins-close ins-selectable"><div class="close-icon"><div class="close-icon__x"></div><div class="close-icon__y"></div></div></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>var rootUrl = "/";
var contentUrl = '/content.json';
(function (window) {
  var INSIGHT_CONFIG = {
  TRANSLATION: {
      POSTS:'Posts',
      PAGES: 'Pages',
      CATEGORIES: 'Categories',
      TAGS: 'Tags',
      UNTITLED: '(Untitled)'
    },
    ROOT_URL: rootUrl,
    CONTENT_URL: contentUrl,
  };
  window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);</script></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">Redux thật là đơn giản (Phần 2)</h1><h2 class="post-subtitle"></h2><header class="post-info">Sep 22, 2017<div class="tags"><a href="/tags/react" class="tag-link">#react</a><a href="/tags/javascript" class="tag-link">#javascript</a><a href="/tags/redux" class="tag-link">#redux</a></div><div class="fb-ir-time"><time datetime="2017-09-22T07:13:23.000Z" class="op-modified"></time><time datetime="2017-09-22T07:13:23.000Z" class="op-published"></time></div></header></div><div class="wrap"><div class="post-content"><h3 id="Redux-voi-React-Native"><a href="#Redux-voi-React-Native" class="headerlink" title="Redux với React Native"></a>Redux với React Native</h3><p><img src="https://cdn-images-1.medium.com/max/1600/1*49G6uGo35MbTX5n7or6zuA.jpeg" alt=""></p>
<p><span class="graf-dropCap">B</span>ài trước <a href="https://medium.com/innovatube/redux-th%E1%BA%ADt-l%C3%A0-%C4%91%C6%A1n-gi%E1%BA%A3n-ph%E1%BA%A7n-1-76a3fa2c31ab" target="_blank" rel="noopener"><strong><em>Nguyên Lý của Redux</em></strong></a> các bạn đã nắm được cơ bản phần lý thuyết về Redux và dùng cho việc gì, sau đây chúng ta sẽ đi vào áp dụng nó với <strong>React</strong> hoặc React Native, ở đây mình chọn <strong>React Native</strong> vì nó vẫn đang còn khá HOT :D (Thực ra React hay React Native thì đều dùng Redux là y hệt nhau)<br><a id="more"></a><br>Đầu tiên các bạn vào link:<a href="https://facebook.github.io/react-native/docs/getting-started.html" target="_blank" rel="noopener">https://facebook.github.io/react-native/docs/getting-started.html</a> để làm theo và tạo 1 project với React Native.</p>
<p><em>Lưu ý: Máy phải được cài sẵn</em> <strong><em>yarn (</em></strong><a href="https://yarnpkg.com/en/" target="_blank" rel="noopener">https://yarnpkg.com/en/</a>) hoặc dùng npm sau khi đã cài <strong>node</strong>, vì nếu cài yarn thì nó sẽ đồng thời cài node luôn cho bạn.</p>
<h4 id="Phan-1-Tao-giao-dien-man-hinh-voi-React-Native"><a href="#Phan-1-Tao-giao-dien-man-hinh-voi-React-Native" class="headerlink" title="Phần 1: Tạo giao diện màn hình với React Native"></a>Phần 1: Tạo giao diện màn hình với React Native</h4><p>Sau khi install xong, tạo thêm thư mục src -&gt; file Main.js như sau:</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*NFjZttazBbGCbcf2lfsUEQ.png" alt=""></p>
<p>Ở đây mình sẽ minh họa tạo chức năng hết sức đơn giản là <strong>Bấm — Tăng — Giảm 1 số</strong> dùng React Native + Redux có màn hình hiển thị lên như sau:</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*UbvASuQS5ASxh8reRU6C8g.png" alt=""></p>
<p>Main.js</p>
<script src="//gist.github.com/5e0e74a531f6637ba4c7e1c89f53e27f.js"></script>
<p>Trong thư mục components ta tạo thêm 1 component có tên <strong>Button</strong>.js, thực tế bạn không cần phải viết hẳn 1 component chỉ render mỗi cái Button như này, do mình muốn tách nhỏ component nên tạm lấy ví dụ viết 1 component con riêng ra. (trong component này mình có dùng react-native-elements cài đặt nó qua yarn bằng lệnh sau:yarn add react-native-elements</p>
<script src="//gist.github.com/f5b5be1a8b2b691132fd379acef13b3a.js"></script>
<p>Component để hiển thị text number:</p>
<script src="//gist.github.com/54801151c4a99c165358812cfe539e12.js"></script>
<p>Okay tới đây coi như xong giao diện, như vậy bạn đã có 1 app counter khá đơn giản :D và hoàn toàn có thể làm dùng React Native đơn giản hơn nhiều, nhưng để hiểu về Redux thì chúng ta nên bắt đầu từ việc đơn giản đã.</p>
<h4 id="Phan-2-Cai-dat-Redux"><a href="#Phan-2-Cai-dat-Redux" class="headerlink" title="Phần 2: Cài đặt Redux"></a>Phần 2: Cài đặt Redux</h4><p><strong>Step1:</strong> <strong>install Redux, React-Redux dependencies</strong></p>
<p>yarn add redux react-redux</p>
<p><strong>Step 2:</strong> <strong>Tạo cấu trúc thư mục project như hình:</strong></p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*zGivefFkBikPcUMfF6Tizg.png" alt=""></p>
<p>3 nhân tố của Redux là <strong>actions</strong>, <strong>reducers</strong> và <strong>store</strong> tương ứng với 3 thư mục trong project.</p>
<h4 id="actions"><a href="#actions" class="headerlink" title="actions:"></a><strong>actions:</strong></h4><ul>
<li>index.js chứa các action (nó sẽ export ra cho các class có thể gọi tới các function bên trong nó)</li>
</ul>
<script src="//gist.github.com/377b80d980e269af5dc4fdbd7f463076.js"></script>
<ul>
<li>types.js định nghĩa các hằng số về kiểu của actions:</li>
</ul>
<script src="//gist.github.com/518d34a4f221f88f471fc6ea1827a97f.js"></script>
<h4 id="reducers"><a href="#reducers" class="headerlink" title="reducers:"></a>reducers:</h4><ul>
<li>Tạo 1 reducer <strong><em>counterReducer</em></strong>: làm nhiệm vụ update state counter mỗi khi có action click</li>
</ul>
<script src="//gist.github.com/f17d4c184b9c5e997218bdcd6548b5d0.js"></script>
<ul>
<li>Tiếp theo tạo file index.js, file này có nhiệm vụ <strong>combine</strong> các <strong>reducers</strong> con thành 1 <strong>reducer</strong> duy nhất để đưa vào store</li>
</ul>
<script src="//gist.github.com/1cec9897584824c616ff473d75b6628a.js"></script>
<h4 id="Store"><a href="#Store" class="headerlink" title="Store:"></a>Store:</h4><p>tạo 1 file index.js trong thư mục store. (Mình có config thêm redux-devtools-extension để tiện debug và xem store khi redux hoạt động trên extention của chrome).</p>
<script src="//gist.github.com/8133759e2d6ffb405a51d23f90c3b49d.js"></script>
<p><strong>Step 3: connect React component với store của Redux</strong></p>
<p>Việc cần làm là làm sao để kết nối toàn bộ components của app với <strong>store</strong> của Redux.</p>
<p>Thư viện <strong>react-redux</strong> đã cung cấp 1 thằng có tên <strong>Provider</strong> để làm cầu nối cho React và Redux, chúng ta chỉ việc bọc nó bao ngoài root component của React và truyền 1 tham số duy nhất là <strong>store</strong> vào (store đã được tạo ở thư mục store và được import vào file này).</p>
<script src="//gist.github.com/11800a8f9c828bf7353fc89cfabea70e.js"></script>
<p><strong>Step 4: Gọi 1 action từ 1 component và map data từ store ra View</strong></p>
<p>Quay lại bài trước như đã biết thì flow của redux:</p>
<blockquote>
<p>action → reducer → store → View</p>
</blockquote>
<p>3 bước đã thực hiện xong ở trên, việc còn lại là store và View tương tác như nào, câu hỏi đặt ra là :</p>
<ul>
<li>Phát đi 1 action từ component → store như thế nào?</li>
<li>Cập nhật data thay đổi từ store → View ra sao?</li>
</ul>
<p>Nhiệm vụ quan trọng này được thực hiện bởi hàm <strong><em>connect()</em></strong> trong react-redux.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*Oc-Ee1lE8mFETwl4tvzoVg.png" alt=""></p>
<p>Hàm connect() có 2 tham số:</p>
<ul>
<li>mapDispatchToProps(dispatch) nhiệm vụ map hàm dispatch() của store trở thành 1 thuộc tính của props của component đó, cụ thể ở code bên dưới thì actions chính là 1 props của component đó và giờ muốn phát đi 1 action ta chỉ việc gọi this.props.actions.tên_action_</li>
</ul>
<script src="//gist.github.com/22c3b3169bc5ce92d86e17e4e5967d23.js"></script>
<ul>
<li>mapStateToProps(state) nhiệm vụ hết sức đơn giản giống như cái tên của nó, biến các state từ store thành props của component và sau đó show ra View</li>
</ul>
<script src="//gist.github.com/e953692d8b678ba28ed01d21f8bebadd.js"></script>
<p>Để đơn giản và ngắn gọn hơn ta sẽ bỏ đi hàm mapDispatchToProps(dispatch) và thay bằng việc truyền trực tiếp actions vào hàm connect() cuối cùng sẽ là:</p>
<p>connnect(mapStateToProps, actions)(COMPONENT)</p>
<p>Quay trở lại code React Native ở trên, ở phần View ta có:</p>
<p><strong>main.js</strong></p>
<script src="//gist.github.com/6bf68818ccb0c4f270a80b5534eb6a74.js"></script>
<p>Giải thích:</p>
<ul>
<li>Actions được import từ thư mục actions → được truyền vào là tham số thứ 2 của hàm connect()</li>
<li>Mỗi khi button đc bấm thì ta gọi tới hàm handle tương ứng để xử lý actions, nhớ rằng đã thực hiện connnect(null, actions) ở trên thì bây giờ các actions export ra từ file index trong thư mực actions trở thành các thuộc tính của props trong component Main.js → khi gọi tới action thì ta chỉ việc gọi this.props.action_name_tương_ứng_</li>
</ul>
<p>Tiếp theo là hiển thị ra <strong>View</strong> ở component <strong><em>child.js</em></strong></p>
<script src="//gist.github.com/e594ff32394bdcaada46513ab6476ae1.js"></script>
<p>Ở file này ta vừa gán thuộc tính <em>counter : state.counter</em> lúc này counter cũng trở thành 1 props của component Child → gọi show ra View ta chỉ cần gọi như thông thường <text>{this.props.counter}</text></p>
<p>Như vậy là 1 app <strong>counter</strong> đơn giản bằng React Native và Redux đã thực hiện xong tóm lại flow như sau:</p>
<blockquote>
<p>1. View gồm 2 button <strong><em>Increase</em></strong> và <strong><em>Decrease</em></strong> và 1 component hiển thị number</p>
</blockquote>
<blockquote>
<p>2. Khi Button được click → dispatch() tới 1 <strong><em>action creator</em></strong> có têncounterIncrease()</p>
</blockquote>
<blockquote>
<p>3. counterIncrease() sẽ tạo ra 1 <strong>Object</strong> (Trong redux action phải là 1 plain object có thuộc tính là type và payload, type là bắt buộc) ở đây chỉ có 1 thuộc tính {type:”INCREASE”} sau đó nó truyền tới counterReducer() để xử lý.</p>
</blockquote>
<blockquote>
<p>4. counterReducer(state, action) =&gt; kiểm tra xem action có kiểu type = “increase” trả ra 1 state mới là: state + 1 (state của redux là immutable)</p>
</blockquote>
<blockquote>
<p>5 ở component View(<strong>Child</strong>) hiển thị number ta sẽ dùng hàm mapStateToProps(state) đẻ nhận state là counter rồi update vào View.</p>
</blockquote>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*T7GbIXCBQIoayv2A6EUs7Q.png" alt=""></p>
<p>→ App đã chạy ngon lành :D</p>
<p>Giả sử bây giờ yêu cầu bài toán có thay đổi chút như sau:</p>
<ul>
<li>Nếu click vào <strong><em>nút tăng hoặc giảm mà sau 1s</em></strong> con số mới thay đổi.</li>
<li>Nâng cao hơn chút là <strong><em>nếu click vào button increase number thì number chạy từ 0 cho tới 1 con số bất kỳ trong khoảng 1s rồi dừng lại.</em></strong></li>
</ul>
<p>Bình thường ở bài toán trên ta bấm nút thì ngay lập tức action đáp trả kết quả, nhưng trong thực tế có nhiều bài toán ko lập tức có thay đổi luôn điển hình như call api tới server để fetch data, thì phải mất 1 lúc kết quả mới được trả về. Hay như bài toán bấm nút thì sau 1s mới thay đổi → thì những điều này người ta gọi đó là side-effect .</p>
<p>Như đã biết thì Redux yêu cầu 1 object được trả ra phải là Plain object: {type: ACTION_TYPE, payload:params} và reducer phải là pure function,hay nói cách khác là hoàn toàn ko có side-effect.</p>
<p>Okay có lẽ bài thứ 2 về redux đến đây là dài rồi :))</p>
<p>Mình sẽ giải quyết vấn đề side-effect ở bài sau dùng Redux-middleware</p>
<p>Hẹn gặp lại các bạn về bài cuối của Redux.</p>
<blockquote>
<p><strong>Source code ví dụ trên:</strong> check out branch lesson_2</p>
</blockquote>
<p><a href="https://github.com/tridungbk2010/react-native-class" target="_blank" rel="noopener">https://github.com/tridungbk2010/react-native-class</a></p>
<span>Source: </span><a href="https://medium.com/innovatube/redux-v%E1%BB%9Bi-react-native-63ea25062084" target="_blank" title="https://medium.com/innovatube/redux-v%E1%BB%9Bi-react-native-63ea25062084" class="post-from">https://medium.com/innovatube/redux-v%E1%BB%9Bi-react-native-63ea25062084</a></div></div></article></div></section><div class="wrap"><footer><div class="paginator"><a href="/2017/09/Mot-bo-phim-hoat-hinh-gioi-thieu-ve-Redux.html" class="prev">NEXT</a><a href="/2017/09/Redux-that-la-don-gian-Phan-1.html" class="next">PREV</a></div><div class="copyright"><p>© 2017 - 2018 <a href="http://nthung2112.github.io">Hung Tan Nguyen</a>, unless otherwise noted.</p></div></footer></div><script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-41935289-1",'auto');ga('send','pageview');</script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/js/zoom.js"></script><script src="/js/insight.js"></script></body></html>
<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title> Bất ngờ về mảng trong javascript · Learn and Share</title><meta name="description" content="Bất ngờ về mảng trong javascript - Hung Tan Nguyen"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="rk-Nc1c8xi1CdZ0ZQIVV-ifsndGrHanIuSHI-yTHZYE"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="Bất ngờ về mảng trong javascript"><meta property="og:image"><meta property="og:description" content="Từng làm việc với một vài ngôn ngữ lập trình (Java, C, C++, C#, Objective-C, PHP), mỗi ngôn ngữ đều có cái hay riêng. Nhưng khi tiếp xúc với JavaScript (JS) lại tự dưng thấy yêu nó, yêu cái vẻ sexy và bất ngờ của nó. Ví như mảng trong JS rất đặc biệt và bất ngờ. Trong bài này sẽ viết lại một số điểm có thể là bất ngờ với một số người như mình.
1. Bạn lấy độ dài của mảng thế nào?Hôm qua ngồi code lúc lấy độ dài mảng bằng thuộc tính length mới thấy khác biệt với phần tử lấy được, làm mình hơi ngạc nhiên một chút. Ngồi đọc lại tài liệu JS, mới thấy dường như nó không có thuộc tính lưu trữ số lượng phần tử hiện hữu (khác undefined) trong nó thì phải? Hoặc ít nhất là mình chưa rõ. Có cao thủ nào chỉ giáo cho thì tốt. Các bạn có thể thử đoạn mã sau thì sẽ thấy rằng thuộc tính length của mảng sẽ bằng tổng của index lớn nhất của mảng với 1.
12345var arr = []arr[10] = 0arr[20] = 'index 20'arr['js'] = 'JavaScript'console.log(arr.length)"></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nthung2112" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item search-form-input"><div class="search-icon"><div class="search-icon__circle"></div><div class="search-icon__rectangle"></div></div></li></ul><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" placeholder="Type something..." class="ins-search-input"><span class="ins-close ins-selectable"><div class="close-icon"><div class="close-icon__x"></div><div class="close-icon__y"></div></div></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>var rootUrl = "/";
var contentUrl = '/content.json';
(function (window) {
  var INSIGHT_CONFIG = {
  TRANSLATION: {
      POSTS:'Posts',
      PAGES: 'Pages',
      CATEGORIES: 'Categories',
      TAGS: 'Tags',
      UNTITLED: '(Untitled)'
    },
    ROOT_URL: rootUrl,
    CONTENT_URL: contentUrl,
  };
  window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);</script></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">Bất ngờ về mảng trong javascript</h1><h2 class="post-subtitle"></h2><header class="post-info">Jan 10, 2017<div class="tags"><a href="/tags/javascript" class="tag-link">#javascript</a><a href="/tags/array" class="tag-link">#array</a></div><div class="fb-ir-time"><time datetime="2017-01-10T13:02:14.000Z" class="op-modified"></time><time datetime="2017-01-10T13:02:14.000Z" class="op-published"></time></div></header></div><div class="wrap"><div class="post-content"><p>Từng làm việc với một vài ngôn ngữ lập trình (Java, C, C++, C#, Objective-C, PHP), mỗi ngôn ngữ đều có cái hay riêng. Nhưng khi tiếp xúc với JavaScript (JS) lại tự dưng thấy yêu nó, yêu cái vẻ sexy và bất ngờ của nó. Ví như mảng trong JS rất đặc biệt và bất ngờ. Trong bài này sẽ viết lại một số điểm có thể là bất ngờ với một số người như mình.</p>
<h3 id="1-Ban-lay-do-dai-cua-mang-the-nao"><a href="#1-Ban-lay-do-dai-cua-mang-the-nao" class="headerlink" title="1. Bạn lấy độ dài của mảng thế nào?"></a>1. Bạn lấy độ dài của mảng thế nào?</h3><p>Hôm qua ngồi code lúc lấy độ dài mảng bằng thuộc tính <code>length</code> mới thấy khác biệt với phần tử lấy được, làm mình hơi ngạc nhiên một chút. Ngồi đọc lại tài liệu JS, mới thấy dường như nó không có thuộc tính lưu trữ số lượng phần tử hiện hữu (khác <code>undefined</code>) trong nó thì phải? Hoặc ít nhất là mình chưa rõ. Có cao thủ nào chỉ giáo cho thì tốt. Các bạn có thể thử đoạn mã sau thì sẽ thấy rằng thuộc tính <code>length</code> của mảng sẽ bằng tổng của index lớn nhất của mảng với 1.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []</span><br><span class="line">arr[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">arr[<span class="number">20</span>] = <span class="string">'index 20'</span></span><br><span class="line">arr[<span class="string">'js'</span>] = <span class="string">'JavaScript'</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.length)</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>Đoạn mã trên sẽ in ra độ dài của mảng arr là 21, tức là bằng index lớn nhất (20) cộng với 1. Hơi bất ngờ chút vì lúc đầu mình nghĩ nó trả ra là 3 (số phần tử khác <code>undefined</code>) .</p>
<p>Còn index không phải là dạng số tự nhiên thì có ý nghĩa gì không? Câu trả lời là không có ý nghĩa gì với thuộc tính length cả. Các bạn có thể xem trong ví dụ sau thì sẽ thấy độ dài <code>length</code> sẽ không phụ thuộc vào các index không thuộc dạng số tự nhiên.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []</span><br><span class="line">arr[<span class="number">-1</span>] = <span class="number">100</span></span><br><span class="line">arr[<span class="string">'js'</span>] = <span class="string">'JavaScript'</span></span><br><span class="line">arr[<span class="string">'me'</span>] = <span class="string">'Java Lover'</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.length)</span><br></pre></td></tr></table></figure>
<p>Đoạn mã này sẽ luôn in ra 0, chứng tỏ các index không số tự nhiên không ảnh hưởng gì tới thuộc tính <code>length</code>.</p>
<p>Vậy câu hỏi đặt ra là làm thế nào để lấy được số phần tử chính xác của một mảng?</p>
<p>Một cách làm đơn giản là duyệt mảng để đếm số lượng các phần tử hiện hữu của mảng đúng không? Thế nhưng mọi chuyện lại không đơn giản như ta nghĩ.</p>
<h3 id="2-Ban-duyet-mang-the-nao"><a href="#2-Ban-duyet-mang-the-nao" class="headerlink" title="2. Bạn duyệt mảng thế nào?"></a>2. Bạn duyệt mảng thế nào?</h3><p>Duyệt mảng trong JS cũng rất thú vị. Cách duyệt mảng thông thường với một mảng là lấy <code>length</code> của nó rồi duyệt từ đầu tới cuối như sau.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []</span><br><span class="line">arr[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">arr[<span class="number">20</span>] = <span class="string">'index 20'</span></span><br><span class="line">arr[<span class="string">'me'</span>] = <span class="string">'Java Lover'</span></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = arr.length; i &lt; len; i ++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i + <span class="string">": "</span> + arr[i])</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(arr[i]) != <span class="string">'undefined'</span>)</span><br><span class="line">        counter ++</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// hoặc như sau</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = arr.length; i &gt; <span class="number">0</span>; -- i) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i + <span class="string">": "</span> + arr[i])</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(arr[i]) != <span class="string">'undefined'</span>)</span><br><span class="line">        counter ++</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'The size of array: %d'</span>, counter)</span><br></pre></td></tr></table></figure>
<p>Kết quả đoạn mã trên sẽ trả ra các phần từ có index từ 0 ~ 9 và 11 ~ 19 là <code>undefined</code>, và counter sẽ là 2.<br>Như vậy là <code>counter</code> không cho ra kết quả chính xác và với một mảng lớn (1000 phần tử chẳng hạn) ta không thể duyệt theo cách này được. Vậy phải có cách khác, ta thử dùng hàm <code>forEach</code> của <code>Array</code> xem sao.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []</span><br><span class="line">arr[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">arr[<span class="number">20</span>] = <span class="string">'index 20'</span></span><br><span class="line">arr[<span class="string">'me'</span>] = <span class="string">'XXX Lover'</span></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">ele, i, array</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i + <span class="string">": "</span> + ele)</span><br><span class="line">    counter ++</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'The size of array: %d'</span>, counter)</span><br></pre></td></tr></table></figure>
<p>Cách này vẫn không ăn thua, kết quả lại như duyệt theo biến length. Thêm một cách duyệt khác là với lệnh <code>for in</code> như sau.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []</span><br><span class="line">arr[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">arr[<span class="number">20</span>] = <span class="string">'index 20'</span></span><br><span class="line">arr[<span class="string">'me'</span>] = <span class="string">'Java Lover'</span></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i + <span class="string">": "</span> + arr[i])</span><br><span class="line">    counter ++</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'The size of array: %d'</span>, counter)</span><br></pre></td></tr></table></figure>
<p>Đoạn này lại cho ra kết quả chính xác với từng phần tử được in ra và kích cỡ mảng trả về là 3.</p>
<p>Từ đây ta có thể thấy một điều là nên cẩn thận với biến length của mảng và nên chú ý cách duyệt mảng sao cho hợp lý. Với các dữ liệu liên tục ta hoàn toàn có thể duyệt theo biến <code>length</code> hay <code>Array.forEach</code>, nhưng dữ liệu cách đoạn và index không là số tự nhiên thì cần theo cách duyệt <code>for in</code>.</p>
<h3 id="3-Lam-sao-de-biet-mot-bien-la-mang"><a href="#3-Lam-sao-de-biet-mot-bien-la-mang" class="headerlink" title="3. Làm sao để biết một biến là mảng?"></a>3. Làm sao để biết một biến là mảng?</h3><p>Các bạn thử chạy đoạn mã sau xem thế nào.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []</span><br><span class="line">arr[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">arr[<span class="number">20</span>] = <span class="string">'index 20'</span></span><br><span class="line">arr[<span class="string">'me'</span>] = <span class="string">'JavaScript Lover'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Trust me, men, I'm an Array @@"</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Really, I have to check your DNA."</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"JavaScript checker: arr is "</span> + <span class="keyword">typeof</span>(arr))</span><br></pre></td></tr></table></figure>
<p>??? Mày là Object mà sao lại bảo là Array?<br>Không cháu là mảng mà, bác thử kiểm tra với cái máy này xem.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []</span><br><span class="line">arr[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">arr[<span class="number">20</span>] = <span class="string">'index 20'</span></span><br><span class="line">arr[<span class="string">'me'</span>] = <span class="string">'JavaScript Lover'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"JavaScript checker: Is arr an array ... "</span></span><br><span class="line">            + (<span class="built_in">Object</span>.prototype.toString.apply(arr) === <span class="string">"[object Array]"</span>))</span><br></pre></td></tr></table></figure>
<p>Ồ, ồ khỉ thật sao lại thế nhỉ? Đấy cháu dòng giống hoàng tộc nên phải ẩn mình thế đấy. Đúng là nhìn gái xinh thì dễ chứ nhìn gái tốt hay xấu phải có mẹo thật.</p>
<p>Để kết thúc bài, dành tặng cho các bạn beginner về NodeJS một đoạn mã nhỏ. Bài toán đặt ra là lấy nội dung 3 trang web (giao thức http) với địa chỉ nhập từ bàn phím theo dạng bất đồng bộ và in ra nội dung các trang đó theo đúng thứ tự đầu vào nhập từ bàn phím.<br>Chắc code này không phải giải thích nhiều các bạn cũng sẽ thấy có mối tương quan với nội dung mình vừa viết phía trên.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> bl = <span class="built_in">require</span>(<span class="string">'bl'</span>)</span><br><span class="line"><span class="keyword">var</span> data = []</span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i&lt; <span class="number">3</span>; i++)</span><br><span class="line">        <span class="built_in">console</span>.log(data[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">    http.get(process.argv[<span class="number">2</span> + index], <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        resp.pipe(bl(<span class="function"><span class="keyword">function</span>(<span class="params">err, buf</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err)</span><br><span class="line">               data[index] = err.toString()</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">               data[index] = buf.toString()</span><br><span class="line">            counter ++</span><br><span class="line">           <span class="keyword">if</span> (counter === <span class="number">3</span>)</span><br><span class="line">            printData()</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    loadData(i)</span><br></pre></td></tr></table></figure></p>
<p>Bài này tạm thời thế, khi nào gặp vấn đề lại update tiếp. Mong các cao thủ biết được gì thêm về mảng trong JavaScript thì chỉ giáo cho các hạ.</p>
</div></div></article></div></section><div class="wrap"><footer><div class="paginator"><a href="/2017/01/Javascript-Tim-hieu-ve-async-va-await-don-gian.html" class="prev">NEXT</a><a href="/2017/01/Javascript-Tim-hieu-ve-call-apply-va-bind.html" class="next">PREV</a></div><div class="copyright"><p>© 2017 - 2018 <a href="http://nthung2112.github.io">Hung Tan Nguyen</a>, unless otherwise noted.</p></div></footer></div><script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-41935289-1",'auto');ga('send','pageview');</script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/js/zoom.js"></script><script src="/js/insight.js"></script></body></html>
<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title> Tìm hiểu về từ khóa this · Learn and Share</title><meta name="description" content="Tìm hiểu về từ khóa this - Hung Tan Nguyen"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="rk-Nc1c8xi1CdZ0ZQIVV-ifsndGrHanIuSHI-yTHZYE"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="Tìm hiểu về từ khóa this"><meta property="og:image"><meta property="og:description" content="123456789101112// app.js// câu hỏi: Đoán kết quả lệnh (1) và lệnh (2)var obj = &amp;#123;    mMethod: function() &amp;#123;        console.log(this)    &amp;#125;&amp;#125;obj.mMethod(); // (1)var _mMethod = obj.mMethod;_mMethod();  // (2)
JavaScript (JS) là một ngôn ngữ lập trình khá linh hoạt và thú vị. Nhưng để có được điều đó nó cũng mang tới không ít phiền phức, dễ nhầm lẫn với những người không chuyên. Với những người mới sờ vào JS, họ thường nghĩ ngay chắc JS cũng lơ lớ như các ngôn ngữ lập trình khác như Java hay C#. Nhưng nhiều điểm ở JS lại khá khác với suy nghĩ ở các ngôn ngữ khác gây nên những hiểu lầm cho người mới vào nghề. Một trong những điểm dễ nhầm lẫn đó là biến this vì trong JS nó không chỉ đơn giản là đại diện cho đối tượng hiện thời như các ngôn ngữ lập trình hướng đối tượng khác. Cụ thể ra sao ta cùng nhau xem xét ở bài viết này.
Đọc tới đây chắc một số bạn biết về this rồi sẽ bật cười là sao lại viết là biến this. Nếu bạn nghĩ tới mức đó thì xin chúc mừng bạn, bạn đã đúng. this trong JS là một từ khoá chứ không phải là một biến nào cả. Bạn không thể gắn giá trị trực tiếp cho this được cũng như chẳng thể nào delete nó đi. Vậy từ khoá này có gì lại rắc rối vậy?"></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nthung2112" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item search-form-input"><div class="search-icon"><div class="search-icon__circle"></div><div class="search-icon__rectangle"></div></div></li></ul><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" placeholder="Type something..." class="ins-search-input"><span class="ins-close ins-selectable"><div class="close-icon"><div class="close-icon__x"></div><div class="close-icon__y"></div></div></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>var rootUrl = "/";
var contentUrl = '/content.json';
(function (window) {
  var INSIGHT_CONFIG = {
  TRANSLATION: {
      POSTS:'Posts',
      PAGES: 'Pages',
      CATEGORIES: 'Categories',
      TAGS: 'Tags',
      UNTITLED: '(Untitled)'
    },
    ROOT_URL: rootUrl,
    CONTENT_URL: contentUrl,
  };
  window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);</script></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">Tìm hiểu về từ khóa this</h1><h2 class="post-subtitle"></h2><header class="post-info">Jan 10, 2017<div class="tags"><a href="/tags/javascript" class="tag-link">#javascript</a><a href="/tags/this" class="tag-link">#this</a></div><div class="fb-ir-time"><time datetime="2017-01-10T12:55:00.000Z" class="op-modified"></time><time datetime="2017-01-10T12:55:00.000Z" class="op-published"></time></div></header></div><div class="wrap"><div class="post-content"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// câu hỏi: Đoán kết quả lệnh (1) và lệnh (2)</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.mMethod(); <span class="comment">// (1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _mMethod = obj.mMethod;</span><br><span class="line">_mMethod();  <span class="comment">// (2)</span></span><br></pre></td></tr></table></figure>
<p>JavaScript (JS) là một ngôn ngữ lập trình khá linh hoạt và thú vị. Nhưng để có được điều đó nó cũng mang tới không ít phiền phức, dễ nhầm lẫn với những người không chuyên. Với những người mới sờ vào JS, họ thường nghĩ ngay chắc JS cũng lơ lớ như các ngôn ngữ lập trình khác như Java hay C#. Nhưng nhiều điểm ở JS lại khá khác với suy nghĩ ở các ngôn ngữ khác gây nên những hiểu lầm cho người mới vào nghề. Một trong những điểm dễ nhầm lẫn đó là biến <code>this</code> vì trong JS nó không chỉ đơn giản là đại diện cho đối tượng hiện thời như các ngôn ngữ lập trình hướng đối tượng khác. Cụ thể ra sao ta cùng nhau xem xét ở bài viết này.</p>
<p>Đọc tới đây chắc một số bạn biết về <code>this</code> rồi sẽ bật cười là sao lại viết là biến <code>this</code>. Nếu bạn nghĩ tới mức đó thì xin chúc mừng bạn, bạn đã đúng. <strong>this</strong> trong JS <strong>là</strong> một <strong>từ khoá</strong> chứ không phải là một biến nào cả. Bạn không thể gắn giá trị trực tiếp cho <code>this</code> được cũng như chẳng thể nào <code>delete</code> nó đi. Vậy từ khoá này có gì lại rắc rối vậy?</p>
<a id="more"></a>
<h3 id="1-Ban-chat-cua-tu-khoa-this"><a href="#1-Ban-chat-cua-tu-khoa-this" class="headerlink" title="1. Bản chất của từ khoá this"></a>1. Bản chất của từ khoá <code>this</code></h3><p>Các đoạn mã của JavaScript được thực thi trong một ngữ cảnh nhất định (Execution Context). Các ngữ cảnh này lại được sắp xếp để thực hiện chương trình một cách tuần tự. Bạn có thể tưởng tượng thế này, mỗi ngữ cảnh chứa một số đoạn mã nhất định, và toàn chương trình của ta sắp xếp các ngữ cảnh này vào một ngăn xếp (stack). Sau đó các ngữ cảnh sẽ được gọi ra thực thi dần cho tới hết, tức là ngữ cảnh trên đỉnh của ngăn xếp sẽ chứa các đoạn mã sẵn sàng chạy. </p>
<p>Mỗi ngữ cảnh thực thi này có tương ứng một <code>ThisBinding</code> có giá trị không đổi đại diện cho ngữ cảnh thực thi đó. Và từ khoá <code>this</code> sẽ bằng giá trị <code>ThisBinding</code> trong ngữ cảnh đang thực thi hiện thời. Như vậy <code>this</code> sẽ đại diện cho ngữ cảnh đang thực thi và nó cần được đánh giá lại tham chiếu khi ngữ cảnh thực thi thay đổi.</p>
<p>Có 3 kiểu ngữ cảnh thực thi là toàn cục (global), eval và hàm (function). Global là ngữ cảnh ở mức trên cùng của toàn bộ chương trình, tức là nó chứa các đoạn mã không nằm trong function hay được gọi bởi eval và global sẽ là ngữ cảnh thực thi chương trình mặc định. Eval là ngữ cảnh chứa các mã được gọi bởi hàm <a href="https://developer.mozilla.org/vi/docs/Web/JavaScript/Reference/Global_Objects/eval" title="eval" target="_blank"><code>eval</code></a>. Còn function là các đoạn mã nằm trong một function nào đó. Ta sẽ xem chi tiết từng ngữ cảnh thực thi qua phần dưới đây.</p>
<h3 id="2-Cac-ngu-canh-thuc-thi"><a href="#2-Cac-ngu-canh-thuc-thi" class="headerlink" title="2. Các ngữ cảnh thực thi"></a>2. Các ngữ cảnh thực thi</h3><h4 id="2-1-Toan-cuc-Global"><a href="#2-1-Toan-cuc-Global" class="headerlink" title="2.1. Toàn cục - Global"></a>2.1. Toàn cục - Global</h4><p>Là ngữ cảnh thực thi nằm ở trên cùng của ngăn xếp ngữ cảnh, tức là ngữ cảnh đầu tiên thực thi chương trình. Ví dụ trong các mã thực thi phía máy khách trong trang web thì ngữ cảnh toàn cục này nằm ngay sau thẻ . Trong ngữ cảnh toàn cục này thì <code>ThisBinding</code> sẽ được thiết lập giá trị là đối tượng toàn cục (Global Object). Trong Nodejs thì đối tượng toàn cục là đối tượng toàn cục của Nodejs - khởi đầu là một đối tượng trống, trong trình duyệt thì nó là đối tượng window, nhưng cần chú ý là nếu ở trong chế độ <a href="https://developer.mozilla.org/vi/docs/Web/JavaScript/Reference/Strict_mode" title="strict mode" target="_blank"><code>strict mode</code></a> thì đối tượng toàn cục là <code>undefined</code>. Ta có thể cùng nhau xem xét ví dụ dưới đây.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">// đối tượng toàn cục trong ngữ cảnh toàn cục</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.mX = <span class="string">"I love JavaScript"</span> <span class="comment">// sử dụng đối tượng toàn cục</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.mX) <span class="comment">// in ra giá trị của thuộc tính mX</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">// in ra giá trị this hiện thời</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.mMethod() <span class="comment">// không còn là đối tượng toàn cục nữa</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-Goi-ma-Eval"><a href="#2-2-Goi-ma-Eval" class="headerlink" title="2.2. Gọi mã - Eval"></a>2.2. Gọi mã - Eval</h4><p>Với trường hợp sử dụng hàm <code>eval</code> ta phân làm 2 trường hợp.</p>
<h5 id="2-2-1-Goi-eval-truc-tiep"><a href="#2-2-1-Goi-eval-truc-tiep" class="headerlink" title="2.2.1. Gọi eval trực tiếp"></a>2.2.1. Gọi eval trực tiếp</h5><p>Gọi <code>eval</code> trực tiếp là ta gọi trực tiếp hàm <code>eval</code> như ví dụ bên dưới. Với trường hợp này thì <code>ThisBinding</code> sẽ được gắn giá trị là ngữ cảnh gốc của đoạn mã đó.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    callMe: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"callMe()"</span>)     <span class="comment">// đối tượng toàn cục</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"obj.callMe()"</span>) <span class="comment">// đối tượng obj</span></span><br></pre></td></tr></table></figure>
<h5 id="2-2-2-Goi-eval-gian-tiep"><a href="#2-2-2-Goi-eval-gian-tiep" class="headerlink" title="2.2.2. Gọi eval gián tiếp"></a>2.2.2. Gọi eval gián tiếp</h5><p>Gọi <code>eval</code> gián tiếp là ta gọi hàm <code>eval</code> thông qua một biến được gắn giá trị tương ứng như truyền hàm <code>eval</code> qua tham số hàm khác hoặc gắn nó với một biến nào đó. Với trường hợp này thì <code>ThisBinding</code> sẽ được gắn giá trị là ngữ toàn cục.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this trong mã thực thi của eval sẽ là đối tượng toàn cục</span></span><br><span class="line"><span class="keyword">this</span>.callMe = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"callMe in Global Object"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    callMe: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    _callMe: <span class="function"><span class="keyword">function</span>(<span class="params">_eval</span>) </span>&#123;</span><br><span class="line">        _eval(<span class="string">"console.log(this)"</span>)</span><br><span class="line">        _eval(<span class="string">"callMe()"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj._callMe(<span class="built_in">eval</span>) <span class="comment">// gọi gián tiếp eval qua tham số hàm</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mEval = <span class="built_in">eval</span> <span class="comment">// gắn eval với một biến</span></span><br><span class="line"></span><br><span class="line">mEval(<span class="string">"console.log(this)"</span>) <span class="comment">// gọi gián tiếp eval qua biến mEval</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-Ham-Function"><a href="#2-3-Ham-Function" class="headerlink" title="2.3. Hàm - Function"></a>2.3. Hàm - Function</h4><p>Khi hàm được gọi thì ngữ cảnh thực thi của nó sẽ phụ thuộc vào tham số đầu vào và ngữ cảnh gọi nó. Giả sử hàm của ta là F, với tham số là argumentsLits, và ngữ cảnh gọi F tương ứng với thisValue. Việc xác định <code>thisBinding</code> được xác định như sau:</p>
<blockquote>
<ol>
<li>If hàm trong chế độ strict, ThisBinding được gắn là thisValue.</li>
<li>Else if thisValue là null hoặc undefined, ThisBinding được gắn là đối tượng toàn cục.</li>
<li>Else if Type(thisValue) không là Object, ThisBinding được gắn là ToObject(thisValue).</li>
<li>Else ThisBinding được gắn là thisValue</li>
</ol>
</blockquote>
<p>Xem thêm về cách gắn <code>thisBinding</code> <a href="http://es5.github.io/#x10.4.3" title="Entering Function Code" target="_blank">ở đây</a>.</p>
<p>Để rõ ràng hơn ta xét một số tình huống cụ với việc gọi hàm.</p>
<h5 id="2-3-1-Goi-thong-qua-ngu-canh-toan-cuc"><a href="#2-3-1-Goi-thong-qua-ngu-canh-toan-cuc" class="headerlink" title="2.3.1. Gọi thông qua ngữ cảnh toàn cục"></a>2.3.1. Gọi thông qua ngữ cảnh toàn cục</h5><p>Trường hợp này <code>this</code> sẽ tham chiếu tới đối tượng toàn cục.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mMethod</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">// đối tượng toàn cục - global object</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mMethod();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    myMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">// đối tượng toàn cục</span></span><br><span class="line">        &#125;)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.myMethod()</span><br></pre></td></tr></table></figure></p>
<h5 id="2-3-2-Goi-thong-qua-doi-tuong"><a href="#2-3-2-Goi-thong-qua-doi-tuong" class="headerlink" title="2.3.2. Gọi thông qua đối tượng"></a>2.3.2. Gọi thông qua đối tượng</h5><p>Trường hợp này <code>this</code> sẽ tham chiếu tới đối tượng thisValue - đối tượng tương ứng chứa hàm.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tạo đối tượng obj</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    oMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'▼ oMethod'</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'▲  oMethod'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.mMethod()    <span class="comment">// this sẽ tương ứng với đối tượng obj</span></span><br><span class="line">obj[<span class="string">'oMethod'</span>]() <span class="comment">// this sẽ tương ứng với đối tượng obj</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Gắn mMethod cho đối tượng khác</span></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    mVal: <span class="string">"I'm obj1"</span></span><br><span class="line">&#125;</span><br><span class="line">obj1.mMethod = obj.mMethod;</span><br><span class="line"></span><br><span class="line">obj1.mMethod() <span class="comment">// this sẽ tương ứng với đối tượng obj1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Gọi qua khởi tạo đối tượng với từ khoá new</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyObject</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.mVal = val || <span class="string">"I xxx JS"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">this</span>.mMethod = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mObj1 = <span class="keyword">new</span> MyObject()</span><br><span class="line"><span class="keyword">var</span> mObj2 = <span class="keyword">new</span> MyObject(<span class="string">"I'm object 2"</span>)</span><br><span class="line"></span><br><span class="line">mObj1.mMethod() <span class="comment">// this sẽ tương ứng với đối tượng mObj1</span></span><br><span class="line">mObj2.mMethod() <span class="comment">// this sẽ tương ứng với đối tượng mObj2</span></span><br></pre></td></tr></table></figure>
<h5 id="2-3-3-Goi-thong-qua-mot-so-ham-dac-biet"><a href="#2-3-3-Goi-thong-qua-mot-so-ham-dac-biet" class="headerlink" title="2.3.3. Gọi thông qua một số hàm đặc biệt"></a>2.3.3. Gọi thông qua một số hàm đặc biệt</h5><p>Trong JavaScript có xây dựng sẵn một số hàm đặc biệt cho phép ta sử dụng <code>this</code> qua đối tượng đầu vào như:</p>
<ul>
<li>Function.prototype.apply(thisArg, argArray)</li>
<li>Function.prototype.call(thisArg[, arg1[ , arg2, …]])</li>
<li>Function.prototype.bind( thisArg[, arg1[ , arg2, …]])</li>
<li>Array.prototype.every(callback[, thisArg])</li>
<li>Array.prototype.some(callback[, thisArg])</li>
<li>Array.prototype.forEach(callback[, thisArg])</li>
<li>Array.prototype.map(callback[, thisArg])</li>
<li>Array.prototype.filter(callback[, thisArg])</li>
</ul>
<p>Bằng việc sử dụng các hàm trên ta có thể thể sử dụng <code>this</code> như là giá trị của đối tượng <code>thisArg</code>. Việc này rất tiện cho ta thay đổi <code>thisBinding</code> một cách chủ động. Ta có thể xem ví dụ sau:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params">firstName, lastName</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> firstName = firstName || <span class="string">"Vô"</span></span><br><span class="line">        <span class="keyword">var</span> lastName = lastName || <span class="string">"Danh"</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Hello "</span> + firstName + <span class="string">" "</span> + lastName)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    mVal: <span class="string">"I'm obj1"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.mMethod.apply(obj1) <span class="comment">// đối tượng obj1</span></span><br><span class="line"></span><br><span class="line">obj.mMethod.apply(obj1, [<span class="string">"Chí"</span>, <span class="string">"Phèo"</span>]) <span class="comment">// đối tượng obj1</span></span><br><span class="line"></span><br><span class="line">obj.mMethod.call(obj1, <span class="string">"Thị"</span>, <span class="string">"Nở"</span>) <span class="comment">// đối tượng obj1</span></span><br></pre></td></tr></table></figure>
<p>Đoạn mã trên sẽ in ra <code>this</code> là đối tượng <code>obj1</code> chứ không còn là <code>obj</code>, do <code>call</code> và <code>apply</code> đã đẩy trực tiếp <code>this</code> qua tham số đầu vào.</p>
<h3 id="3-Mot-so-truong-hop-de-nham-lan"><a href="#3-Mot-so-truong-hop-de-nham-lan" class="headerlink" title="3. Một số trường hợp dễ nhầm lẫn"></a>3. Một số trường hợp dễ nhầm lẫn</h3><h4 id="3-1-Goi-thong-qua-ngu-canh-khac"><a href="#3-1-Goi-thong-qua-ngu-canh-khac" class="headerlink" title="3.1. Gọi thông qua ngữ cảnh khác"></a>3.1. Gọi thông qua ngữ cảnh khác</h4><p>Ta xét trường hợp sau:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mVal: <span class="string">"Việt Nam"</span>,</span><br><span class="line">    </span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Hello "</span> + <span class="keyword">this</span>.mVal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> oMethod = obj.mMethod <span class="comment">// oMethod nằm trong ngữ cảnh toàn cục</span></span><br><span class="line"></span><br><span class="line">oMethod()</span><br></pre></td></tr></table></figure>
<p>Khi thực hiện đoạn mã trên kết quả in ra sẽ là <code>Hello undefined</code>, vì ta đã đẩy <code>this</code> ra đối tượng toàn cục mất rồi. Vậy làm sao để có được đúng kết quả là <code>Hello Việt Nam</code>? Để giải quyết được cái này ta sẽ sử dụng hàm <code>bind</code> để đẩy giá trị đối tượng <code>obj</code> cho biến <code>this</code> ở đây như sau:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mVal: <span class="string">"Việt Nam"</span>,</span><br><span class="line">    </span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Hello "</span> + <span class="keyword">this</span>.mVal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> oMethod = obj.mMethod.bind(obj) <span class="comment">// this trong oMethod sẽ bị ép thành giá trị obj</span></span><br><span class="line"></span><br><span class="line">oMethod()</span><br></pre></td></tr></table></figure>
<p>Vì sao lại là <code>bind</code> mà không phải là <code>call</code> hay <code>apply</code>? Vì <code>bind</code> sẽ giữ giá trị của <code>obj</code> để gọi nhiều lần chứ không chỉ gọi một lần như với <code>call</code> hay <code>apply</code>. Các bạn có thể đọc thêm <a href="https://dofeet.wordpress.com/2015/03/07/js-apply-call-va-bind-khac-gi-nhau" title="[JS] apply, call và bind khác gì nhau?" target="_blank">ở đây</a>.<br>Với trường hợp gọi một lần với <code>call</code> hoặc <code>apply</code> ta có thể cùng nhau xem ví dụ sau:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mVal: <span class="string">"Việt Nam"</span>,</span><br><span class="line">    </span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Hello "</span> + <span class="keyword">this</span>.mVal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    mVal: <span class="string">"Nhật Bản"</span>    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.mMethod.call(obj1) <span class="comment">// in ra là: Hello Nhật Bản</span></span><br></pre></td></tr></table></figure>
<p>Đoạn mã trên sẽ gọi hàm <code>mMethod</code> của đối tượng <code>obj</code> nhưng <code>this</code> trong hàm <code>mMethod</code> đã được ép thành đối tượng <code>obj1</code>. Với việc gọi 1 lần này ta có thể mượn phương thức <code>mMethod</code> của đối tượng <code>obj</code> để thực thi cho đối tượng <code>obj1</code> mà không cần tạo phương thức này cho đối tượng <code>obj1</code>. Cái này khá <em>kool</em> đúng hem ^.^</p>
<h4 id="3-2-Ham-phan-hoi-Callback"><a href="#3-2-Ham-phan-hoi-Callback" class="headerlink" title="3.2. Hàm phản hồi - Callback"></a>3.2. Hàm phản hồi - Callback</h4><p>Gọi thông qua hàm phản hồi cũng chính là một trường hợp của gọi thông qua ngữ cảnh khác vì hàm phản hồi được thực thi trong một ngữ cảnh khác. Ta xét ví dụ sau:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mVal: <span class="string">"Việt Nam"</span>,</span><br><span class="line">    </span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Hello "</span> + <span class="keyword">this</span>.mVal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    oMethod: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callback();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj1.oMethod(obj.mMethod)</span><br></pre></td></tr></table></figure>
<p>Vì gọi trong ngữ cảnh của đối tượng <code>obj1</code> nên <code>mMethod</code> lúc này sẽ lấy giá trị cho <code>this</code> là <code>obj1</code> chứ không còn là <code>obj</code> nữa. Vẫn làm tương tự như phần 3.1, ta sử dụng <code>bind</code> để đẩy giá trị ngữ cảnh <code>obj</code> vào cho <code>mMethod</code> như sau:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mVal: <span class="string">"Việt Nam"</span>,</span><br><span class="line">    </span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Hello "</span> + <span class="keyword">this</span>.mVal)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">    oMethod: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callback();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj1.oMethod(obj.mMethod.bind(obj))</span><br></pre></td></tr></table></figure>
<p>Hoàn hảo, đoạn mã trên đã cho ta kết quả như mong muốn. Đọc tới đây, nhiều bạn thắc mắc sao cần gì phải tách ra 3.1 với 3.2 làm gì cho rắc rối? Tách ra thế này có lợi thế là không bị vướng quá nhiều vấn đề vào cả một cụm, ví hàm phản hồi là một trường hợp rất hay được sử dụng khi lập trình với JavaScript. Ví dụ như trong Nodejs, hàm phản hồi là một thành phần quan trọng, một khái niệm cơ bản nhất cần nắm được để có thể lập trình với Nodejs. Hay nhiều bạn có sử dụng JQuery để làm phía trình duyệt, các sự kiện <code>click</code> vào một nút nào đó chẳng hạn, các bạn đều sử dụng luôn được từ khoá <code>this</code> ngay trong hàm phản hồi của các nút đó mà không cần quan tâm tới ngữ cảnh thực thi hiện tại là gì cả. Để làm được việc đó, jQuery đều đã <code>bind</code> các nút tương ứng đó cho các hàm phản hồi cho các bạn rồi đó.</p>
<h4 id="3-3-Ham-long-nhau"><a href="#3-3-Ham-long-nhau" class="headerlink" title="3.3. Hàm lồng nhau"></a>3.3. Hàm lồng nhau</h4><p>Ta cùng xét sự nhập nhằng qua ví dụ sau.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mVal: <span class="string">"Việt Nam"</span>,</span><br><span class="line">    </span><br><span class="line">    oVal: &#123;</span><br><span class="line">        oMethod: <span class="function"><span class="keyword">function</span>(<span class="params">callMe</span>) </span>&#123;</span><br><span class="line">            callMe()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.oVal.oMethod(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Hello "</span> + <span class="keyword">this</span>.mVal)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.mMethod() <span class="comment">// in ra là: Hello undefined</span></span><br></pre></td></tr></table></figure>
<p>Với đoạn mã trên ta mong muốn nó in ra được giá chỉ của biến mVal trong đối tượng obj nhưng thực tế nó sẽ in ra <code>Hello undefined</code>? Nguyên nhân là ngữ cảnh của thực thi ở <code>console.log</code> lúc này là đối tượng <code>oVal</code> mất rồi. Vậy làm sao ta có thể sử dụng được biến <code>mVal</code> của đối tượng <code>obj</code>? Muốn làm được như vậy ta cần lấy được ngữ cảnh thực thi của đối tượng <code>obj</code> bằng cách nhớ lại ngữ cảnh thực thi thông qua một biến trung gian và sử dụng biến này với ngữ cảnh của đối tượng <code>oVal</code>. Ví dụ dưới đây sẽ thực hiện theo ý tưởng này:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    mVal: <span class="string">"Việt Nam"</span>,</span><br><span class="line">    </span><br><span class="line">    oVal: &#123;</span><br><span class="line">        oMethod: <span class="function"><span class="keyword">function</span>(<span class="params">callMe</span>) </span>&#123;</span><br><span class="line">            callMe()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    mMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _this = <span class="keyword">this</span>; <span class="comment">// nhớ ngữ cảnh thực thi của obj trong biến _this</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.oVal.oMethod(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Hello "</span> + _this.mVal) <span class="comment">// gọi tới ngữ cảnh thực thi của obj</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.mMethod()</span><br></pre></td></tr></table></figure>
<h3 id="4-Ket-luan"><a href="#4-Ket-luan" class="headerlink" title="4. Kết luận"></a>4. Kết luận</h3><p>Từ khoá <code>this</code> hơi rắc rối một chút nên khi lập trình ta cần chú ý tới ngữ cảnh thực thi để sử dụng từ khoá này cho hiệu quả và đúng đắn dựa vào ngữ cảnh gọi nó và kiểu của ngữ cảnh thực thi. Ta cũng cần chú ý hơn ở những đoạn sử dụng tới hàm phản hồi hay hàm lồng nhau. Ngoài ra ta có thể thay đổi được ngữ cảnh thực thi của một đối tượng bằng cách sử dụng <code>call</code>, <code>apply</code> hoặc <code>bind</code> như đã mô tả phía trên. </p>
<p>Về việc sử dụng Call, Apply và Bind cụ thể ra sao thì các bạn đọc thêm ở <a href="https://dofeet.wordpress.com/2015/03/07/js-apply-call-va-bind-khac-gi-nhau/" title="[JS] apply, call và bind khác gì nhau?" target="_blank" rel="noopener">bài viết này</a>.</p>
<p>Ngoài ra, bạn có thể tham khảo về chuẩn ECMAScript 5.1 <a href="http://es5.github.io" title="Entering Function Code" target="_blank">ở đây</a>.</p>
</div></div></article></div></section><div class="wrap"><footer><div class="paginator"><a href="/2017/01/Javascript-Tim-hieu-ve-call-apply-va-bind.html" class="prev">NEXT</a></div><div class="copyright"><p>© 2017 - 2019 <a href="http://nthung2112.github.io">Hung Tan Nguyen</a>, unless otherwise noted.</p></div></footer></div><script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-41935289-1",'auto');ga('send','pageview');</script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/js/zoom.js"></script><script src="/js/insight.js"></script></body></html>
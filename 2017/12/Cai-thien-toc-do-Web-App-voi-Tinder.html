<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title> Cải thiện tốc độ Web App với Tinder · Learn and Share</title><meta name="description" content="Cải thiện tốc độ Web App với Tinder - Hung Tan Nguyen"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="rk-Nc1c8xi1CdZ0ZQIVV-ifsndGrHanIuSHI-yTHZYE"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="Cải thiện tốc độ Web App với Tinder"><meta property="og:image" content="https://cdn-images-1.medium.com/max/2000/1*j2n8zzLYxoum1ob-1mjUcw.png"><meta property="og:description" content="Tinder recently swiped right on the web. Their new responsive Progressive Web App — Tinder Online — is available to 100% of users on desktop and mobile, employing techniques for JavaScript performance optimization, Service Workers for network resilience and Push Notifications for chat engagement. Today we’ll walk through some of their web perf learnings."></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nthung2112" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item search-form-input"><div class="search-icon"><div class="search-icon__circle"></div><div class="search-icon__rectangle"></div></div></li></ul><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" placeholder="Type something..." class="ins-search-input"><span class="ins-close ins-selectable"><div class="close-icon"><div class="close-icon__x"></div><div class="close-icon__y"></div></div></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>var rootUrl = "/";
var contentUrl = '/content.json';
(function (window) {
  var INSIGHT_CONFIG = {
  TRANSLATION: {
      POSTS:'Posts',
      PAGES: 'Pages',
      CATEGORIES: 'Categories',
      TAGS: 'Tags',
      UNTITLED: '(Untitled)'
    },
    ROOT_URL: rootUrl,
    CONTENT_URL: contentUrl,
  };
  window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);</script></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">Cải thiện tốc độ Web App với Tinder</h1><h2 class="post-subtitle"></h2><header class="post-info">Dec 25, 2017<div class="tags"><a href="/tags/javascript" class="tag-link">#javascript</a></div><div class="fb-ir-time"><time dateTime="2017-12-25T11:29:59.000Z" class="op-modified"></time><time dateTime="2017-12-25T11:29:59.000Z" class="op-published"></time></div></header></div><div class="post-banner"><img src="https://cdn-images-1.medium.com/max/2000/1*j2n8zzLYxoum1ob-1mjUcw.png"></div><div class="wrap"><div class="post-content"><p>Tinder recently swiped right on the web. Their new responsive <a href="https://developers.google.com/web/progressive-web-apps/" target="_blank" rel="noopener">Progressive Web App</a> — <a href="https://tinder.com" target="_blank" rel="noopener">Tinder Online</a> — is available to 100% of users on desktop and mobile, employing techniques for <a href="https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e" target="_blank" rel="noopener">JavaScript performance optimization</a>, <a href="https://developers.google.com/web/fundamentals/primers/service-workers/" target="_blank" rel="noopener">Service Workers</a> for network resilience and <a href="https://developers.google.com/web/fundamentals/push-notifications/" target="_blank" rel="noopener">Push Notifications</a> for chat engagement. Today we’ll walk through some of their web perf learnings.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*1HmfQhMAQL8kukiNtMZRjA.png" alt=""><br><a id="more"></a></p>
<h3 id="Journey-to-a-Progressive-Web-App"><a href="#Journey-to-a-Progressive-Web-App" class="headerlink" title="Journey to a Progressive Web App"></a>Journey to a Progressive Web App</h3><p>Tinder Online started with the goal of getting adoption in new markets, striving to hit feature parity with V1 of Tinder’s experience on other platforms.</p>
<p><strong>The MVP for the PWA took 3 months to implement using</strong> <a href="https://reactjs.com" target="_blank" rel="noopener"><strong>React</strong></a> <strong>as their UI library and</strong> <a href="https://redux.js.org" target="_blank" rel="noopener"><strong>Redux</strong></a> <strong>for state management.</strong> The result of their efforts is a PWA that delivers the core Tinder experience in <strong>10%</strong> of the data-investment costs for someone in a data-costly or data-scarce market:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*cqYbI-L0zukfYS0ZAwUtqA.png" alt="">Comparing the data-investment for Tinder Online vs the native apps. It’s important to note that this isn’t comparing apples to apples, however. The PWA loads code for new routes on demand, and the cost of additional code is amortized over the lifetime of the application. Subsequent navigations still don’t cost as much data as the download of the app.</p>
<p>Early signs show good swiping, messaging and session length compared to the native app. With the PWA:</p>
<ul>
<li>Users swipe more on web than their native apps</li>
<li>Users message more on web than their native apps</li>
<li>Users purchase on par with native apps</li>
<li>Users edit profiles more on web than on their native apps</li>
<li>Session times are longer on web than their native apps</li>
</ul>
<h3 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h3><p>The mobile devices Tinder Online’s users most commonly access their web experience with include:</p>
<ul>
<li>Apple iPhone &amp; iPad</li>
<li>Samsung Galaxy S8</li>
<li>Samsung Galaxy S7</li>
<li>Motorola Moto G4</li>
</ul>
<p>Using the <a href="https://developers.google.com/web/tools/chrome-user-experience-report/" target="_blank" rel="noopener">Chrome User Experience report</a> (CrUX), we’re able to learn that the majority of users accessing the site are on a 4G connection:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*gO4n3kBs5Zy1eAkMQqxx7w.png" alt=""></p>
<p><em>Note: Rick Viscomi recently covered CrUX on</em> <a href="https://calendar.perfplanet.com/2017/finding-your-competitive-edge-with-the-chrome-user-experience-report/" target="_blank" rel="noopener"><em>PerfPlanet</em></a> <em>and Inian Parameshwaran covered</em> <a href="https://calendar.perfplanet.com/2017/introducing-ruxt-visualizing-real-user-experience-data-for-1-2-million-websites/" target="_blank" rel="noopener"><em>rUXt</em></a> <em>for better visualizing this data for the top 1M sites.</em></p>
<p>Testing the new experience on <a href="https://www.webpagetest.org/result/171224_ZB_13cef955385ddc4cae8847f451db8403/" target="_blank" rel="noopener">WebPageTest</a> and <a href="https://github.com/GoogleChrome/lighthouse/" target="_blank" rel="noopener">Lighthouse</a> (using the Galaxy S7 on 4G) we can see that they’re able to load and get interactive in <strong>under 5 seconds</strong>:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*e-EHgbBBNXyuce8Z836Sgg.png" alt=""></p>
<p>There is of course <strong>lots of room</strong> to improve this further on <a href="https://www.webpagetest.org/lighthouse.php?test=171224_NP_f7a489992a86a83b892bf4b4da42819d&amp;run=3" target="_blank" rel="noopener">median mobile hardware</a> (like the Moto G4), which is more CPU constrained:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*VJ3ZbSQtIjxsIW8Feuiejw.png" alt=""></p>
<p>Tinder are hard at work on optimizing their experience and we look forward to hearing about their work on web performance in the near future.</p>
<h3 id="Performance-Optimization"><a href="#Performance-Optimization" class="headerlink" title="Performance Optimization"></a>Performance Optimization</h3><p>Tinder were able to improve how quickly their pages could load and become interactive through a number of techniques. They implemented route-based code-splitting, introduced performance budgets and long-term asset caching.</p>
<h3 id="Route-level-code-splitting"><a href="#Route-level-code-splitting" class="headerlink" title="Route-level code-splitting"></a>Route-level code-splitting</h3><p>Tinder initially had large, monolithic JavaScript bundles that delayed how quickly their experience could get interactive. These bundles contained code that wasn’t immediately needed to boot-up the core user experience, so it could be broken up using <a href="https://webpack.js.org/guides/code-splitting/" target="_blank" rel="noopener">code-splitting</a>. <strong>It’s generally useful to only ship code users need upfront and lazy-load the rest as needed</strong>.</p>
<p>To accomplish this, Tinder used <a href="https://reacttraining.com/react-router/" target="_blank" rel="noopener">React Router</a> and <a href="https://github.com/thejameskyle/react-loadable" target="_blank" rel="noopener">React Loadable</a>. As their application centralized all their route and rendering info a configuration base, they found it straight-forward to implement code splitting at the top level.</p>
<p><strong>In summary:</strong></p>
<p>React Loadable is a small library by James Kyle to make component-centric <strong>code splitting</strong> easier in React. <strong>Loadable</strong> is a higher-order component (a function that creates a component) which makes it easy to <strong>split</strong> up bundles at a component level.</p>
<p>Let’s say we have two components “A” and “B”. Before code-splitting, Tinder statically imported everything (A, B, etc) into their main bundle. This was inefficient as we didn’t need both A and B right away:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*DoTby4l_-A3TNdiUSZ0LmA.png" alt=""></p>
<p>After adding code-splitting, components A and B could be loaded as and when needed. Tinder did this by introducing React Loadable, <a href="https://webpack.js.org/guides/code-splitting/#dynamic-imports" target="_blank" rel="noopener">dynamic import()</a> and <a href="https://medium.com/faceyspacey/how-to-use-webpacks-new-magic-comment-feature-with-react-universal-component-ssr-a38fd3e296a" target="_blank" rel="noopener">webpack’s magic comment syntax</a> (for naming dynamic chunks) to their JS:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*aPY-1uGEvPV1dNKrrD8z4Q.png" alt=""></p>
<p>For “vendor” (library) chunking, Tinder used the webpack <a href="https://webpack.js.org/plugins/commons-chunk-plugin/" target="_blank" rel="noopener"><strong>CommonsChunkPlugin</strong></a> to move commonly used libraries across routes up to a single bundle file that could be cached for longer periods of time:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*R-kXPcn937BNoFXLukPJPg.png" alt=""></p>
<p>Next, Tinder used <a href="https://github.com/thejameskyle/react-loadable#loadablecomponentpreload" target="_blank" rel="noopener">React Loadable’s preload support</a> to preload potential resources for the next page on control component:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*G2JvbNCsm4eBXbGgyW6OmA.png" alt=""></p>
<p>Tinder also used <a href="https://developers.google.com/web/fundamentals/primers/service-workers/" target="_blank" rel="noopener">Service Workers</a> to precache all their route level bundles and include routes that users are most likely to visit in the main bundle without code-splitting. They’re of course also using common optimizations like JavaScript minification via UglifyJS:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">      parallel: <span class="literal">true</span>,</span><br><span class="line">      compress: &#123;</span><br><span class="line">        warnings: <span class="literal">false</span>,</span><br><span class="line">        screw_ie8: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      sourceMap: SHOULD_SOURCEMAP</span><br><span class="line">    &#125;),</span><br></pre></td></tr></table></figure>
<h4 id="Impact"><a href="#Impact" class="headerlink" title="Impact"></a>Impact</h4><p>After introducing route-based code-splitting their main bundle sizes went down from 166KB to 101KB and DCL improved from 5.46s to 4.69s:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*1Tt8bnnkyIi8aEw0BjRgMw.png" alt=""></p>
<h3 id="Long-term-asset-caching"><a href="#Long-term-asset-caching" class="headerlink" title="Long-term asset caching"></a>Long-term asset caching</h3><p>Ensuring <a href="https://webpack.js.org/guides/caching/" target="_blank" rel="noopener">long-term caching</a> of static resources output by webpack benefits from using [chunkhash] to add a cache-buster to each file.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*nofQB3Q-8IUo9f1Eipd0xw.png" alt=""></p>
<p>Tinder were using a number of open-source (vendor) libraries as part of their dependency tree. Changes to these libraries would originally cause the [chunkhash] to change and invalidate their cache. To address this, Tinder began defining a <a href="https://gist.github.com/tinder-rhsiao/89cd682c34d1e1307111b091801e6fe5]%28https://gist.github.com/tinder-rhsiao/89cd682c34d1e1307111b091801e6fe5" target="_blank" rel="noopener">whitelist of external dependencies</a> and splitting out their webpack manifest from the main chunk to improve caching. The bundle size is now about 160KB for both chunks.</p>
<h3 id="Preloading-late-discovered-resources"><a href="#Preloading-late-discovered-resources" class="headerlink" title="Preloading late-discovered resources"></a>Preloading late-discovered resources</h3><p>As a refresher, <a href="https://developers.google.com/web/fundamentals/performance/resource-prioritization" target="_blank" rel="noopener"><link rel="preload"></a> is a declarative instruction to the browser to load critical, late-discovered resources earlier on. In single-page applications, these resources can sometimes be JavaScript bundles.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*CaObLc_tGJvnllyV3CGD5w.png" alt=""></p>
<p>Tinder implemented support for to preload their critical JavaScript/webpack bundles that were important for the core experience. This reduced load time by 1s and first paint from 1000ms to about 500ms.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*AtzElAKy_pCvRjZN__YSsQ.png" alt=""></p>
<h3 id="Performance-budgets"><a href="#Performance-budgets" class="headerlink" title="Performance budgets"></a>Performance budgets</h3><p>Tinder adopted <strong>performance budgets</strong> for helping them hit their performance goals on mobile. As Alex Russell noted in “<a href="https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/" target="_blank" rel="noopener">Can you afford it?: real-world performance budgets</a>”, you have a limited headroom to deliver an experience when considering slow 3G connections being used on median mobile hardware.</p>
<p>To get and stay interactive quickly, Tinder enforced a budget of ~155KB for their main and vendor chunks, asynchronous (lazily loaded) chunks are ~55KB and other chunks are ~35KB. CSS has a limit of 20KB. This was crucial to ensuring they were able to avoid regressing on performance.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*OgDLsMxsy6IO79NmjQtcng.png" alt=""></p>
<h3 id="Webpack-Bundle-Analysis"><a href="#Webpack-Bundle-Analysis" class="headerlink" title="Webpack Bundle Analysis"></a>Webpack Bundle Analysis</h3><p><a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener">Webpack Bundle Analyzer</a> allows you to discover what the dependency graph for your JavaScript bundles looks like so you can discover whether there’s low-hanging fruit to optimize.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*qsiUA0G50a4p3y2e4p7CyA.png" alt=""></p>
<p>Tinder used Webpack Bundle Analyzer to discover areas for improvement:</p>
<ul>
<li><strong>Polyfills:</strong> Tinder are targeting modern browsers with their experience but also support IE11 and Android 4.4 and above. <strong>To keep polyfills &amp; transpiled code to a minimum, they use For polyfills, they use</strong> <a href="https://github.com/babel/babel-preset-env" target="_blank" rel="noopener"><strong>babel-preset-env</strong></a> <strong>and</strong> <a href="https://github.com/zloirock/core-js" target="_blank" rel="noopener"><strong>core-js</strong></a><strong>.</strong></li>
<li><strong>Slimmer use of libraries:</strong> Tinder replaced <a href="https://github.com/localForage/localForage" target="_blank" rel="noopener">localForage</a> with direct use of IndexedDB.</li>
<li><strong>Better splitting:</strong> Split out components from the main bundles which were not required for first paint/interactive</li>
<li><strong>Code re-use:</strong> Created asynchronous common chunks to abstract chunks used more than three times from children.</li>
<li><strong>CSS:</strong> Tinder also removed <a href="https://www.smashingmagazine.com/2015/08/understanding-critical-css/" target="_blank" rel="noopener">critical CSS</a> from their core bundles (as they had shifted to server-side rendering and delivered this CSS anyway)</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*ZL3i2BRHo8Sq_dv1NyA8Dw.png" alt=""></p>
<p>Using bundle analysis led to also also taking advantage of Webpack’s <a href="https://github.com/lodash/lodash-webpack-plugin" target="_blank" rel="noopener">Lodash Module Replacement Plugin</a>. The plugin creates smaller Lodash builds by replacing feature sets of modules with noop, identity or simpler alternatives:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*of2Mv5ypTySRpTZQZVRj7A.png" alt=""></p>
<p>Webpack Bundle Analyzer can be integrated into your Webpack config. Tinder’s setup for it looks like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">      <span class="keyword">new</span> BundleAnalyzerPlugin(&#123;</span><br><span class="line">        analyzerMode: <span class="string">'server'</span>,</span><br><span class="line">        analyzerPort: <span class="number">8888</span>,</span><br><span class="line">        reportFilename: <span class="string">'report.html'</span>,</span><br><span class="line">        openAnalyzer: <span class="literal">true</span>,</span><br><span class="line">        generateStatsFile: <span class="literal">false</span>,</span><br><span class="line">        statsFilename: <span class="string">'stats.json'</span>,</span><br><span class="line">        statsOptions: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br></pre></td></tr></table></figure>
<p>The majority of the JavaScript left is the main chunk which is trickier to split out without architecture changes to Redux Reducer and Saga Register.</p>
<h3 id="CSS-Strategy"><a href="#CSS-Strategy" class="headerlink" title="CSS Strategy"></a>CSS Strategy</h3><p>Tinder are using <a href="https://acss.io/" target="_blank" rel="noopener">Atomic CSS</a> to create highly reusable CSS styles. All of these atomic CSS styles are inlined in the initial paint and some of the rest of the CSS is loaded in the stylesheet (including animation or base/reset styles). Critical styles have a maximum size of 20KB gzipped, with recent builds coming in at a lean &lt; 11KB.</p>
<p>Tinder use <a href="http://cssstats.com/stats?url=https%253A%252F%252Ftinder.com&amp;ua=Browser%2520Default%0A" target="_blank" rel="noopener">CSS stats</a> and Google Analytics for each release to keep track of what has changed. Before Atomic CSS was being used, average page load times were ~6.75s. After they were ~5.75s.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*Uv_at6Xs7QYHZJ0iy8c7GQ.png" alt=""></p>
<p>Tinder Online also uses the PostCSS <a href="https://twitter.com/autoprefixer" target="_blank" rel="noopener">Autoprefixer plugin</a> to parse CSS and add vendor prefixes based on rules from <a href="http://caniuse.com" target="_blank" rel="noopener">Can I Use</a>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.LoaderOptionsPlugin(&#123;</span><br><span class="line">    options: &#123;</span><br><span class="line">    context: paths.basePath,</span><br><span class="line">    output: &#123; <span class="attr">path</span>: <span class="string">'./'</span> &#125;,</span><br><span class="line">    minimize: <span class="literal">true</span>,</span><br><span class="line">    postcss: [</span><br><span class="line">        autoprefixer(&#123;</span><br><span class="line">        browsers: [</span><br><span class="line">            <span class="string">'last 2 versions'</span>,</span><br><span class="line">            <span class="string">'not ie &lt; 11'</span>,</span><br><span class="line">            <span class="string">'Safari &gt;= 8'</span></span><br><span class="line">        ]</span><br><span class="line">        &#125;)</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<h3 id="Runtime-performance"><a href="#Runtime-performance" class="headerlink" title="Runtime performance"></a>Runtime performance</h3><h4 id="Deferring-non-critical-work-with-requestIdleCallback"><a href="#Deferring-non-critical-work-with-requestIdleCallback" class="headerlink" title="Deferring non-critical work with requestIdleCallback()"></a>Deferring non-critical work with requestIdleCallback()</h4><p>To improve runtime performance, Tinder opted to use <a href="https://developers.google.com/web/updates/2015/08/using-requestidlecallback" target="_blank" rel="noopener">requestIdleCallback()</a> to defer non-critical actions into idle time.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requestIdleCallback(myNonEssentialWork);</span><br></pre></td></tr></table></figure>
<p>This included work like instrumentation beacons. They also simplified some HTML composite layers to reduce paint count while swiping.</p>
<p><strong>Using requestIdleCallback() for their instrumentation beacons while swiping:</strong></p>
<p>before..</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*oHJ8IjCs7AKdCrt9b28ZPw.png" alt=""></p>
<p>and after..</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*UTQuSSp7MGMY06mwYtQmaw.png" alt=""></p>
<h3 id="Dependency-upgrades"><a href="#Dependency-upgrades" class="headerlink" title="Dependency upgrades"></a>Dependency upgrades</h3><p><strong>Webpack 3 + Scope Hoisting</strong></p>
<p>In older versions of webpack, when bundling each module in your bundle would be wrapped in individual function closures. These wrapper functions made it slower for your JavaScript to execute in the browser. <a href="https://medium.com/webpack/webpack-3-official-release-15fd2dd8f07b" target="_blank" rel="noopener">Webpack 3</a> introduced “scope hoisting” — the ability to concatenate the scope of all your modules into one closure and allow for your code to have a faster execution time in the browser. It accomplishes this with the Module Concatenation plugin:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.ModuleConcatenationPlugin()</span><br></pre></td></tr></table></figure>
<p><strong>Webpack 3’s scope hoisting improved Tinder’s initial JavaScript parsing time for vendor chunk by 8%.</strong></p>
<p><strong>React 16</strong></p>
<p>React 16 introduced improvements that <a href="https://reactjs.org/blog/2017/09/26/react-v16.0.html#reduced-file-size" target="_blank" rel="noopener">decreased React’s bundle size</a> compared to previous versions. This was in part due to better packaging (using Rollup) as well as removing now unused code.</p>
<p><strong>By updating from React 15 to React 16, Tinder reduced the total gzipped size of their vendor chunk by ~7%.</strong></p>
<p>The size of react + react-dom used to be~50KB gzipped and is now just ~<strong>35KB</strong>. Thanks to <a href="https://twitter.com/dan_abramov" target="_blank" rel="noopener">Dan Abramov</a>, <a href="https://twitter.com/trueadm" target="_blank" rel="noopener">Dominic Gannaway</a> and <a href="https://twitter.com/natehunzaker" target="_blank" rel="noopener">Nate Hunzaker</a> who were instrumental in trimming down React 16’s bundle size.</p>
<h3 id="Workbox-for-network-resilience-and-offline-asset-caching"><a href="#Workbox-for-network-resilience-and-offline-asset-caching" class="headerlink" title="Workbox for network resilience and offline asset caching"></a>Workbox for network resilience and offline asset caching</h3><p>Tinder also use the <a href="https://developers.google.com/web/tools/workbox/get-started/webpack" target="_blank" rel="noopener">Workbox Webpack plugin</a> for caching both their <a href="https://developers.google.com/web/fundamentals/architecture/app-shell" target="_blank" rel="noopener">Application Shell</a> and their core static assets like their main, vendor, manifest bundles and CSS. This enables network resilience for repeat visits and ensures that the application starts-up more quickly when a user returns for subsequent visits.</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*yXpAzyA1ODPk2OSOTA6Lhg.png" alt=""></p>
<h3 id="Opportunities"><a href="#Opportunities" class="headerlink" title="Opportunities"></a>Opportunities</h3><p>Digging into the Tinder bundles using <a href="https://www.npmjs.com/package/source-map-explorer" target="_blank" rel="noopener">source-map-explorer</a> (another bundle analysis tool), there are additional opportunities for reducing payload size. Before logging in, components like Facebook Photos, notifications, messaging and captchas are fetched. Moving these away from the critical path could save up to 20% off the main bundle:</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*G1nq7BNZPEo2mFr_my5zjA.png" alt=""></p>
<p>Another dependency in the critical path is a 200KB Facebook SDK script. Dropping this script (which could be lazily loaded when needed) could shave 1 second off initial loading time.</p>
<h3 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h3><p>Tinder are still iterating on their Progressive Web App but have already started to see positive results from the fruits of their labor. Check out Tinder.com and stay tuned for more progress in the near future!</p>
<p><em>With thanks and congrats to Roderick Hsiao, Jordan Banafsheha, and Erik Hellenbrand for launching Tinder Online and their input to this article. Thanks to Cheney Tsai for his review.</em></p>
<p><strong>Related reading:</strong></p>
<ul>
<li><a href="https://medium.com/dev-channel/a-pinterest-progressive-web-app-performance-case-study-3bd6ed2e6154" target="_blank" rel="noopener">A Pinterest PWA performance case study</a></li>
<li><a href="https://medium.com/dev-channel/treebo-a-react-and-preact-progressive-web-app-performance-case-study-5e4f450d5299" target="_blank" rel="noopener">A Treebo React &amp; Preact performance case study</a></li>
<li><a href="https://medium.com/@paularmstrong/twitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3" target="_blank" rel="noopener">Twitter Lite and high-performance PWAs at scale</a></li>
</ul>
<p>This article was cross-posted from <a href="https://calendar.perfplanet.com/2017/a-tinder-progressive-web-app-performance-case-study/" target="_blank" rel="noopener">Performance Planet</a>. If you’re new to React, I’ve found <a href="https://goo.gl/G1WGxU" target="_blank" rel="noopener">React for Beginners</a> a comprehensive starting point.</p>
<span>Source: </span><a href="https://medium.com/@addyosmani/a-tinder-progressive-web-app-performance-case-study-78919d98ece0" target="_blank" title="https://medium.com/@addyosmani/a-tinder-progressive-web-app-performance-case-study-78919d98ece0" class="post-from">https://medium.com/@addyosmani/a-tinder-progressive-web-app-performance-case-study-78919d98ece0</a></div></div></article></div></section><div class="wrap"><footer><div class="paginator"><a href="/2018/01/Kien-thuc-cho-phong-van-Javascript-developer.html" class="prev">NEXT</a><a href="/2017/12/The-Cost-Of-JavaScript.html" class="next">PREV</a></div><div class="copyright"><p>© 2017 - 2018 <a href="http://nthung2112.github.io">Hung Tan Nguyen</a>, unless otherwise noted.</p></div></footer></div><script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-41935289-1",'auto');ga('send','pageview');</script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/js/zoom.js"></script><script src="/js/insight.js"></script></body></html>
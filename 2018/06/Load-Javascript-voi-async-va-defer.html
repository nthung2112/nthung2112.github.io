<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title> Load Javascript với async và defer · Learn and Share</title><meta name="description" content="Load Javascript với async và defer - Hung Tan Nguyen"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#FB4D42"><meta name="google-site-verification" content="rk-Nc1c8xi1CdZ0ZQIVV-ifsndGrHanIuSHI-yTHZYE"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/zoom.css"><meta property="og:title" content="Load Javascript với async và defer"><meta property="og:image" content="https://cdn-images-1.medium.com/max/800/1*xPX0KhPP_WSkMyGA82H79w.jpeg"><meta property="og:description" content="Vấn đềJavascript là 1 trong những tài nguyên chặn trang, có nghĩa là việc hiển thị HTML có thể bị chặn hay làm chậm bởi Javascript. Khi parser đọc đến &amp;lt;script&amp;gt; tag, bất kể là inline hay là external file, quá trình parse sẽ tạm dừng để fetch script đó về và execute. Việc này có thể là vấn đề nếu chúng ta load nhiều file Javascript trên trang, làm tăng thời gian load trang mặc dù có thể việc hiển thị html ở trang không thực sự phụ thuộc vào những file javascript đó. Và may mắn thay, thẻ &amp;lt;script&amp;gt; có 2 thuộc tính, đó là async và defer, cho phép chúng ta kiểm soát và load những file này theo ý muốn, tránh chặn quá trình load trang."></head><body><div class="wrap"><div class="header"><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nthung2112" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item search-form-input"><div class="search-icon"><div class="search-icon__circle"></div><div class="search-icon__rectangle"></div></div></li></ul><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" placeholder="Type something..." class="ins-search-input"><span class="ins-close ins-selectable"><div class="close-icon"><div class="close-icon__x"></div><div class="close-icon__y"></div></div></span></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>var rootUrl = "/";
var contentUrl = '/content.json';
(function (window) {
  var INSIGHT_CONFIG = {
  TRANSLATION: {
      POSTS:'Posts',
      PAGES: 'Pages',
      CATEGORIES: 'Categories',
      TAGS: 'Tags',
      UNTITLED: '(Untitled)'
    },
    ROOT_URL: rootUrl,
    CONTENT_URL: contentUrl,
  };
  window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);</script></div></div><section class="container"><div class="post"><article class="post-block"><div class="wrap"><h1 class="post-title">Load Javascript với async và defer</h1><h2 class="post-subtitle"></h2><header class="post-info">Jun 23, 2018<div class="tags"><a href="/tags/javascript" class="tag-link">#javascript</a></div><div class="fb-ir-time"><time dateTime="2018-06-23T11:29:00.000Z" class="op-modified"></time><time dateTime="2018-06-23T11:29:00.000Z" class="op-published"></time></div></header></div><div class="post-banner"><img src="https://cdn-images-1.medium.com/max/800/1*xPX0KhPP_WSkMyGA82H79w.jpeg"></div><div class="wrap"><div class="post-content"><h1 id="Van-de"><a href="#Van-de" class="headerlink" title="Vấn đề"></a>Vấn đề</h1><p><strong>Javascript</strong> là 1 trong những tài nguyên chặn trang, có nghĩa là việc hiển thị HTML có thể bị chặn hay làm chậm bởi Javascript. Khi parser đọc đến <code>&lt;script&gt;</code> tag, bất kể là inline hay là external file, quá trình parse sẽ tạm dừng để fetch script đó về và execute. Việc này có thể là vấn đề nếu chúng ta load nhiều file Javascript trên trang, làm tăng thời gian load trang mặc dù có thể việc hiển thị html ở trang không thực sự phụ thuộc vào những file javascript đó. Và may mắn thay, thẻ <code>&lt;script&gt;</code> có 2 thuộc tính, đó là <strong>async và defer</strong>, cho phép chúng ta kiểm soát và load những file này theo ý muốn, tránh chặn quá trình load trang.</p>
<a id="more"></a>
<h1 id="Mo-ta-cach-thuc-thi"><a href="#Mo-ta-cach-thuc-thi" class="headerlink" title="Mô tả cách thực thi"></a>Mô tả cách thực thi</h1><p><img src="http://www.growingwiththeweb.com/images/2014/02/26/legend.svg" alt=""></p>
<h2 id="lt-script-gt"><a href="#lt-script-gt" class="headerlink" title="&lt;script&gt;"></a><code>&lt;script&gt;</code></h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"script.js"</span> /&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    ....</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>Với thẻ script không có thuộc tính gì khác thì HTML file sẽ được parse cho đến khi gặp phải thẻ script, đến lúc này thì quá trình parse sẽ tạm dùng và để fetch script file về (nếu là external file), sau đó execute những code script này, sau đó mới tiếp tục lại quá trình parse html </p>
<p><img src="http://www.growingwiththeweb.com/images/2014/02/26/script.svg" alt=""></p>
<h2 id="lt-script-async-gt"><a href="#lt-script-async-gt" class="headerlink" title="&lt;script async&gt;"></a><code>&lt;script async&gt;</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script <span class="keyword">async</span> src=<span class="string">"script.js"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>Với thẻ script có thuộc tính async, khi quá trình parse html gặp phải script này, nó sẽ vẫn tiếp tục parse html cho đến khi script này được download xong, thì quá trình parse html mới tạm dừng để execute những code script này, sau đó lại tiếp tiếp quá trình parse html</p>
<p><img src="http://www.growingwiththeweb.com/images/2014/02/26/script-async.svg" alt=""></p>
<h2 id="lt-script-defer-gt"><a href="#lt-script-defer-gt" class="headerlink" title="&lt;script defer&gt;"></a><code>&lt;script defer&gt;</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script defer src=<span class="string">"script.js"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>Với thẻ script có thuộc tính defer, quá trình parse html sẽ không bị dừng lại mà parse cho đến khi hoàn thành, quá trình download các script file được tiến hành song song, và cuối cùng thì sẽ execute những script code này khi html đã parse xong.</p>
<p><img src="http://www.growingwiththeweb.com/images/2014/02/26/script-defer.svg" alt=""></p>
<h1 id="Vay-nen-dung-khi-nao"><a href="#Vay-nen-dung-khi-nao" class="headerlink" title="Vậy nên dùng khi nào?"></a>Vậy nên dùng khi nào?</h1><p>Nó phụ thuộc vào từng tình huống cụ thể.</p>
<h2 id="Quy-tac-nhu-sau"><a href="#Quy-tac-nhu-sau" class="headerlink" title="Quy tắc như sau:"></a>Quy tắc như sau:</h2><ul>
<li>Nếu script là 1 module tách biệt, không phụ thuộc vào script nào khác thì nên sử dụng async cho load và execute với trang luôn</li>
<li>Nếu script phụ thuộc vào script khác, hoặc bị script khác phụ thuộc, thì nên dùng defer, để load và execute theo thứ tự</li>
<li>Nếu script nhỏ và các script khác phụ thuộc vào nó, thì cho load inline và không cần async hay defer</li>
</ul>
<h2 id="Ngoai-ra-nen-can-nhac-1-so-cau-hoi-truoc-khi-them-cac-thuoc-tinh-nay"><a href="#Ngoai-ra-nen-can-nhac-1-so-cau-hoi-truoc-khi-them-cac-thuoc-tinh-nay" class="headerlink" title="Ngoài ra nên cân nhắc 1 số câu hỏi trước khi thêm các thuộc tính này"></a>Ngoài ra nên cân nhắc 1 số câu hỏi trước khi thêm các thuộc tính này</h2><h3 id="1-The-script-dang-nam-o-dau-trong-trang"><a href="#1-The-script-dang-nam-o-dau-trong-trang" class="headerlink" title="1. Thẻ script đang nằm ở đâu trong trang"></a>1. Thẻ script đang nằm ở đâu trong trang</h3><p>Async và defer có thể rất cần thiết nếu thẻ script không nằm ở cuối trang. HMTL document được parse theo thứ tự, từ thẻ mở <html> cho đến thẻ đóng </html>. Nếu script năm ngay gần cuối thẻ đóng  thì việc sử dụng async hay defer thì cũng không có ý nghĩa lắm bởi vì việc parse html đã gần xong xuôi, và javascript không còn block gì html nữa.</p>
<h3 id="2-Script-do-co-doc-lap-khong"><a href="#2-Script-do-co-doc-lap-khong" class="headerlink" title="2. Script đó có độc lập không?"></a>2. Script đó có độc lập không?</h3><p>Với những file script không phụ thuộc vào những file khác, thì thuộc tính async dùng cho script đó là việc nên làm, vì nó load và execute script song song, giảm thời gian tải trang, kết quả cuối cùng nhanh hơn.</p>
<h3 id="3-Script-co-yeu-cau-viec-load-DOM-xong-moi-thuc-hien"><a href="#3-Script-co-yeu-cau-viec-load-DOM-xong-moi-thuc-hien" class="headerlink" title="3. Script có yêu cầu việc load DOM xong mới thực hiện?"></a>3. Script có yêu cầu việc load DOM xong mới thực hiện?</h3><p>Trong nhiều trường hợp, các script chứa đựng code tương tác với DOM, hoặc phụ thuộc vào các thành phần trên trang, yêu cầu trang phải parse xong thì mới execute script. Thông thường thì những file như thế sẽ được đặt ở cuối trang để chắc chắn mọi thử đã được parse. Tuy nhiên chúng ta có thể dùng thuộc tính defer thay thế, đảm bảo script sẽ được execute khi trang đã tải xong.</p>
<h3 id="4-Script-nho-va-cac-file-khac-phu-thuoc-vao-no"><a href="#4-Script-nho-va-cac-file-khac-phu-thuoc-vao-no" class="headerlink" title="4.Script nhỏ và các file khác phụ thuộc vào nó?"></a>4.Script nhỏ và các file khác phụ thuộc vào nó?</h3><p>Nếu script dung lượng nhỏ, và các file khác phụ thuộc vào nó, thì nên để script đó inline. Mặc dù nó block quá trình parse HTML, nhưng nó không đáng kể vì dung lượng nhỏ.</p>
<h1 id="Loi-ich"><a href="#Loi-ich" class="headerlink" title="Lợi ích"></a>Lợi ích</h1><p>Với việc biết cách sử dụng các thuộc tính async, defer hợp lí thì tốc độ load trang sẽ được cải thiện hơn, mang lại cảm giác thích thú cho người dùng. Vì vậy nó giúp tối ưu SEO, giúp tăng điểm Google Page Speed (<a href="https://developers.google.com/speed/pagespeed/insights" target="_blank" rel="noopener">https://developers.google.com/speed/pagespeed/insights</a>)</p>
<span>Source: </span><a href="http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html" target="_blank" title="http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html" class="post-from">http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html</a></div></div></article></div></section><div class="wrap"><footer><div class="paginator"><a href="/2018/06/Local-Storage-Session-Storage-va-Cookie.html" class="prev">NEXT</a><a href="/2018/06/Functional-Programming-Phan-3-Buong-bo.html" class="next">PREV</a></div><div class="copyright"><p>© 2017 - 2018 <a href="http://nthung2112.github.io">Hung Tan Nguyen</a>, unless otherwise noted.</p></div></footer></div><script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-41935289-1",'auto');ga('send','pageview');</script><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/js/zoom.js"></script><script src="/js/insight.js"></script></body></html>
<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Learn and Share</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://nthung2112.github.io/"/>
  <updated>2019-01-06T16:34:26.744Z</updated>
  <id>http://nthung2112.github.io/</id>
  
  <author>
    <name>Hung Tan Nguyen</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Web Architecture 101</title>
    <link href="http://nthung2112.github.io/2019/01/Web-Architecture-101.html"/>
    <id>http://nthung2112.github.io/2019/01/Web-Architecture-101.html</id>
    <published>2019-01-06T16:31:00.000Z</published>
    <updated>2019-01-06T16:34:26.744Z</updated>
    
    <content type="html"><![CDATA[<p>KhÃ¡i niá»‡m kiáº¿n trÃºc web cÆ¡ báº£n mÃ  tÃ´i Æ°á»›c tÃ´i biáº¿t khi má»›i trá»Ÿ thÃ nh developer.</p><p><img src="https://cdn-images-1.medium.com/max/1600/1*K6M-x-6e39jMq_c-2xqZIQ.png" alt=""></p><p>Biá»ƒu Ä‘á»• trÃªn trÃ¬nh bÃ y khÃ¡ Ä‘á»§ vá» kiáº¿n trÃºc cá»§a chÃºng tÃ´i á»Ÿ <strong><a href="https://www.storyblocks.com/" target="_blank" rel="noopener">Storyblocks</a></strong>. Náº¿u báº¡n khÃ´ng pháº£i lÃ  má»™t web developer lÃ¢u nÄƒm thÃ¬ áº£nh trÃªn trÃ´ng sáº½ khÃ¡ phá»©c táº¡p. Viá»‡c má»• xáº» dÆ°á»›i Ä‘Ã¢y cháº¯c sáº½ giÃºp nÃ³ dá»… tiáº¿p cáº­n hÆ¡n trÆ°á»›c khi chÃºng ta Ä‘Ã o sÃ¢u vÃ o chi tiáº¿t cá»§a má»—i thÃ nh pháº§n.<br><a id="more"></a></p><blockquote><p>NgÆ°á»i dÃ¹ng search trÃªn Google tá»« khÃ³a â€œStrong Beautiful Fog And Sunbeams In The Forestâ€. Káº¿t quáº£ Ä‘áº§u tiÃªn Ä‘áº¿n tá»« Storyblocks, trang stock vÃ  vector cá»§a chÃºng tÃ´i. NgÆ°á»i dÃ¹ng click vÃ o káº¿t quáº£ vÃ  Ä‘Æ°á»£c chuyá»ƒn tiáº¿p Ä‘áº¿n trang chi tiáº¿t vá» bá»©c áº£nh. Vá» cÆ¡ báº£n lÃ  trÃ¬nh duyá»‡t cá»§a ngÆ°á»i dÃ¹ng gá»­i má»™t request Ä‘áº¿n server DNS Ä‘á»ƒ tÃ¬m cÃ¡ch liÃªn há»‡ vá»›i Storyblocks, vÃ  sau Ä‘Ã³ gá»­i request.</p><hr><p>Request nÃ y sáº½ gá»­i Ä‘áº¿n load balancer, vÃ  nÃ³ chá»n ngáº«u nhiÃªn 1 trong sá»‘ cÃ¡c web server chÃºng tÃ´i Ä‘ang cháº¡y Ä‘á»ƒ xá»­ lÃ½ request. Web server tÃ¬m thÃ´ng tin vá» áº£nh tá»« caching service vÃ  láº¥y dá»¯ liá»‡u cÃ²n láº¡i tá»« database. CÅ©ng lÆ°u Ã½ ráº±ng â€œhá»“ sÆ¡ mÃ uâ€ cá»§a bá»©c áº£nh chÆ°a Ä‘Æ°á»£c tÃ­nh toÃ¡n, nÃªn chÃºng tÃ´i gá»­i má»™t job Ä‘áº¿n hÃ ng Ä‘á»£i â€œjob queueâ€, vÃ  job server sáº½ xá»­ lÃ½ Ä‘á»“ng bá»™, Ä‘á»“ng thá»i cáº­p nháº­t database vá»›i káº¿t quáº£ cÃ³ Ä‘Æ°á»£c sau khi xá»­ lÃ½.</p><hr><p>Tiáº¿p Ä‘Ã³, chÃºng tÃ´i thá»­ tÃ¬m nhá»¯ng bá»©c áº£nh tÆ°Æ¡ng tá»± báº±ng cÃ¡ch gá»­i má»™t request Ä‘áº¿n service â€œfull text searchâ€ vá»›i Ä‘áº§u vÃ o lÃ  tiÃªu Ä‘á» bá»©c áº£nh. NgÆ°á»i dÃ¹ng tÃ¬nh cá» Ä‘Äƒng nháº­p vÃ o Storyblocks vá»›i tÆ° cÃ¡ch thÃ nh viÃªn thÃ¬ chÃºng tÃ´i tÃ¬m thÃ´ng tin tÃ i khoáº£n tá»« â€œaccount serviceâ€. Cuá»‘i cÃ¹ng, chÃºng tÃ´i báº¯n má»™t sá»± kiá»‡n Ä‘áº¿n firehose Ä‘á»ƒ lÆ°u láº¡i trÃªn há»‡ thá»‘ng lÆ°u trá»¯ Ä‘Ã¡m mÃ¢y vÃ  load vÃ o data warehouse, thá»© sáº½ Ä‘Æ°á»£c phÃ¢n tÃ­ch Ä‘á»ƒ tráº£ lá»i nhá»¯ng cÃ¢u há»i vá» business.</p><hr><p>Server render HTML view vÃ  gá»­i nÃ³ trá»Ÿ láº¡i trÃ¬nh duyá»‡t cá»§a ngÆ°á»i dÃ¹ng, trÆ°á»›c háº¿t thÃ´ng qua load balancer. Trang web chá»©a JavaScript vÃ  CSS Ä‘Æ°á»£c load tá»« há»‡ lÆ°u trá»¯ Ä‘Ã¡m máº¥y, nÃ³ káº¿t ná»‘i vá»›i CDN, nÃªn trÃ¬nh duyá»‡t cá»§a ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ liÃªn há»‡ vá»›i CDN Ä‘á»ƒ nháº­n ná»™i dung. Sau cÃ¹ng, trÃ¬nh duyá»‡t hiá»ƒn thá»‹ trang web cho ngÆ°á»i dÃ¹ng.</p></blockquote><p>Giá» tÃ´i sáº½ Ä‘i láº§n lÆ°á»£t tá»«ng thÃ nh pháº§n, giá»›i thiá»‡u theo kiá»ƒu â€œ101 â€¦â€ nháº±m cung cáº¥p cho báº¡n má»™t mÃ´ hÃ¬nh chuáº©n Ä‘á»ƒ suy nghÄ© vá» kiáº¿n trÃºc web (web architecture) vá» sau.</p><h3 id="1-DNS"><a href="#1-DNS" class="headerlink" title="1. DNS"></a>1. DNS</h3><p>DNS lÃ  viáº¿t táº¯t cá»§a â€œDomain Name Serverâ€ vÃ  nÃ³ lÃ  cÃ´ng nghá»‡ xÆ°Æ¡ng sá»‘ng Ä‘á»ƒ Ä‘á»ƒ www (world wide web) trá»Ÿ nÃªn kháº£ dÄ©. á» má»©c Ä‘á»™ cÆ¡ báº£n thÃ¬ DNS cung cáº¥p má»™t tham chiáº¿u key/value tá»« domain name (cháº³ng háº¡n <a href="http://google.com" target="_blank" rel="noopener">google.com</a> â€¦) Ä‘áº¿n má»™t Ä‘á»‹a chá»‰ IP (cháº³ng háº¡n 85.129.83.120 â€¦), giÃºp mÃ¡y tÃ­nh Ä‘iá»u hÆ°á»›ng request Ä‘áº¿n server tÆ°Æ¡ng á»©ng. TÆ°Æ¡ng tá»± vá»›i sá»‘ Ä‘iá»‡n thoáº¡i, sá»± khÃ¡c biá»‡t giá»¯a domain vÃ  Ä‘á»‹a chá»‰ IP chÃ­nh lÃ  sá»± khÃ¡c biá»‡t giá»¯a viá»‡c â€œgá»i John Doeâ€ vÃ  â€œgá»i Ä‘áº¿n sá»‘ 201-867-5309â€. Báº¡n cáº§n má»™t danh báº¡ Ä‘á»ƒ tÃ¬m sá»‘ cá»§a John, vÃ  tÆ°Æ¡ng tá»±, báº¡n cáº§n DNS Ä‘á»ƒ tÃ¬m Ä‘á»‹a chá»‰ IP cho domain (tÃªn miá»n). Tháº¿ nÃªn báº¡n cÃ³ thá»ƒ xem DNS lÃ  má»™t cuá»‘n danh báº¡ cho internet.</p><p>CÃ²n nhiá»u Ä‘iá»u chi tiáº¿t hÆ¡n mÃ  chÃºng ta cÃ³ thá»ƒ Ä‘á» cáº­p Ä‘áº¿n nhÆ°ng tÃ´i sáº½ bá» qua vÃ¬ nÃ³ khÃ´ng pháº£i á»Ÿ má»©c giá»›i thiá»‡u kiá»ƒu â€œ101â€.</p><p>P/S: 101 lÃ  gÃ¬ thÃ¬ Ä‘á»c á»Ÿ Ä‘Ã¢y nhÃ© <a href="http://www.slate.com/articles/news_and_politics/explainer/2006/09/101_101.html" target="_blank" rel="noopener">http://www.slate.com/articles/news_and_politics/explainer/2006/09/101_101.html</a></p><h3 id="2-Load-Balancer-Can-bang-tai"><a href="#2-Load-Balancer-Can-bang-tai" class="headerlink" title="2. Load Balancer (CÃ¢n báº±ng táº£i)"></a>2. Load Balancer (CÃ¢n báº±ng táº£i)</h3><p>TrÆ°á»›c khi Ä‘i sÃ¢u vÃ o cÃ¢n báº±ng táº£i, chÃºng ta cáº§n tháº£o luáº­n vá» â€œ<strong>horizontal scaling</strong>â€œ (má»Ÿ rá»™ng theo chiá»u ngang) vÃ  â€œ<strong>vertical scaling</strong>â€œ (má»Ÿ rá»™ng theo chiá»u dá»c). ChÃºng lÃ  gÃ¬ vÃ  khÃ¡c nhau nhÆ° tháº¿ nÃ o? ÄÆ¡n giáº£n â€œhorizontal scalingâ€ nghÄ©a lÃ  má»Ÿ rá»™ng quy mÃ´ báº±ng cÃ¡ch thÃªm nhiá»u mÃ¡y tÃ­nh vÃ o nguá»“n tÃ i nguyÃªn, trong khi â€œvertical scalingâ€ nghÄ©a lÃ  tÄƒng cÆ°á»ng sá»©c máº¡nh cho má»™t mÃ¡y tÃ­nh Ä‘Ã£ cÃ³ (cháº³ng háº¡n nhÆ° CPU, RAM).</p><p>Trong web development, gáº§n nhÆ° báº¡n luÃ´n muá»‘n má»Ÿ rá»™ng theo kiá»ƒu â€œhorizontalâ€. VÃ¬, server cÃ³ thá»ƒ bá»—ng dÆ°ng bá»‹ cháº¿t, máº¡ng gáº·p sá»± cá»‘, toÃ n bá»™ trung tÃ¢m dá»¯ liá»‡u thÆ°á»ng xuyÃªn máº¥t máº¡ng. CÃ³ nhiá»u hÆ¡n má»™t server cho phÃ©p báº¡n láº­p káº¿ hoáº¡ch cho cÃ¡c sá»± cá»‘ Ä‘á»ƒ á»©ng dá»¥ng váº«n tiáº¿p tá»¥c cháº¡y (fault tolerant). LÃ½ do thá»© hai, â€œhorizontal scalingâ€ sáº½ cho báº¡n káº¿t há»£p tá»‘i thiá»ƒu cÃ¡c pháº§n backend khÃ¡c nhau cá»§a á»©ng dá»¥ng (web server, database, service X, â€¦) báº±ng cÃ¡ch Ä‘á»ƒ chÃºng cháº¡y trÃªn nhiá»u server. Cuá»‘i cÃ¹ng, báº¡n cÃ³ thá»ƒ má»Ÿ rá»™ng quy mÃ´ Ä‘áº¿n má»™t má»©c mÃ  â€œvertical scalingâ€ khÃ´ng thá»ƒ lÃ m Ä‘Æ°á»£c. ÄÃ³ lÃ  vÃ¬ khÃ´ng cÃ³ má»™t mÃ¡y tÃ­nh nÃ o trÃªn tháº¿ giá»›i Ä‘á»§ lá»›n Ä‘á»ƒ thá»±c hiá»‡n táº¥t cáº£ tÃ­nh toÃ¡n cho á»©ng dá»¥ng. HÃ£y nghÄ© ná»n táº£ng tÃ¬m kiáº¿m cá»§a Google nhÆ° má»™t vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh (dÃ¹ Ä‘iá»u nÃ y á»©ng dá»¥ng cho cÃ¡c cÃ´ng ty á»Ÿ quy mÃ´ bÃ© hÆ¡n nhiá»u). <strong>Storyblocks</strong>, cháº¡y tá»« 150 Ä‘áº¿n 400 AWS EC2 táº¡i thá»i Ä‘iá»ƒm viáº¿t bÃ i nÃ y, Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c khá»‘i lÆ°á»£ng tÃ­nh toÃ¡n áº¥y báº±ng â€œvertical scalingâ€ lÃ  má»™t thÃ¡ch thá»©c ráº¥t lá»›n.</p><p>Trá»Ÿ láº¡i vá»›i cÃ¢n báº±ng táº£i, chÃºng lÃ  ma thuáº­t Ä‘á»ƒ má»Ÿ rá»™ng theo kiá»ƒu â€œhorizontalâ€, Ä‘iá»u hÆ°á»›ng <em>incoming request</em> Ä‘áº¿n má»™t trong nhiá»u server vÃ  gá»­i pháº£n há»“i tá»« server vá» client. Báº¥t ká»³ server nÃ o cÅ©ng pháº£i xá»­ lÃ½ request theo cÃ¹ng má»™t cÃ¡ch, do Ä‘Ã³ chá»‰ cÃ²n láº¡i má»™t váº¥n Ä‘á» lÃ  phÃ¢n bá»• request qua nhiá»u server Ä‘á»ƒ chÃºng khÃ´ng bá»‹ quÃ¡ táº£i (overload).</p><p>Váº­y Ä‘Ã³, khÃ¡i niá»‡m cÃ¢n báº±ng táº£i khÃ¡ Ä‘Æ¡n giáº£n. Táº¥t nhiÃªn cÃ´ng nghá»‡ náº±m phÃ­a sau nÃ³ ráº¥t phá»©c táº¡p nhÆ°ng khÃ´ng cáº§n Ä‘á» cáº­p vá»›i phiÃªn báº£n â€œ101â€ lÃ m chi.</p><h3 id="3-Web-Application-Servers"><a href="#3-Web-Application-Servers" class="headerlink" title="3. Web Application Servers"></a>3. Web Application Servers</h3><p>Web server lÃ  nÆ¡i thá»±c thi business logic, xá»­ lÃ½ request cá»§a user vÃ  gá»­i láº¡i HTML Ä‘áº¿n trÃ¬nh duyá»‡t cá»§a user. Äá»ƒ lÃ m viá»‡c Ä‘Ã³, chÃºng káº¿t ná»‘i vá»›i nhiá»u infra phÃ­a back-end nhÆ° database, caching layer, job queue, search service, microservice, data/logging queue, â€¦ NhÆ° Ä‘Ã£ Ä‘á» cáº­p á»Ÿ trÃªn, Ã­t nháº¥t 2 server thÆ°á»ng Ä‘Æ°á»£c káº¿t ná»‘i vá»›i cÃ¢n báº±ng táº£i Ä‘á»ƒ xá»­ lÃ½ request cá»§a ngÆ°á»i dÃ¹ng.</p><p>Báº¡n nÃªn biáº¿t ráº±ng triá»ƒn khai server yÃªu cáº§u má»™t ngÃ´n ngá»¯ cá»¥ thá»ƒ (Node.js, Ruby, PHP, Scala, Java, C# .NET, â€¦) vÃ  má»™t web framework cho ngÃ´n ngá»¯ Ä‘Ã³ (Express, Ruby on Rails, Play, Laravel, â€¦). Tuy nhiÃªn Ä‘i sÃ¢u vÃ o chi tiáº¿t cá»§a nhá»¯ng ngÃ´n ngá»¯ nÃ y náº±m ngoÃ i pháº¡m vi cá»§a bÃ i viáº¿t.</p><h3 id="4-Database-Servers"><a href="#4-Database-Servers" class="headerlink" title="4. Database Servers"></a>4. Database Servers</h3><p>Má»i á»©ng dá»¥ng web hiá»‡n Ä‘áº¡i Ä‘á»u sá»­ dá»¥ng má»™t hoáº·c nhiá»u database Ä‘á»ƒ lÆ°u trá»¯ thÃ´ng tin. Database cung cáº¥p phÆ°Æ¡ng thá»©c Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cáº¥u trÃºc dá»¯ liá»‡u, insert dá»¯ liá»‡u má»›i, tÃ¬m dá»¯ liá»‡u Ä‘Ã£ cÃ³, cáº­p nháº­t hoáº·c xÃ³a dá»¯ liá»‡u, thá»±c hiá»‡n tÃ­nh toÃ¡n, â€¦</p><p>DÃ¹ tÃ´i trÃ¡nh Ä‘Ã o sao vÃ o má»™t cÃ´ng nghá»‡ cá»¥ thá»ƒ cho má»—i thÃ nh pháº§n cá»§a kiáº¿n trÃºc web, sáº½ ráº¥t tá»‡ náº¿u tÃ´i khÃ´ng Ä‘á» cáº­p Ä‘áº¿n SQL vÃ  NoSQL.</p><p>SQL lÃ  viáº¿t táº¯t cá»§a â€œStructured Query Languageâ€ (ngÃ´n ngá»¯ truy váº¥n cÃ³ cáº¥u trÃºc) Ä‘Æ°á»£c phÃ¡t minh vÃ o tháº­p niÃªn 70 cá»§a tháº¿ ká»· trÆ°á»›c, cung cáº¥p má»™t chuáº©n Ä‘á»ƒ truy váº¥n dá»¯ liá»‡u. SQL database lÆ°u trá»¯ dá»¯ liá»‡u theo báº£ng, Ä‘Æ°á»£c liÃªn káº¿t vá»›i nhau thÆ°á»ng báº±ng ID. HÃ£y láº¥y má»™t vÃ­ dá»¥ cÆ¡ báº£n vá» lÆ°u trá»¯ Ä‘á»‹a chá»‰ cá»§a ngÆ°á»i dÃ¹ng. Báº¡n cÃ³ 2 báº£ng, <em>users</em> vÃ  _user_addresses_, liÃªn káº¿t vá»›i nhau báº±ng id cá»§a ngÆ°á»i dÃ¹ng.</p><p><img src="https://images.viblo.asia/646f6ef3-7806-4835-bc29-950c6532657b.png" alt=""></p><p>NoSQL, nghÄ©a lÃ  â€œNon-SQLâ€, lÃ  má»™t cÃ´ng nghá»‡ cÆ¡ sá»Ÿ dá»¯ liá»‡u má»›i hÆ¡n, dÃ¹ng Ä‘á»ƒ xá»­ lÃ½ khá»‘i lÆ°á»£ng dá»¯ liá»‡u lá»›n Ä‘Æ°á»£c sinh ra bá»Ÿi nhá»¯ng á»©ng dá»¥ng web cÃ³ quy mÃ´ lÆ¡n (háº§u háº¿t cÃ¡c biáº¿n thá»ƒ cá»§a SQL khÃ´ng scale theo kiá»ƒu â€œhorizontalâ€ tá»‘t vÃ  chá»‰ cÃ³ thá»ƒ scale theo kiá»ƒu â€œverticalâ€ Ä‘áº¿n má»™t má»©c Ä‘á»™ nháº¥t Ä‘á»‹nh). Náº¿u báº¡n khÃ´ng biáº¿t gÃ¬ vá» NoSQL, tÃ´i Ä‘á» nghá»‹ xem nhá»¯ng tÃ i liá»‡u dÆ°á»›i Ä‘Ã¢y:</p><ul><li><a href="https://www.w3resource.com/mongodb/nosql.php" target="_blank" rel="noopener">https://www.w3resource.com/mongodb/nosql.php</a></li><li><a href="http://www.kdnuggets.com/2016/07/seven-steps-understanding-nosql-databases.html" target="_blank" rel="noopener">http://www.kdnuggets.com/2016/07/seven-steps-understanding-nosql-databases.html</a></li><li><a href="https://resources.mongodb.com/getting-started-with-mongodb/back-to-basics-1-introduction-to-nosql" target="_blank" rel="noopener">https://resources.mongodb.com/getting-started-with-mongodb/back-to-basics-1-introduction-to-nosql</a></li></ul><h3 id="5-Caching-Service"><a href="#5-Caching-Service" class="headerlink" title="5. Caching Service"></a>5. Caching Service</h3><p>Má»™t <em>caching service</em> (dá»‹ch vá»¥ lÆ°u bá»™ nhá»› Ä‘á»‡m) cung cáº¥p lÆ°u trá»¯ dá»¯ liá»‡u theo kiá»ƒu â€œkey/valueâ€ Ä‘Æ¡n giáº£n giÃºp nÃ³ tÃ¬m kiáº¿m thÃ´ng tin vá»›i thá»i gian gáº§n nhÆ° báº±ng 0. CÃ¡c á»©ng dá»¥ng thÆ°á»ng táº­n dá»¥ng <em>caching service</em> Ä‘á»ƒ lÆ°u káº¿t quáº£ cá»§a nhá»¯ng tÃ­nh toÃ¡n Ä‘áº¯t Ä‘á» Ä‘á»ƒ nháº­n káº¿t cá»§a tá»« bá»™ nhá»› Ä‘á»‡m thay vÃ¬ pháº£i tÃ­nh toÃ¡n láº¡i má»™t láº§n ná»¯a khi cáº§n. á»¨ng dá»¥ng cÃ³ thá»ƒ cache káº¿t quáº£ cá»§a má»™t truy váº¥n cÆ¡ sá»Ÿ dá»¯ liá»‡u, gá»i Ä‘áº¿n má»™t dá»‹ch vá»¥ bÃªn ngoÃ i, cache HTML cá»§a má»™t Ä‘Æ°á»ng link, â€¦ DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ i vÃ­ dá»¥ thá»±c táº¿:</p><ul><li>Google lÆ°u káº¿t quáº£ tÃ¬m kiáº¿m cho nhá»¯ng truy váº¥n thÃ´ng thÆ°á»ng nhÆ° â€œdogâ€ hoáº·c â€œTaylor Swiftâ€ Ä‘á»ƒ khÃ´ng pháº£i tÃ­nh toÃ¡n láº¡i má»—i láº§n</li><li>Facebook lÆ°u nhiá»u dá»¯ liá»‡u báº¡n nhÃ¬n tháº¥y khi Ä‘Äƒng nháº­p, cháº³ng háº¡n bÃ i viáº¿t, báº¡n bÃ¨â€¦ Báº¡n cÃ³ thá»ƒ Ä‘á»c chi tiáº¿t vá» Facebook caching á»Ÿ <a href="https://medium.com/@shagun/scaling-memcache-at-facebook-1ba77d71c082" target="_blank" rel="noopener">Ä‘Ã¢y</a>.</li><li>Storyblocks lÆ°u HTML output, káº¿t quáº£ tÃ¬m kiáº¿m, â€¦</li></ul><p>Hai cÃ´ng nghá»‡ caching phá»• biáº¿n nháº¥t lÃ  Redis vÃ  Memcache.</p><h3 id="6-Job-Queue-amp-Servers"><a href="#6-Job-Queue-amp-Servers" class="headerlink" title="6. Job Queue &amp; Servers"></a>6. Job Queue &amp; Servers</h3><p>Háº§u háº¿t á»©ng dá»¥ng web Ä‘á»u cáº§n lÃ m má»™t sá»‘ cÃ´ng viá»‡c báº¥t Ä‘á»“ng bá»™ á»Ÿ phÃ­a back-end mÃ  khÃ´ng káº¿t há»£p trá»±c tiáº¿p vÃ o dá»¯ liá»‡u tráº£ vá» cho ngÆ°á»i dÃ¹ng. Cháº³ng háº¡n, Google cáº§n crawl vÃ  index toÃ n bá»™ internet Ä‘á»ƒ tráº£ vá» káº¿t quáº£ tÃ¬m kiáº¿m. NÃ³ khÃ´ng Ä‘Æ°á»£c lÃ m má»—i láº§n báº¡n tÃ¬m kiáº¿m. Thay vÃ o Ä‘Ã³, nÃ³ crawl cÃ¡c trang web má»™t cÃ¡ch báº¥t Ä‘á»“ng bá»™, vÃ  cáº­p nháº­t index theo thá»i gian.</p><p>Máº·c dÃ¹ cÃ³ nhiá»u kiáº¿n trÃºc khÃ¡c nhau cho cÃ¡c cÃ´ng viá»‡c báº¥t Ä‘á»“ng bá»™, nhÆ°ng phá»‘ biáº¿n nháº¥t lÃ  kiáº¿n trÃºc â€œjob queueâ€. NÃ³ chá»©a 2 thÃ nh pháº§n: má»™t hÃ ng Ä‘á»£i â€œjobâ€ cáº§n Ä‘Æ°á»£c cháº¡y, vÃ  má»™t hoáº·c nhiá»u â€œjob serverâ€ (hay cÃ²n láº¡i lÃ  worker) Ä‘á»ƒ cháº¡y job trong hÃ ng Ä‘á»£i.</p><p>Job queue chá»©a má»™t danh sÃ¡ch job cáº§n Ä‘Æ°á»£c cháº¡y báº¥t Ä‘á»“ng bá»™. HÃ ng Ä‘á»£i Ä‘Æ¡n giáº£n nháº¥t lÃ  FIFO (first in first out) máº·c dÃ¹ háº§u háº¿t á»©ng dá»¥ng sáº½ cáº§n má»™t vÃ i hÃ ng Ä‘á»£i cÃ³ Æ°u tiÃªn. Má»—i khi á»©ng dá»¥ng cáº§n cháº¡y job thÃ¬ nÃ³ chá»‰ cáº§n thÃªm job Ä‘Ã³ vÃ o hÃ ng Ä‘á»£i.</p><p>Storyblocks, cháº³ng háº¡n, táº­n dá»¥ng â€œjob queueâ€ Ä‘á»ƒ há»— trá»£ ráº¥t nhiá»u cÃ´ng viá»‡c phÃ­a back-end nháº±m phá»¥c vá»¥ thá»‹ trÆ°á»ng cá»§a chÃºng tÃ´i. ChÃºng tÃ´i cháº¡y job Ä‘á»ƒ encode video vÃ  áº£nh, xá»­ lÃ½ file CSV, thá»‘ng kÃª ngÆ°á»i dÃ¹ng, gá»­i máº­t kháº©u reset email, â€¦ LÃºc Ä‘áº§u chÃºng tÃ´i sá»­ dá»¥ng hÃ ng Ä‘á»£i FIFO Ä‘Æ¡n giáº£n, sau Ä‘Ã³ nÃ¢ng cáº¥p lÃªn hÃ ng Ä‘á»£i Æ°u tiÃªn Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng nhá»¯ng hoáº¡t Ä‘á»™ng kháº©n nhÆ° gá»­i máº­t kháº©u reset email Ä‘Æ°á»£c hoÃ n thÃ nh cÃ ng sá»›m cÃ ng tá»‘t.</p><p>Job server xá»­ lÃ½ job. ChÃºng thÄƒm dÃ² â€œjob queueâ€ Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ³ job cáº§n lÃ m hay khÃ´ng, vÃ  náº¿u cÃ³ thÃ¬ chÃºng sáº½ Ä‘áº©y job vÃ o hÃ ng Ä‘á»£i vÃ  thá»±c thi nÃ³.</p><h3 id="7-Full-text-Search-Service"><a href="#7-Full-text-Search-Service" class="headerlink" title="7. Full-text Search Service"></a>7. Full-text Search Service</h3><p>Háº§u háº¿t á»©ng dá»¥ng web há»— trá»£ má»™t vÃ i chá»©c nÄƒng tÃ¬m kiáº¿m mÃ  ngÆ°á»i dÃ¹ng thÆ°á»ng sáº½ cung cáº¥p má»™t tham sá»‘ vÄƒn báº£n (cÃ²n gá»i lÃ  â€œqueryâ€) vÃ  á»©ng dá»¥ng tráº£ vá» káº¿t quáº£ â€œliÃªn quanâ€. CÃ´ng nghá»‡ há»— trá»£ Ä‘áº·c tÃ­nh nÃ y thÆ°á»ng gá»i lÃ  â€œfull-text searchâ€, sá»­ dá»¥ng index Ä‘á»ƒ nhanh chÃ³ng tÃ¬m tÃ i liá»‡u chá»©a tá»« khÃ³a cáº§n truy váº¥n.</p><p><img src="https://images.viblo.asia/eba8d45b-27eb-4e56-8380-6db35a45329d.png" alt=""></p><p>DÃ¹ cÃ³ thá»ƒ thá»±c hiá»‡n â€œfull-text searchâ€ trá»±c tiáº¿p tá»« database (cháº³ng háº¡n MySQL há»— trá»£ full-text search), nÃ³ thÆ°á»ng cháº¡y má»™t â€œsearch serviceâ€ riÃªng Ä‘á»ƒ tÃ­nh toÃ¡n vÃ  lÆ°u trá»¯ chá»‰ má»¥c vÃ  cung cáº¥p má»™t giao diá»‡n truy váº¥n riÃªng. Ná»n táº£ng full-text search phá»• biáº¿n nháº¥t hiá»‡n nay lÃ  Eltasticsearch, bÃªn cáº¡nh má»™t sá»‘ lá»±a chá»n khÃ¡c nhÆ° Sphinx hoáº·c Apache Solr.</p><h3 id="8-Services"><a href="#8-Services" class="headerlink" title="8. Services"></a>8. Services</h3><p>Khi á»©ng dá»¥ng Ä‘áº¡t Ä‘áº¿n quy mÃ´ nháº¥t Ä‘á»‹nh, sáº½ cÃ³ má»™t sá»‘ â€œserviceâ€ Ä‘Æ°á»£c tahcs ra Ä‘á»ƒ cháº¡y nhÆ° má»™t á»©ng dá»¥ng riÃªng. ChÃºng khÃ´ng Ä‘Æ°á»£c public bÃªn ngoÃ i nhÆ°ng á»©ng dá»¥ng vÃ  cÃ¡c service khÃ¡c cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c vá»›i chÃºng. Storyblocks cÃ³ má»™t sá»‘ service nhÆ° váº­y:</p><ul><li>Account service Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u ngÆ°á»i dÃ¹ng trÃªn táº¥t cáº£ cÃ¡c trang web cá»§a chÃºng tÃ´i, cho phÃ©p chÃºng tÃ´i dá»… dÃ ng cung cáº¥p cÃ¡c cÆ¡ há»™i â€œcross-sellâ€ vÃ  táº¡o nhá»¯ng tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng nháº¥t quÃ¡n hÆ¡n</li><li>Content service lÆ°u trá»¯ metadata cho video, audio, áº£nh. NÃ³ cÅ©ng cung cáº¥p giao diá»‡n Ä‘á»ƒ download ná»™i dung vÃ  xem lá»‹ch sá»­ download.</li><li>Payment service cung cáº¥p giao diá»‡n thanh toÃ¡n báº±ng tháº» tÃ­n dá»¥ng.</li><li>HTML â†’ PDF service cung cáº¥p giao diá»‡n Ä‘Æ¡n giáº£n Ä‘á»ƒ sinh ra file PDF tá»« HTML.</li></ul><h3 id="9-Data"><a href="#9-Data" class="headerlink" title="9. Data"></a>9. Data</h3><p>NgÃ y nay, cÃ´ng ty muá»‘n tá»“n táº¡i thÃ¬ pháº£i dá»±a trÃªn cÃ¡ch há» khai thÃ¡c dá»¯ liá»‡u. Háº§u háº¿t nhá»¯ng á»©ng dá»¥ng bÃ¢y giá», má»—i láº§n Ä‘áº¡t Ä‘áº¿n má»™t quy mÃ´ nháº¥t Ä‘á»‹nh, hÃ£y táº­n dá»¥ng kÃªnh dá»¯ liá»‡u (data pipeline) Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng dá»¯ liá»‡u Ä‘Æ°á»£c thu tháº­p, lÆ°u trá»¯ vÃ  phÃ¢n tÃ­ch. Má»™t kÃªnh dá»¯ liá»‡u bao gá»“m 3 giai Ä‘oáº¡n chÃ­nh:</p><ol><li>á»¨ng dá»¥ng gá»­i dá»¯ liá»‡u, sá»± kiá»‡n vá» tÆ°Æ¡ng tÃ¡c cá»§a ngÆ°á»i dÃ¹ng cho â€œfirehoseâ€ (cung cáº¥p giao diá»‡n streaming Ä‘á»ƒ nháº­p vÃ  xá»­ lÃ½ dá»¯ liá»‡u). ThÃ´ng thÆ°á»ng dá»¯ liá»‡u thÃ´ Ä‘Æ°á»£c xá»­ lÃ½ sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n firehose khÃ¡c. AWS Kinesis vÃ  Kafka lÃ  hai cÃ´ng nghá»‡ phá»‘ biáº¿n nháº¥t cho má»¥c Ä‘Ã­ch nÃ y.</li><li>Dá»¯ liá»‡u thÃ´ cÅ©ng nhÆ° dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i Ä‘Æ°á»£c lÆ°u trá»¯ Ä‘áº¿n cloud. AWS Kinesis cung cáº¥p má»™t setting gá»i lÃ  â€œfirehoseâ€ sáº½ lÆ°u dá»¯ liá»‡u thÃ´ vÃ o S3 Ä‘á»ƒ dá»… cáº¥u hÃ¬nh.</li><li>Dá»¯ liá»‡u Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i sáº½ Ä‘Æ°á»£c táº£i vÃ o data warehouse Ä‘á»ƒ phÃ¢n tÃ­ch. ChÃºng tÃ´i sá»­ dá»¥ng AWS Redshift, máº·c dÃ¹ cÃ¡c cÃ´ng ty lá»›n khÃ¡c thÆ°á»ng dÃ¹ng Oracle hoáº·c cÃ´ng nghá»‡ warehouse Ä‘á»™c quyá»n. Náº¿u bá»™ dá»¯ liá»‡u Ä‘á»§ lá»›n, cÃ´ng nghá»‡ NoSQL MapReduce nhÆ° Hadoop sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ phÃ¢n tÃ­ch.</li></ol><p>Má»™t bÆ°á»›c khÃ¡c khÃ´ng Ä‘Æ°á»£c mÃ´ táº£ trong biá»ƒu Ä‘á»“ kiáº¿n trÃºc lÃ : táº£i dá»¯ liá»‡u tá»« database cá»§a á»©ng dá»¥ng vÃ  service vÃ o data warehouse. Cháº³ng háº¡n á»Ÿ Storyblocks, chÃºng tÃ´i táº£i VideoBlocks, AudioBlocks, Storyblocks, account service, â€¦ vÃ o Redshift má»—i Ä‘Ãªm. Äiá»u nÃ y cung cáº¥p cho bá»™ phÃ¢n tÃ­ch nhá»¯ng dá»¯ liá»‡u tá»•ng thá»ƒ báº±ng cÃ¡ch cáº¥p phÃ¡t dá»¯ liá»‡u business cÃ¹ng vá»›i dá»¯ liá»‡u tÆ°Æ¡ng tÃ¡c cá»§a ngÆ°á»i dÃ¹ng.</p><h3 id="10-Cloud-storage"><a href="#10-Cloud-storage" class="headerlink" title="10. Cloud storage"></a>10. Cloud storage</h3><p>Dá»‹ch vá»¥ Ä‘Ã¡m mÃ¢y lÃ  cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t Ä‘á»ƒ lÆ°u trá»¯, truy xuáº¥t vÃ  chia sáº» dá»¯ liá»‡u trÃªn internet, theo AWS. Báº¡n cÃ³ thá»ƒ dÃ¹ng nÃ³ Ä‘á»ƒ lÆ°u trá»¯ vÃ  truy cáº­p vá»›i lá»£i tháº¿ lÃ  tÆ°Æ¡ng tÃ¡c vá»›i nÃ³ quáº£ RESTful API. Amazon S3 lÃ  dá»‹ch vá»¥ lÆ°u trá»¯ Ä‘Ã¡m mÃ¢y phá»• biáº¿n nháº¥t ngÃ y nay, vÃ  chÃºng tÃ´i dá»±a vÃ o nÃ³ Ä‘á»ƒ lÆ°u trá»¯ video, áº£nh, audio, CSS vÃ  JavaScript, dá»¯ liá»‡u sá»± kiá»‡n ngÆ°á»i dÃ¹ng vÃ  hÆ¡n tháº¿ ná»¯a.</p><h3 id="11-CDN"><a href="#11-CDN" class="headerlink" title="11. CDN"></a>11. CDN</h3><p>CSN lÃ  viáº¿t táº¯t cá»§a â€œContent Delivery Networkâ€ vÃ  cÃ´ng nghá»‡ cung cáº¥p má»™t cÃ¡ch Ä‘á»ƒ phá»¥c vá»¥ ná»™i dung tÄ©nh nhÆ° HTML, CSS, JavaScript vÃ  áº£nh trÃªn web nhanh hÆ¡n so vá»›i viá»‡c chá»‰ dÃ¹ng má»™t server. NÃ³ hoáº¡t Ä‘á»™ng báº±ng cÃ¡ch phÃ¢n tÃ¡n ná»™i dung qua nhiá»u â€œedge serverâ€ kháº¯p tháº¿ giá»›i Ä‘á»ƒ ngÆ°á»i dÃ¹ng cuá»‘i cÃ³ thá»ƒ download ná»™i dung tá»« â€œedge serverâ€ thay vÃ¬ tá»« server gá»‘c. Cháº³ng háº¡n nhÆ° áº£nh dÆ°á»›i Ä‘Ã¢y, má»™t ngÆ°á»i dÃ¹ng tá»« TÃ¢y Ban Nha request má»™t trang web mÃ  cÃ³ server gá»‘c lÃ  á»Ÿ New York, nhÆ°ng cÃ¡c tÃ i nguyÃªn tÄ©nh cá»§a trang web láº¡i Ä‘Æ°á»£c táº£i vá» tá»« â€œedge serverâ€ cá»§a CDN tá»« Anh.</p><p><img src="https://images.viblo.asia/0bf32d18-11cf-496a-98b7-ccbbe31ec4b5.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;KhÃ¡i niá»‡m kiáº¿n trÃºc web cÆ¡ báº£n mÃ  tÃ´i Æ°á»›c tÃ´i biáº¿t khi má»›i trá»Ÿ thÃ nh developer.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn-images-1.medium.com/max/1600/1*K6M-x-6e39jMq_c-2xqZIQ.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Biá»ƒu Ä‘á»• trÃªn trÃ¬nh bÃ y khÃ¡ Ä‘á»§ vá» kiáº¿n trÃºc cá»§a chÃºng tÃ´i á»Ÿ &lt;strong&gt;&lt;a href=&quot;https://www.storyblocks.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Storyblocks&lt;/a&gt;&lt;/strong&gt;. Náº¿u báº¡n khÃ´ng pháº£i lÃ  má»™t web developer lÃ¢u nÄƒm thÃ¬ áº£nh trÃªn trÃ´ng sáº½ khÃ¡ phá»©c táº¡p. Viá»‡c má»• xáº» dÆ°á»›i Ä‘Ã¢y cháº¯c sáº½ giÃºp nÃ³ dá»… tiáº¿p cáº­n hÆ¡n trÆ°á»›c khi chÃºng ta Ä‘Ã o sÃ¢u vÃ o chi tiáº¿t cá»§a má»—i thÃ nh pháº§n.&lt;br&gt;
    
    </summary>
    
    
      <category term="architecture" scheme="http://nthung2112.github.io/tags/architecture/"/>
    
  </entry>
  
  <entry>
    <title>Má»™t mÃ´ hÃ¬nh sá»­ dá»¥ng Git branches hiá»‡u quáº£</title>
    <link href="http://nthung2112.github.io/2019/01/Mot-mo-hinh-su-dung-Git-branches-hieu-qua.html"/>
    <id>http://nthung2112.github.io/2019/01/Mot-mo-hinh-su-dung-Git-branches-hieu-qua.html</id>
    <published>2019-01-06T16:24:00.000Z</published>
    <updated>2019-01-06T16:27:51.189Z</updated>
    
    <content type="html"><![CDATA[<p>Má»›i Ä‘áº§u mÃ¬nh tÃ­nh viáº¿t vá» <a href="https://github.com/nvie/gitflow" target="_blank" rel="noopener">git-flow</a> - má»™t tool Ä‘Æ¡n giáº£n dÃ¹ng Ä‘á»ƒ quáº£n lÃ½ Git branches, xong tháº¥y bÃ i viáº¿t <a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener">nÃ y</a> vá» má»™t vÃ­ dá»¥ sá»­ dá»¥ng Git branches hay quÃ¡, nÃªn quyáº¿t Ä‘á»‹nh dá»‹ch luÃ´n.</p><h2 id="Mo-dau"><a href="#Mo-dau" class="headerlink" title="Má»Ÿ Ä‘áº§u"></a>Má»Ÿ Ä‘áº§u</h2><p>Ngay bÃ¢y giá», tÃ´i sáº½ giá»›i thiá»‡u vá»›i cÃ¡c báº¡n mÃ´ hÃ¬nh sá»­ dá»¥ng Git mÃ  tÃ´i Ä‘Ã£ vÃ  Ä‘ang sá»­ dá»¥ng trong cÃ¡c dá»± Ã¡n khoáº£ng má»™t nÄƒm trá»Ÿ láº¡i Ä‘Ã¢y. ÄÃ³ lÃ  má»™t mÃ´ hÃ¬nh thá»±c sá»± thÃ nh cÃ´ng, nhÆ°ng mÃ£i Ä‘áº¿n giá» tÃ´i má»›i cÃ³ cÆ¡ há»™i Ä‘á»ƒ cÃ³ thá»ƒ viáº¿t vá» nÃ³ vÃ  chia sáº» vá»›i cÃ¡c báº¡n. TÃ´i sáº½ khÃ´ng Ä‘i vÃ o chi tiáº¿t dá»± Ã¡n, mÃ  chá»‰ xoay quanh chiáº¿n lÆ°á»£c quáº£n lÃ½ cÃ¡c phÃ¢n nhÃ¡nh mÃ  thÃ´i.<br><a id="more"></a><br><img src="http://nvie.com/img/git-model@2x.png" alt=""></p><p>Trong bÃ i viáº¿t dÆ°á»›i Ä‘Ã¢y, tÃ´i sá»­ dá»¥ng Git Ä‘á»ƒ quáº£n lÃ½ version cho toÃ n bá»™ source code. Náº¿u cÃ¡c báº¡n cÃ³ há»©ng thÃº vá»›i viá»‡c phÃ¢n tÃ­ch dá»¯ liá»‡u thá»i gian thá»±c dá»±a vÃ o hoáº¡t Ä‘á»™ng trÃªn Git, cÃ³ thá»ƒ tham kháº£o pháº§n má»m mÃ  <a href="http://gitprime.com/" target="_blank" rel="noopener">GitPrime</a> mÃ  cÃ´ng ty tÃ´i phÃ¡t triá»ƒn.</p><h2 id="Tai-sao-lai-chon-Git"><a href="#Tai-sao-lai-chon-Git" class="headerlink" title="Táº¡i sao láº¡i chá»n Git?"></a>Táº¡i sao láº¡i chá»n Git?</h2><p>ÄÃ£ cÃ³ quÃ¡ nhiá»u cuá»™c chiáº¿n ná»• ra khi bÃ n vá» Æ°u Ä‘iá»ƒm nhÆ°á»£c Ä‘iá»ƒm cá»§a Git so vá»›i cÃ¡c cÃ´ng cá»¥ quáº£n lÃ½ source code táº­p trung khÃ¡c (nhÆ° CVS, SVN). LÃ  má»™t developer, tÃ´i cáº£m tháº¥y yÃªu thÃ­ch Git hÆ¡n. Git thá»±c sá»± Ä‘Ã£ thay Ä‘á»•i cÃ¡ch suy nghÄ© vá» merging vÃ  branching. Nhá»¯ng ai Ä‘Ã£ tá»«ng lÃ m viá»‡c vá»›i CVS/Subversion Ä‘á»u hiá»ƒu merging/branching khÃ´ng há» Ä‘Æ¡n giáº£n, trong <a href="http://svnbook.red-bean.com/" target="_blank" rel="noopener">tÃ i liá»‡u vá» CVS/Subversion</a> branching vÃ  merging chá»‰ Ä‘Æ°á»£c nháº¯c Ä‘áº¿n á»Ÿ chapter cuá»‘i, dÃ nh cho cÃ¡c users cÃ³ kinh nghiá»‡m. CÃ²n vá»›i Git, branching/merging lÃ  má»™t pháº§n trong workflow hÃ ng ngÃ y cá»§a báº¡n, Ä‘Æ°á»£c mÃ´ táº£ á»Ÿ nhá»¯ng pháº§n Ä‘áº§u tiÃªn trong <a href="http://book.git-scm.com/" target="_blank" rel="noopener">Git book</a>.</p><h2 id="Phan-tan-nhung-tap-trung"><a href="#Phan-tan-nhung-tap-trung" class="headerlink" title="PhÃ¢n tÃ¡n, nhÆ°ng táº­p trung"></a>PhÃ¢n tÃ¡n, nhÆ°ng táº­p trung</h2><p>MÃ´ hÃ¬nh Git mÃ  tÃ´i sá»­ dá»¥ng hoáº¡t Ä‘á»™ng xoay quanh má»™t repo trung tÃ¢m. NÃªn nhá»› Ä‘Ã³ â€œchá»‰ Ä‘Æ°á»£c xem nhÆ°â€ lÃ  repo trung tÃ¢m, chá»© vá» máº·t ká»¹ thuáº­t thÃ¬ GIT khÃ´ng há» cÃ³ cÃ¡i gÃ¬ gá»i lÃ  repo trung tÃ¢m cáº£. VÃ­ dá»¥ nhÆ° repo origin á»Ÿ hÃ¬nh bÃªn dÆ°á»›i.</p><p><img src="http://nvie.com/img/centr-decentr@2x.png" alt=""></p><p>Má»—i developer sáº½ pull vÃ  push vá»›i origin. BÃªn cáº¡nh Ä‘Ã³, má»—i ngÆ°á»i cÃ³ thá»ƒ pull nhá»¯ng thay Ä‘á»•i tá»« nhá»¯ng ngÆ°á»i khÃ¡c Ä‘á»ƒ táº¡o thÃ nh cÃ¡c sub teams. Äiá»u nÃ y sáº½ thá»±c sá»± cÃ³ Ã­ch khi pháº£i lÃ m viá»‡c nhÃ³m 2-3 ngÆ°á»i trá»Ÿ lÃªn Ä‘á»ƒ hoÃ n thÃ nh má»™t feature lá»›n, mÃ  khÃ´ng pháº£i Ä‘áº©y source code váº«n Ä‘ang dá»Ÿ dang lÃªn origin. á» hÃ¬nh váº½ bÃªn trÃªn, cÃ¡c subteams lÃ  Alice-Bob, Alice-David, Clair-David.</p><p>Vá» máº·t ká»¹ thuáº­t, Ä‘Æ¡n giáº£n lÃ  Alice Ä‘á»‹nh nghÄ©a má»™t Git remote lÃ  bob, trá» Ä‘áº¿n repo cá»§a Bob, vÃ  ngÆ°á»£c láº¡i.</p><h2 id="Nhung-branches-chinh"><a href="#Nhung-branches-chinh" class="headerlink" title="Nhá»¯ng branches chÃ­nh"></a>Nhá»¯ng branches chÃ­nh</h2><p>Repo trung tÃ¢m sáº½ chá»©a hai branches chÃ­nh hoáº¡t Ä‘á»™ng mÃ£i mÃ£i:</p><ul><li>master</li><li>develop</li></ul><p>NhÃ¡nh master táº¡i origin lÃ  nhÃ¡nh quen thuá»™c vá»›i táº¥t cáº£ cÃ¡c Git users. Song song lÃ  nhÃ¡nh develop.</p><p><img src="http://nvie.com/img/main-branches@2x.png" alt=""></p><p>origin/master Ä‘Æ°á»£c coi lÃ  nhÃ¡nh chÃ­nh vá»›i HEAD pháº£n Ã¡nh tráº¡ng thÃ¡i production-ready.</p><p>origin/develop Ä‘Æ°á»£c coi lÃ  nhÃ¡nh chÃ­nh vá»›i HEAD pháº£n Ã¡nh tráº¡ng thÃ¡i thay Ä‘á»•i má»›i nháº¥t trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn, chuáº©n bá»‹ cho release tiáº¿p theo.</p><p>Khi source code bÃªn develop Ä‘áº¡t Ä‘áº¿n má»™t má»©c Ä‘á»™ á»•n Ä‘á»‹nh nÃ o Ä‘Ã³ vÃ  sáºµn sÃ ng Ä‘á»ƒ release thÃ¬ sáº½ Ä‘Æ°á»£c merge sang bÃªn master vÃ  Ä‘Ã¡nh dáº¥u vá»›i release number.</p><p>NhÆ° váº­y, theo Ä‘á»‹nh nghÄ©a vá» nhÃ¡nh master, chÃºng ta máº·c Ä‘á»‹nh hiá»ƒu ráº±ng khi cÃ³ thay Ä‘á»•i Ä‘Æ°á»£c merge vÃ o master thÃ¬ tá»©c lÃ  sáº½ cÃ³ má»™t phiÃªn báº£n production má»›i Ä‘Æ°á»£c release. Nhá» Ä‘Ã³ chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng script Ä‘á»ƒ tá»± Ä‘á»™ng build lÃªn production server má»—i khi cÃ³ commit á»Ÿ master.</p><h2 id="Nhung-branches-phu"><a href="#Nhung-branches-phu" class="headerlink" title="Nhá»¯ng branches phá»¥"></a>Nhá»¯ng branches phá»¥</h2><p>BÃªn cáº¡nh hai branches chÃ­nh master vÃ  develop, mÃ´ hÃ¬nh mÃ  tÃ´i Ä‘ang sá»­ dá»¥ng cÃ²n cÃ³ thÃªm ráº¥t nhiá»u nhá»¯ng branches phá»¥ Ä‘á»ƒ giÃºp cÃ¡c team members cÃ³ thá»ƒ phÃ¡t triá»ƒn song song, dá»… dÃ ng tracking theo features, chuáº©n bá»‹ cho release hoáº·c fix nhanh cÃ¡c váº¥n Ä‘á» production. KhÃ¡c vá»›i hai branches chÃ­nh kia, cÃ¡c branches phá»¥ nÃ y chá»‰ tá»“n táº¡i trong má»™t khoáº£ng thá»i gian ngáº¯n, rá»“i sáº½ bá»‹ xoÃ¡ Ä‘i.</p><ul><li>Feature branches</li><li>Release branches</li><li>Hotfix branches</li></ul><p>PhÃ­a trÃªn lÃ  cÃ¡c loáº¡i branches khÃ¡c nhau tÃ´i hay sá»­ dá»¥ng. Má»—i loáº¡i branches láº¡i cÃ³ má»™t nhiá»‡m vá»¥ riÃªng, vÃ  cÃ¡ch xá»­ lÃ½ riÃªng. TÃ´i sáº½ Ä‘i sÃ¢u vÃ o phÃ¢n tÃ­ch á»Ÿ Ä‘oáº¡n sau.</p><p>Vá» máº·t ká»¹ thuáº­t, cháº£ cÃ³ branch nÃ o lÃ  â€œÄ‘áº·c biá»‡tâ€ so vá»›i cÃ¡c branches khÃ¡c cáº£. Táº¥t cáº£ chá»‰ lÃ  Git branches thÃ´ng thÆ°á»ng, chÃºng chá»‰ Ä‘Æ°á»£c phÃ¢n loáº¡i báº±ng cÃ¡ch ta sá»­ dá»¥ng ra sao thÃ´i.</p><h3 id="Feature-branches"><a href="#Feature-branches" class="headerlink" title="Feature branches"></a>Feature branches</h3><ul><li>TÃ¡ch tá»«: develop</li><li>Merge vÃ o: develop</li><li>Naming convention: tá»± do, ngoáº¡i trá»« master, develop, release-<em>, hotfix-</em></li></ul><p><img src="http://nvie.com/img/fb@2x.png" alt=""></p><p>Feature branches (hay cÃ²n gá»i lÃ  topic branches) Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ phÃ¡t triá»ƒn cÃ¡c feature má»›i phá»¥c vá»¥ cho release sau nÃ y. Khi báº¯t Ä‘áº§u phÃ¡t triá»ƒn má»™t chá»©c nÄƒng, cÃ³ thá»ƒ chÆ°a rÃµ Ä‘Æ°á»£c thá»i Ä‘iá»ƒm chá»©c nÄƒng Ä‘Ã³ Ä‘Æ°á»£c tÃ­ch há»£p vÃ o há»‡ thá»‘ng vÃ  release. Feature branch sáº½ tá»“n táº¡i trong quÃ¡ trÃ¬nh chá»©c nÄƒng Ä‘Æ°á»£c phÃ¡t triá»ƒn, cuá»‘i cÃ¹ng sáº½ Ä‘Æ°á»£c merge láº¡i vÃ o develop (khi quyáº¿t Ä‘á»‹nh láº§n release tá»›i bao gá»“m chá»©c nÄƒng Ä‘Ã³) hoáº·c bá»‹ bá» Ä‘i (khi tháº¥y chá»©c nÄƒng khÃ´ng cÃ²n cáº§n thiáº¿t).</p><p>Vá» cÆ¡ báº£n thÃ¬ feature branches chá»‰ tá»“n táº¡i á»Ÿ repos cá»§a developers, chá»© ko pháº£i á»Ÿ origin.</p><h4 id="Tao-feature-branch"><a href="#Tao-feature-branch" class="headerlink" title="Táº¡o feature branch"></a>Táº¡o feature branch</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b myfeature develop</span><br></pre></td></tr></table></figure><h4 id="Merge-vao-develop"><a href="#Merge-vao-develop" class="headerlink" title="Merge vÃ o develop"></a>Merge vÃ o develop</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout develop</span><br><span class="line">$ git merge --no--ff myfeature</span><br><span class="line">$ git branch -d myfeature</span><br><span class="line">$ git push origin develop</span><br></pre></td></tr></table></figure><p>â€“no-ff giÃºp thao tÃ¡c merge luÃ´n táº¡o ra má»™t commit má»›i, ngay cáº£ khi cÃ³ thá»ƒ merge theo fast-forward. Flag nÃ y giÃºp chÃºng ta khÃ´ng bá»‹ máº¥t thÃ´ng tin liÃªn quan Ä‘áº¿n lá»‹ch sá»­ cÃ¡c commits cá»§a feature branch.</p><p><img src="http://nvie.com/img/merge-without-ff@2x.png" alt=""></p><p>á» trÆ°á»ng há»£p bÃªn pháº£i, khÃ´ng thá»ƒ nháº­n biáº¿t Ä‘Æ°á»£c nhá»¯ng commits nÃ o phÃ¡t triá»ƒn cÃ¹ng chá»©c nÄƒng náº¿u khÃ´ng ngá»“i Ä‘á»c log message cá»§a tá»«ng commit. Khi dáº¥y, náº¿u muá»‘n revert láº¡i cáº£ feature (pháº£i revert nhiá»u commits liÃªn quan) thÃ¬ thá»±c sá»± lÃ  Ä‘au Ä‘áº§u. VÃ  Ä‘Ã³ lÃ  lÃ½ do mÃ  â€“no-ff Ä‘Æ°á»£c sá»­ dá»¥ng.</p><p>ÄÆ°Æ¡ng nhiÃªn, nÃ³ sáº½ táº¡o ra thÃªm vÃ i commit, nhÆ°ng cháº£ cÃ³ váº¥n Ä‘á» gÃ¬ cáº£.</p><h3 id="Release-branches"><a href="#Release-branches" class="headerlink" title="Release branches"></a>Release branches</h3><ul><li>TÃ¡ch tá»«: develop</li><li>Merge vÃ o: develop vÃ  master</li><li>Naming convention: release-*</li></ul><p>Release branches Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chuáº©n bá»‹ cho release báº£n production má»›i. Táº¥t cáº£ cÃ¡c cÃ´ng viá»‡c cuá»‘i cÃ¹ng trÆ°á»›c khi release sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n á»Ÿ Ä‘Ã¢y, ngoÃ i ra cÃ²n Ä‘á»ƒ fix ná»‘t cÃ¡c bugs láº» táº», chuáº©n bá»‹ meta-data (version number, build dates, etc..). Nhá» viá»‡c tÃ¡ch nhÃ¡nh ra khá»i develop, chÃºng ta cÃ³ thá»ƒ tiáº¿p tá»¥c phÃ¡t triá»ƒn cÃ¡c features cho Ä‘á»£t release khÃ¡c má»™t cÃ¡ch bÃ¬nh thÆ°á»ng.</p><p>Thá»i Ä‘iá»ƒm Ä‘Æ°á»£c lá»±a chá»n Ä‘á»ƒ tÃ¡ch nhÃ¡nh tá»« develop lÃ  khi develop pháº£n Ã¡nh Ä‘Æ°á»£c tráº¡ng thÃ¡i mong muá»‘n cho viá»‡c release má»›i. Ãt nháº¥t lÃºc Ä‘Ã³ táº¥t cáº£ cÃ¡c features dÃ nh cho Ä‘á»£t release pháº£i Ä‘Æ°á»£c merge vÃ o develop rá»“i. Nhá»¯ng features nháº¯m Ä‘áº¿n cÃ¡c láº§n release sau thÃ¬ chÆ°a Ä‘Æ°á»£c merge vÃ o, pháº£i Ä‘á»£i sau khi tÃ¡ch nhÃ¡nh.</p><p>ChÃºng ta sáº½ tiáº¿n hÃ nh Ä‘Ã¡nh version theo rule cá»§a dá»± Ã¡n ngay sau khi táº¡o release branch.</p><h4 id="Tao-release-branch"><a href="#Tao-release-branch" class="headerlink" title="Táº¡o release branch"></a>Táº¡o release branch</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b release-1.2 develop</span><br><span class="line">$ ./bump-version.sh 1.2</span><br><span class="line">$ git commit -a -m &quot;Bumped version number to 1.2&quot;</span><br></pre></td></tr></table></figure><p>á» vÃ­ dá»¥ trÃªn, bump-version.sh tÆ°á»£ng trÆ°ng cho má»™t script thay Ä‘á»•i má»™t vÃ i files trong source code Ä‘á»ƒ pháº£n Ã¡nh version má»›i. Sau khi táº¡o branch má»›i vÃ  chuyá»ƒn sang branch Ä‘Ã³, chÃºng ta sáº½ thá»±c hiá»‡n nÃ¢ng version, rá»“i commit thao tÃ¡c Ä‘Ã³.</p><p>Branch má»›i nÃ y sáº½ tá»“n táº¡i cho Ä‘áº¿n khi viá»‡c release Ä‘Æ°á»£c thá»±c hiá»‡n gá»n gháº½. Trong khoáº£ng thá»i gian Ä‘Ã³, cÃ³ thá»ƒ thá»±c hiá»‡n fix bugs á»Ÿ branch nÃ y, tuy nhiÃªn nghiÃªm cáº¥m viá»‡c bá»• sung feature má»›i lÃªn Ä‘Ã³. Tá»‘t nháº¥t náº¿u cÃ³ features má»›i thÃ¬ hÃ£y merge vÃ o develop, vÃ  Ä‘á»£i Ä‘á»£t release sau.</p><h4 id="Ket-thuc-release-branch"><a href="#Ket-thuc-release-branch" class="headerlink" title="Káº¿t thÃºc release branch"></a>Káº¿t thÃºc release branch</h4><p>Khi source code trÃªn release branch sáºµn sÃ ng Ä‘á»ƒ release, Ä‘áº§u tiÃªn, pháº£i merge vÃ o master, sau Ä‘Ã³ pháº£i Ä‘c merge láº¡i vÃ o develop Ä‘á»ƒ nhá»¯ng láº§n release sau cÅ©ng chá»©a nhá»¯ng thay Ä‘á»•i á»Ÿ láº§n nÃ y.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge --no-ff release-1.2</span><br><span class="line">$ git tag -a 1.2</span><br></pre></td></tr></table></figure><p>Váº­y lÃ  source code Ä‘Ã£ Ä‘Æ°á»£c release lÃªn master, vÃ  Ä‘Ã£ Ä‘Æ°á»£c tag Ä‘á»ƒ tiá»‡n sau nÃ y tham chiáº¿u.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout develop</span><br><span class="line">$ git merge --no-ff release-1.2</span><br></pre></td></tr></table></figure><p>á» bÆ°á»›c nÃ y, ráº¥t cÃ³ thá»ƒ sáº½ cÃ³ confict, nÃªn hÃ£y fix nÃ³ rá»“i commit nhÃ©.</p><p>BÃ¢y giá» thÃ¬ viá»‡c release Ä‘Ã£ hoÃ n thÃ nh, vÃ  chÃºng ta ko cáº§n Ä‘áº¿n branch nÃ y ná»¯a.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d release-1.2</span><br></pre></td></tr></table></figure><h3 id="Hotfix-branches"><a href="#Hotfix-branches" class="headerlink" title="Hotfix branches"></a>Hotfix branches</h3><ul><li>TÃ¡ch tá»«: master</li><li>Merge vÃ o: develop vÃ  master</li><li>Naming convention: hotfix-*</li></ul><p><img src="http://nvie.com/img/hotfix-branches@2x.png" alt=""></p><p>Hotfix branches cÅ©ng giá»‘ng release branches á»Ÿ chá»— Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chuáº©n bá»‹ cho viá»‡c release production má»›i, chá»‰ khÃ¡c á»Ÿ chá»— lÃ  ko cÃ³ plan tá»« trÆ°á»›c. Khi cÃ³ má»™t bug nghiÃªm trá»ng trÃªn báº£n production cáº§n Ä‘Æ°á»£c giáº£i quyáº¿t ngay láº­p tá»©c, má»™t hotfix branch sáº½ Ä‘Æ°á»£c tÃ¡ch ra tá»« master vÃ  Ä‘Æ°á»£c Ä‘Ã¡nh version Ä‘á»ƒ nháº­n biáº¿t.</p><p>Æ¯u Ä‘iá»ƒm cá»§a viá»‡c tÃ¡ch nhÃ¡nh nÃ y á»Ÿ chá»— cÃ¡c team members khÃ¡c cÃ³ thá»ƒ tiáº¿p tá»¥c cÃ´ng viá»‡c á»Ÿ develop trong khi nhá»¯ng ngÆ°á»i khÃ¡c cÃ³ thá»ƒ táº­p trung vÃ o fix bug cá»§a production.</p><h4 id="Tao-hotfix-branch"><a href="#Tao-hotfix-branch" class="headerlink" title="Táº¡o hotfix branch"></a>Táº¡o hotfix branch</h4><p>Hotfix branch Ä‘Æ°á»£c táº¡o ra tá»« master. VÃ­ dá»¥ hiá»‡n táº¡i version 1.2 lÃ  phiÃªn báº£n production Ä‘ang cháº¡y vÃ  xuáº¥t hiá»‡n lá»—i nghiÃªm trá»ng. Tuy nhiÃªn source code trÃªn develop váº«n chÆ°a á»•n Ä‘á»‹nh, vÃ¬ tháº¿ chÃºng ta pháº£i tÃ¡ch nhÃ¡nh hotfix vÃ  tiáº¿n hÃ nh sá»­a lá»—i.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b hotfix-1.2.1 master</span><br><span class="line">$ ./bump-version.sh 1.2.1</span><br><span class="line">$ git commit -a -m &quot;Bumped version number to 1.2.1&quot;</span><br></pre></td></tr></table></figure><p>Sau khi tÃ¡ch nhÃ¡nh pháº£i tiáº¿n hÃ nh up version luÃ´n nhÃ©!</p><p>Sau khi sá»­a lá»—i, hÃ£y thá»±c hiá»‡n commit.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &quot;Fixed severe production problem&quot;</span><br></pre></td></tr></table></figure><h4 id="Ket-thuc-hotfix-branch"><a href="#Ket-thuc-hotfix-branch" class="headerlink" title="Káº¿t thÃºc hotfix branch"></a>Káº¿t thÃºc hotfix branch</h4><p>Sau khi káº¿t thÃºc sá»­a lá»—i, nhá»¯ng thay Ä‘á»•i pháº£i Ä‘Æ°á»£c merge láº¡i master, Ä‘á»“ng thá»i cÅ©ng pháº£i merge vÃ o develop Ä‘á»ƒ ngÄƒn lá»—i xáº£y ra á»Ÿ nhá»¯ng láº§n release sau. Nghe ráº¥t giá»‘ng vá»›i xá»­ lÃ½ trÃªn release branch pháº£i khÃ´ng.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge --no-ff hotfix-1.2.1</span><br><span class="line">$ git tag -a 1.2.1</span><br><span class="line"></span><br><span class="line">$ git checkout develop</span><br><span class="line">$ git merge --no-ff hotfix-1.2.1</span><br></pre></td></tr></table></figure><p>Tuy nhiÃªn, cÃ³ má»™t Ä‘iá»ƒm cáº§n lÆ°u Ã½ ráº±ng: <strong>khi Ä‘ang tá»“n táº¡i má»™t release branch thÃ¬ cáº§n pháº£i merge hotfix vÃ o release branch Ä‘Ã³, thay cho develop</strong>. Khi release branch Ä‘Æ°á»£c merge vÃ o develop thÃ¬ cuá»‘i cÃ¹ng nhá»¯ng thay Ä‘á»•i trong hotfix cÅ©ng Ä‘Æ°á»£c merge vÃ o develop, nÃªn khÃ´ng cÃ³ váº¥n Ä‘á» gÃ¬ cáº£. Trá»« khi thá»±c sá»± cÃ´ng viá»‡c á»Ÿ develop cáº§n pháº§n hotfix ngay láº­p tá»©c vÃ  ko thá»ƒ Ä‘á»£i release branch Ä‘Æ°á»£c merge, thÃ¬ cáº§n cáº©n tháº­n merge hotfix vÃ o develop.</p><p>Cuá»‘i cÃ¹ng, chÃºng ta cÅ©ng ko cáº§n Ä‘áº¿n branch nÃ y ná»¯a:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d hotfix-1.2.1</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Má»›i Ä‘áº§u mÃ¬nh tÃ­nh viáº¿t vá» &lt;a href=&quot;https://github.com/nvie/gitflow&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;git-flow&lt;/a&gt; - má»™t tool Ä‘Æ¡n giáº£n dÃ¹ng Ä‘á»ƒ quáº£n lÃ½ Git branches, xong tháº¥y bÃ i viáº¿t &lt;a href=&quot;http://nvie.com/posts/a-successful-git-branching-model/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;nÃ y&lt;/a&gt; vá» má»™t vÃ­ dá»¥ sá»­ dá»¥ng Git branches hay quÃ¡, nÃªn quyáº¿t Ä‘á»‹nh dá»‹ch luÃ´n.&lt;/p&gt;
&lt;h2 id=&quot;Mo-dau&quot;&gt;&lt;a href=&quot;#Mo-dau&quot; class=&quot;headerlink&quot; title=&quot;Má»Ÿ Ä‘áº§u&quot;&gt;&lt;/a&gt;Má»Ÿ Ä‘áº§u&lt;/h2&gt;&lt;p&gt;Ngay bÃ¢y giá», tÃ´i sáº½ giá»›i thiá»‡u vá»›i cÃ¡c báº¡n mÃ´ hÃ¬nh sá»­ dá»¥ng Git mÃ  tÃ´i Ä‘Ã£ vÃ  Ä‘ang sá»­ dá»¥ng trong cÃ¡c dá»± Ã¡n khoáº£ng má»™t nÄƒm trá»Ÿ láº¡i Ä‘Ã¢y. ÄÃ³ lÃ  má»™t mÃ´ hÃ¬nh thá»±c sá»± thÃ nh cÃ´ng, nhÆ°ng mÃ£i Ä‘áº¿n giá» tÃ´i má»›i cÃ³ cÆ¡ há»™i Ä‘á»ƒ cÃ³ thá»ƒ viáº¿t vá» nÃ³ vÃ  chia sáº» vá»›i cÃ¡c báº¡n. TÃ´i sáº½ khÃ´ng Ä‘i vÃ o chi tiáº¿t dá»± Ã¡n, mÃ  chá»‰ xoay quanh chiáº¿n lÆ°á»£c quáº£n lÃ½ cÃ¡c phÃ¢n nhÃ¡nh mÃ  thÃ´i.&lt;br&gt;
    
    </summary>
    
    
      <category term="git" scheme="http://nthung2112.github.io/tags/git/"/>
    
      <category term="gitflow" scheme="http://nthung2112.github.io/tags/gitflow/"/>
    
  </entry>
  
  <entry>
    <title>Giá»›i thiá»‡u vá» Atomic CSS</title>
    <link href="http://nthung2112.github.io/2019/01/Gioi-thieu-ve-Atomic-CSS.html"/>
    <id>http://nthung2112.github.io/2019/01/Gioi-thieu-ve-Atomic-CSS.html</id>
    <published>2019-01-06T10:18:00.000Z</published>
    <updated>2019-01-06T10:39:27.084Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nhung-van-de-voi-cach-viet-CSS-hien-tai"><a href="#Nhung-van-de-voi-cach-viet-CSS-hien-tai" class="headerlink" title="Nhá»¯ng váº¥n Ä‘á» vá»›i cÃ¡ch viáº¿t CSS hiá»‡n táº¡i"></a>Nhá»¯ng váº¥n Ä‘á» vá»›i cÃ¡ch viáº¿t CSS hiá»‡n táº¡i</h2><h3 id="Specificity-war-tham-cung-noi-chien"><a href="#Specificity-war-tham-cung-noi-chien" class="headerlink" title="Specificity war, thÃ¢m cung ná»™i chiáº¿n"></a>Specificity war, thÃ¢m cung ná»™i chiáº¿n</h3><p>Báº¡n cÃ²n nhá»› láº§n Ä‘áº§u báº¡n viáº¿t CSS giá»‘ng nhÆ° tháº¿ nÃ o khÃ´ng? CÃ³ thá»ƒ lÃ  khai bÃ¡o style cho má»™t tháº» HTML nÃ o Ä‘Ã³.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: rainbow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Sau Ä‘Ã³ báº¡n biáº¿t thÃªm vá» ID vÃ  class:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#header</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: fabulous;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>VÃ  báº¡n há»c Ä‘Æ°á»£c cÃ¡ch xá»­ lÃ½ cÃ¡c pseudo selectors, hoáº·c khai bÃ¡o cho cÃ¡c pháº§n tá»­ anh chá»‹ em con chÃ¡u há» hÃ ng, v.vâ€¦</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#header</span> &gt; <span class="selector-tag">a</span><span class="selector-pseudo">:first-child</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: unicorn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#header</span> <span class="selector-tag">p</span> &gt; <span class="selector-tag">a</span><span class="selector-class">.text</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">'â›“'</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: Comic Sans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Rá»“i khi báº¡n Ä‘Ã£ quen vá»›i CSS vÃ  báº¯t tay vÃ o lÃ m dá»± Ã¡n thá»±c táº¿, báº¡n bÃ ng hoÃ ng nháº­n ra káº» thÃ¹ khÃ´ng á»Ÿ Ä‘Ã¢u xa, chÃºng Ä‘ang lá»Ÿn vá»Ÿn quanh ta Ã­ mÃ . Báº¡n bÆ°á»›c vÃ o cuá»™c chiáº¿n gá»i lÃ  <a href="https://css-tricks.com/a-specificity-battle/" target="_blank" rel="noopener">â€œspecificity warâ€</a>, Ä‘Ã¡nh nhau tÆ¡i bá»i khÃ³i lá»­a vá»›i class Ä‘Æ°á»£c viáº¿t bá»Ÿi cÃ¡c chiáº¿n há»¯u trong team. Quáº£ lÃ  má»™t tráº­n Ä‘áº¥u kinh hoÃ ng khi ai cÅ©ng muá»‘n Ä‘Ã¨ Ä‘áº§u cÆ°á»¡i cá»• (override) ngÆ°á»i Ä‘i trÆ°á»›c. Káº» náº¯m giá»¯ !important trong tay cá»© nghÄ© Ä‘Ã£ gáº§n vá»›i chiáº¿n tháº¯ng, nÃ o ngá» xuáº¥t hiá»‡n tiá»ƒu nhÃ¢n dÃ¹ng inline style + !important. TÃ¬nh anh em sá»©t máº», chiáº¿n há»¯u quay Ä‘áº§u khÃ´ng nhÃ¬n máº·t nhau. Báº¡n á»©c cháº¿ vÃ  gÃ o lÃªn â€œÄ‘áº­u phá»™ng CSS ğŸ¥œâ€.</p><blockquote><p><strong>Specificity lÃ  gÃ¬?</strong></p><p>Specificity lÃ  má»™t trá»ng sá»‘ Ä‘Æ°á»£c trÃ¬nh duyá»‡t sá»­ dá»¥ng Ä‘á»ƒ quyáº¿t Ä‘á»‹nh CSS style nÃ o sáº½ Ä‘Æ°á»£c Ã¡p dá»¥ng cho cÃ¡c element. Specificity Ä‘Æ°á»£c tÃ­nh toÃ¡n dá»±a vÃ o phÃ¢n loáº¡i selector vÃ  sá»‘ lÆ°á»£ng selector Ã¡p dá»¥ng lÃªn má»™t element. Báº¡n cÃ³ thá»ƒ Ä‘á»c thÃªm vá» chá»§ Ä‘á» nÃ y <a href="http://gockinhnghiem.com/2011/11/09/specificity-trong-css-la-gi/" target="_blank" rel="noopener">á»Ÿ Ä‘Ã¢y</a> hoáº·c trÃªn trang <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Specificity" target="_blank" rel="noopener">MDN</a>. <a href="http://cssspecificity.com" target="_blank" rel="noopener">http://cssspecificity.com</a> minh hoáº¡ khÃ¡ cá»¥ thá»ƒ cÃ¡ch tÃ­nh specificity.</p></blockquote><h3 id="Block-Elementâ€“Modifier"><a href="#Block-Elementâ€“Modifier" class="headerlink" title="Block__Elementâ€“Modifier"></a>Block__Elementâ€“Modifier</h3><p>DÃ¢n tay to máº·t bá»± Ä‘á»c Ä‘áº¿n Ä‘Ã¢y cÃ³ láº½ Ä‘ang Ã¢m tháº§m (hoáº·c cÃ´ng khai) cÆ°á»i kháº©y: â€œAi kÃªu gÃ , xÃ i BEM lÃ  Ä‘Æ°á»£c rá»“iâ€. ChÃ­p chÃ­p ğŸ¥</p><blockquote><p><strong>Cho nhá»¯ng báº¡n chÆ°a biáº¿t:</strong></p><p><a href="https://css-tricks.com/bem-101/" target="_blank" rel="noopener">BEM - Block Element Modifier</a> lÃ  má»™t phÆ°Æ¡ng phÃ¡p Ä‘áº·t tÃªn CSS class Ä‘Æ°á»£c phÃ¡t triá»ƒn bá»Ÿi Yandex. Theo lÃ½ thuyáº¿t, BEM giÃºp báº¡n xÃ¢y dá»±ng cÃ¡c class theo tá»«ng block, má»—i block láº¡i cÃ³ element con, vÃ  cÃ¡c element nÃ y cÃ³ thá»ƒ sáº½ cÃ³ giao diá»‡n khÃ¡c nhau tuá»³ thuá»™c vÃ o modifier cá»§a nÃ³.</p><p>VÃ­ dá»¥ Ä‘Ã¢y lÃ  CSS:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment">/* Block */</span></span><br><span class="line">&gt; .btn &#123;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment">/* Element */</span></span><br><span class="line">&gt; .btn__price &#123;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment">/* Modifier */</span></span><br><span class="line">&gt; .btn--big &#123;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt; .btn--green &#123;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>Ãp dá»¥ng vÃ o HTML:</p><p><code>&lt;button class=&quot;btn btn--big btn--green&quot;&gt;&lt;span class=&quot;btn__price&quot;&gt;$9.99&lt;/span&gt;&lt;/button&gt;</code></p></blockquote><p>HoÃ n toÃ n khÃ´ng sai. BEM lÃ  má»™t phÆ°Æ¡ng phÃ¡p hiá»‡u quáº£ Ä‘á»ƒ chia nhá» trang thÃ nh tá»«ng component, vÃ  báº¡n hoÃ n toÃ n cÃ³ thá»ƒ trÃ¡nh Ä‘Æ°á»£c cuá»™c thÃ¡nh chiáº¿n á»Ÿ trÃªn báº±ng cÃ¡ch chá»‰ sá»­ dá»¥ng class Ä‘Æ°á»£c Ä‘áº·t tÃªn theo BEM. NgoÃ i ra, khi má»™t component khÃ´ng cÃ²n Ä‘Æ°á»£c dÃ¹ng ná»¯a, báº¡n cÃ³ thá»ƒ tá»± tin xoÃ¡ Ä‘i class cá»§a nÃ³ mÃ  khÃ´ng sá»£ áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c component khÃ¡c.</p><p>Tuy nhiÃªn BEM cÅ©ng cÃ³ nhá»¯ng váº¥n Ä‘á» â€œkhÃ³ chá»‹uâ€ mÃ  báº¡n cÃ³ thá»ƒ xem thÃªm á»Ÿ bÃ i viáº¿t <a href="https://www.smashingmagazine.com/2016/06/battling-bem-extended-edition-common-problems-and-how-to-avoid-them/" target="_blank" rel="noopener">Battling BEM CSS: 10 Common Problems And How To Avoid Them</a>. Kinh nghiá»‡m cÃ¡ nhÃ¢n lÃ  khi lÃ m viá»‡c vá»›i BEM, cÃ³ thá»ƒ báº¡n sáº½ bá» kha khÃ¡ thá»i gian chá»‰ Ä‘á»ƒ suy nghÄ© vá» ngá»¯ nghÄ©a (semantics) cá»§a class. Báº¡n sáº½ pháº£i cÃ¢n nháº¯c block nÃ y nÃªn Ä‘áº·t tÃªn lÃ  gÃ¬, nhá»¯ng thÃ nh pháº§n con cá»§a nÃ³ cÃ³ nÃªn lÃ  element hay lÃ  má»™t component khÃ¡c, rá»“i element nÃ y nÃªn cÃ³ tÃªn chi, nÃªn gá»i nÃ³ lÃ  wrapper, container, hay body, v.vâ€¦ Äá»«ng coi thÆ°á»ng viá»‡c Ä‘áº·t tÃªn nhÃ©, má»™t trong nhá»¯ng váº¥n Ä‘á» khÃ³ nhai nháº¥t cá»§a khoa há»c mÃ¡y tÃ­nh Ä‘áº¥y. NgoÃ i ra tÃªn class thÆ°á»ng dÃ­nh liá»n vá»›i cáº¥u trÃºc/ ná»™i dung HTML mÃ  nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng, dáº«n Ä‘áº¿n viá»‡c khi refactor code láº¡i (chuyá»ƒn thÃ nh component tá»•ng quÃ¡t hÆ¡n), chÃºng ta pháº£i tá»‘n thá»i gian suy nghÄ© tÃªn khÃ¡c cho há»£p lÃ½.</p><p>Vá»›i mÃ¬nh, viá»‡c suy nghÄ© thÃªm vá» ngá»¯ nghÄ©a cho CSS class khÃ´ng Ä‘em láº¡i hiá»‡u quáº£ Ä‘Ã¡ng ká»ƒ. VÃ¬ khÃ´ng giá»‘ng nhÆ° HTML, trÃ¬nh duyá»‡t vÃ  crawlers khÃ´ng quan tÃ¢m báº¡n Ä‘áº·t tÃªn class cÃ³ Ã½ nghÄ©a hay khÃ´ng. ChÃºng chá»‰ cÃ³ giÃ¡ trá»‹ vá»›i láº­p trÃ¬nh viÃªn, vÃ  thÆ°á»ng thÃ¬ chÃºng ta chá»‰ muá»‘n viáº¿t HTML/CSS sao cho giá»‘ng vá»›i thiáº¿t káº¿ tá»« designers nháº¥t mÃ  thÃ´i.</p><h3 id="Tinh-tai-su-dung-va-kich-thuoc-tap-tin-CSS"><a href="#Tinh-tai-su-dung-va-kich-thuoc-tap-tin-CSS" class="headerlink" title="TÃ­nh tÃ¡i sá»­ dá»¥ng vÃ  kÃ­ch thÆ°á»›c táº­p tin CSS"></a>TÃ­nh tÃ¡i sá»­ dá»¥ng vÃ  kÃ­ch thÆ°á»›c táº­p tin CSS</h3><p>Má»‰a mai thay, tÃ­nh cháº¥t â€œcascadingâ€ cá»§a CSS vá»‘n Ä‘Æ°á»£c sinh ra Ä‘á»ƒ há»— trá»£ tÃ¡i sá»­ dá»¥ng code láº¡i lÃ  má»™t con dao 2 lÆ°á»¡i vÃ  Ä‘em Ä‘áº¿n phiá»n muá»™n cho biáº¿t bao nhiÃªu ngÆ°á»i. Cascading cÃ¹ng vá»›i specificity lÃ m cho CSS trá»Ÿ nÃªn khÃ³ dá»± Ä‘oÃ¡n vÃ  lá»i khuyÃªn lÃ  háº¡n cháº¿ cascading Ä‘Æ°á»£c bao nhiÃªu hay báº¥y nhiÃªu. Äiá»u nÃ y dáº«n Ä‘áº¿n táº­p tin CSS chá»©a nhiá»u khai bÃ¡o bá»‹ trÃ¹ng láº¯p.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.ie6 #footer-content .flex-control-nav li a,</span><br><span class="line">.ie7 #footer-content .flex-control-nav li a,</span><br><span class="line">.ie8 #footer-content .flex-control-nav li a &#123;</span><br><span class="line">  float: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#nav.challenger-a li.menu-products &#123;</span><br><span class="line">  float: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Khi dá»± Ã¡n cá»§a báº¡n phÃ¡t triá»ƒn, nhiá»u component xuáº¥t hiá»‡n Ä‘á»“ng nghÄ©a vá»›i kÃ­ch thÆ°á»›c táº­p tin CSS ngÃ y cÃ ng to ra. ÄÃ¡ng buá»“n lÃ , khÃ´ng pháº£i táº¥t cáº£ CSS Ä‘Æ°á»£c gá»­i xuá»‘ng cho ngÆ°á»i dÃ¹ng sáº½ tháº­t sá»± Ä‘Æ°á»£c sá»­ dá»¥ng trong trang.</p><p><img src="https://res.cloudinary.com/duqeezi8j/image/upload/f_auto,c_scale,w_1000/v1545725390/1_qoyWe6NLqjzVRlDb5YWQAA_nhykgd.jpg" alt=""></p><p><em>KÃ­ch thÆ°á»›c táº­p tin CSS cá»§a cÃ¡c website lá»›n, tÃ­nh Ä‘áº¿n thÃ¡ng 11 nÄƒm 2016. Nguá»“n: [1]</em></p><h2 id="Vay-atomic-CSS-giai-quyet-duoc-nhung-van-de-tren-a"><a href="#Vay-atomic-CSS-giai-quyet-duoc-nhung-van-de-tren-a" class="headerlink" title="Váº­y atomic CSS giáº£i quyáº¿t Ä‘Æ°á»£c nhá»¯ng váº¥n Ä‘á» trÃªn Ã ?"></a>Váº­y atomic CSS giáº£i quyáº¿t Ä‘Æ°á»£c nhá»¯ng váº¥n Ä‘á» trÃªn Ã ?</h2><p>CÃ³ thá»ƒ. NhÆ°ng trÆ°á»›c háº¿t hÃ£y xem atomic CSS lÃ  gÃ¬ Ä‘Ã£.</p><p>Atomic CSS lÃ  cÃ¡ch khai bÃ¡o cÃ¡c class sao cho má»—i class chá»‰ mÃ´ táº£ má»™t tÃ­nh nÄƒng duy nháº¥t. Äá»ƒ xÃ¢y dá»±ng component lá»›n hÆ¡n, chÃºng ta sáº½ káº¿t há»£p cÃ¡c class nguyÃªn tá»­ nÃ y láº¡i vá»›i nhau. Cháº³ng háº¡n nhÆ°:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.white</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bg-green</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#3d9970</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.px-10</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*  OÃ¡t Ä‘á» há»£i (à² _à² ) */</span></span><br></pre></td></tr></table></figure><p>Trong vÃ­ dá»¥ trÃªn, class white chá»‰ lÃ m duy nháº¥t má»™t viá»‡c lÃ  Ä‘á»•i chá»¯ sang mÃ u tráº¯ng, bg-green sáº½ thiáº¿t láº­p ná»n sang mÃ u xanh, trong khi px-10 chá»‰nh padding á»Ÿ bÃªn trÃ¡i vÃ  pháº£i (trá»¥c x/ trá»¥c hoÃ nh) thÃ nh 10px. Má»™t component Ä‘Æ°á»£c viáº¿t theo atomic CSS sáº½ giá»‘ng nhÆ° tháº¿ nÃ y:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"b1 b--green bg-green white br-5 ma-10 f3 ttu fw-400 padding-10"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bg-dark o4 white padding-x-12 fw-600 br-left-5"</span>&gt;</span>$9.99<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Purchase</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>See the Pen <a href="https://codepen.io/ehkoo/pen/KbmGEq/" target="_blank" rel="noopener">BEM vs atomic CSS</a> by Ehkoo (<a href="https://codepen.io/ehkoo" target="_blank" rel="noopener">@ehkoo</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p>Atomic CSS Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi cÃ¡c cÃ´ng ty nhÆ° <a href="https://www.npmjs.com/" target="_blank" rel="noopener">npm</a>, <a href="https://stackoverflow.design/product/guidelines/using-stacks#goals" target="_blank" rel="noopener">StackOverflow</a>, <a href="https://design.herokai.com/purple3" target="_blank" rel="noopener">Heroku</a>, v.vâ€¦</p><p><strong>Chuyá»‡n bÃªn lá»: Functional CSS, Atomic CSS, hay Utility-first CSS?</strong></p><p>â€œFunctional CSSâ€ lÃ  tÃªn gá»i Ä‘áº§u tiÃªn mÃ¬nh báº¯t gáº·p khi tÃ¬m hiá»ƒu vá» cÃ¡ch viáº¿t CSS nÃ y. Tá»« â€œfunctionalâ€ ngoÃ i nghÄ©a nhÆ° trong â€œfunctional programmingâ€ cÃ²n cÃ³ nghÄ©a lÃ  â€œhoáº¡t Ä‘á»™ngâ€ (trÃ­ch <a href="https://en.oxforddictionaries.com/definition/functional" target="_blank" rel="noopener">tá»« Ä‘iá»ƒn Oxford</a>). Do Ä‘Ã³ â€œfunctional CSSâ€ cÃ³ thá»ƒ hiá»ƒu lÃ  â€œCSS hoáº¡t Ä‘á»™ng Ä‘Æ°á»£câ€, hoÃ n toÃ n khÃ´ng liÃªn quan Ä‘áº¿n Ã½ tÆ°á»Ÿng chÃ­nh: Ä‘áº·t CSS class thÃ nh tá»«ng hÃ m nhá».</p><p>Má»™t tÃªn gá»i khÃ¡c lÃ  â€œAtomic CSSâ€, theo nghÄ©a má»—i class lÃ  má»™t â€œnguyÃªn tá»­â€ Ä‘á»™c láº­p. TÃªn gá»i nÃ y ráº¥t phÃ¹ há»£p vá»›i tiÃªu chÃ­ chia nhá» class, nhÆ°ng Ä‘Ã¡ng tiáº¿c thay khi nÃ³ â€œcÃ³ thá»ƒâ€ nháº§m láº«n lÃ  cÃ³ liÃªn quan tá»›i phÆ°Æ¡ng thá»©c <a href="http://atomicdesign.bradfrost.com/chapter-2/" target="_blank" rel="noopener">Atomic Design</a>. NgoÃ i ra, cÃ³ má»™t thÆ° viá»‡n cá»§a Yahoo! cÅ©ng tÃªn lÃ  <a href="https://acss.io/" target="_blank" rel="noopener">Atomic CSS</a>.</p><p>Cuá»‘i cÃ¹ng, â€œUtility-first CSSâ€ cÃ³ láº½ lÃ  tÃªn gá»i mÃ´ táº£ chÃ­nh xÃ¡c nháº¥t. â€œUtility-firstâ€ mang nghÄ©a â€œtáº­p trung xÃ¢y dá»±ng cÃ¡c class há»— trá»£â€. Äiá»ƒm trá»« cá»§a thuáº­t ngá»¯ nÃ y lÃ â€¦tÃªn dÃ i quÃ¡.</p><p>Suy Ä‘i xÃ©t láº¡i thiá»‡t hÆ¡n thÃ¬ trong bÃ i viáº¿t nÃ y mÃ¬nh chá»n â€œatomic CSSâ€ (chá»¯ â€œaâ€ viáº¿t thÆ°á»ng) vÃ¬â€¦gÃµ nhanh thÃ´i. NhÆ°ng báº¡n Ä‘á»ƒ Ã½ lÃ  3 thuáº­t ngá»¯ nÃ y Ä‘á»u dÃ¹ng chung cho má»™t cÃ¡ch viáº¿t CSS nhÃ©.</p><h2 id="Vay-co-gi-hay"><a href="#Vay-co-gi-hay" class="headerlink" title="Váº­y cÃ³ gÃ¬ hay?"></a>Váº­y cÃ³ gÃ¬ hay?</h2><h3 id="Tranh-canh-binh-dao"><a href="#Tranh-canh-binh-dao" class="headerlink" title="TrÃ¡nh cáº£nh binh Ä‘ao"></a>TrÃ¡nh cáº£nh binh Ä‘ao</h3><p>Lá»£i Ã­ch Ä‘áº§u tiÃªn lÃ  cÅ©ng giá»‘ng nhÆ° BEM, atomic CSS chá»‰ cho phÃ©p khai bÃ¡o cÃ¡c class nÃªn chÃºng khÃ´ng xáº£y ra tranh cháº¥p specificity. Äá»“ng thá»i vÃ¬ má»—i class chá»‰ mÃ´ táº£ má»™t tÃ­nh nÄƒng duy nháº¥t, viá»‡c cÃ¡c thuá»™c tÃ­nh giáº«m chÃ¢n lÃªn nhau Ä‘Æ°á»£c háº¡n cháº¿ á»Ÿ má»©c tháº¥p nháº¥t.</p><p>CÃ²n váº«n ghÃ©t nhau quÃ¡, muá»‘n Ä‘áº¡p nhau cho cháº¿t thÃ¬ Ä‘Ã¢y:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"red"</span>&gt;</span></span><br><span class="line">  Roses are red</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"blue"</span>&gt;</span></span><br><span class="line">    Violets are blue</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"yellow"</span>&gt;</span></span><br><span class="line">      Honey is sweet</span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"brown"</span>&gt;</span>But not as sweet as you<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><em>Credit: @huytd</em></p><h3 id="Tap-tin-CSS-nhe-hon"><a href="#Tap-tin-CSS-nhe-hon" class="headerlink" title="Táº­p tin CSS nháº¹ hÆ¡n"></a>Táº­p tin CSS nháº¹ hÆ¡n</h3><p>Báº±ng cÃ¡ch xÃ¢y dá»±ng component báº±ng nhá»¯ng class nguyÃªn tá»­, báº¡n khÃ´ng cáº§n pháº£i láº·p Ä‘i láº·p láº¡i nhá»¯ng khai bÃ¡o Ä‘Ã£ cÃ³. Khi nháº­n Ä‘Æ°á»£c thiáº¿t káº¿ cho component má»›i, báº¡n chá»‰ cáº§n káº¿t há»£p nhá»¯ng class Ä‘Ã£ cÃ³ sáºµn vá»›i nhau hoáº·c viáº¿t thÃªm atomic classes. Nhá»¯ng class má»›i xuáº¥t hiá»‡n sáº½ tiáº¿p tá»¥c Ä‘Æ°á»£c tÃ¡i sá»­ dá»¥ng nÃªn sá»‘ lÆ°á»£ng class báº¡n thÃªm vÃ o sáº½ ngÃ y cÃ ng giáº£m Ä‘i khi tuá»•i thá» cá»§a dá»± Ã¡n dÃ i ra. Trong bÃ i viáº¿t <a href="https://medium.com/@johnpolacek/by-the-numbers-a-year-and-half-with-atomic-css-39d75b1263b4" target="_blank" rel="noopener">By The Numbers: A Year and Half with Atomic CSS</a>, John Polacek Ä‘Ã£ thá»­ nghiá»‡m chuyá»ƒn Ä‘á»•i tá»« CSS truyá»n thá»‘ng sang atomic CSS vÃ  káº¿t quáº£ lÃ  dung lÆ°á»£ng táº­p tin giáº£m tá»« 123.1KB xuá»‘ng cÃ²n 72.7KB (chÆ°a nÃ©n gzip).</p><p><img src="https://res.cloudinary.com/duqeezi8j/image/upload/c_scale,f_auto,w_1000/v1545725434/1_Tvxaigmr3ve2GrWDwHB9Pw_qtsoai.jpg" alt=""></p><p>Káº¿t quáº£ cuá»‘i cÃ¹ng lÃ  cÃ ng ngÃ y báº¡n sáº½ cÃ ng viáº¿t Ã­t CSS láº¡i.</p><h3 id="Khong-phai-suy-nghi-chuyen-dat-ten-class"><a href="#Khong-phai-suy-nghi-chuyen-dat-ten-class" class="headerlink" title="KhÃ´ng pháº£i suy nghÄ© chuyá»‡n Ä‘áº·t tÃªn class"></a>KhÃ´ng pháº£i suy nghÄ© chuyá»‡n Ä‘áº·t tÃªn class</h3><p>VÃ¬ cÃ¡c atomic classes Ä‘Æ°á»£c Ä‘áº·t tÃªn gáº§n vá»›i thuá»™c tÃ­nh cá»§a chÃºng, báº¡n khÃ´ng cáº§n pháº£i suy nghÄ© nÃªn Ä‘áº·t tÃªn gÃ¬. Má»™t lá»£i Ã­ch ná»¯a lÃ  nhÃ¬n vÃ o HTML báº¡n cÃ³ thá»ƒ tÆ°Æ¡ng Ä‘á»‘i biáº¿t Ä‘Æ°á»£c style cá»§a má»™t element. Láº¥y vÃ­ dá»¥:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- BEM --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn--big btn--green"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"btn__price"</span>&gt;</span>$9.99<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Purchase<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- atomic CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"b1 b--green bg-green white br-5 ma-10 f3 ttu fw-400 padding-10"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bg-dark o4 white padding-x-12 fw-600 br-left-5"</span>&gt;</span>$9.99<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Purchase</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Vá»›i BEM, báº¡n cÃ³ thá»ƒ sÆ¡ Ä‘oÃ¡n â€œÃ  cÃ¡i nÃºt nÃ y lÃ  cÃ¡i nÃºt mÃ u xanh bá»± nÃ¨â€, nhÆ°ng â€œbá»±â€ lÃ  cÃ¡i gÃ¬ â€œbá»±â€, font size hay height, vÃ  cÃ¡i gÃ¬ â€œxanhâ€, chá»¯ xanh, ná»n xanh hay viá»n xanh. Khi Ä‘i Ä‘áº¿n btn__price thÃ¬ hoÃ n toÃ n khÃ´ng thá»ƒ biáº¿t Ä‘Æ°á»£c style cá»§a nÃ³. So sÃ¡nh vá»›i atomic CSS, báº¡n cÃ³ thá»ƒ Ä‘á»c ngay lÃ  â€œnÃºt nÃ y cÃ³ viá»n 1px, viá»n mÃ u xanh, ná»n xanh, chá»¯ tráº¯ng, bo trÃ²n gÃ³c 5px, margin á»Ÿ bá»‘n phÃ­a 10px, font á»Ÿ level 3, chá»¯ Ä‘Æ°á»£c chuyá»ƒn thÃ nh chá»¯ hoa cÃ³ font weight 400, padding bá»‘n phÃ­a 10pxâ€. TÆ°Æ¡ng tá»± vá»›i tháº» SPAN, báº¡n cÃ³ thá»ƒ Ä‘á»c lÃ  â€œná»n Ä‘en cÃ³ opacity 0.4, chá»¯ tráº¯ng, padding trÃ¡i pháº£i 12px, font weight 600, bo trÃ²n gÃ³c bÃªn trÃ¡i 5pxâ€.</p><p>Liá»‡u viá»‡c Ä‘á»c style nhÆ° tháº¿ nÃ y cÃ³ cáº§n thiáº¿t? Náº¿u báº¡n má»›i báº¯t Ä‘áº§u, cÃ¢u tráº£ lá»i cÃ³ thá»ƒ lÃ  khÃ´ng, nhÆ°ng khi Ä‘Ã£ quen rá»“i, Ä‘á»c class nhanh giÃºp báº¡n debug vÃ  thay Ä‘á»•i style dá»… dÃ ng hÆ¡n.</p><h3 id="Xay-dung-prototype-nhanh-hon"><a href="#Xay-dung-prototype-nhanh-hon" class="headerlink" title="XÃ¢y dá»±ng prototype nhanh hÆ¡n"></a>XÃ¢y dá»±ng prototype nhanh hÆ¡n</h3><p>Prototyping, hay lÃ  chuyá»‡n lÃ m nhá»¯ng giao diá»‡n giáº£ Ä‘á»ƒ kiá»ƒm tra UI/UX, khÃ´ng cÃ²n láº¡ vá»›i dÃ¢n lÃ m frontend ná»¯a. Má»™t trong nhá»¯ng lÃ½ do báº¡n chá»n Bootstrap, Foundation, hay Bulmaâ€¦ cho dá»± Ã¡n vÃ¬ Ä‘Æ¡n giáº£n chÃºng cung cáº¥p nhá»¯ng component Ä‘Æ°á»£c xÃ¢y dá»±ng sáºµn, cÃ¹ng vá»›i há»‡ thá»‘ng grid vÃ  cÃ¡c class há»— trá»£. NhÆ°ng rá»“i báº¡n sáº½ lÃ¢m vÃ o cáº£nh Ä‘Ã¡nh nhau vá»›i cÃ¡c class cá»§a framework Ä‘á»ƒ tuá»³ biáº¿n cho phÃ¹ há»£p vá»›i chuáº©n thiáº¿t káº¿. Káº¿t quáº£ ra sao thÃ¬ báº¡n biáº¿t rá»“i.</p><p>CÃ¡c framework Ä‘Æ°á»£c thiáº¿t káº¿ theo hÆ°á»›ng atomic khÃ´ng cÃ³ nhiá»u component, nhÆ°ng bÃ¹ láº¡i chÃºng khÃ´ng Ä‘áº·t quÃ¡ nhiá»u Ã½ kiáº¿n riÃªng vÃ  Ã©p buá»™c báº¡n pháº£i lÃ m theo. Háº§u háº¿t Ä‘á»u cho phÃ©p báº¡n tuá»³ chá»‰nh mÃ u sáº¯c, kÃ­ch thÆ°á»›c theo Ã½, tá»« Ä‘Ã³ báº¡n cÃ³ thá»ƒ xÃ¢y dá»±ng lÃªn nhá»¯ng component cáº§n thiáº¿t.</p><h2 id="Han-che"><a href="#Han-che" class="headerlink" title="Háº¡n cháº¿"></a>Háº¡n cháº¿</h2><h3 id="Bung-no-class"><a href="#Bung-no-class" class="headerlink" title="BÃ¹ng ná»• class"></a>BÃ¹ng ná»• class</h3><p><a href="http://tachyons.io/docs/themes/skins/" target="_blank" rel="noopener">Tachyons</a> lÃ  má»™t trong nhá»¯ng atomic CSS framework phá»• biáº¿n nháº¥t. Trong phiÃªn báº£n 4.10.0, Tachyons há»— trá»£ 37 mÃ u. Giáº£ sá»­ má»—i mÃ u sáº½ cÃ³ class tÆ°Æ¡ng á»©ng vá»›i mÃ u chá»¯, mÃ u ná»n, mÃ u viá»n, hover Ä‘á»•i mÃ u chá»¯, hover Ä‘á»•i mÃ u ná»n, vÃ  hover Ä‘á»•i mÃ u viá»n. Tachyons cÃ³ 3 breakpoints. NhÆ° váº­y tá»•ng sá»‘ class Ä‘Æ°á»£c táº¡o ra lÃ  37 x 8 (thuá»™c tÃ­nh) x 3 = 888 classes. Náº¿u báº¡n pháº£i sá»­ dá»¥ng nhiá»u mÃ u hÆ¡n, vÃ­ dá»¥ nhÆ° color palette cá»§a <a href="https://material.io/design/color/the-color-system.html#tools-for-picking-colors" target="_blank" rel="noopener">Material Design</a>, há»— trá»£ nhiá»u thuá»™c tÃ­nh vÃ  pseudo selector hÆ¡n, thÃªm vÃ i breakpoints ná»¯a, báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘oÃ¡n Ä‘Æ°á»£c sá»‘ lÆ°á»£ng class phÃ¬nh ra nhÆ° tháº¿ nÃ o.</p><p>Thá»±c táº¿ lÃ  khÃ´ng pháº£i táº¥t cáº£ class mÃ u Ä‘á»u Ä‘Æ°á»£c sá»­ dá»¥ng, nÃªn viá»‡c táº¡o ra class Ä‘á»ƒ bao gá»“m táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p lÃ  khÃ´ng cáº§n thiáº¿t. CÃ¡ch giáº£i quyáº¿t á»Ÿ Ä‘Ã¢y lÃ  chá»‰ viáº¿t thÃªm class khi báº¡n tháº­t sá»± cáº§n Ä‘áº¿n nÃ³.</p><h3 id="Tim-va-thay-doi-class-theo-yeu-cau-moi-kho-hon"><a href="#Tim-va-thay-doi-class-theo-yeu-cau-moi-kho-hon" class="headerlink" title="TÃ¬m vÃ  thay Ä‘á»•i class theo yÃªu cáº§u má»›i khÃ³ hÆ¡n"></a>TÃ¬m vÃ  thay Ä‘á»•i class theo yÃªu cáº§u má»›i khÃ³ hÆ¡n</h3><p>Giáº£ sá»­ má»™t ngÃ y Ä‘áº¹p trá»i nÃ o Ä‘Ã³, Ä‘á»“ng chÃ­ Nguyá»…n VÄƒn XÃ i NÆ¡ quyáº¿t Ä‘á»‹nh ná»n mÃ u xanh cá»§a táº¥t cáº£ cÃ¡c nÃºt pháº£i Ä‘áº­m hÆ¡n chÃºt xÃ­u, nÃºt bá»± nghÄ©a lÃ  font size pháº£i á»Ÿ level 2. Vá»›i BEM, báº¡n chá»‰ cáº§n thay Ä‘á»•i giÃ¡ trá»‹ cá»§a class .btnâ€“green vÃ  .btnâ€“big lÃ  xong. Trong khi Ä‘Ã³ báº¡n khÃ´ng thá»ƒ Ä‘á»•i mÃ£ mÃ u cá»§a .bg-green bá»Ÿi vÃ¬ thay Ä‘á»•i nÃ y chá»‰ Ã¡p dá»¥ng trÃªn nÃºt vÃ  biáº¿t Ä‘Ã¢u Ä‘Æ°á»£c mÃ u cÅ© váº«n Ä‘Æ°á»£c dÃ¹ng á»Ÿ nÆ¡i khÃ¡c. Báº¡n cÅ©ng khÃ´ng thá»ƒ tuá»³ tiá»‡n tÄƒng font size cá»§a .f3. Giáº£i phÃ¡p an toÃ n nháº¥t lÃ  tÃ¬m táº¥t cáº£ cÃ¡c nÃºt, xoÃ¡ Ä‘i class cÅ© vÃ  thÃªm vÃ o f2 bg-dark-green. Báº¡n tÃ¬m cÃ¡c nÃºt báº±ng cÃ¡ch nÃ o? Search and Replaceâ€¦ bg-green white br-5 ma-10 f3 -&gt; bg-dark-green white br-5 ma-10 f2? Lá»¡ nhÆ° cÃ³ má»™t class nÃ o Ä‘Ã³ chen vÃ o giá»¯a bg-green white br-5 ma-10 letter-spacing-1 f3 vÃ  tháº¿ lÃ  tÃ¨n tÃ©n ten.</p><p>Náº¿u dá»± Ã¡n cá»§a báº¡n sá»­ dá»¥ng React, Vue, hay cÃ¡c thÆ° viá»‡n há»— trá»£ (web) component khÃ¡c, viá»‡c thay Ä‘á»•i nÃ y khÃ´ng thÃ nh váº¥n Ä‘á». CÃ²n vá»›i thuáº§n HTML thÃ¬â€¦coi bá»™ cá»±c Ä‘Ã³. Báº¡n cÃ³ thá»ƒ Ä‘áº·t tÃªn cho UI component báº±ng data-, nhÆ°ng nhÆ° váº­y markup sáº½ bá»‹ rá»‘i vÃ  á»Ÿ phÃ­a ngÆ°á»i dÃ¹ng, cÃ¡c thuá»™c tÃ­nh nÃ y hoÃ n toÃ n khÃ´ng Ä‘Æ°á»£c dÃ¹ng Ä‘áº¿n.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-ui-name</span>=<span class="string">"button-big-green"</span> <span class="attr">class</span>=<span class="string">"b1 b--green bg-green white br-5 ma-10 f3 ttu fw-400 padding-10"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bg-dark o4 white padding-x-12 fw-600 br-left-5"</span>&gt;</span>$9.99<span class="tag">&lt;/<span class="name">span</span>&gt;</span> Purchase</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Nghi-ngo-tu-cong-dong"><a href="#Nghi-ngo-tu-cong-dong" class="headerlink" title="Nghi ngá» tá»« cá»™ng Ä‘á»“ng"></a>Nghi ngá» tá»« cá»™ng Ä‘á»“ng</h3><p>ThÃ nh tháº­t mÃ  nÃ³i, atomic CSS ráº¥t khÃ´ng tá»± nhiÃªn khi tiáº¿p xÃºc láº§n Ä‘áº§u tiÃªn. ChÃºng ta Ä‘Ã£ quÃ¡ quen vá»›i cÃ¡ch viáº¿t CSS truyá»n thá»‘ng/ BEM, vÃ  khi nhÃ¬n tháº¥y má»™t Ä‘á»‘ng class Ä‘i chung vá»›i nhá»¯ng cÃ¡i tÃªn xa láº¡ nhÆ° ma, px, hay ttu, nghi ngá» lÃ  pháº£n á»©ng ráº¥t dá»… hiá»ƒu.</p><blockquote><p><strong>Váº­y cÃ³ khÃ¡c gÃ¬ inline style?</strong></p></blockquote><p>NhÃ¬n sÆ¡ qua thÃ¬ Ä‘Ãºng lÃ  giá»‘ng nhÆ° inline style váº­y, vÃ  ai cÅ©ng biáº¿t inline style lÃ  bad practice. NhÆ°ng atomic classes khÃ¡c hoÃ n toÃ n vÃ  máº¡nh máº½ hÆ¡n inline style nhiá»u. Atomic classes cho phÃ©p báº¡n viáº¿t media queries, @support, pseudo selectors hay sá»­ dá»¥ng animation, nhá»¯ng Ä‘iá»u mÃ  inline style khÃ´ng lÃ m Ä‘Æ°á»£c. VÃ  vÃ¬ atomic CSS Ä‘Æ°á»£c lÆ°u trong táº­p tin CSS, trÃ¬nh duyá»‡t cÃ³ thá»ƒ lÆ°u vÃ o bá»™ nhá»› Ä‘á»‡m, khÃ´ng giá»‘ng nhÆ° inline style.</p><blockquote><p><strong>TÃªn class tháº¥y gá»›m</strong></p></blockquote><p>Kiá»ƒu viáº¿t táº¯t ma (margin all), px (padding x), ph (padding horizontal) hay bg ráº¥t phá»• biáº¿n trong cá»™ng Ä‘á»“ng atomic CSS. Ban Ä‘áº§u báº¡n cÃ³ thá»ƒ tháº¥y khÃ³ hiá»ƒu vÃ  tá»‘n thá»i gian Ä‘á»ƒ há»c, nhÆ°ng sau má»™t thá»i gian chÃºng sáº½ trá»Ÿ nÃªn tá»± nhiÃªn.</p><p>NgoÃ i ra cÃ²n má»™t sá»‘ Ã½ kiáº¿n pháº£n Ä‘á»‘i atomic CSS ná»¯a mÃ  náº¿u muá»‘n, báº¡n cÃ³ thá»ƒ Ä‘á»c bÃ i viáº¿t <a href="https://medium.com/simple-human/the-problem-with-atomic-css-d0c09c7aa38e" target="_blank" rel="noopener">The Problem with Atomic CSS</a> rá»“i tá»± Ä‘Æ°a ra nháº­n xÃ©t. Spoiler alert: khÃ´ng pháº£i táº¥t cáº£ luáº­n Ä‘iá»ƒm trong bÃ i Ä‘á»u há»£p lÃ½.</p><h2 id="Tich-hop-vao-du-an"><a href="#Tich-hop-vao-du-an" class="headerlink" title="TÃ­ch há»£p vÃ o dá»± Ã¡n"></a>TÃ­ch há»£p vÃ o dá»± Ã¡n</h2><p>Náº¿u báº¡n Ä‘á»c Ä‘áº¿n Ä‘Ã¢y vÃ  khÃ´ng cáº£m tháº¥y atomic CSS lÃ  má»™t Ã½ tÆ°á»Ÿng dá»‹ há»£m thÃ¬ bÃ i viáº¿t nÃ y coi nhÆ° Ä‘Ã£ thÃ nh cÃ´ng. Äá»ƒ dÃ¹ng atomic CSS trong dá»± Ã¡n, báº¡n cÃ³ thá»ƒ chá»n cÃ¡ch dÃ¹ng cÃ¡c thÆ° viá»‡n cÃ³ sáºµn, hoáº·c tá»± xÃ¢y dá»±ng thÆ° viá»‡n riÃªng.</p><h3 id="Dung-hang-an-san"><a href="#Dung-hang-an-san" class="headerlink" title="DÃ¹ng hÃ ng Äƒn sáºµn"></a>DÃ¹ng hÃ ng Äƒn sáºµn</h3><p>CÃ¡ch nÃ y phÃ¹ há»£p vá»›i nhá»¯ng dá»± Ã¡n má»›i hoáº·c báº¡n muá»‘n thá»­ nghiá»‡m vá»›i atomic CSS. Hiá»‡n táº¡i thÃ¬ hai thÆ° viá»‡n phá»• biáº¿n nháº¥t lÃ  <a href="http://tachyons.io/" target="_blank" rel="noopener">Tachyons</a> vÃ  <a href="http://tailwindcss.com/" target="_blank" rel="noopener">Tailwind</a>. Tachyons cÃ³ lÆ°á»£ng ngÆ°á»i dÃ¹ng Ä‘Ã´ng Ä‘áº£o vÃ¬ xuáº¥t hiá»‡n trÆ°á»›c, nhÆ°ng Tailwind láº¡i máº¡nh máº½ hÆ¡n vÃ¬ cho phÃ©p báº¡n thay Ä‘á»•i mÃ u sáº¯c, kÃ­ch thÆ°á»›c, v.vâ€¦ hoÃ n toÃ n theo Ã½ muá»‘n. KhÃ´ng thÃ¬ báº¡n cÃ³ thá»ƒ dÃ¹ng há»‡ thá»‘ng thiáº¿t káº¿ cá»§a <a href="https://stackoverflow.design/product/guidelines/using-stacks#goals" target="_blank" rel="noopener">StackOverflow</a> hay <a href="https://design.herokai.com/purple3" target="_blank" rel="noopener">Heroku</a> cÅ©ng Ä‘Æ°á»£c.</p><p>Sá»± tháº­t lÃ  cÃ¡c atomic classes quÃ¡ nhá» nÃªn chÃºng gáº§n nhÆ° giá»‘ng há»‡t nhau á»Ÿ táº¥t cáº£ framework, cÃ³ khÃ¡c chÄƒng chá»‰ lÃ  tÃªn gá»i mÃ  thÃ´i.</p><h3 id="Tu-trong"><a href="#Tu-trong" class="headerlink" title="Tá»± trá»“ng"></a>Tá»± trá»“ng</h3><p>Trong má»™t dá»± Ã¡n Ä‘ang cháº¡y, náº¿u muá»‘n Ã¡p dá»¥ng atomic CSS thÃ¬ khÃ´ng gÃ¬ tá»‘t hÆ¡n lÃ  tá»± trá»“ng láº¥y má»™t framework. CÃ¡c atomic classes ráº¥t nhá» vÃ  Ä‘Æ¡n giáº£n nÃªn hoÃ n toÃ n khÃ´ng cÃ³ gÃ¬ khÃ³ Ä‘á»ƒ tá»± viáº¿t cáº£. Báº¡n cÃ³ thá»ƒ tá»« tá»« bÃ³c tÃ¡ch cÃ¡c thuá»™c tÃ­nh cá»§a cÃ¡c class cÅ© vÃ  chuyá»ƒn chÃºng thÃ nh atomic classes. Dá»± Ã¡n cá»§a báº¡n cÃ³ thá»ƒ sáº¯p xáº¿p cÃ¡c táº­p tin (S)CSS nhÆ° tháº¿ nÃ y.</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">styles/utils/</span><br><span class="line">â”œâ”€â”€ _animation<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _background<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _border<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _box-shadow<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _color<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _cursor<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _display<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _flex<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _font-size<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _font-weight<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _height<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _letter-spacing<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _line-<span class="attribute">height</span><span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _list<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _margin<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _max-<span class="attribute">width</span><span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _padding<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _ratio<span class="selector-class">.scss</span></span><br><span class="line">â”œâ”€â”€ _text-align<span class="selector-class">.scss</span></span><br><span class="line">â””â”€â”€ _width<span class="selector-class">.scss</span></span><br></pre></td></tr></table></figure><p>Vá» viá»‡c Ä‘áº·t tÃªn, báº¡n cÃ³ thá»ƒ chá»n kiá»ƒu viáº¿t táº¯t px, ma hay ttu nhÆ° trong Tachyons, hoáº·c kiá»ƒu Ä‘áº§y Ä‘á»§ padding-x, margin-all, text-transform-uppercase. CÃ¡i nÃ y tuá»³ thuá»™c vÃ o sá»Ÿ thÃ­ch cá»§a tá»«ng team.</p><p>NgoÃ i ra, viá»‡c viáº¿t láº·p Ä‘i láº·p láº¡i nhÃ³m class cÃ³ thá»ƒ gÃ¢y nhÃ m chÃ¡n, do Ä‘Ã³ báº¡n Ä‘á»«ng quÃªn táº­n dá»¥ng cÃ¡c cÃ´ng cá»¥ tiá»n xá»­ lÃ½ CSS nhÆ° SASS, LESS, hay Stylus Ä‘á»ƒ cuá»™c sá»‘ng dá»… thá»Ÿ hÆ¡n. Cháº³ng háº¡n nhÆ° Ä‘oáº¡n code dÆ°á»›i Ä‘Ã¢y Ä‘á»ƒ táº¡o ra cÃ¡c class liÃªn quan Ä‘áº¿n height:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$list</span>: <span class="number">28</span> <span class="number">96</span> <span class="number">128</span> <span class="number">640</span>;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">each</span> <span class="variable">$value</span> in <span class="variable">$list</span> &#123;</span><br><span class="line">  <span class="selector-class">.h-</span>#&#123;<span class="variable">$value</span>&#125; &#123;</span><br><span class="line">    <span class="attribute">height</span>: #&#123;<span class="variable">$value</span>&#125;px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Khi cáº§n thÃªm má»™t giÃ¡ trá»‹ má»›i, báº¡n chá»‰ cáº§n bá» nÃ³ vÃ o $list. Báº¡n cÅ©ng cÃ³ thá»ƒ dÃ¹ng mixin Ä‘á»ƒ táº¡o ra cÃ¡c class responsive:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">include</span> media(extra-large) &#123;</span><br><span class="line">  <span class="variable">$list</span>: <span class="number">28</span> <span class="number">96</span> <span class="number">128</span> <span class="number">640</span>;</span><br><span class="line"></span><br><span class="line">  @<span class="keyword">each</span> <span class="variable">$value</span> in <span class="variable">$list</span> &#123;</span><br><span class="line">    <span class="selector-class">.h-</span>#&#123;<span class="variable">$value</span>&#125;-xl &#123;</span><br><span class="line">      <span class="attribute">height</span>: #&#123;<span class="variable">$value</span>&#125;px;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ket"><a href="#Ket" class="headerlink" title="Káº¿t"></a>Káº¿t</h2><p>Náº¿u nhÃ³m cá»§a báº¡n Ä‘ang dÃ¹ng BEM hay cÃ¡c phÆ°Æ¡ng phÃ¡p phÃ¡t triá»ƒn CSS khÃ¡c vÃ  hÃ i lÃ²ng vá»›i chÃºng, báº¡n cÃ³ thá»ƒ khÃ´ng cáº§n atomic CSS. Atomic CSS khÃ´ng pháº£i sinh ra lÃ  Ä‘á»ƒ triá»‡t tiÃªu BEM, mÃ  bá»• sung vÃ  giÃºp báº¡n lÃ m viá»‡c vá»›i CSS má»™t cÃ¡ch hiá»‡u quáº£ hÆ¡n.</p><p>Cuá»‘i cÃ¹ng, hÃ£y xem video nÃ y vÃ  quyáº¿t Ä‘á»‹nh cÃ³ nÃªn xÃ i atomic CSS khÃ´ng nhÃ© ;)</p><div class="video-container"><iframe src="//www.youtube.com/embed/16W7c0mb-rE" frameborder="0" allowfullscreen></iframe></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Nhung-van-de-voi-cach-viet-CSS-hien-tai&quot;&gt;&lt;a href=&quot;#Nhung-van-de-voi-cach-viet-CSS-hien-tai&quot; class=&quot;headerlink&quot; title=&quot;Nhá»¯ng váº¥n Ä‘á» v
      
    
    </summary>
    
    
      <category term="css" scheme="http://nthung2112.github.io/tags/css/"/>
    
      <category term="atomic" scheme="http://nthung2112.github.io/tags/atomic/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P19: BÃªn trong custom element + thá»§ thuáº­t xÃ¢y dá»±ng component tá»‘i Æ°u</title>
    <link href="http://nthung2112.github.io/2019/01/Cach-Javascript-hoat-dong-P19-Ben-trong-custom-element-thu-thuat-xay-dung-component-toi-uu.html"/>
    <id>http://nthung2112.github.io/2019/01/Cach-Javascript-hoat-dong-P19-Ben-trong-custom-element-thu-thuat-xay-dung-component-toi-uu.html</id>
    <published>2019-01-05T17:03:00.000Z</published>
    <updated>2019-01-05T17:07:19.212Z</updated>
    
    <content type="html"><![CDATA[<p><strong><em>ÄÃ¢y lÃ  bÃ i cuá»‘i cÃ¹ng trong series rá»“i (cháº¯c váº­y Ã¡, lÃ¢u nay khÃ´ng tháº¥y há» Ä‘Äƒng bÃ i má»›i). Cáº£m Æ¡n má»i ngÆ°á»i Ä‘Ã£ á»§ng há»™ mÃ¬nh trong suá»‘t thá»i gian qua. Tuy nhiÃªn náº¿u SessionStack cÃ³ bÃ i viáº¿t nÃ o má»›i thÃ¬ mÃ¬nh sáº½ cáº­p nháº­t thÃªm.</em></strong></p><ul><li>Element: pháº§n tá»­</li><li>Custom element: pháº§n tá»­ tÃ¹y chá»n (tá»©c lÃ  nhá»¯ng element do ngÆ°á»i dÃ¹ng tá»± táº¡o ra)</li><li>Component: thÃ nh pháº§n</li></ul><p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 19 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.<br><a id="more"></a></p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>Trong bÃ i trÆ°á»›c chÃºng ta Ä‘Ã£ tháº£o luáº­n vá» Shadow DOM API vÃ  1 vÃ i Ã½ tÆ°á»Ÿng vá»‘n lÃ  cÃ¡c máº£nh ghÃ©p cá»§a 1 bá»©c tranh lá»›n hÆ¡n: web components. ToÃ n bá»™ Ã½ tÆ°á»Ÿng Ä‘áº±ng sau tiÃªu chuáº©n <strong>web components</strong> lÃ  cÃ³ thá»ƒ má»Ÿ rá»™ng cÃ¡c tÃ­nh nÄƒng sáºµn cÃ³ cá»§a HTML báº±ng cÃ¡ch táº¡o ra cÃ¡c element vá»«a nhá» gá»n, hÆ°á»›ng mÃ´ Ä‘un vÃ  cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng nhiá»u láº§n. ÄÃ¢y lÃ  1 tiÃªu chuáº©n tÆ°Æ¡ng Ä‘á»‘i má»›i trong W3C vÃ  Ä‘Ã£ Ä‘Æ°á»£c cháº¥p nháº­n bá»Ÿi Ä‘a sá»‘ cÃ¡c trÃ¬nh duyá»‡t lá»›n vÃ  cÃ³ thá»ƒ tháº¥y nÃ³ xuáº¥t hiá»‡n trong nhiá»u mÃ´i trÆ°á»ng productionâ€¦ dÄ© nhiÃªn lÃ  vá»›i 1 chÃºt sá»± giÃºp Ä‘á»¡ tá»« cÃ¡c thÆ° viá»‡n polyfill mÃ  chÃºng ta sáº½ nÃ³i sau.<br>*_Polyfill lÃ  Ä‘á»ƒ chá»‰ viá»‡c biáº¿n Ä‘á»•i, thay tháº¿ hoáº·c chá»‰nh sá»­a cÃ¡c tÃ­nh nÄƒng má»›i cá»§a ngÃ´n ngá»¯ JS, HTML, CSS sao cho nÃ³ cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c trÃªn cÃ¡c trÃ¬nh duyá»‡t cÅ© nhÆ° IE</p><p>NhÆ° cÃ¡c báº¡n Ä‘Ã£ biáº¿t, trÃ¬nh duyá»‡t cung cáº¥p cho chÃºng ta 1 sá»‘ Ã­t cÃ¡c cÃ´ng cá»¥ quan trá»ng Ä‘á»ƒ xÃ¢y dá»±ng website vÃ  cÃ¡c webapp. Ta Ä‘ang nÃ³i vá» HTML, CSS &amp; Javascript. Báº¡n dÃ¹ng HTML Ä‘á»ƒ kiáº¿n trÃºc nÃªn app cá»§a báº¡n, CSS Ä‘á»ƒ trang Ä‘iá»ƒm vÃ  lÃ m cho nÃ³ Ä‘áº¹p hÆ¡n rá»“i dÃ¹ng Javascript thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng khÃ¡c. Tuy nhiÃªn, trÆ°á»›c khi <strong>web components</strong> Ä‘Æ°á»£c giá»›i thiá»‡u thÃ¬ khÃ´ng cÃ³ cÃ¡ch nÃ o dá»… dÃ ng Ä‘á»ƒ liÃªn káº¿t cÃ¡c hÃ nh vi cá»§a Javascript Ä‘áº¿n vá»›i kiáº¿n trÃºc cá»§a HTML.</p><p>Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» ná»n táº£ng cá»§a web component: <strong>custom element</strong>. NÃ³i ngáº¯n gá»n, API custom element cho phÃ©p báº¡n táº¡o ra cÃ¡c custom HTML element vá»›i logic Javascript vÃ  CSS style tÃ­ch há»£p sáºµn. Ráº¥t nhiá»u ngÆ°á»i cáº£m tháº¥y bá»‘i rá»‘i nháº§m láº«n custom element vá»›i Shadow DOM. NhÆ°ng chÃºng lÃ  2 Ã½ tÆ°á»Ÿng hoÃ n toÃ n khÃ¡c nhau vÃ  chÃºng thá»±c sá»­ bá»• khuyáº¿t cho nhau thay vÃ¬ thay tháº¿ láº«n nhau.</p><p>Má»™t vÃ i framework vÃ  library nhÆ° Angular, Reactâ€¦ cá»‘ giáº£i quyáº¿t cÃ¹ng 1 váº¥n Ä‘á» báº±ng cÃ¡ch giá»›i thiá»‡u Ã½ tÆ°á»Ÿng riÃªng cá»§a há». Báº¡n cÃ³ thá»ƒ so sÃ¡nh custom element vá»›i Angular directive hoáº·c React component. Tuy nhiÃªn, custom element gáº§n gÅ©i vá»›i trÃ¬nh duyá»‡t mÃ  khÃ´ng yÃªu cáº§u gÃ¬ hÆ¡n ngoÃ i báº£n gá»‘c cá»§a Javascript, HTML, CSS. DÄ© nhiÃªn, Ä‘iá»u nÃ y khÃ´ng cÃ³ nghÄ©a ráº±ng nÃ³ lÃ  báº£n thay tháº¿ cho cÃ¡c Javascript framework Ä‘iá»ƒn hÃ¬nh. CÃ¡c framework hiá»‡n Ä‘áº¡i cho phÃ©p chÃºng ta thá»±c hiá»‡n nhiá»u thá»© hÆ¡n lÃ  chá»‰ giáº£ láº­p hÃ nh vi cá»§a custom element. VÃ¬ tháº¿ mÃ  chÃºng cÃ³ thá»ƒ cÃ¹ng hoáº¡t Ä‘á»™ng bÃªn cáº¡nh nhau.</p><h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><p>TrÆ°á»›c khi chÃºng ta Ä‘Ã o sÃ¢u hÆ¡n thÃ¬ hÃ£y cÃ¹ng duyá»‡t qua nhá»¯ng gÃ¬ mÃ  API cung cáº¥p. Object global customElements sáºµn cÃ³ cho ta vÃ i phÆ°Æ¡ng thá»©c:</p><ul><li>define(tagName, constructor, options): Äá»‹nh nghÄ©a custom element má»›i. NÃ³ nháº­n vÃ o 3 Ä‘á»‘i sá»‘: 1 tháº» tÃªn há»£p lá»‡ cho custom element, Ä‘á»‹nh nghÄ©a lá»›p cho custom element vÃ  1 object options. Hiá»‡n táº¡i thÃ¬ chá»‰ cÃ³ 1 option Ä‘Æ°á»£c há»— trá»£ lÃ  extends, mang giÃ¡ trá»‹ lÃ  1 string chá»‰ Ä‘á»‹nh tÃªn cá»§a element cÃ³ sáºµn Ä‘á»ƒ má»Ÿ rá»™ng. ThÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ táº¡o ra cÃ¡c tÃ¹y biáº¿n cá»§a element sáºµn cÃ³.</li><li>get(tagName): Tráº£ vá» constructor cá»§a 1 custom element náº¿u nhÆ° element Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vÃ  ngÆ°á»£c láº¡i thÃ¬ tráº£ vá» undefined. NÃ³ nháº­n vÃ o 1 Ä‘á»‘i sá»‘ duy nháº¥t: tháº» tÃªn há»£p lá»‡ cá»§a custom element.</li><li>whenDefined(tagName): Tráº£ vá» 1 promise vÃ  Ä‘Æ°á»£c resolve khi custom element Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. Náº¿u nhÆ° element Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a rá»“i thÃ¬ nÃ³ sáº½ resolve ngay láº­p tá»©c. Promise bá»‹ reject náº¿u nhÆ° tháº» tÃªn khÃ´ng pháº£i lÃ  tÃªn há»£p lá»‡ cá»§a custom element. NÃ³ nháº­n vÃ o 1 Ä‘á»‘i sá»‘: tháº» tÃªn há»£p lá»‡ cá»§a 1 custom element.</li></ul><h1 id="Cach-tao-custom-element"><a href="#Cach-tao-custom-element" class="headerlink" title="CÃ¡ch táº¡o custom element"></a>CÃ¡ch táº¡o custom element</h1><p>Táº¡o ra custom element ráº¥t Ä‘Æ¡n giáº£n. Báº¡n chá»‰ cáº§n lÃ m 2 viá»‡c: Ä‘á»‹nh nghÄ©a 1 lá»›p cho element vÃ  cho nÃ³ extends tá»« lá»›p HTMLElement, viá»‡c thá»© 2 lÃ  Ä‘Äƒng kÃ½ tÃªn cho element Ä‘Ã³:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomElement</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="comment">// â€¦</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// â€¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">customElements.define(<span class="string">'my-custom-element'</span>, MyCustomElement);</span><br></pre></td></tr></table></figure><p>Hoáº·c náº¿u muá»‘n thÃ¬ báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng anonymous class (lá»›p vÃ´ danh) trong trÆ°á»ng há»£p báº¡n muá»‘n code gá»n gÃ ng hÆ¡n 1 chÃºt:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">customElements.define(<span class="string">'my-custom-element'</span>, <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="comment">// â€¦</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// â€¦</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>NhÆ° cÃ¡c báº¡n Ä‘Ã£ tháº¥y, custom element Ä‘Æ°á»£c Ä‘Äƒng kÃ½ báº±ng phÆ°Æ¡ng thá»©c customElements.define(â€¦)</p><h1 id="Custom-element-giai-quyet-van-de-gi"><a href="#Custom-element-giai-quyet-van-de-gi" class="headerlink" title="Custom element giáº£i quyáº¿t váº¥n Ä‘á» gÃ¬ ?"></a>Custom element giáº£i quyáº¿t váº¥n Ä‘á» gÃ¬ ?</h1><p>Váº­y chá»© váº¥n Ä‘á» á»Ÿ Ä‘Ã¢y lÃ  gÃ¬? <strong>Div soups</strong> cháº³ng háº¡n. Tháº¿ div soups lÃ  cÃ¡i ná»“i gÃ¬? ThÃ¬ rÃµ theo nghÄ©a Ä‘en thÃ¬ nÃ³ lÃ  cÃ¡i ná»“i sÃºp tháº» div. Trong cÃ¡c á»©ng dá»¥ng webapp hiá»‡n Ä‘áº¡i thÃ¬ Ä‘Ã¢y lÃ  kiá»ƒu kiáº¿n trÃºc ráº¥t phá»• biáº¿n khi ta cÃ³ ráº¥t nhiá»u cÃ¡c tháº» div lá»“ng nhau nhÆ° tháº¿ nÃ y Ä‘Ã¢y:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"top-container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"middle-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inside-container"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inside-inside-container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"are-we-really-doing-this"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mariana-trench"</span>&gt;</span></span><br><span class="line">            â€¦</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Kiá»ƒu kiáº¿n trÃºc nhÆ° tháº¿ nÃ y thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng vÃ¬ nÃ³ báº£o trÃ¬nh duyá»‡t pháº£i render nhá»¯ng gÃ¬ mÃ  developer muá»‘n. NhÆ°ng nÃ³ láº¡i lÃ m cho code HTML khÃ³ Ä‘á»c vÃ  ráº¥t khÃ³ báº£o trÃ¬. VÃ­ dá»¥ chÃºng ta cÃ³ 1 component trÃ´ng nhÆ° tháº¿ nÃ y:<br><img src="https://cdn-images-1.medium.com/max/1000/0*v56OyrPtg_cZzzaZ" alt=""></p><p>Váº­y thÃ¬ theo cÃ¡ch cÅ©, HTML sáº½ nhÆ° tháº¿ nÃ y:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"primary-toolbar toolbar"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button-outer-box"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button-inner-box"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"icon"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"icon-undo"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button-outer-box"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button-inner-box"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"icon"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"icon-redo"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button-outer-box"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button-inner-box"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"icon"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"icon-print"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-toggle-button toolbar-button"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button-outer-box"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"toolbar-button-inner-box"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"icon"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"icon-paint-format"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Tuy nhiÃªn, tÆ°á»Ÿng tÆ°á»£ng ráº±ng chÃºng ta cÃ³ thá»ƒ lÃ m nhÆ° tháº¿ nÃ y:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">primary-toolbar</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">toolbar-group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">toolbar-button</span> <span class="attr">class</span>=<span class="string">"icon-undo"</span>&gt;</span><span class="tag">&lt;/<span class="name">toolbar-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">toolbar-button</span> <span class="attr">class</span>=<span class="string">"icon-redo"</span>&gt;</span><span class="tag">&lt;/<span class="name">toolbar-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">toolbar-button</span> <span class="attr">class</span>=<span class="string">"icon-print"</span>&gt;</span><span class="tag">&lt;/<span class="name">toolbar-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">toolbar-toggle-button</span> <span class="attr">class</span>=<span class="string">"icon-paint-format"</span>&gt;</span><span class="tag">&lt;/<span class="name">toolbar-toggle-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">toolbar-group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">primary-toolbar</span>&gt;</span></span><br></pre></td></tr></table></figure><p>RÃµ rÃ ng vÃ­ dá»¥ thá»© 2 nhÃ¬n sáº¡ch sáº½ vÃ  gá»n hÆ¡n nhiá»u. Dá»… báº£o trÃ¬, dá»… Ä‘á»c cho cáº£ trÃ¬nh duyá»‡t vÃ  developer. ÄÆ¡n giáº£n hÆ¡n nhiá»u.</p><p>Váº¥n Ä‘á» tiáº¿p theo lÃ  kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng. CÃ´ng viá»‡c cá»§a developer chÃºng ta Ä‘Ã²i há»i khÃ´ng chá»‰ viáº¿t code hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c mÃ  cÃ²n pháº£i báº£o trÃ¬ Ä‘Æ°á»£c. VÃ  1 Ä‘iá»u lÃ m cho code dá»… báº£o trÃ¬ lÃ  nÃ³ cÃ³ thá»ƒ dá»… dÃ ng tÃ¡i sá»­ dá»¥ng 1 pháº§n nÃ o Ä‘Ã³ cá»§a code thay vÃ¬ pháº£i viáº¿t Ä‘i viáº¿t láº¡i nhiá»u láº§n.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  1 vÃ­ dá»¥ Ä‘Æ¡n giáº£n nhÆ°ng báº¡n sáº½ hiá»ƒu Ã½ tÆ°á»Ÿng cá»§a nÃ³. Giáº£ sá»­ ta cÃ³ element sau:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-custom-element"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"submit"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Náº¿u chÃºng ta cáº§n sá»­ dá»¥ng nÃ³ á»Ÿ nÆ¡i nÃ o khÃ¡c thÃ¬ ta sáº½ pháº£i viáº¿t láº¡i Ä‘oáº¡n HTML trÃªn nhiá»u láº§n. Giáº£ sá»­ nhÆ° ta cáº§n thay Ä‘á»•i 1 pháº§n nÃ o Ä‘Ã³ vÃ  Ã¡p dá»¥ng cho má»i element. Ta sáº½ pháº£i Ä‘i tÃ¬m táº¥t cáº£ má»i nÆ¡i cÃ³ Ä‘oáº¡n code Ä‘Ã³ vÃ  chá»‰nh sá»­a chÃ­nh xÃ¡c cÃ¹ng 1 thay Ä‘á»•i y chang nhau ráº¥t nhiá»u láº§n, bÃ¹mâ€¦..</p><p>Váº­y thÃ¬ khÃ´ng tá»‘t hÆ¡n náº¿u ta chá»‰ cáº§n nhÆ° váº­y thÃ´i sao:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-custom-element</span>&gt;</span><span class="tag">&lt;/<span class="name">my-custom-element</span>&gt;</span></span><br></pre></td></tr></table></figure><p>NhÆ°ng webapp hiá»‡n Ä‘áº¡i khÃ´ng chá»‰ cÃ³ HTML tÄ©nh. Báº¡n cáº§n tÆ°Æ¡ng tÃ¡c vá»›i nÃ³ ná»¯a. VÃ  Ä‘Ã¢y lÃ  lÃºc ta cáº§n Javascript. ThÆ°á»ng thÃ¬ báº¡n sáº½ táº¡o ra 1 vÃ i element, ghÃ©p chÃºng vÃ o báº¥t ká»³ event listener nÃ o mÃ  báº¡n muá»‘n Ä‘á»ƒ cho nÃ³ cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c pháº£n há»“i khi cÃ³ input tá»« ngÆ°á»i dÃ¹ng. Báº¥t ká»ƒ lÃ  click, kÃ©o-tháº£, hover, nháº¥n bÃ n phÃ­m, vÃ¢n vÃ¢n</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myDiv = <span class="built_in">document</span>.querySelector(<span class="string">'.my-custom-element'</span>);</span><br><span class="line"></span><br><span class="line">myDiv.addEventListener(<span class="string">'click'</span>, _ =&gt; &#123;</span><br><span class="line">  myDiv.innerHTML = <span class="string">'&lt;b&gt; I have been clicked &lt;/b&gt;'</span>;</span><br><span class="line">&#125;);<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-custom-element"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  I have not been clicked yet.</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>Vá»›i API custom element, toÃ n bá»™ pháº§n logic nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i vÃ o bÃªn trong chÃ­nh element Ä‘Ã³. Xem vÃ­ dá»¥ bÃªn dÆ°á»›i</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomElement</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    self.addEventListener(<span class="string">'click'</span>, _ =&gt; &#123;</span><br><span class="line">      self.innerHTML = <span class="string">'&lt;b&gt; I have been clicked &lt;/b&gt;'</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">customElements.define(<span class="string">'my-custom-element'</span>, MyCustomElement);<span class="xml"><span class="tag">&lt;<span class="name">my-custom-element</span>&gt;</span></span></span><br><span class="line"><span class="xml">  I have not been clicked yet</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">my-custom-element</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>Má»›i Ä‘áº§u nhÃ¬n vÃ o thÃ¬ cÃ³ váº» nhÆ° giáº£i phÃ¡p custom element nÃ y Ä‘Ã²i há»i nhiá»u Javascript. Tuy nhiÃªn trong cÃ¡c á»©ng dá»¥ng thá»±c táº¿ thÃ¬ báº¡n sáº½ hiáº¿m khi gáº·p pháº£i trÆ°á»ng há»£p mÃ  báº¡n táº¡o ra 1 element mÃ  khÃ´ng pháº£i tÃ¡i sá»­ dá»¥ng nÃ³. Má»™t diá»u Ä‘iá»ƒn hÃ¬nh ná»¯a trong cÃ¡c webapp hiá»‡n Ä‘áº¡i lÃ  Ä‘a sá»‘ cÃ¡c element Ä‘á»u Ä‘Æ°á»£c táº¡o ra báº±ng code trong quÃ¡ trÃ¬nh hoáº¡t Ä‘á»™ng (dynamic). VÃ¬ tháº¿ báº¡n cáº§n pháº£i xá»­ lÃ½ cÃ¡c trÆ°á»ng há»£p riÃªng biá»‡t khi element Ä‘Æ°á»£c thÃªm vÃ o báº±ng Javascript hoáº·c nÃ³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÆ°á»›c kia trong kiáº¿n trÃºc HTML. Báº¡n sáº½ cÃ³ toÃ n bá»™ nhá»¯ng tÃ­nh nÄƒng áº¥y náº¿u dÃ¹ng custom element.</p><p>TÃ³m láº¡i, custom element lÃ m code báº¡n dá»… hiá»ƒu, dá»… báº£o trÃ¬ hÆ¡n, chia nhá» nÃ³ thÃ nh cÃ¡c module khÃ©p kÃ­n nhá» hÆ¡n, cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng.</p><h1 id="Cac-yeu-cau"><a href="#Cac-yeu-cau" class="headerlink" title="CÃ¡c yÃªu cáº§u"></a>CÃ¡c yÃªu cáº§u</h1><p>TrÆ°á»›c khi báº¡n báº¯t Ä‘áº§u táº¡o custom element cá»§a chÃ­nh mÃ¬nh, báº¡n nÃªn biáº¿t ráº±ng cÃ³ 1 sá»‘ quy táº¯c Ä‘áº·c biá»‡t mÃ  ta pháº£i tuÃ¢n theo:</p><ul><li>TÃªn <strong>pháº£i</strong> chá»©a dáº¥u gáº¡ch ngang (-). Báº±ng cÃ¡ch nÃ y bá»™ parser cá»§a HTML má»›i hiá»ƒu Ä‘Æ°á»£c element nÃ o lÃ  do ngÆ°á»i dÃ¹ng táº¡o ra vÃ  element nÃ o lÃ  sáºµn cÃ³. NÃ³ cÅ©ng Ä‘áº£m báº£o ráº±ng khÃ´ng cÃ³ xung Ä‘á»™t khi Ä‘áº·t tÃªn vá»›i cÃ¡c element sáºµn cÃ³ (báº¥t ká»ƒ bÃ¢y giá» hay trong tÆ°Æ¡ng lai, khi má»™t element má»›i Ä‘Æ°á»£c thÃªm vÃ o). VÃ­ dá»¥, <code>&lt;my-custom-element&gt;</code> lÃ  1 tÃªn há»£p lá»‡ trong khi <code>&lt;myCustomElement&gt;</code> vÃ  <code>&lt;my_custom_element&gt;</code> thÃ¬ khÃ´ng.</li><li>KhÃ´ng Ä‘Æ°á»£c Ä‘Äƒng kÃ½ cÃ¹ng 1 tháº» tÃªn nhiá»u hÆ¡n 1 láº§n. Äiá»u nÃ y sáº½ lÃ m cho trÃ¬nh duyá»‡t báº¯n ra 1 biá»‡t lá»‡ DOMException. Báº¡n khÃ´ng thá»ƒ ghi Ä‘Ã¨ cÃ¡c custom element.</li><li>Custom element khÃ´ng thá»ƒ tá»± Ä‘Ã³ng tháº». Bá»™ parser HTML chá»‰ cho phÃ©p 1 nhÃ³m cÃ¡c element sáºµn cÃ³ cÃ³ thá»ƒ tá»± Ä‘Ã³ng tháº» cá»§a nÃ³ (vÃ­ dá»¥: <code>&lt;img&gt;</code>, <code>&lt;link&gt;</code>, <code>&lt;br&gt;</code>).</li></ul><h1 id="Cac-kha-nang"><a href="#Cac-kha-nang" class="headerlink" title="CÃ¡c kháº£ nÄƒng"></a>CÃ¡c kháº£ nÄƒng</h1><p>Váº­y thÃ¬ báº¡n thá»±c sá»± cÃ³ thá»ƒ lÃ m Ä‘Æ°á»£c gÃ¬ vá»›i custom element? VÃ  cÃ¢u tráº£ lá»i lÃ : ráº¥t nhiá»u thá»©.</p><p>Má»™t trong sá»‘ nhá»¯ng tÃ­nh nÄƒng tá»‘t nháº¥t lÃ  Ä‘á»‹nh nghÄ©a class cá»§a element thá»±c sá»± liÃªn káº¿t Ä‘áº¿n chÃ­nh DOM element cá»§a nÃ³. Äiá»u nÃ y cÃ³ nghÄ©a báº¡n cÃ³ thá»ƒ dÃ¹ng trá»±c tiáº¿p this vá»›i event listener, truy cáº­p vÃ o cÃ¡c property cá»§a nÃ³, truy cáº­p cÃ¡c node con vÃ  vÃ¢n vÃ¢n.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomElement</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.addEventListener(<span class="string">'mouseover'</span>, _ =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'I have been hovered'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DÄ© nhiÃªn lÃ  nÃ³ cho báº¡n kháº£ nÄƒng Ä‘á»ƒ ghi Ä‘Ã¨ láº¡i node con cá»§a 1 element vá»›i ná»™i dung má»›i. VÃ  cÅ©ng dÄ© nhiÃªn lÃ  Ä‘iá»u nÃ y khÃ´ng nÃªn lÃ m, bá»Ÿi vÃ¬ nÃ³ sáº½ dáº«n Ä‘áº¿n nhiá»u váº¥n Ä‘á» khÃ´ng mong muá»‘n. RÃµ rÃ ng náº¿u nhÆ° báº¡n cÃ³ 1 custom element Ä‘ang hoáº¡t Ä‘á»™ng vÃ  Ä‘á»™t nhiÃªn phÃ¡t hiá»‡n ra pháº§n markup cá»§a element cá»§a mÃ¬nh bá»‹ thay Ä‘á»•i thÃ¬ sáº½ bá»‘i rá»‘i láº¯m.</p><p>CÃ³ 1 vÃ i vá»‹ trÃ­ Ä‘áº·c biá»‡t mÃ  báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a Ä‘á»ƒ thá»±c thi code táº¡i cÃ¡c thá»i Ä‘iá»ƒm cá»¥ thá»ƒ trong vÃ²ng Ä‘á»i cá»§a element.</p><ul><li>constructor: constructor Ä‘Æ°á»£c gá»i 1 láº§n khi element Ä‘Æ°á»£c táº¡o ra hoáº·c nÃ¢ng cáº¥p (chÃºng ta sáº½ nÃ³i vá» nÃ³ sau). Äa sá»‘ nÃ³ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ khá»Ÿi táº¡o state (tráº¡ng thÃ¡i), gáº¯n káº¿t cÃ¡c event listener, táº¡o shadow DOM, vÃ¢n vÃ¢n. LÆ°u Ã½ báº¡n háº§u nhÆ° cáº§n pháº£i gá»i super() trong constructor.</li><li>connectedCallback: phÆ°Æ¡ng thá»©c connectedCallback Ä‘Æ°á»£c gá»i má»—i láº§n element Ä‘Æ°á»£c thÃªm vÃ o DOM. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng (khuyáº¿n nghá»‹ nÃªn dÃ¹ng) Ä‘á»ƒ delay (hoÃ£n láº¡i) vÃ i viá»‡c cho Ä‘áº¿n khi element thá»±c sá»± Ä‘Æ°á»£c gáº¯n vÃ o trang (cháº³ng háº¡n nhÆ° láº¥y tÃ i nguyÃªn tá»« server).</li><li>disconnectedCallback: tÆ°Æ¡ng tá»± nhÆ° connectedCallback thÃ¬ disconnectedCallback Ä‘Æ°á»£c gá»i khi 1 element bá»‹ láº¥y ra khá»i DOM. ThÆ°á»ng lÃ  Ä‘á»ƒ giáº£i phÃ³ng tÃ i nguyÃªn. LÆ°u Ã½ ráº±ng disconnectedCallback khÃ´ng bao giá» Ä‘Æ°á»£c gá»i náº¿u nhÆ° user Ä‘Ã³ng tab. HÃ£y cáº©n tháº­n vá»›i nhá»¯ng thá»© mÃ  báº¡n khá»Ÿi táº¡o lÃºc Ä‘áº§u.</li><li>attributeChangedCallback: phÆ°Æ¡ng thá»©c nÃ y Ä‘Æ°á»£c gá»i khi 1 attribute cá»§a element Ä‘Æ°á»£c thÃªm vÃ o, gá»¡ ra, cáº­p nháº­t hoáº·c thay tháº¿. NÃ³ cÅ©ng Ä‘Æ°á»£c gá»i khi element Ä‘Æ°á»£c táº¡o ra bá»Ÿi parser. Tuy nhiÃªn, lÆ°u Ã½ ráº±ng nÃ³ chá»‰ Ã¡p dá»¥ng cho cÃ¡c attribute náº±m trong danh sÃ¡ch an toÃ n (whitelist) cá»§a property observedAttributes</li><li>addoptedCallback: phÆ°Æ¡ng thá»©c nÃ y Ä‘Æ°á»£c gá»i khi document.adoptNote(â€¦) Ä‘Æ°á»£c gá»i Ä‘á»ƒ Ä‘Æ°a Ä‘Ã³ sang 1 document khÃ¡c.</li></ul><p>LÆ°u Ã½ ráº±ng táº¥t cáº£ cÃ¡c callbacks á»Ÿ trÃªn Ä‘á»u lÃ  <strong>Ä‘á»“ng bá»™</strong>. VÃ­ dá»¥, connectedCallback Ä‘Æ°á»£c gá»i ngay láº­p tá»©c sau khi element Ä‘Æ°á»£c thÃªm vÃ o DOM vÃ  trong lÃºc Ä‘Ã³ khÃ´ng cÃ³ gÃ¬ xáº£y ra.</p><h1 id="Phan-chieu-property"><a href="#Phan-chieu-property" class="headerlink" title="Pháº£n chiáº¿u property"></a>Pháº£n chiáº¿u property</h1><p>CÃ¡c element HTML sáºµn cÃ³ cung cáº¥p 1 kháº£ nÄƒng ráº¥t tiá»‡n dá»¥ng: pháº£n chiáº¿u property. NghÄ©a lÃ  cÃ¡c giÃ¡ trá»‹ cá»§a 1 vÃ i property Ä‘Æ°á»£c pháº£n chiáº¿u trá»±c tiáº¿p vá» DOM dÆ°á»›i dáº¡ng attribute. Má»™t vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh lÃ  property id.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myDiv.id = <span class="string">'new-id'</span>;</span><br></pre></td></tr></table></figure><p>CÅ©ng sáº½ cáº­p nháº­t DOM thÃ nh:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"new-id"</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>VÃ  nÃ³ cÅ©ng Ã¡p dá»¥ng theo hÆ°á»›ng ngÆ°á»£c láº¡i ná»¯a. Pháº§n nÃ y cá»±c ká»³ tiá»‡n lá»£i bá»Ÿi vÃ¬ nÃ³ cho phÃ©p báº¡n cáº¥u hÃ¬nh cÃ¡c element khai bÃ¡o.</p><p>Custom element khÃ´ng cÃ³ tÃ­nh nÄƒng nhÆ° tháº¿ nÃ y nhÆ°ng cÃ³ 1 cÃ¡ch Ä‘á»ƒ báº¡n tá»± triá»ƒn khai. Ta cÃ³ thá»ƒ cÃ³ Ä‘Æ°á»£c tÃ­nh nÄƒng tÆ°Æ¡ng tá»± khi Ä‘á»‹nh nghÄ©a cÃ¡c getter &amp; setter cho cÃ¡c property.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomElement</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  get myProperty() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.hasAttribute(<span class="string">'my-property'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  set myProperty(newValue) &#123;</span><br><span class="line">    <span class="keyword">if</span> (newValue) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setAttribute(<span class="string">'my-property'</span>, newValue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.removeAttribute(<span class="string">'my-property'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Mo-rong-element"><a href="#Mo-rong-element" class="headerlink" title="Má»Ÿ rá»™ng element"></a>Má»Ÿ rá»™ng element</h1><p>API custom element cho phÃ©p báº¡n khÃ´ng chá»‰ táº¡o ra cÃ¡c element HTML mÃ  cÃ²n cÃ³ thá»ƒ má»Ÿ rá»™ng element sáºµn cÃ³. PhÆ°Æ¡ng phÃ¡p nÃ y hoáº¡t Ä‘á»™ng cá»±c tá»‘t cho cáº£ element sáºµn cÃ³ vÃ  custom element. Báº¡n chá»‰ cáº§n má»Ÿ rá»™ng Ä‘á»‹nh nghÄ©a class cá»§a nÃ³ lÃ  Ä‘Æ°á»£c.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAwesomeButton</span> <span class="keyword">extends</span> <span class="title">MyButton</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">customElements.define(<span class="string">'my-awesome-button'</span>, MyAwesomeButton);</span><br></pre></td></tr></table></figure><p>Hoáº·c trong trÆ°á»ng há»£p cá»§a element cÃ³ sáºµn, ta cáº§n thÃªm 1 param thá»© 3 vÃ o hÃ m customElements.define(â€¦) - má»™t object vá»›i property extends vÃ  giÃ¡ trá»‹ lÃ  tháº» tÃªn cá»§a element Ä‘ang Ä‘Æ°á»£c má»Ÿ rá»™ng. Báº±ng cÃ¡ch nÃ y trÃ¬nh duyá»‡t biáº¿t Ä‘Æ°á»£c chÃ­nh xÃ¡c thÃ¬ element nÃ o Ä‘ang Ä‘Æ°á»£c má»Ÿ rá»™ng bá»Ÿi vÃ¬ cÃ³ ráº¥t nhiá»u element sáºµn cÃ³ cÃ¹ng chia sáº» giao diá»‡n DOM. Náº¿u khÃ´ng chá»‰ Ä‘á»‹nh element nÃ o mÃ  mÃ¬nh muá»‘n má»Ÿ rá»™ng, trÃ¬nh duyá»‡t sáº½ khÃ´ng biáº¿t Ä‘Æ°á»£c chá»©c nÄƒng nÃ o Ä‘ang Ä‘Æ°á»£c má»Ÿ rá»™ng.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyButton</span> <span class="keyword">extends</span> <span class="title">HTMLButtonElement</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">customElements.define(<span class="string">'my-button'</span>, MyButton, &#123;<span class="attr">extends</span>: <span class="string">'button'</span>&#125;);</span><br></pre></td></tr></table></figure><p>Má»™t element gá»‘c má»Ÿ rá»™ng (extended native element) cÃ²n Ä‘Æ°á»£c gá»i lÃ  element Ä‘Æ°á»£c tÃ¹y biáº¿n (customized built-in element).</p><p>NguyÃªn táº¯c vÃ ng cho báº¡n Ä‘Ã³ lÃ  luÃ´n luÃ´n má»Ÿ rá»™ng cÃ¡c element Ä‘ang tá»“n táº¡i sáºµn. VÃ  lÃ m viá»‡c nÃ y má»™t cÃ¡ch dáº§n dáº§n. NÃ³ cho phÃ©p báº¡n giá»¯ láº¡i táº¥t cáº£ cÃ¡c tÃ­nh nÄƒng trÆ°á»›c Ä‘Ã³ (property, attribute, cÃ¡c hÃ m).</p><p>ChÃº Ã½ ráº±ng element Ä‘Æ°á»£c tÃ¹y biáº¿n chá»‰ Ä‘Æ°á»£c há»— trá»£ tá»« Chrome 67 trá»Ÿ lÃªn. NÃ³ sáº½ Ä‘Æ°á»£c triá»ƒn khai cho cÃ¡c trÃ¬nh duyá»‡t khÃ¡c ngoáº¡i trá»« Safari.</p><h1 id="Nang-cap-element"><a href="#Nang-cap-element" class="headerlink" title="NÃ¢ng cáº¥p element"></a>NÃ¢ng cáº¥p element</h1><p>NhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn, chÃºng ta sá»­ dá»¥ng phÆ°Æ¡ng thá»©c customElements.define(â€¦) Ä‘á»ƒ Ä‘Äƒng kÃ½ 1 custom element. NhÆ°ng nÃ³ khÃ´ng cÃ³ nghÄ©a ráº±ng Ä‘Ã³ lÃ  viá»‡c Ä‘áº§u tiÃªn báº¡n pháº£i lÃ m. ÄÄƒng kÃ½ custom element cÃ³ thá»ƒ Ä‘Æ°á»£c hoÃ£n láº¡i sau nÃ y. Ká»ƒ cáº£ sau khi chÃ­nh element Ä‘Ã³ Ä‘Æ°á»£c thÃªm vÃ o DOM. QuÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c gá»i lÃ  nÃ¢ng cáº¥p element. Äá»ƒ giÃºp báº¡n biáº¿t Ä‘Æ°á»£c thá»±c sá»± khi nÃ o thÃ¬ element Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a thÃ¬ trÃ¬nh duyá»‡t cÃ³ cung cáº¥p phÆ°Æ¡ng thá»©c customElements.whenDefine(â€¦). Báº¡n truyá»n tháº» tÃªn cá»§a element vÃ o, nÃ³ tráº£ vá» 1 promise vÃ  sáº½ Ä‘Æ°á»£c resolve khi element Ä‘Äƒng kÃ½ xong.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">customElements.whenDefined(<span class="string">'my-custom-element'</span>).then(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'My custom element is defined'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>VÃ­ dá»¥, khi báº¡n muá»‘n delay 1 vÃ i thá»© cho Ä‘áº¿n khi táº¥t cáº£ cÃ¡c element con Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a xong, cá»±c ká»³ cÃ³ Ã­ch khi mÃ  báº¡n cÃ³ cÃ¡c custom element lá»“ng nhau. Thá»‰nh thoáº£ng element cha sáº½ dá»±a vÃ o sá»± triá»ƒn khai cá»§a cÃ¡c element con. Trong trÆ°á»ng há»£p nÃ y báº¡n cáº§n Ä‘áº£m báº£o ráº±ng cÃ¡c element con Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÆ°á»›c element cha.</p><h1 id="Shadow-DOM"><a href="#Shadow-DOM" class="headerlink" title="Shadow DOM"></a>Shadow DOM</h1><p>NhÆ° Ä‘Ã£ nÃ³i, custom element vÃ  shadow DOM Ä‘i Ä‘Ã´i vá»›i nhau. Custom element Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ Ä‘Ã³ng gÃ³i logic Javascript vÃ o bÃªn trong 1 element trong khi shadow DOM Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ táº¡o ra 1 mÃ´i trÆ°á»ng khÃ©p kÃ­n cho pháº§n DOM khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi cÃ¡c yáº¿u tá»‘ bÃªn ngoÃ i. MÃ¬nh Ä‘á» nghá»‹ báº¡n nÃªn Ä‘á»c láº¡i <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-17---ben-trong-Shadow-DOM---xay-dung-component-khep-kin" target="_blank" rel="noopener">bÃ i viáº¿t trÆ°á»›c</a> Ä‘á»ƒ hiá»ƒu thÃªm vá» shadow DOM vÃ  cÃ¡c Ã½ tÆ°á»Ÿng cá»§a nÃ³.</p><p>Äá»ƒ sá»­ dá»¥ng shadow DOM cho custom element, báº¡n chá»‰ cáº§n Ä‘Æ¡n giáº£n gá»i this.attachShadow</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomElement</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> shadowRoot = <span class="keyword">this</span>.attachShadow(&#123;<span class="attr">mode</span>: <span class="string">'open'</span>&#125;);</span><br><span class="line">    <span class="keyword">let</span> elementContent = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">    shadowRoot.appendChild(elementContent);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h1><p>ChÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu sÆ¡ vá» template trong <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-17---ben-trong-Shadow-DOM---xay-dung-component-khep-kin" target="_blank" rel="noopener">bÃ i viáº¿t trÆ°á»›c vá» shadow DOM</a> vÃ  chÃºng xá»©ng Ä‘Ã¡ng cÃ³ 1 bÃ i viáº¿t riÃªng. á» Ä‘Ã¢y chÃºng ta sáº½ Ä‘Æ°a ra 1 vÃ­ dá»¥ Ä‘Æ¡n giáº£n lÃ m tháº¿ nÃ o Ä‘á»ƒ báº¡n cÃ³ thá»ƒ káº¿t há»£p cÃ¡c template vÃ o quÃ¡ trÃ¬nh táº¡o ra custom element. Sá»­ dá»¥ng tháº» <code>&lt;template&gt;</code> báº¡n cÃ³ thá»ƒ khai bÃ¡o tháº» cá»§a 1 máº£nh DOM, má»™t thá»© Ä‘Æ°á»£c parse nhÆ°ng khÃ´ng Ä‘Æ°á»£c render trÃªn trang.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template id=<span class="string">"my-custom-element-template"</span>&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"my-custom-element"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"email"</span> /&gt;</span><br><span class="line">    &lt;button <span class="class"><span class="keyword">class</span></span>=<span class="string">"submit"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;<span class="keyword">let</span> myCustomElementTemplate = <span class="built_in">document</span>.querySelector(<span class="string">'#my-custom-element-template'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomElement</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> shadowRoot = <span class="keyword">this</span>.attachShadow(&#123;<span class="attr">mode</span>: <span class="string">'open'</span>&#125;);</span><br><span class="line">    shadowRoot.appendChild(myCustomElementTemplate.content.cloneNode(<span class="literal">true</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Giá» Ä‘Ã¢y chÃºng ta cÃ³ thá»ƒ káº¿t há»£p custom element vá»›i shadow DOM vÃ  template, ta cÃ³ Ä‘Æ°á»£c 1 element khÃ©p kÃ­n trong pháº¡m vi cá»§a chÃ­nh nÃ³ vÃ  cÃ³ kiáº¿n trÃºc HTML riÃªng biá»‡t cÅ©ng nhÆ° Javascript logic</p><h1 id="Styling"><a href="#Styling" class="headerlink" title="Styling"></a>Styling</h1><p>ChÃºng ta Ä‘Ã£ Ä‘i qua pháº§n cá»§a HTML &amp; Javascript, giá» lÃ  vá» CSS. RÃµ rÃ ng thÃ¬ ta cáº§n 1 cÃ¡ch Ä‘á»ƒ chá»‰nh style cho cÃ¡c element. ChÃºng ta cÃ³ thá»ƒ thÃªm CSS stylesheet vÃ o bÃªn trong shadow DOM nhÆ°ng báº¡n sáº½ tháº¯c máº¯c lÃ  lÃ m tháº¿ nÃ o ta cÃ³ thá»ƒ chá»‰nh style cá»§a element tá»« bÃªn ngoÃ i vá»›i vai trÃ² lÃ  1 user cá»§a element Ä‘Ã³. VÃ  cÃ¢u tráº£ lá»i láº¡i Ä‘Æ¡n giáº£n: báº¡n cá»© style nÃ³ giá»‘ng nhÆ° cÃ¡ch báº¡n lÃ m vá»›i cÃ¡c element gá»‘c.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my-custom-element &#123;</span><br><span class="line">  border-radius: <span class="number">5</span>px;</span><br><span class="line">  width: <span class="number">30</span>%;</span><br><span class="line">  height: <span class="number">50</span>%;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LÆ°u Ã½ ráº±ng style Ä‘á»‹nh nghÄ©a tá»« bÃªn ngoÃ i cÃ³ Ä‘á»™ Æ°u tiÃªn cao hÆ¡n vÃ  nÃ³ sáº½ ghi Ä‘Ã¨ style Ä‘á»‹nh nghÄ©a tá»« element.</p><p>Báº¡n cÅ©ng biáº¿t cÃ³ 1 sá»‘ trÆ°á»ng há»£p khi trang Ä‘Æ°á»£c load nhÆ°ng ná»™i dung trÃªn trang váº«n á»Ÿ dáº¡ng HTML thÃ´ vÃ  chÆ°a Ä‘Æ°á»£c style (flash of unstyled content - FOUC). Báº¡n cÃ³ thá»ƒ ngÄƒn cháº·n tÃ¬nh huá»‘ng nÃ y báº±ng cÃ¡ch Ä‘á»‹nh nghÄ©a style cho cÃ¡c undefined component vÃ  sá»­ dá»¥ng má»™t sá»‘ cÃ¡ch transition khi chÃºng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a xong. Äá»ƒ lÃ m nhÆ° váº­y ta cáº§n dÃ¹ng selector :defined</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my-button:not(:defined) &#123;</span><br><span class="line">  height: <span class="number">20</span>px;</span><br><span class="line">  width: <span class="number">50</span>px;</span><br><span class="line">  opacity: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Element-khong-ton-tai-unknown-va-custom-element-chua-dinh-nghia-undefined"><a href="#Element-khong-ton-tai-unknown-va-custom-element-chua-dinh-nghia-undefined" class="headerlink" title="Element khÃ´ng tá»“n táº¡i (unknown) vÃ  custom element chÆ°a Ä‘á»‹nh nghÄ©a (undefined)"></a>Element khÃ´ng tá»“n táº¡i (unknown) vÃ  custom element chÆ°a Ä‘á»‹nh nghÄ©a (undefined)</h1><p>TiÃªu chuáº©n HTML ráº¥t linh Ä‘á»™ng vÃ  cho phÃ©p khai bÃ¡o báº¥t ká»³ tháº» nÃ o ta muá»‘n. Náº¿u trÃ¬nh duyá»‡t khÃ´ng thá»ƒ nháº­n ra tháº» Ä‘Ã³ thÃ¬ nÃ³ sáº½ Ä‘Æ°á»£c parse dÆ°á»›i dáº¡ng HTMLUnknownElement.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">'thisElementIsUnknown'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (element <span class="keyword">instanceof</span> HTMLUnknownElement) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The selected element is unknown'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tuy nhiÃªn, Ä‘iá»u nÃ y láº¡i khÃ´ng Ã¡p dá»¥ng vá»›i custom element. Báº¡n cÃ³ nhá»› khi chÃºng ta bÃ n vá» viá»‡c cÃ³ 1 sá»‘ quy táº¯c Ä‘áº·t tÃªn Ä‘á»ƒ Ä‘á»‹nh nghÄ©a custom element? LÃ½ do lÃ  náº¿u nhÆ° trÃ¬nh duyá»‡t nháº­n ra tÃªn <strong>há»£p lá»‡</strong> cho 1 custom element thÃ¬ nÃ³ sáº½ parse nÃ³ dÆ°á»›i dáº¡ng HTMLElement vÃ  trÃ¬nh duyá»‡t cÃ¢n nháº¯c Ä‘á»ƒ trá»Ÿ thÃ nh custom element chÆ°a Ä‘á»‹nh nghÄ©a.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.createElement(<span class="string">'this-element-is-undefined'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (element <span class="keyword">instanceof</span> HTMLElement) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The selected element is undefined but not unknown'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Máº·c dÃ¹ khÃ´ng cÃ³ sá»± khÃ¡c biá»‡t nÃ o cÃ³ thá»ƒ nhÃ¬n báº±ng máº¯t thÆ°á»ng giá»¯a HTMLElement vÃ  HTMLUnknownElement nhÆ°ng cÅ©ng cÃ³ vÃ i thá»© mÃ  ta cáº§n pháº£i nhá»›. Parser sáº½ Ä‘á»‘i xá»­ vá»›i chÃºng khÃ¡c nhau. Náº¿u má»™t element cÃ³ cÃ¡i tÃªn há»£p lá»‡ (theo kiá»ƒu custom element nhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn) thÃ¬ sáº½ Ä‘Æ°á»£c kiá»ƒm tra xem nÃ³ cÃ³ pháº§n triá»ƒn khai nÃ o cho custom element khÃ´ng. NÃ³ sáº½ Ä‘Æ°á»£c Ä‘á»‘i xá»­ nhÆ° 1 div bÃ¬nh thÆ°á»ng cho tá»›i khi pháº§n triá»ƒn khai Ä‘Ã³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. NgÆ°á»£c láº¡i element chÆ°a Ä‘á»‹nh nghÄ©a thÃ¬ khÃ´ng triá»ƒn khai báº¥t ká»³ phÆ°Æ¡ng thá»©c hay property nÃ o.</p><h1 id="Ho-tro-tu-trinh-duyet"><a href="#Ho-tro-tu-trinh-duyet" class="headerlink" title="Há»— trá»£ tá»« trÃ¬nh duyá»‡t"></a>Há»— trá»£ tá»« trÃ¬nh duyá»‡t</h1><p>PhiÃªn báº£n Ä‘áº§u tiÃªn cá»§a custom element Ä‘Æ°á»£c giá»›i thiá»‡u trong Chrome 36+. CÃ¡i gá»i lÃ  API v0 cá»§a custom element mÃ  giá» Ä‘Ã¢y Ä‘Ã£ khÃ´ng dÃ¹ng ná»¯a vÃ  cÃ¢n nháº¯c ráº±ng Ä‘Ã³ lÃ  nhá»¯ng yáº¿u kÃ©m máº·c dÃ¹ váº«n Ä‘ang tá»“n táº¡i. Náº¿u báº¡n muá»‘n tÃ¬m hiá»ƒu vá» v0 thÃ¬ cÃ³ thá»ƒ Ä‘á»c <a href="https://www.html5rocks.com/en/tutorials/webcomponents/customelements/" target="_blank" rel="noopener">bÃ i viáº¿t á»Ÿ Ä‘Ã¢y</a>. API v1 cá»§a custom element xuáº¥t hiá»‡n ká»ƒ tá»« Chrome 54 vÃ  Safari 10.1 (chá»‰ cÃ³ 1 pháº§n). Microsoft Edge thÃ¬ Ä‘ang trong giai Ä‘oáº¡n thá»­ máº«u vÃ  Mozilla Ä‘Ã£ cÃ³ tá»« v50 nhá»¯ng khÃ´ng Ä‘Æ°á»£c kÃ­ch hoáº¡t sáºµn vÃ  cáº§n ngÆ°á»i dÃ¹ng tá»± kÃ­ch hoáº¡t nÃ³. Hiá»‡n táº¡i chá»‰ cÃ³ cÃ¡c trÃ¬nh duyá»‡t webkit má»›i há»— trá»£ hoÃ n toÃ n. Tuy nhiÃªn nhÆ° Ä‘Ã£ nháº¯c á»Ÿ trÃªn, cÃ³ cÃ¡c polyfill tá»“n táº¡i cho phÃ©p báº¡n dÃ¹ng custom element trÃªn táº¥t cáº£ cÃ¡c trÃ¬nh duyá»‡t, ká»ƒ cáº£ IE11.</p><h1 id="Kiem-tra-tinh-kha-dung"><a href="#Kiem-tra-tinh-kha-dung" class="headerlink" title="Kiá»ƒm tra tÃ­nh kháº£ dá»¥ng"></a>Kiá»ƒm tra tÃ­nh kháº£ dá»¥ng</h1><p>Äá»ƒ Ä‘áº£m báº£o trÃ¬nh duyá»‡t cÃ³ há»— trá»£ custom element báº¡n cÃ³ thá»ƒ lÃ m lÃ  thá»±c hiá»‡n 1 bÃ i kiá»ƒm tra nhá» Ä‘á»ƒ xem property customElements cÃ³ tá»“n táº¡i trong object window hay khÃ´ng:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> supportsCustomElements = <span class="string">'customElements'</span> <span class="keyword">in</span> <span class="built_in">window</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (supportsCustomElements) &#123;</span><br><span class="line">  <span class="comment">// Báº¡n cÃ³ thá»ƒ dÃ¹ng API Custom elements á»Ÿ Ä‘Ã¢y</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hoáº·c náº¿u ta dÃ¹ng thÆ° viá»‡n polifyll:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadScript</span>(<span class="params">src</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line"></span><br><span class="line">    script.src = src;</span><br><span class="line">    script.onload = resolve;</span><br><span class="line">    script.onerror = reject;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.head.appendChild(script);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cháº¡y lazy load cho polyfill náº¿u cáº§n thiáº¿t</span></span><br><span class="line"><span class="keyword">if</span> (supportsCustomElements) &#123;</span><br><span class="line">  <span class="comment">// TrÃ¬nh duyá»‡t há»— trá»£ sáºµn cho custom element. Báº¡n cÃ³ thá»ƒ dÃ¹ng bÃ¬nh thÆ°á»ng.</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  loadScript(<span class="string">'path/to/custom-elements.min.js'</span>).then(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Polyfill cho custom element Ä‘Ã£ Ä‘Æ°á»£c kÃ­ch hoáº¡t. Báº¡n cÃ³ thá»ƒ dÃ¹ng bÃ¬nh thÆ°á»ng.</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Váº­y nÃ³i gá»n gá»n láº¡i, 1 pháº§n cá»§a tiÃªu chuáº©n web component lÃ  custom element cho báº¡n cÃ¡c kháº£ nÄƒng sau:</p><ul><li>LiÃªn káº¿t Javascript vÃ  CSS vá»›i HTML element</li><li>Cho phÃ©p báº¡n má»Ÿ rá»™ng cÃ¡c element HTML sáºµn cÃ³ (cáº£ element gá»‘c vÃ  custom element)</li><li>KhÃ´ng cáº§n thÆ° viá»‡n hay framework ngoÃ i. Báº¡n chá»‰ cáº§n Javascript, HTML vÃ  CSS gá»‘c vÃ  cÃ³ thá»ƒ cáº§n thÃªm thÆ° viá»‡n polyfill Ä‘á»ƒ há»— trá»£ trÃ¬nh duyá»‡t cÅ©.</li><li>NÃ³ Ä‘Æ°á»£c xÃ¢y dá»±ng Ä‘á»ƒ hoáº¡t Ä‘á»™ng trÆ¡n tru, mÆ°á»£t mÃ  vá»›i cÃ¡c tÃ­nh nÄƒng khÃ¡c cá»§a web component (shadow DOM, template, slots, vÃ¢n vÃ¢n)</li><li>LiÃªn káº¿t cháº·t cháº½ vá»›i cÃ´ng cá»¥ dev cá»§a trÃ¬nh duyá»‡t.</li><li>Táº­n dá»¥ng cÃ¡c tÃ­nh nÄƒng tiáº¿p cáº­n sáºµn cÃ³.</li></ul><p>Custom element khÃ´ng khÃ¡c vá»›i nhá»¯ng thá»© chÃºng ta Ä‘Ã£ dÃ¹ng báº¥y lÃ¢u nay. NÃ³ chá»‰ lÃ  1 cÃ¡ch khÃ¡c Ä‘á»ƒ lÃ m cho má»i viá»‡c dá»… dÃ ng hÆ¡n khi phÃ¡t triá»ƒn webapp. NÃ³ má»Ÿ ra cÃ¡nh cá»•ng Ä‘áº¿n vá»›i viá»‡c xÃ¢y dá»±ng nhá»¯ng app phá»©c táº¡p vá»›i tá»‘c Ä‘á»™ nhanh. Tuy nhiÃªn cÃ ng phá»©c táº¡p thÃ¬ cÃ ng cÃ³ nhiá»u kháº£ nÄƒng cÃ³ lá»—i mÃ  khÃ³ tÃ¬m hiá»ƒu hoáº·c tÃ¡i láº­p. VÃ¬ tháº¿ khi debug ta cáº§n nhiá»u ngá»¯ cáº£nh vÃ  cÃ´ng cá»¥ nhÆ° SessionStack Ä‘á»ƒ há»— trá»£.</p><p>SessionStack tÃ­ch há»£p vÃ o trong webapp vÃ  báº¯t Ä‘áº§u thu tháº­p cÃ¡c thÃ´ng tin nhÆ° sá»± kiá»‡n ngÆ°á»i dÃ¹ng, dá»¯ liá»‡u máº¡ng, biá»‡t lá»‡, thÃ´ng bÃ¡o debug, thay Ä‘á»•i trÃªn DOM, vÃ¢n vÃ¢n, vÃ  gá»­i chÃºng vá» server cá»§a há».</p><p>Sau Ä‘Ã³, dá»¯ liá»‡u thu Ä‘Æ°á»£c sáº½ Ä‘Æ°á»£c xá»­ lÃ½ Ä‘á»ƒ táº¡o ra Ä‘oáº¡n video tráº£i nghiá»‡m Ä‘á»ƒ báº¡n cÃ³ thá»ƒ xem user Ä‘Ã£ tÆ°Æ¡ng tÃ¡c nhÆ° tháº¿ nÃ o vá»›i sáº£n pháº©m cá»§a báº¡n. BÃªn cáº¡nh nhá»¯ng thÃ´ng tin ká»¹ thuáº­t mÃ  SessionStack Ä‘Ã£ cung cáº¥p thÃ¬ nÃ³ cÃ²n cho phÃ©p báº¡n kháº£ nÄƒng Ä‘á»ƒ tÃ¡i hiá»‡n láº¡i cÃ¡c váº¥n Ä‘á» mÃ  báº¡n khÃ´ng bao giá» biáº¿t Ä‘Æ°á»£c khi debug trÆ°á»›c Ä‘Ã¢y.</p><p>Äá»ƒ Ä‘áº£m báº£o cho SessionStack luÃ´n luÃ´n thá»±c hiá»‡n Ä‘Æ°á»£c cÃ¡c phiÃªn lÃ m viá»‡c hoÃ n háº£o Ä‘áº¿n tá»«ng pixel thÃ¬ team cá»§a há» Ä‘Ã£ bÃ¡m sÃ¡t láº¥y nhá»¯ng cÃ´ng nghá»‡, framework vÃ  tiÃªu chuáº©n web tiÃªn tiáº¿n cÅ©ng nhÆ° má»›i nháº¥t.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;&lt;em&gt;ÄÃ¢y lÃ  bÃ i cuá»‘i cÃ¹ng trong series rá»“i (cháº¯c váº­y Ã¡, lÃ¢u nay khÃ´ng tháº¥y há» Ä‘Äƒng bÃ i má»›i). Cáº£m Æ¡n má»i ngÆ°á»i Ä‘Ã£ á»§ng há»™ mÃ¬nh trong suá»‘t thá»i gian qua. Tuy nhiÃªn náº¿u SessionStack cÃ³ bÃ i viáº¿t nÃ o má»›i thÃ¬ mÃ¬nh sáº½ cáº­p nháº­t thÃªm.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Element: pháº§n tá»­&lt;/li&gt;
&lt;li&gt;Custom element: pháº§n tá»­ tÃ¹y chá»n (tá»©c lÃ  nhá»¯ng element do ngÆ°á»i dÃ¹ng tá»± táº¡o ra)&lt;/li&gt;
&lt;li&gt;Component: thÃ nh pháº§n&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 19 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P18: WebRTC &amp; cÆ¡ cháº¿ máº¡ng peer-to-peer</title>
    <link href="http://nthung2112.github.io/2019/01/Cach-Javascript-hoat-dong-P18-WebRTC-co-che-mang-peer-to-peer.html"/>
    <id>http://nthung2112.github.io/2019/01/Cach-Javascript-hoat-dong-P18-WebRTC-co-che-mang-peer-to-peer.html</id>
    <published>2019-01-05T17:00:00.000Z</published>
    <updated>2019-01-06T10:16:09.777Z</updated>
    
    <content type="html"><![CDATA[<p><strong><em>ThÃªm má»™t bÃ i ná»¯a mang náº·ng kiáº¿n thá»©c vá» máº¡ng mÃ  mÃ¬nh láº¡i khÃ´ng chuyÃªn vá» máº£ng nÃ y, náº¿u mÃ¬nh dá»‹ch chá»— nÃ o khÃ´ng phÃ¹ há»£p thÃ¬ nhá» má»i ngÆ°á»i giÃºp Ä‘á»¡ nhÃ© @</em>@_</strong></p><ul><li><strong>Peer-To-Peer hay P2P</strong>: Máº¡ng ngang hÃ ng</li><li><strong>Real-time</strong>: thá»i gian thá»±c</li></ul><p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 18 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.<br><a id="more"></a></p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>Äáº§u tiÃªn thÃ¬ WebRTC lÃ  cÃ¡i gÃ¬ váº­y? NÃ³ lÃ  viáº¿t táº¯t cá»§a chá»¯ <strong>R</strong>eal <strong>T</strong>ime <strong>C</strong>ommunication (Giao tiáº¿p thá»i gian thá»±c), nghe qua cháº¯c báº¡n cÅ©ng Ä‘Ã£ cÃ³ cÃ¡i gÃ¬ sÆ¡ sÆ¡ vá» cÃ´ng nghá»‡ nÃ y rá»“i nhá»‰.</p><p>WebRTC láº¥p Ä‘áº§y 1 khoáº£ng trá»‘ng lá»›n trong ná»n táº£ng web. TrÆ°á»›c Ä‘Ã¢y, cÃ¡c cÃ´ng nghá»‡ P2P cháº³ng háº¡n nhÆ° nhá»¯ng app chat trÃªn desktop cÃ³ thá»ƒ lÃ m nhá»¯ng viá»‡c mÃ  web khÃ´ng lÃ m Ä‘Æ°á»£c. NhÆ°ng WebRTC Ä‘Ã£ thay Ä‘á»•i Ä‘iá»u Ä‘Ã³.</p><p>Vá» cÆ¡ báº£n WebRTC cho phÃ©p webapp cÃ³ thá»ƒ thiáº¿t láº­p giao tiáº¿p Peer-To-Peer, chÃ­nh lÃ  ná»™i dung trong bÃ i viáº¿t nÃ y. Ta sáº½ tháº£o luáº­n vá» cÃ¡c chá»§ Ä‘á» sau Ä‘Ã¢y Ä‘á»ƒ cÃ³ thá»ƒ mang Ä‘áº¿n cho báº¡n 1 cÃ¡i nhÃ¬n toÃ n cáº£nh vá» â€œruá»™t gan phÃ¨o phá»•iâ€ cá»§a WebRTC:</p><ul><li>Giao tiáº¿p Peer-To-Peer</li><li>TÆ°á»ng lá»­a vÃ  NAT Traversal</li><li>TÃ­n hiá»‡u (Signaling), PhiÃªn (Session), Giao thá»©c (Protocol)</li><li>CÃ¡c API cá»§a WebRTC</li></ul><h1 id="Giao-tiep-Peer-To-Peer"><a href="#Giao-tiep-Peer-To-Peer" class="headerlink" title="Giao tiáº¿p Peer-To-Peer"></a>Giao tiáº¿p Peer-To-Peer</h1><p>Äá»ƒ cÃ³ thá»ƒ giao tiáº¿p láº«n nhau thÃ´ng qua trÃ¬nh duyá»‡t web, má»—i trÃ¬nh duyá»‡t cá»§a user pháº£i thá»±c hiá»‡n nhá»¯ng bÆ°á»›c sau Ä‘Ã¢y:</p><ul><li>Äá»“ng Ã½ Ä‘á»ƒ báº¯t Ä‘áº§u giao tiáº¿p</li><li>Biáº¿t cÃ¡ch xÃ¡c Ä‘á»‹nh vá»‹ trÃ­ cá»§a Ä‘á»‘i tÆ°á»£ng</li><li>VÆ°á»£t qua an ninh vÃ  tÆ°á»Ÿng lá»­a báº£o vá»‡</li><li>Chuyá»ƒn giao táº¥t cáº£ cÃ¡c giao tiáº¿p Ä‘a phÆ°Æ¡ng tiá»‡n theo real-time</li></ul><p>1 trong sá»‘ nhá»¯ng thÃ¡ch thá»©c lá»›n nháº¥t liÃªn quan Ä‘áº¿n cÃ¡c giao tiáº¿p P2P dá»±a trÃªn trÃ¬nh duyá»‡t lÃ  lÃ m sao Ä‘á»ƒ biáº¿t vá»‹ trÃ­ &amp; thiáº¿t láº­p 1 káº¿t ná»‘i socket máº¡ng (network socket connection) vá»›i 1 trÃ¬nh duyá»‡t khÃ¡c Ä‘á»ƒ váº­n chuyá»ƒn dá»¯ liá»‡u 2 chiá»u. Ta sáº½ xem xÃ©t nhá»¯ng khÃ³ khÄƒn liÃªn quan Ä‘áº¿n viá»‡c thiáº¿t láº­p káº¿t ná»‘i nÃ y.</p><p>Khi webapp cá»§a báº¡n cáº§n dá»¯ liá»‡u hoáº·c tÃ i nguyÃªn, nÃ³ sáº½ láº¥y vá» tá»« cÃ¡c server. Tuy nhiÃªn, náº¿u báº¡n muá»‘n táº¡o ra 1 á»©ng dá»¥ng video chat cháº³ng háº¡n, báº±ng cÃ¡ch káº¿t ná»‘i trá»±c tiáº¿p Ä‘áº¿n trÃ¬nh duyá»‡t cá»§a ngÆ°á»i khÃ¡c - thÃ¬ Ä‘Ã¢y lÃ  váº¥n Ä‘á», vÃ¬ báº¡n khÃ´ng biáº¿t Ä‘á»‹a chá»‰ bá»Ÿi vÃ¬ trÃ¬nh duyá»‡t cá»§a ngÆ°á»i kia khÃ´ng pháº£i lÃ  1 web server. VÃ¬ váº­y Ä‘á»ƒ cÃ³ thá»ƒ thiáº¿t láº­p 1 káº¿t ná»‘i P2P ta cáº§n ráº¥t nhiá»u thá»©.</p><h1 id="Tuong-lua-va-NAT-Traversal"><a href="#Tuong-lua-va-NAT-Traversal" class="headerlink" title="TÆ°á»ng lá»­a vÃ  NAT Traversal"></a>TÆ°á»ng lá»­a vÃ  NAT Traversal</h1><p>ThÆ°á»ng thÃ¬ mÃ¡y tÃ­nh cá»§a báº¡n khÃ´ng khÃ´ng cÃ³ Ä‘á»‹a chá»‰ IP public tÄ©nh. LÃ½ do lÃ  mÃ¡y tÃ­nh cá»§a báº¡n pháº£i nÃºp Ä‘áº±ng sau tÆ°á»ng lá»­a vÃ  thiáº¿t bá»‹ NAT (Network access translation - Bá»™ phiÃªn dá»‹ch truy cáº­p máº¡ng).</p><p>Thiáº¿t bá»‹ NAT sáº½ dá»‹ch Ä‘á»‹a chá»‰ IP cÃ¡ nhÃ¢n tá»« bÃªn trong tÆ°á»ng lá»­a thÃ nh Ä‘á»‹a chá»‰ IP cÃ´ng khai (public-facing IP). Ta cáº§n cÃ¡c thiáº¿t bá»‹ NAT Ä‘á»ƒ báº£o máº­t vÃ  giáº£i quyáº¿t sá»± giá»›i háº¡n cá»§a IPv4 Ä‘á»‘i vá»›i nhá»¯ng Ä‘á»‹a chá»‰ IP cÃ´ng khai sáºµn cÃ³. ÄÃ³ lÃ  lÃ½ do táº¡i sao webapp khÃ´ng nÃªn giáº£ Ä‘á»‹nh ráº±ng thiáº¿t bá»‹ hiá»‡n táº¡i cÃ³ 1 Ä‘á»‹a chá»‰ IP public tÄ©nh.</p><p>CÃ¹ng tÃ¬m hiá»ƒu 1 chÃºt vá» cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a cÃ¡c thiáº¿t bá»‹ NAT. Náº¿u nhÆ° báº¡n Ä‘ang á»Ÿ trong mÃ´i trÆ°á»ng cÃ´ng cá»™ng vÃ  káº¿t ná»‘i vÃ o máº¡ng WiFi, mÃ¡y tÃ­nh cá»§a báº¡n sáº½ Ä‘Æ°á»£c gÃ¡n 1 Ä‘á»‹a chá»‰ IP mÃ  nÃ³ chá»‰ tá»“n táº¡i Ä‘áº±ng sau NAT. Giáº£ sá»­ IP lÃ  172.0.23.4, tuy nhiÃªn, vá»›i tháº¿ giá»›i bÃªn ngoÃ i, Ä‘á»‹a chá»‰ IP cá»§a báº¡n cÃ³ thá»ƒ mang giÃ¡ trá»‹ khÃ¡c, vÃ­ dá»¥ 164.53.27.98. VÃ¬ váº­y, tháº¿ giá»›i bÃªn ngoÃ i sáº½ tháº¥y cÃ¡c request cá»§a báº¡n Ä‘áº¿n tá»« Ä‘á»‹a chá»‰ 164.53.27.98 nhÆ°ng thiáº¿t bá»‹ NAT sáº½ Ä‘áº£m báº£o cÃ¡c response cho nhá»¯ng request (Ä‘Æ°á»£c gá»­i tá»« mÃ¡y cá»§a báº¡n) sáº½ tráº£ vá» Ä‘Ãºng chá»— lÃ  172.0.23.4. Æ n trá»i cÃ¡c báº£ng Ã¡nh xáº¡ (mapping table). LÆ°u Ã½ ráº±ng ngoÃ i Ä‘á»‹a chá»‰ IP thÃ¬ cá»•ng (port) cÅ©ng lÃ  Ä‘iá»u kiá»‡n cáº§n thiáº¿t cho cÃ¡c giao tiáº¿p máº¡ng.</p><p>Do cÃ³ sá»± tham gia cá»§a cÃ¡c thiáº¿t bá»‹ NAT, trÃ¬nh duyá»‡t cá»§a báº¡n cáº§n tÃ¬m Ä‘Æ°á»£c Ä‘á»‹a chá»‰ IP cá»§a mÃ¡y tÃ­nh cÃ³ trÃ¬nh duyá»‡t mÃ  báº¡n muá»‘n giao tiáº¿p.</p><p>Äáº¿n Ä‘Ã¢y thÃ¬ ta láº¡i pháº£i nhá» Ä‘áº¿n cÃ¡c server <strong>STUN</strong> (<strong>S</strong>ession <strong>T</strong>raversal <strong>U</strong>tilities for <strong>N</strong>AT - Tiá»‡n Ã­ch truyá»n táº£i theo phiÃªn cho NAT) vÃ  <strong>TURN</strong> (<strong>T</strong>raversal <strong>U</strong>sing <strong>R</strong>elays around <strong>N</strong>AT - Truyá»n táº£i sá»­ dá»¥ng Ä‘iá»ƒm chuyá»ƒn tiáº¿p vÃ²ng quanh NAT). Äá»ƒ cÃ¡c cÃ´ng nghá»‡ WebRTC hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c, Ä‘áº§u tiÃªn thÃ¬ 1 request há»i Ä‘á»‹a chá»‰ IP public cá»§a báº¡n sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n server STUN. Báº¡n cá»© nghÄ© theo hÆ°á»›ng kiá»ƒu nhÆ° mÃ¡y tÃ­nh Ä‘ang táº¡o truy váº¥n Ä‘áº¿n 1 server tá»« xa Ä‘á»ƒ há»i vá» Ä‘á»‹a chá»‰ IP mÃ  server Ä‘Ã³ nháº­n cÃ¢u truy váº¥n lÃ  bao nhiÃªu. Server tá»« xa sáº½ tráº£ vá» Ä‘á»‹a chá»‰ IP mÃ  nÃ³ tháº¥y. NÃ³i ngáº¯n gá»n lÃ  mÃ¡y tÃ­nh cá»§a báº¡n â€œhá»iâ€ 1 server tá»« xa Ä‘á»‹a chá»‰ IP cá»§a chÃ­nh mÃ¡y báº¡n lÃ  bao nhiÃªu.</p><p>Giáº£ sá»­ tiáº¿n trÃ¬nh nÃ y hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng vÃ  báº¡n nháº­n Ä‘Æ°á»£c Ä‘á»‹a chá»‰ IP public cá»§a mÃ¬nh cÅ©ng nhÆ° sá»‘ port, báº¡n sáº½ cÃ³ thá»ƒ nÃ³i vá»›i nhá»¯ng peer ngang hÃ ng khÃ¡c lÃ m tháº¿ nÃ o Ä‘á»ƒ káº¿t ná»‘i trá»±c tiáº¿p Ä‘áº¿n báº¡n. Nhá»¯ng peer nÃ y cÅ©ng cÃ³ thá»ƒ lÃ m cÃ¹ng 1 viá»‡c lÃ  sá»­ dá»¥ng STUN &amp; server TURN vÃ  nÃ³i cho báº¡n biáº¿t nÃªn liÃªn láº¡c Ä‘áº¿n Ä‘á»‹a chá»‰ nÃ o.</p><h1 id="Signaling-Sessions-Protocols"><a href="#Signaling-Sessions-Protocols" class="headerlink" title="Signaling, Sessions, Protocols"></a>Signaling, Sessions, Protocols</h1><p><strong><em>TÃ­n hiá»‡u, phiÃªn, giao thá»©c</em></strong></p><p>QuÃ¡ trÃ¬nh khÃ¡m phÃ¡ thÃ´ng tin máº¡ng Ä‘Æ°á»£c mÃ´ táº£ á»Ÿ trÃªn chá»‰ lÃ  1 pháº§n cá»§a chá»§ Ä‘á» vá» Signaling to bá»± hÆ¡n nhiá»u, trong trÆ°á»ng há»£p cá»§a WebRTC thÃ¬ pháº§n signaling nÃ y dá»±a trÃªn 1 chuáº©n JSEP (<strong>J</strong>avascript <strong>S</strong>ession <strong>E</strong>stablishment <strong>P</strong>rotocol - Giao thá»©c thiáº¿t láº­p phiÃªn cá»§a Javascript). Signaling bao gá»“m cáº£ khÃ¡m phÃ¡ máº¡ng (network discovery) vÃ  NAT Traversal, táº¡o vÃ  quáº£n lÃ½ phiÃªn, báº£o máº­t giao tiáº¿p, siÃªu dá»¯ liá»‡u (metadata) vÃ  phá»‘i há»£p kháº£ nÄƒng cá»§a media, xá»­ lÃ½ lá»—i.</p><p>Äá»ƒ káº¿t ná»‘i cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng, peer thu Ä‘Æ°á»£c nhá»¯ng Ä‘iá»u kiá»‡n vá» local media cho metadata (vÃ­ dá»¥: nhá»¯ng kháº£ nÄƒng vá» kÃ­ch thÆ°á»›c vÃ  kiá»ƒu codec) vÃ  gom gÃ³p cÃ¡c Ä‘á»‹a chá»‰ máº¡ng cÃ³ thá»ƒ cÃ³ cho host cá»§a á»©ng dá»¥ng. CÆ¡ cháº¿ signaling dÃ¹ng Ä‘á»ƒ truyá»n tá»›i/lui nhá»¯ng thÃ´ng tin quan trá»ng nÃ y khÃ´ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong API cá»§a WebRTC.</p><p>Signaling khÃ´ng Ä‘Æ°á»£c quy Ä‘á»‹nh bá»Ÿi chuáº©n WebRTC vÃ  nÃ³ khÃ´ng Ä‘Æ°á»£c triá»ƒn khai báº±ng API cá»§a nÃ³ Ä‘á»ƒ cho phÃ©p sá»­ dá»¥ng má»™t cÃ¡ch linh Ä‘á»™ng cÃ¡c cÃ´ng nghá»‡ vÃ  giao thá»©c cáº§n thiáº¿t. CÃ¡c WebRTC developer sáº½ Ä‘á»‘i phÃ³ vá»›i signaling vÃ  server xá»­ lÃ½ signaling.</p><p>Giáº£ sá»­ app WebRTC dá»±a trÃªn trÃ¬nh duyá»‡t cá»§a báº¡n cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c Ä‘á»‹a chá»‰ IP public cá»§a nÃ³ báº±ng cÃ¡ch sá»­ dá»¥ng STUN nhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn, bÆ°á»›c tiáº¿p theo thá»±c sá»± lÃ  1 mÃ n Ä‘Ã m phÃ¡n &amp; thiáº¿t láº­p phiÃªn káº¿t ná»‘i Ä‘áº¿n vá»›i peer.</p><p>Pháº§n Ä‘Ã m phÃ¡n vÃ  thiáº¿t láº­p khá»Ÿi táº¡o phiÃªn xáº£y ra khi dÃ¹ng 1 giao thá»©c signaling/giao tiáº¿p Ä‘Æ°á»£c Ä‘áº·c táº£ trong cÃ¡c giao tiáº¿p Ä‘a phÆ°Æ¡ng tiá»‡n. Giao thá»©c nÃ y cÅ©ng chá»‹u trÃ¡ch nhiá»‡m cho viá»‡c Ä‘iá»u hÃ nh cÃ¡c quy Ä‘á»‹nh trong Ä‘Ã³ phiÃªn Ä‘Æ°á»£c quáº£n lÃ½ vÃ  há»§y bá».</p><p>Má»™t trong sá»‘ cÃ¡c giao thá»©c nhÆ° váº­y cÃ³ tÃªn lÃ  <strong>S</strong>ession <strong>I</strong>nitiation <strong>P</strong>rotocol (SIP - Giao thá»©c khá»Ÿi táº¡o phiÃªn). LÆ°u Ã½ ráº±ng do sá»± linh Ä‘á»™ng cá»§a WebRTC signaling, SIP khÃ´ng pháº£i lÃ  giao thá»©c signaling duy nháº¥t cÃ³ thá»ƒ dÃ¹ng. Giao thá»©c signaling Ä‘Æ°á»£c chá»n pháº£i hoáº¡t Ä‘á»™ng vá»›i 1 giao thá»©c á»Ÿ táº§ng á»©ng dá»¥ng gá»i lÃ  <strong>S</strong>ession <strong>D</strong>escription <strong>P</strong>rotocol (SDP - Giao thá»©c mÃ´ táº£ phiÃªn), giao thá»©c nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng trong trÆ°á»ng há»£p cá»§a WebRTC. Táº¥t cáº£ cÃ¡c metadata Ä‘a phÆ°Æ¡ng tiá»‡n cá»¥ thá»ƒ Ä‘Æ°á»£c truyá»n Ä‘i báº±ng giao thá»©c SDP nÃ y.</p><p>Báº¥t ká»³ peer nÃ o (vÃ­ dá»¥: app táº­n dá»¥ng WebRTC) thá»­ giao tiáº¿p vá»›i 1 peer khÃ¡c Ä‘á»u sinh ra 1 táº­p cÃ¡c á»©ng viÃªn giao thá»©c Interactive Connectivity Establishment (ICE - Thiáº¿t láº­p káº¿t ná»‘i tÆ°Æ¡ng tÃ¡c). Nhá»¯ng á»©ng viÃªn nÃ y biá»ƒu diá»…n 1 bá»™ káº¿t há»£p cá»§a Ä‘á»‹a chá»‰ IP, port, giao thá»©c giao váº­n Ä‘Æ°á»£c dÃ¹ng. LÆ°u Ã½ ráº±ng 1 mÃ¡y tÃ­nh cÃ³ thá»ƒ cÃ³ nhiá»u giao diá»‡n máº¡ng (khÃ´ng dÃ¢y, cÃ³ dÃ¢y, vÃ¢n vÃ¢n), vÃ¬ tháº¿ cÃ³ thá»ƒ Ä‘Æ°á»£c gÃ¡n nhiá»u Ä‘á»‹a chá»‰ IP cho má»—i giao diá»‡n.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  sÆ¡ Ä‘á»“ láº¥y tá»« MDN mÃ´ táº£ láº¡i sá»± trao Ä‘á»•i:<br><img src="https://cdn-images-1.medium.com/max/1000/0*SXRTlnVxy2-hE9ZX" alt=""></p><h1 id="Thiet-lap-ket-noi"><a href="#Thiet-lap-ket-noi" class="headerlink" title="Thiáº¿t láº­p káº¿t ná»‘i"></a>Thiáº¿t láº­p káº¿t ná»‘i</h1><p>Má»—i peer Ä‘áº§u tiÃªn pháº£i thiáº¿t láº­p Ä‘á»‹a chá»‰ IP public nhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn. â€œKÃªnhâ€ (channel) dá»¯ liá»‡u signaling sau Ä‘Ã³ Ä‘Æ°á»£c tá»± Ä‘á»™ng táº¡o ra Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ¡c peer vÃ  há»— trá»£ Ä‘Ã m phÃ¡n peer-to-peer vÃ  thiáº¿t láº­p phiÃªn.</p><p>Tháº¿ giá»›i bÃªn ngoÃ i hoÃ n toÃ n khÃ´ng biáº¿t hoáº·c khÃ´ng thá»ƒ truy xuáº¥t Ä‘áº¿n nhá»¯ng â€œkÃªnhâ€ nÃ y vÃ  nÃ³ cÅ©ng yÃªu cáº§u 1 Ä‘á»‹nh danh duy nháº¥t náº¿u muá»‘n truy cáº­p.</p><p>LÆ°u Ã½ ráº±ng, do sá»± linh Ä‘á»™ng cá»§a WebRTC vÃ  cÅ©ng bá»Ÿi tiáº¿n trÃ¬nh signaling khÃ´ng Ä‘Æ°á»£c cá»¥ thá»ƒ hÃ³a trong cÃ¡c tiÃªu chuáº©n, Ã½ tÆ°á»Ÿng vÃ  cÃ¡ch thá»±c hiá»‡n cá»§a â€œkÃªnhâ€ cÃ³ thá»ƒ sáº½ cÃ³ Ã­t nhiá»u khÃ¡c biá»‡t tuy vÃ o cÃ´ng nghá»‡ sá»­ dá»¥ng. RÃµ rÃ ng, 1 vÃ i giao thá»©c khÃ´ng cáº§n Ä‘áº¿n cÆ¡ cháº¿ â€œkÃªnhâ€ mÃ  vÃ£n giao tiáº¿p Ä‘Æ°á»£c.</p><p>ChÃºng ta sáº½ giáº£ sá»­ ráº±ng â€œkÃªnhâ€ Ä‘Æ°á»£c dÃ¹ng trong viá»‡c triá»ƒn khai cho cÃ¡c má»¥c Ä‘Ã­ch Ä‘Æ°á»£c nháº¯c tá»›i á»Ÿ bÃ i viáº¿t nÃ y.</p><p>Má»™t khi 2 hoáº·c nhiá»u peer Ä‘Ã£ cÃ¹ng káº¿t ná»‘i vÃ o 1 â€œkÃªnhâ€ thÃ¬ nhá»¯ng peer Ä‘Ã£ cÃ³ thá»ƒ giao tiáº¿p vÃ  trao Ä‘á»•i thÃ´ng tin phiÃªn. Tiáº¿n trÃ¬nh nÃ y vá» máº·t nÃ o Ä‘Ã³ thÃ¬ tÆ°Æ¡ng tá»± nhÆ° <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" target="_blank" rel="noopener">mÃ´ hÃ¬nh publish/subscribe</a>. Vá» cÆ¡ báº£n, peer khá»Ÿi táº¡o ban Ä‘áº§u sáº½ gá»­i 1 â€œlá»i Ä‘á» nghá»‹â€ sá»­ dá»¥ng 1 giao thá»©c signaling cháº³ng háº¡n nhÆ° Session Initiation Protocol (SIP - Giao thá»©c khá»Ÿi táº¡o phiÃªn) vÃ  SDP. NgÆ°á»i khá»Ÿi táº¡o sáº½ chá» Ä‘á»ƒ nháº­n Ä‘Æ°á»£c â€œcÃ¢u tráº£ lá»iâ€ tá»« báº¥t ká»³ ngÆ°á»i nháº­n nÃ o Ä‘Ã£ káº¿t ná»‘i vá»›i â€œkÃªnhâ€.</p><p>Khi Ä‘Ã£ nháº­n Ä‘Æ°á»£c cÃ¢u tráº£ lá»i, 1 tiáº¿n trÃ¬nh diá»…n ra Ä‘á»ƒ xÃ¡c Ä‘á»‹nh vÃ  trao Ä‘á»•i giao thá»©c á»©ng viÃªn ICE tá»‘t nháº¥t (Interactive Connectivity Establishment - Thiáº¿t láº­p káº¿t ná»‘i tÆ°Æ¡ng tÃ¡c) mÃ  má»—i peer thu tháº­p Ä‘Æ°á»£c. Má»™t khi chá»n Ä‘Æ°á»£c á»©ng viÃªn ICE tá»‘i Æ°u thÃ¬ vá» cÆ¡ báº£n sáº½ cÃ³ nhiá»u thá»© theo sau Ä‘Ã³ Ä‘Æ°á»£c cháº¥p nháº­n, bao gá»“m: nhá»¯ng metadata cáº§n thiáº¿t, cÃ¡c Ä‘á»‹nh tuyáº¿n máº¡ng (Ä‘á»‹a chá»‰ IP vÃ  port) vÃ  cÃ¡c thÃ´ng tin media thÆ°á»ng dÃ¹ng Ä‘á»ƒ giao tiáº¿p vá»›i má»—i peer. PhiÃªn máº¡ng socket máº¡ng giá»¯a nhá»¯ng peer sau Ä‘Ã³ Ä‘Æ°á»£c thiáº¿t láº­p hoÃ n chá»‰nh vÃ  kÃ­ch hoáº¡t. Tiáº¿p Ä‘Ã³, cÃ¡c luá»“ng dá»¯ liá»‡u local vÃ  cÃ¡c endpoint kÃªnh dá»¯ liá»‡u Ä‘Æ°á»£c táº¡o ra bá»Ÿi má»—i peer, dá»¯ liá»‡u Ä‘a phÆ°Æ¡ng tiá»‡n cuá»‘i cÃ¹ng Ä‘Æ°á»£c chuyá»ƒn Ä‘i theo cáº£ 2 Ä‘Æ°á»ng sá»­ dá»¥ng báº¥t ká»³ cÃ´ng nghá»‡ giao tiáº¿p 2 chiá»u nÃ o.</p><p>Náº¿u nhÆ° tiáº¿n trÃ¬nh Ä‘á»“ng Ã½ cháº¥p nháº­n á»©ng viÃªn ICE tá»‘t nháº¥t bá»‹ tháº¥t báº¡i, thá»‰nh thoáº£ng nguyÃªn nhÃ¢n lÃ  do tÆ°á»ng lá»­a hoáº·c ká»¹ thuáº­t NAT Ä‘ang dÃ¹ng, thÃ¬ giáº£i phÃ¡p dá»± phÃ²ng sau Ä‘Ã³ lÃ  sá»­ dá»¥ng 1 server TURN dÆ°á»›i dáº¡ng 1 Ä‘iá»ƒm chuyá»ƒn tiáº¿p thay tháº¿. Tiáº¿n trÃ¬nh nÃ y vá» cÆ¡ báº£n sáº½ dÃ¹ng 1 server hoáº¡t Ä‘á»™ng nhÆ° ngÆ°á»i trung gian vÃ  nÃ³ chuyá»ƒn tiáº¿p báº¥t ká»³ dá»¯ liá»‡u nÃ o truyá»n qua láº¡i giá»¯a cÃ¡c peer. LÆ°u Ã½ ráº±ng Ä‘Ã¢y khÃ´ng pháº£i lÃ  giao tiáº¿p peer-to-peer thá»±c thá»¥ trong Ä‘Ã³ cÃ¡c peer truyá»n dá»¯ liá»‡u 2 chiá»u trá»±c tiáº¿p Ä‘áº¿n vá»›i nhau.</p><p>Khi sá»­ dá»¥ng giáº£i phÃ¡p dá»± phÃ²ng TURN Ä‘á»ƒ giao tiáº¿p, má»—i peer sáº½ khÃ´ng cáº§n pháº£i biáº¿t lÃ m tháº¿ nÃ o Ä‘á»ƒ liÃªn láº¡c vÃ  truyá»n dá»¯ liá»‡u Ä‘áº¿n bÃªn kia. Thay vÃ o Ä‘Ã³, nÃ³ cáº§n biáº¿t server TURN public nÃ o Ä‘á»ƒ gá»­i vÃ  nháº­n dá»¯ liá»‡u Ä‘a phÆ°Æ¡ng tiá»‡n theo thá»i gian thá»±c xuyÃªn suá»‘t phiÃªn giao tiáº¿p.</p><p>Äiá»u quan trá»ng cáº§n pháº£i hiá»ƒu ráº±ng Ä‘Ã¢y cháº¯c cháº³n lÃ  1 dáº¡ng â€œkáº¿ hoáº¡ch dá»± phÃ²ngâ€ vÃ  chá»‰ dÃ¹ng khi khÃ´ng cÃ²n cÃ¡ch nÃ o khÃ¡c. CÃ¡c server TURN pháº£i khÃ¡ vá»¯ng cháº¯c, cÃ³ bÄƒng thÃ´ng rá»™ng, kháº£ nÄƒng xá»­ lÃ½ vÃ  cÃ³ thá»ƒ xá»­ lÃ½ 1 lÆ°á»£ng lá»›n dá»¯ liá»‡u tiá»m tÃ ng. CÃ¡ch sá»­ dá»¥ng server TURN vÃ¬ tháº¿ rÃµ rÃ ng lÃ  sáº½ phÃ¡t sinh thÃªm chi phÃ­ vÃ  sá»± phá»©c táº¡p.</p><h1 id="Cac-API-cua-WebRTC"><a href="#Cac-API-cua-WebRTC" class="headerlink" title="CÃ¡c API cá»§a WebRTC"></a>CÃ¡c API cá»§a WebRTC</h1><p>CÃ³ 3 má»¥c phÃ¢n loáº¡i API chÃ­nh trong WebRTC:</p><ul><li><strong>Media Capture and Streams</strong> (luá»“ng media vÃ  chá»¥p media) - cho phÃ©p báº¡n truy xuáº¥t vÃ o cÃ¡c thiáº¿t bá»‹ Ä‘áº§u vÃ o, cháº³ng háº¡n nhÆ° microphone hay web camera. API cho phÃ©p báº¡n láº¥y 1 luá»“ng media tá»« cÃ¡c thiáº¿t bá»‹ Ä‘Ã³.</li><li><strong>RTCPeerConnection</strong> - dÃ¹ng nhá»¯ng API nÃ y, báº¡n cÃ³ thá»ƒ gá»­i theo thá»i gian thá»±c 1 luá»“ng Ã¢m thanh &amp; hÃ¬nh áº£nh Ä‘Ã£ báº¯t Ä‘Æ°á»£c thÃ´ng qua internet Ä‘áº¿n 1 endpoint WebRTC khÃ¡c. Báº¡n cÃ³ thá»ƒ táº¡o ra káº¿t ná»‘i giá»¯a mÃ¡y local vÃ  peer tá»« xa. NÃ³ cÅ©ng cung cáº¥p cÃ¡c phÆ°Æ¡ng thá»©c Ä‘á»ƒ káº¿t ná»‘i Ä‘áº¿n 1 peer tá»« xa, duy trÃ¬ vÃ  kiá»ƒm soÃ¡t káº¿t ná»‘i &amp; Ä‘Ã³ng káº¿t ná»‘i 1 khi ta khÃ´ng cáº§n Ä‘áº¿n nÃ³ ná»¯a.</li><li><strong>RTCDataChannel</strong> - API nÃ y cho phÃ©p báº¡n truyá»n dá»¯ liá»‡u tÃ¹y Ã½. Má»—i kÃªnh dá»¯ liá»‡u Ä‘Æ°á»£c liÃªn káº¿t vá»›i 1 RTCPeerConnection.</li></ul><p>ChÃºng ta sáº½ Ä‘i sÃ¢u vÃ o tháº£o luáº­n má»—i loáº¡i trÃªn.</p><h2 id="Media-Capture-amp-Streams"><a href="#Media-Capture-amp-Streams" class="headerlink" title="Media Capture &amp; Streams"></a>Media Capture &amp; Streams</h2><p>API <strong>Media Capture &amp; Streams</strong>, thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  <em>Media Stream API</em> hoáº·c <em>Stream API</em>, lÃ  1 API há»— trá»£ nhá»¯ng luá»“ng (stream) dá»¯ liá»‡u Ã¢m thanh hay hÃ¬nh áº£nh, cÃ¡c phÆ°Æ¡ng thá»©c Ä‘á»ƒ lÃ m viá»‡c vá»›i chÃºng, nhá»¯ng háº¡n cháº¿ liÃªn káº¿t vá»›i tá»«ng loáº¡i dá»¯ liá»‡u, callback thÃ nh cÃ´ng/tháº¥t báº¡i khi sá»­ dá»¥ng dá»¯ liá»‡u báº¥t Ä‘á»“ng bá»™ vÃ  nhá»¯ng sá»± kiá»‡n Ä‘Æ°á»£c báº¯n ra suá»‘t quÃ¡ trÃ¬nh.</p><p>PhÆ°Æ¡ng thá»©c getUserMedia() cá»§a <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices" target="_blank" rel="noopener">MediaDevices</a> nháº¯c nhá»Ÿ ngÆ°á»i dÃ¹ng cáº¥p quyá»n Ä‘á»ƒ sá»­ dá»¥ng Ä‘áº§u vÃ o media, nÃ³ táº¡o ra 1 <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream" target="_blank" rel="noopener">MediaStream</a> kÃ¨m vá»›i cÃ¡c track chá»©a kiá»ƒu request cá»§a media. Luá»“ng Ä‘Ã³ cÃ³ thá»ƒ chá»©a 1 track video (Ä‘Æ°á»£c táº¡o ra bá»Ÿi pháº§n cá»©ng hay nguá»“n video áº£o cháº³ng háº¡n nhÆ° camera, thiáº¿t bá»‹ ghi video, dá»‹ch vá»¥ chia sáº» mÃ n hÃ¬nh, vÃ¢n vÃ¢n), 1 track audio (tÆ°Æ¡ng tá»±, Ä‘Æ°á»£c táº¡o ra bá»Ÿi nguá»“n ghi váº­t lÃ½ hoáº·c nguá»“n ghi áº£o nhÆ° microphone, bá»™ chuyá»ƒn A/Dâ€¦) vÃ  cÃ³ thá»ƒ cÃ³ cáº£ nhá»¯ng loáº¡i track khÃ¡c.</p><p>NÃ³ sáº½ tráº£ vá» 1 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener">Promise</a> vÃ  resolve thÃ nh object <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream" target="_blank" rel="noopener">MediaStream</a>. Náº¿u ngÆ°á»i dÃ¹ng tá»« chá»‘i cáº¥p quyá»n hoáº·c lÃ  media phÃ¹ há»£p khÃ´ng tá»“n táº¡i thÃ¬ promise Ä‘Ã³ sáº½ bá»‹ reject vá»›i PermissionDeniedError hoáº·c NotFoundError.</p><p>MÃ´ hÃ¬nh singleton MediaDevice cÃ³ thá»ƒ Ä‘Æ°á»£c truy xuáº¥t thÃ´ng qua object navigator nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">navigator.mediaDevices.getUserMedia(constraints)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">stream</span>) </span>&#123;</span><br><span class="line"> <span class="comment">/* use the stream */</span></span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line"> <span class="comment">/* handle the error */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>LÆ°u Ã½ lÃ  báº¡n cáº§n truyá»n object constraints Ä‘á»ƒ nÃ³i cho API loáº¡i stream nÃ o Ä‘á»ƒ tráº£ vá». Báº¡n cÃ³ thá»ƒ cáº¥u hÃ¬nh táº¥t cáº£ nhá»¯ng thá»© linh tinh liÃªn quan, bao gá»“m cáº£ camera mÃ  báº¡n dÃ¹ng (camera trÆ°á»›c/sau), táº§n suáº¥t khung hÃ¬nh, Ä‘á»™ phÃ¢n giáº£i, vÃ¢n vÃ¢n.</p><p>Ká»ƒ tá»« phiÃªn báº£n 25, cÃ¡c trÃ¬nh duyá»‡t dá»±a trÃªn nhÃ¢n Chromium cho phÃ©p dá»¯ liá»‡u Ã¢m thanh tá»« getUserMedia() cÃ³ thá»ƒ Ä‘Æ°á»£c truyá»n Ä‘áº¿n element audio hoáº·c video (nhÆ°ng lÆ°u Ã½ ráº±ng máº·c Ä‘á»‹nh thÃ¬ cÃ¡c media element bá»‹ táº¯t tiáº¿ng (mute))</p><p>getUserMedia cÃ²n cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng nhÆ° 1 <a href="http://updates.html5rocks.com/2012/09/Live-Web-Audio-Input-Enabled" target="_blank" rel="noopener">node Ä‘áº§u vÃ o cho Web Audio API</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gotStream</span>(<span class="params">stream</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.AudioContext = <span class="built_in">window</span>.AudioContext || <span class="built_in">window</span>.webkitAudioContext;</span><br><span class="line">    <span class="keyword">var</span> audioContext = <span class="keyword">new</span> AudioContext();</span><br><span class="line">    <span class="comment">// Táº¡o AudioNode tá»« stream</span></span><br><span class="line">    <span class="keyword">var</span> mediaStreamSource = audioContext.createMediaStreamSource(stream);</span><br><span class="line">    <span class="comment">// Káº¿t ná»‘i nÃ³ Ä‘áº¿n Ä‘iá»ƒm Ä‘Ã­ch Ä‘á»ƒ nghe báº¡n </span></span><br><span class="line">    <span class="comment">// hoáº·c báº¥t ká»³ node nÃ o khÃ¡c Ä‘ang xá»­ lÃ½</span></span><br><span class="line">    mediaStreamSource.connect(audioContext.destination);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">navigator.getUserMedia(&#123;<span class="attr">audio</span>:<span class="literal">true</span>&#125;, gotStream);</span><br></pre></td></tr></table></figure><h3 id="Gioi-han-ve-su-rieng-tu"><a href="#Gioi-han-ve-su-rieng-tu" class="headerlink" title="Giá»›i háº¡n vá» sá»± riÃªng tÆ°"></a>Giá»›i háº¡n vá» sá»± riÃªng tÆ°</h3><p>LÃ  1 API cÃ³ thá»ƒ chá»©a nhiá»u Ä‘iá»u lo ngáº¡i Ä‘Ã¡ng ká»ƒ vá» quyá»n riÃªng tÆ°, getUserMedia() Ä‘Æ°á»£c tá»• chá»©c bá»Ÿi cÃ¡c Ä‘áº·c Ä‘iá»ƒm ká»¹ thuáº­t vá»›i nhá»¯ng yÃªu cáº§u ráº¥t cá»¥ thá»ƒ vá» thÃ´ng bÃ¡o ngÆ°á»i dÃ¹ng vÃ  quáº£n lÃ½ quyá»n truy cáº­p. getUserMedia() pháº£i luÃ´n luÃ´n xin quyá»n tá»« ngÆ°á»i dÃ¹ng trÆ°á»›c khi má»Ÿ báº¥t ká»³ thiáº¿t bá»‹ thu tháº­p thÃ´ng tin media nÃ o cháº³ng háº¡n nhÆ° webcam hay microphone. TrÃ¬nh duyá»‡t cÃ³ thá»ƒ cÃ³ tÃ­nh nÄƒng cáº¥p quyá»n trÃªn má»—i domain (once-per-domain), nhÆ°ng nÃ³ pháº£i há»i báº¡n Ã­t nháº¥t lÃ  láº§n Ä‘áº§u tiÃªn hoáº¡t Ä‘á»™ng vÃ  ngÆ°á»i dÃ¹ng pháº£i Ä‘áº·c biá»‡t cáº¥p quyá»n tiáº¿p theo náº¿u há» muá»‘n.</p><p>Má»™t Ä‘iá»u quan trá»ng tÆ°Æ¡ng Ä‘Æ°Æ¡ng lÃ  cÃ¡c quy Ä‘á»‹nh xung quanh thÃ´ng bÃ¡o (notification). TrÃ¬nh duyá»‡t Ä‘Æ°á»£c yÃªu cáº§u pháº£i hiá»ƒn thá»‹ 1 thÃ´ng sá»‘ thá»ƒ hiá»‡n camera hoáº·c microphone Ä‘ang hoáº¡t Ä‘á»™ng, hÆ¡n háº¿t tháº£y báº¥t ká»³ thÃ´ng sá»‘ thá»ƒ hiá»‡n pháº§n cá»©ng nÃ o khÃ¡c. Há» cÅ©ng pháº£i hiá»‡n 1 chá»‰ sá»‘ cho tháº¥y ráº±ng quyá»n Ä‘Æ°á»£c Ä‘Æ°á»£c cáº¥p Ä‘á»ƒ sá»­ dá»¥ng thiáº¿t bá»‹ Ä‘áº§u vÃ o, ká»ƒ cáº£ náº¿u nhÆ° thiáº¿t bá»‹ Ä‘Ã³ chÆ°a Ä‘Æ°á»£c kÃ­ch hoáº¡t Ä‘á»ƒ ghi chÃ©p táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³.</p><h1 id="RTCPeerConnection"><a href="#RTCPeerConnection" class="headerlink" title="RTCPeerConnection"></a>RTCPeerConnection</h1><p>Giao diá»‡n <strong>RTCPeerConnection</strong> thá»ƒ hiá»‡n 1 káº¿t ná»‘i WebRTC giá»¯a mÃ¡y tÃ­nh local vÃ  peer tá»« xa. NÃ³ cung cáº¥p cÃ¡c phÆ°Æ¡ng thá»©c Ä‘á»ƒ káº¿t ná»‘i Ä‘áº¿n peer tá»« xa, duy trÃ¬, kiá»ƒm soÃ¡t káº¿t ná»‘i vÃ  ngáº¯t káº¿t ná»‘i má»™t khi nÃ³ khÃ´ng cáº§n dÃ¹ng tá»›i ná»¯a.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  1 mÃ´ hÃ¬nh kiáº¿n trÃºc cá»§a WebRTC thá»ƒ hiá»‡n vai trÃ² cá»§a RTCPeerConnection:<br><img src="https://cdn-images-1.medium.com/max/1000/0*Nm9r_NLcAhJernmo" alt=""></p><p>Tá»« gÃ³c Ä‘á»™ cá»§a Javascript, Ä‘iá»u cáº§n hiá»ƒu trong mÃ´ hÃ¬nh trÃªn lÃ  <strong>RTCPeerConnection</strong> trao cho cÃ¡c web developer má»™t cÃ¡i nhÃ¬n tinh táº¿ tá»« nhá»¯ng sá»± phá»©c táº¡p xuáº¥t phÃ¡t tá»« Ä‘á»‘ng â€œná»™i táº¡ngâ€ rá»‘i ráº¯m bÃªn dÆ°á»›i. CÃ¡c mÃ£ codec vÃ  giao thá»©c Ä‘Æ°á»£c dÃ¹ng bá»Ÿi WebRTC thá»±c hiá»‡n 1 lÆ°á»£ng lá»›n cÃ´ng viá»‡c dá»ƒ lÃ m cho giao tiáº¿p real-time hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c, ká»ƒ cáº£ vá»›i cÃ¡c máº¡ng khÃ´ng Ä‘Ã¡ng tin cáº­y:</p><ul><li>Che dáº¥u máº¥t gÃ³i tin (Package loss concealment - PLC, lÃ  1 ká»¹ thuáº­t dÃ¹ng Ä‘á»ƒ che Ä‘áº­y áº£nh hÆ°á»Ÿng cá»§a tÃ¬nh tráº¡ng máº¥t gÃ³i tin trong giao tiáº¿p VoIP)</li><li>Há»§y bá» pháº£n há»“i (Echo cancellation - trong máº¡ng mÃ¡y tÃ­nh thÃ¬ â€œechoâ€ Ä‘Æ°á»£c hiá»ƒu lÃ  quÃ¡ trÃ¬nh gá»­i tráº£ vá» gÃ³i tin Ä‘Ã£ gá»­i Ä‘i)</li><li>Kháº£ nÄƒng thÃ­ch á»©ng bÄƒng thÃ´ng</li><li>Bá»™ Ä‘á»‡m jitter Ä‘á»™ng (jitter buffer - Trong ká»¹ thuáº­t VoIP thÃ¬ jitter buffer lÃ  vÃ¹ng dá»¯ liá»‡u chia sáº» nÆ¡i mÃ  cÃ¡c gÃ³i tin Ã¢m thanh cÃ³ thá»ƒ Ä‘Æ°á»£c thu tháº­p, lÆ°u trá»¯ vÃ  gá»­i Ä‘i Ä‘áº¿n bá»™ xá»­ lÃ½ Ã¢m thanh)</li><li>Tá»± Ä‘á»™ng chiáº¿m quyá»n kiá»ƒm soÃ¡t</li><li>Giáº£m nhiá»…u vÃ  xÃ³a nhiá»…u</li><li>â€œDá»n dáº¹pâ€ hÃ¬nh áº£nh</li></ul><h1 id="RTCDataChannel"><a href="#RTCDataChannel" class="headerlink" title="RTCDataChannel"></a>RTCDataChannel</h1><p>CÅ©ng nhÆ° hÃ¬nh áº£nh vÃ  Ã¢m thanh, WebRTC cÅ©ng há»— trá»£ giao tiáº¿p real-time cho cÃ¡c loáº¡i dá»¯ liá»‡u khÃ¡c.</p><p>API RTCDataChannel cho phÃ©p peer-to-peer trao Ä‘á»•i cÃ¡c dá»¯ liá»‡u tÃ¹y Ã½.</p><p>CÃ³ ráº¥t nhiá»u trÆ°á»ng há»£p sá»­ dá»¥ng API nÃ y, vÃ­ dá»¥:</p><ul><li>DÃ¹ng trong cÃ¡c game</li><li>á»¨ng dá»¥ng chat real-time</li><li>Truyá»n file</li><li>CÃ¡c máº¡ng phi táº­p trung</li></ul><p>API cÅ©ng cÃ³ nhiá»u tÃ­nh nÄƒng Ä‘á»ƒ táº­n dá»¥ng tá»‘i Ä‘a RTCPeerConnection vÃ  kÃ­ch hoáº¡t sá»©c máº¡nh cÅ©ng nhÆ° sá»± linh Ä‘á»™ng cá»§a giao tiáº¿p peer-to-peer:</p><ul><li>Táº­n dá»¥ng cÃ i Ä‘áº·t phiÃªn cá»§a RTCPeerConnection</li><li>Äa kÃªnh Ä‘á»“ng thá»i vá»›i kháº£ nÄƒng phÃ¢n chia má»©c Ä‘á»™ Æ°u tiÃªn</li><li>Ngá»¯ cáº£nh váº­n chuyá»ƒn Ä‘Ã¡ng tin cáº­y vÃ  khÃ´ng Ä‘Ã¡ng tin cáº­y.</li><li>TÃ­ch há»£p sáºµn báº£o máº­t (DTLS) vÃ  kiá»ƒm soÃ¡t táº¯c ngháº½n.</li></ul><p>CÃº phÃ¡p tÆ°Æ¡ng tá»± nhÆ° WebSocket mÃ  ta Ä‘Ã£ biáº¿t, vá»›i phÆ°Æ¡ng thá»©c send() vÃ  sá»± kiá»‡n message:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> peerConnection = <span class="keyword">new</span> webkitRTCPeerConnection(servers,</span><br><span class="line">    &#123;<span class="attr">optional</span>: [&#123;<span class="attr">RtpDataChannels</span>: <span class="literal">true</span>&#125;]&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">peerConnection.ondatachannel = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    receiveChannel = event.channel;</span><br><span class="line">    receiveChannel.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">"#receiver"</span>).innerHTML = event.data;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">sendChannel = peerConnection.createDataChannel(<span class="string">"sendDataChannel"</span>, &#123;<span class="attr">reliable</span>: <span class="literal">false</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">"button#send"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = <span class="built_in">document</span>.querySelector(<span class="string">"textarea#send"</span>).value;</span><br><span class="line">    sendChannel.send(data);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Sá»± giao tiáº¿p diá»…n ra trá»±c tiáº¿p giá»¯a cÃ¡c trÃ¬nh duyá»‡t, vÃ¬ tháº¿ RTCDataChannel cÃ³ thá»ƒ nhanh hÆ¡n nhiá»u so vá»›i WebSocket ká»ƒ cáº£ khi cáº§n Ä‘áº¿n 1 server chuyá»ƒn tiáº¿p (TURN).</p><h1 id="WebRTC-trong-the-gioi-thuc"><a href="#WebRTC-trong-the-gioi-thuc" class="headerlink" title="WebRTC trong tháº¿ giá»›i thá»±c"></a>WebRTC trong tháº¿ giá»›i thá»±c</h1><p>Trong tháº¿ giá»›i thá»±c thÃ¬ WebRTC cáº§n cÃ³ server, tuy nhiÃªn thá»±c táº¿ láº¡i Ä‘Æ¡n giáº£n hÆ¡n:</p><ul><li>CÃ¡c user tá»± khÃ¡m phÃ¡ ra Ä‘á»‘i tÃ¡c cá»§a há» vÃ  trao Ä‘á»•i cÃ¡c chi tiáº¿t cháº³ng háº¡n nhÆ° tÃªn.</li><li>CÃ¡c á»©ng dá»¥ng WebRTC phÃ­a client (cÃ¡c peer) trao Ä‘á»•i thÃ´ng tin máº¡ng.</li><li>CÃ¡c peer trao Ä‘á»•i dá»¯ liá»‡u vá» media cháº³ng háº¡n nhÆ° Ä‘á»‹nh dáº¡ng hÃ¬nh áº£nh vÃ  Ä‘á»™ phÃ¢n giáº£i.</li><li>CÃ¡c á»©ng dá»¥ng WebRTC phÃ­a client di chuyá»ƒn xuyÃªn qua cÃ¡c <a href="http://en.wikipedia.org/wiki/NAT_traversal" target="_blank" rel="noopener">cá»•ng NAT</a> vÃ  tÆ°á»ng lá»­a.</li></ul><p>NÃ³i cÃ¡ch khÃ¡c, WebRTC cáº§n pháº£i cÃ³ 4 tÃ­nh nÄƒng á»Ÿ phÃ­a server:</p><ul><li>User khÃ¡m phÃ¡ ra vÃ  giao tiáº¿p.</li><li>Signaling</li><li>Di chuyá»ƒn NAT/tÆ°á»ng lá»­a</li><li>CÃ¡c server chuyá»ƒn tiáº¿p trong trÆ°á»ng há»£p giao tiáº¿p peer-to-peer tháº¥t báº¡i.</li></ul><p>Giao thá»©c <a href="http://en.wikipedia.org/wiki/STUN" target="_blank" rel="noopener">STUN</a> vÃ  báº£n má»Ÿ rá»™ng <a href="http://en.wikipedia.org/wiki/Traversal_Using_Relay_NAT" target="_blank" rel="noopener">TURN</a> cá»§a nÃ³ Ä‘Æ°á»£c dÃ¹ng bá»Ÿi <a href="http://en.wikipedia.org/wiki/Interactive_Connectivity_Establishment" target="_blank" rel="noopener">ICE</a> Ä‘á»ƒ kÃ­ch hoáº¡t RTCPeerConnection nháº±m Ä‘á»‘i phÃ³ vá»›i di chuyá»ƒn NAT vÃ  cÃ¡c thay Ä‘á»•i máº¡ng mÆ¡ há»“ khÃ¡c.</p><p>NhÆ° Ä‘Ã£ nháº¯c Ä‘áº¿n trÆ°á»›c Ä‘Ã³, ICE lÃ  1 giao thá»©c Ä‘á»ƒ káº¿t ná»‘i cÃ¡c peer, cháº³ng háº¡n nhÆ° 2 á»©ng dá»¥ng video chat client. Khi khá»Ÿi táº¡o, ICE sáº½ thá»­ káº¿t ná»‘i trá»±c tiáº¿p Ä‘áº¿n cÃ¡c peer vá»›i Ä‘á»™ trá»… tháº¥p nháº¥t cÃ³ thá»ƒ thÃ´ng qua UDP. Trong tiáº¿n trÃ¬nh nÃ y, cÃ¡c server STUN cÃ³ 1 tÃ¡c vá»¥ duy nháº¥t: kÃ­ch hoáº¡t 1 peer phÃ­a sau NAT Ä‘á»ƒ tÃ¬m Ä‘á»‹a chá»‰ public &amp; sá»‘ port. Báº¡n cÃ³ thá»ƒ kiá»ƒm tra cÃ¡c server STUN Ä‘ang tá»“n táº¡i á»Ÿ danh sÃ¡ch nÃ y (Google cÅ©ng cÃ³ 1 sá»‘ server)</p><p>|  | # source : <a href="http://code.google.com/p/natvpn/source/browse/trunk/stun_server_list" target="_blank" rel="noopener">http://code.google.com/p/natvpn/source/browse/trunk/stun_server_list</a> |<br>|  | # A list of available STUN server. |<br>|  |  |<br>|  | stun.l.google.com:19302 |<br>|  | stun1.l.google.com:19302 |<br>|  | stun2.l.google.com:19302 |<br>|  | stun3.l.google.com:19302 |<br>|  | stun4.l.google.com:19302 |<br>|  | stun01.sipphone.com |<br>|  | stun.ekiga.net |<br>|  | stun.fwdnet.net |<br>|  | stun.ideasip.com |<br>|  | stun.iptel.org |<br>|  | stun.rixtelecom.se |<br>|  | stun.schlund.de |<br>|  | stunserver.org |<br>|  | stun.softjoys.com |<br>|  | stun.voiparound.com |<br>|  | stun.voipbuster.com |<br>|  | stun.voipstunt.com |<br>|  | stun.voxgratia.org |<br>|  | stun.xten.com |</p><p><a href="https://gist.github.com/zziuni/3741933/raw/212e4b6316110dc5c128d08f65ff8f174d7ae383/stuns" target="_blank" rel="noopener">view raw</a> <a href="https://gist.github.com/zziuni/3741933#file-stuns" target="_blank" rel="noopener">stuns</a> hosted with â¤ by <a href="https://github.com" target="_blank" rel="noopener">GitHub</a>.<br><img src="https://cdn-images-1.medium.com/max/1000/1*ONNxJHqmMTXB1Nuq3qTNXQ.png" alt=""></p><h2 id="Tim-nhung-ung-vien-ket-noi"><a href="#Tim-nhung-ung-vien-ket-noi" class="headerlink" title="TÃ¬m nhá»¯ng á»©ng viÃªn káº¿t ná»‘i"></a>TÃ¬m nhá»¯ng á»©ng viÃªn káº¿t ná»‘i</h2><p>Náº¿u nhÆ° UDP tháº¥t báº¡i, ICE sáº½ thá»­ TCP: Ä‘áº§u tiÃªn lÃ  HTTP, sau Ä‘Ã³ lÃ  HTTPS. Náº¿u káº¿t ná»‘i trá»±c tiáº¿p tháº¥t báº¡i - cá»¥ thá»ƒ lÃ  bá»Ÿi vÃ¬ dá»‹ch chuyá»ƒn NAT &amp; tÆ°á»ng lá»­a má»©c Ä‘á»™ doanh nghiá»‡p - ICE sáº½ dÃ¹ng 1 server TURN trung gian (Ä‘iá»ƒm chuyá»ƒn tiáº¿p). NÃ³i cÃ¡ch khÃ¡c, ICE Ä‘áº§u tiÃªn sáº½ dÃ¹ng STUN vá»›i UDP Ä‘á»ƒ káº¿t ná»‘i trá»±c tiáº¿p cÃ¡c peer vá»›i nhau, náº¿u tháº¥t báº¡i, nÃ³ sáº½ Ä‘á»•i káº¿ hoáº¡ch sang dÃ¹ng server chuyá»ƒn tiáº¿p TURN. Cá»¥m tá»« â€œtÃ¬m kiáº¿m á»©ng viÃªnâ€ nháº¯c Ä‘áº¿n quÃ¡ trÃ¬nh tÃ¬m kiáº¿m cÃ¡c giao diá»‡n máº¡ng &amp; port.<br><img src="https://cdn-images-1.medium.com/max/1000/1*0REL14sYPR34hY7yua6-PA.png" alt=""></p><h1 id="Bao-mat"><a href="#Bao-mat" class="headerlink" title="Báº£o máº­t"></a>Báº£o máº­t</h1><p>CÃ³ ráº¥t nhiá»u cÃ¡ch mÃ  1 á»©ng dá»¥ng hoáº·c plugin giao tiáº¿p real-time cÃ³ thá»ƒ bá»‹ áº£nh hÆ°á»Ÿng vá» báº£o máº­t. VÃ­ dá»¥:</p><ul><li>Dá»¯ liá»‡u hoáº·c media khÃ´ng Ä‘Æ°á»£c mÃ£ hÃ³a cÃ³ thá»ƒ bá»‹ cháº·n trÃªn Ä‘Æ°á»ng Ä‘i giá»¯a cÃ¡c trÃ¬nh duyá»‡t hay giá»¯a trÃ¬nh duyá»‡t vÃ  server</li><li>Má»™t á»©ng dá»¥ng cÃ³ thá»ƒ ghi chÃ©p vÃ  phÃ¢n phá»‘i Ã¢m thanh, hÃ¬nh áº£nh mÃ  user hoÃ n toÃ n khÃ´ng biáº¿t</li><li>Malware hoáº·c virus mÃ¡y tÃ­nh cÃ³ thá»ƒ Ä‘Æ°á»£c cÃ i Ä‘áº·t cÃ¹ng vá»›i 1 á»©ng dá»¥ng hoáº·c plugin vá»› váº©n.</li></ul><p>WebRTC cÃ³ nhiá»u tÃ­nh nÄƒng Ä‘á»ƒ trÃ¡nh cÃ¡c váº¥n Ä‘á» trÃªn:</p><ul><li>WebRTC triá»ƒn khai sá»­ dá»¥ng cÃ¡c giao thá»©c báº£o máº­t cháº³ng háº¡n nhÆ° <a href="http://en.wikipedia.org/wiki/Datagram_Transport_Layer_Security" target="_blank" rel="noopener">DTLS</a> vÃ  <a href="http://en.wikipedia.org/wiki/Secure_Real-time_Transport_Protocol" target="_blank" rel="noopener">SRTP</a></li><li>MÃ£ hÃ³a lÃ  Ä‘iá»u cáº§n thiáº¿t Ä‘á»‘i vá»›i táº¥t cáº£ cÃ¡c component cá»§a WebRTC, bao gá»“m cáº£ cÆ¡ cháº¿ signaling.</li><li>WebRTC khÃ´ng pháº£i lÃ  1 plugin: cÃ¡c component cá»§a nÃ³ cháº¡y trong sandbox cá»§a trÃ¬nh duyá»‡t vÃ  khÃ´ng cháº¡y á»Ÿ luá»“ng riÃªng, cÃ¡c component khÃ´ng yÃªu cáº§u cÃ i Ä‘áº·t riÃªng láº» vÃ  Ä‘Æ°á»£c cáº­p nháº­t má»—i khi trÃ¬nh duyá»‡t Ä‘Æ°á»£c cáº­p nháº­t.</li><li>Truy xuáº¥t camera vÃ  microphone pháº£i Ä‘Æ°á»£c cáº¥p quyá»n rÃµ rÃ ng vÃ  khi camera hoáº·c microphone Ä‘ang hoáº¡t Ä‘á»™ng thÃ¬ pháº£i Ä‘Æ°á»£c thá»ƒ hiá»‡n ra á»Ÿ phÃ­a giao diá»‡n ngÆ°á»i dÃ¹ng.</li></ul><p>WebRTC lÃ  1 cÃ´ng nghá»‡ cá»±c ká»³ thÃº vá»‹ &amp; máº¡nh máº½ dÃ nh cho cÃ¡c sáº£n pháº©m cáº§n lÃ m viá»‡c vá»›i mÃ´ hÃ¬nh truyá»n táº£i real-time giá»¯a cÃ¡c trÃ¬nh duyá»‡t.</p><p>VÃ­ dá»¥, á»Ÿ SessionStack, há» cho phÃ©p user tÃ­ch há»£p thÆ° viá»‡n Javascript cá»§a há» vÃ o bÃªn trong webapp cá»§a user. Nhiá»‡m vá»¥ cá»§a nÃ³ lÃ  báº¯t Ä‘áº§u thu tháº­p cÃ¡c dá»¯ liá»‡u nhÆ° sá»± kiá»‡n ngÆ°á»i dÃ¹ng, thay Ä‘á»•i trÃªn DOM, dá»¯ liá»‡u máº¡ng, biá»‡t lá»‡, thÃ´ng bÃ¡o debug, vÃ¢n vÃ¢n, vÃ  gá»­i chÃºng vá» cho server.</p><p>Trong khi Ä‘Ã³, user cá»§a báº¡n cÃ³ thá»ƒ vÃ o trong webapp cá»§a há», má»Ÿ 1 phiÃªn lÃ m viá»‡c bÃ¬nh thÆ°á»ng vÃ  xem nÃ³ hoáº¡t Ä‘á»™ng theo thá»i gian thá»±c. Sá»­ dá»¥ng cÃ¡c dá»¯ liá»‡u thu tháº­p Ä‘Æ°á»£c, SessionStack cÃ³ thá»ƒ tÃ¡i táº¡o má»i thá»© Ä‘Ã£ tá»«ng xáº£y ra trÃªn trÃ¬nh duyá»‡t cá»§a user, káº¿t há»£p cÃ¡c thÃ´ng tin vá» hÃ¬nh áº£nh thuáº§n tÃºy vá»›i 1 bá»™ giáº£ láº­p console cá»§a trÃ¬nh duyá»‡t vÃ  má»i thá»© bÃªn trong nÃ³. Báº¡n cá»© nghÄ© nÃ³ giá»‘ng nhÆ° desktop tá»« xa nhÆ°ng khÃ´ng báº¯t ngÆ°á»i dÃ¹ng cuá»‘i pháº£i táº£i vá» báº¥t cá»© chÆ°Æ¡ng trÃ¬nh nÃ o. VÃ  trÃªn háº¿t táº¥t cáº£ cÃ¡c thÃ´ng tin hÃ¬nh áº£nh, báº¡n cÃ³ thá»ƒ thá»±c sá»± tháº¥y Ä‘Æ°á»£c cÃ¡c thÃ´ng tin ká»¹ thuáº­t láº¥y tá»« phiÃªn.</p><p>Há» Ä‘Ã£ lÃ m Ä‘Æ°á»£c táº¥t cáº£ Ä‘iá»u Ä‘Ã³ thuáº§n tÃºy vá»›i cÃ¡c server, tuy nhiÃªn sá»­ dá»¥ng WebRTC há» cÃ³ thá»ƒ tháº­t sá»± khÃ´ng cáº§n phá»¥ thuá»™c vÃ o server ná»¯a mÃ  giao tiáº¿p trá»±c tiáº¿p giá»¯a cÃ¡c trÃ¬nh duyá»‡t vá»›i nhau, giáº£m Ä‘á»™ trá»… vÃ  sá»©c máº¡nh tÃ­nh toÃ¡n cáº§n thiáº¿t.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;&lt;em&gt;ThÃªm má»™t bÃ i ná»¯a mang náº·ng kiáº¿n thá»©c vá» máº¡ng mÃ  mÃ¬nh láº¡i khÃ´ng chuyÃªn vá» máº£ng nÃ y, náº¿u mÃ¬nh dá»‹ch chá»— nÃ o khÃ´ng phÃ¹ há»£p thÃ¬ nhá» má»i ngÆ°á»i giÃºp Ä‘á»¡ nhÃ© @&lt;/em&gt;@_&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Peer-To-Peer hay P2P&lt;/strong&gt;: Máº¡ng ngang hÃ ng&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Real-time&lt;/strong&gt;: thá»i gian thá»±c&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 18 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P17: BÃªn trong Shadow DOM + xÃ¢y dá»±ng component khÃ©p kÃ­n</title>
    <link href="http://nthung2112.github.io/2019/01/Cach-Javascript-hoat-dong-P17-Ben-trong-Shadow-DOM-xay-dung-component-khep-kin.html"/>
    <id>http://nthung2112.github.io/2019/01/Cach-Javascript-hoat-dong-P17-Ben-trong-Shadow-DOM-xay-dung-component-khep-kin.html</id>
    <published>2019-01-05T16:50:00.000Z</published>
    <updated>2019-01-06T10:16:19.727Z</updated>
    
    <content type="html"><![CDATA[<p><strong><em>Trong bÃ i cÃ³ nhiá»u tá»« mÃ¬nh Ä‘á»ƒ nguyÃªn mÃ  khÃ´ng dá»‹ch nhÃ©, vÃ¬ dá»‹ch ra thÃ¬ bay máº¥t nghÄ©a @</em>@_</strong></p><ul><li><strong>element</strong>: pháº§n tá»­</li><li><strong>custom element</strong>: pháº§n tá»­ tá»± táº¡o</li><li><strong>component</strong>: thÃ nh pháº§n</li><li><strong>custom component</strong>: thÃ nh pháº§n tá»± táº¡o</li><li><strong>markup</strong>: nÃ³i chung lÃ  ngÃ´n ngá»¯ Ä‘Ã¡nh dáº¥u, hay nÃ³i dá»… hiá»ƒu hÆ¡n lÃ  code HTML (Hyper Text <strong>Markup</strong> Language)</li></ul><p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 17 trong series khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.<br><a id="more"></a></p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>Web Components (ThÃ nh pháº§n web) lÃ  1 bá»™ cÃ¡c cÃ´ng nghá»‡ khÃ¡c nhau cho phÃ©p ta táº¡o ra nhá»¯ng custom element cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng. TÃ­nh nÄƒng cá»§a chÃºng Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i tÃ¡ch hoÃ n toÃ n khá»i code vÃ  báº¡n cÃ³ thá»ƒ dÃ¹ng nÃ³ trong webapp cá»§a mÃ¬nh.</p><p>CÃ³ 4 loáº¡i Web Component tiÃªu chuáº©n:</p><ul><li>Shadow DOM (BÃ³ng cá»§a DOM)</li><li>HTML Templates (cÃ¡c máº«u HTML)</li><li>Custom elements (CÃ¡c custom element)</li><li>HTML Imports</li></ul><p>Trong bÃ i nÃ y ta sáº½ táº­p trung vÃ o <strong>Shadow DOM</strong></p><p>Shadow DOM Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° 1 cÃ´ng cá»¥ dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng cÃ¡c app dá»±a trÃªn component. NÃ³ cung cáº¥p cÃ¡c giáº£i phÃ¡p cho cÃ¡c váº¥n Ä‘á» chung trong ngÃ nh phÃ¡t triá»ƒn web mÃ  báº¡n cháº¯c cháº¯n Ä‘Ã£ gáº·p qua:</p><ul><li><strong>Isolated DOM (DOM cÃ´ láº­p)</strong>: 1 DOM cá»§a component khÃ©p kÃ­n (vÃ­ dá»¥: document.querySelector() khÃ´ng tráº£ vá» cÃ¡c node trong Shadow DOM cá»§a component). Äiá»u nÃ y cÅ©ng lÃ m Ä‘Æ¡n giáº£n hÃ³a cÃ¡c CSS Selector trong webapp cá»§a báº¡n bá»Ÿi vÃ¬ cÃ¡c DOM component Ä‘á»u bá»‹ cÃ´ láº­p, nÃ³ cho phÃ©p báº¡n kháº£ nÄƒng sá»­ dá»¥ng chung nhiá»u id/class mÃ  khÃ´ng lo bá»‹ xung Ä‘á»™t vá» cÃ¡ch Ä‘áº·t tÃªn.</li><li><strong>Scoped CSS (CSS trong pháº¡m vi)</strong>: CSS Ä‘á»‹nh nghÄ©a bÃªn trong Shadow DOM chá»‰ cÃ³ pháº¡m vi trong nÃ³. CÃ¡c quy táº¯c vá» style khÃ´ng lá»t ra ngoÃ i vÃ  style cá»§a trang cÅ©ng khÃ´ng can thiá»‡p vÃ o nÃ³.</li><li><strong>Composition (káº¿t há»£p)</strong>: Thiáº¿t káº¿ 1 API khai bÃ¡o, dá»±a trÃªn markup cho component cá»§a báº¡n.</li></ul><h1 id="Shadow-DOM"><a href="#Shadow-DOM" class="headerlink" title="Shadow DOM"></a>Shadow DOM</h1><p>BÃ i viáº¿t nÃ y giáº£ Ä‘á»‹nh ráº±ng báº¡n Ä‘Ã£ quen thuá»™c vá»›i cÃ¡c khÃ¡i niá»‡m vÃ  API vá» DOM. Náº¿u báº¡n chÆ°a rÃµ thÃ¬ cÃ³ thá»ƒ Ä‘á»c bÃ i viáº¿t chi tiáº¿t vá» nÃ³ á»Ÿ Ä‘Ã¢y: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction</a></p><p>Shadow DOM cÅ©ng chá»‰ lÃ  1 DOM bÃ¬nh thÆ°á»ng, ngoáº¡i trá»« 2 Ä‘iá»u sau:</p><ul><li>CÃ¡ch táº¡o ra/sá»­ dá»¥ng trong má»‘i quan há»‡ vá»›i toÃ n bá»™ trang so vá»›i cÃ¡ch mÃ  báº¡n táº¡o/sá»­ dá»¥ng DOM thÆ°á»ng.</li><li>CÃ¡ch tÆ°Æ¡ng tÃ¡c cá»§a nÃ³ trong má»‘i quan há»‡ vá»›i toÃ n bá»™ trang</li></ul><p>Má»™t cÃ¡ch tá»•ng quÃ¡t, báº¡n táº¡o ra cÃ¡c node DOM vÃ  ná»‘i (append) chÃºng dÆ°á»›i dáº¡ng children vÃ o element khÃ¡c. Trong trÆ°á»ng há»£p cá»§a Shadow DOM, báº¡n táº¡o ra 1 cÃ¢y DOM trong pháº¡m vi (scoped DOM) vÃ  Ä‘Æ°á»£c káº¿t ná»‘i vÃ o element tuy nhiÃªn nÃ³ tÃ¡ch biá»‡t vá»›i children cá»§a chÃ­nh nÃ³. CÃ¢y con trong pháº¡m vi nÃ y Ä‘Æ°á»£c gá»i lÃ  <strong>shadow tree</strong>. Element mÃ  nÃ³ ná»‘i vÃ o Ä‘Æ°á»£c gá»i lÃ  <strong>shadow host</strong>. Báº¥t cá»© thá»© gÃ¬ báº¡n thÃªm vÃ o shadow tree trá»Ÿ thÃ nh 1 pháº§n local cá»§a element chá»§, bao gá»“m cáº£ <code>&lt;style&gt;</code>. ÄÃ¢y lÃ  cÃ¡ch mÃ  Shadow DOM cÃ³ Ä‘Æ°á»£c pháº¡m vi cá»§a CSS style.</p><h1 id="Tao-Shadow-DOM"><a href="#Tao-Shadow-DOM" class="headerlink" title="Táº¡o Shadow DOM"></a>Táº¡o Shadow DOM</h1><p>Má»™t <strong>shadow root</strong> lÃ  1 pháº§n cá»§a document vÃ  Ä‘Æ°á»£c ná»‘i vÃ o 1 element chá»§ (host element). Thá»i Ä‘iá»ƒm báº¡n ná»‘i 1 shadow root chÃ­nh lÃ  lÃºc element cÃ³ Ä‘Æ°á»£c shadow DOM cá»§a nÃ³. Äá»ƒ táº¡o shadow DOM cho 1 element, ta gá»i element.attachShadow():</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> header = <span class="built_in">document</span>.createElement(<span class="string">'header'</span>);</span><br><span class="line"><span class="keyword">var</span> shadowRoot = header.attachShadow(&#123;<span class="attr">mode</span>: <span class="string">'open'</span>&#125;);</span><br><span class="line"><span class="keyword">var</span> paragraphElement = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</span><br><span class="line"></span><br><span class="line">paragraphElement.innerText = <span class="string">'Shadow DOM'</span>;</span><br><span class="line">shadowRoot.appendChild(paragraphElement);</span><br></pre></td></tr></table></figure><p>Pháº§n <a href="http://w3c.github.io/webcomponents/spec/shadow/#h-methods" target="_blank" rel="noopener">thÃ´ng sá»‘ ká»¹ thuáº­t</a> nÃ y Ä‘á»‹nh nghÄ©a 1 danh sÃ¡ch cÃ¡c element mÃ  shadow tree <strong>khÃ´ng thá»ƒ</strong> ná»‘i vÃ o.</p><h1 id="Tinh-ket-hop-trong-Shadow-DOM"><a href="#Tinh-ket-hop-trong-Shadow-DOM" class="headerlink" title="TÃ­nh káº¿t há»£p trong Shadow DOM"></a>TÃ­nh káº¿t há»£p trong Shadow DOM</h1><p>TÃ­nh káº¿t há»£p lÃ  1 trong sá»‘ nhá»¯ng tÃ­nh nÄƒng quan trá»ng nháº¥t cá»§a Shadow DOM.</p><p>Khi viáº¿t code HTML, â€œkáº¿t há»£pâ€ lÃ  cÃ¡ch mÃ  báº¡n xÃ¢y dá»±ng webapp. Báº¡n káº¿t ná»‘i vÃ  cÃ i Ä‘áº·t cÃ¡c viÃªn gáº¡ch khÃ¡c nhau (cÃ²n gá»i lÃ  cÃ¡c element) cháº³ng háº¡n nhÆ° <code>&lt;div&gt;</code>, <code>&lt;header&gt;</code>, <code>&lt;form&gt;</code>, vÃ¢n vÃ¢n, Ä‘á»ƒ xÃ¢y dá»±ng UI cho webapp. Má»™t sá»‘ tag tháº­m chÃ­ cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng vá»›i nhau.</p><p>Sá»± káº¿t há»£p Ä‘á»‹nh nghÄ©a táº¡i sao cÃ¡c element nhÆ° <code>&lt;select&gt;</code>, <code>&lt;form&gt;</code>, <code>&lt;video&gt;</code>â€¦ láº¡i linh Ä‘á»™ng vÃ  cháº¥p nháº­n cÃ¡c element HTML cá»¥ thá»ƒ lÃ m children cá»§a nÃ³ Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c cÃ´ng viá»‡c Ä‘áº·c biá»‡t.</p><p>VÃ­ dá»¥, <code>&lt;select&gt;</code> biáº¿t cÃ¡ch render cÃ¡c element <code>&lt;option&gt;</code> thÃ nh 1 danh sÃ¡ch dropdown vá»›i cÃ¡c item Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÆ°á»›c.</p><p>Shadow DOM giá»›i thiá»‡u cÃ¡c tÃ­nh nÄƒng sau mÃ  tá»« Ä‘Ã³ ta cÃ³ thá»ƒ thá»±c hiá»‡n tÃ­nh â€œkáº¿t há»£pâ€.</p><h1 id="Light-DOM-DOM-nhe"><a href="#Light-DOM-DOM-nhe" class="headerlink" title="Light DOM (DOM nháº¹)"></a>Light DOM (DOM nháº¹)</h1><p>ÄÃ¢y lÃ  Ä‘oáº¡n markup mÃ  user cá»§a component cá»§a báº¡n viáº¿t ra. DOM nÃ y tá»“n táº¡i bÃªn ngoÃ i Shadow DOM cá»§a component. NÃ³ lÃ  má»™t children thá»±c cá»§a element. TÆ°á»Ÿng tÆ°á»£ng ráº±ng báº¡n Ä‘Ã£ táº¡o ra 1 custom component cÃ³ tÃªn <code>&lt;extended-button&gt;</code> cÃ³ thá»ƒ má»Ÿ rá»™ng button máº·c Ä‘á»‹nh cá»§a HTML vÃ  báº¡n muá»‘n thÃªm 1 bá»©c hÃ¬nh, thÃªm vÃ i Ä‘oáº¡n text bÃªn trong nÃ³, thÃ¬ dÆ°á»›i Ä‘Ã¢y lÃ  nhá»¯ng gÃ¬ mÃ  nÃ³ nÃªn cÃ³:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">extended-button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--â€Štháº» img vÃ  span lÃ  Light DOM cá»§a extended-button --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"boot.png"</span> <span class="attr">slot</span>=<span class="string">"image"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>Launch<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">extended-button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>extended-button lÃ  component tÃ¹y chá»n mÃ  báº¡n Ä‘á»‹nh nghÄ©a, Ä‘oáº¡n HTML bÃªn trong nÃ³ Ä‘Æ°á»£c gá»i lÃ  <strong>Light DOM</strong> vÃ  Ä‘Æ°á»£c thÃªm vÃ o bá»Ÿi user cá»§a component cá»§a báº¡n.</p><p>Shadow DOM á»Ÿ Ä‘Ã¢y chÃ­nh lÃ  component mÃ  báº¡n Ä‘Ã£ táº¡o ra (tá»©c lÃ  <code>&lt;extended-button&gt;</code>). Vá»›i component thÃ¬ Shadow DOM lÃ  local, nÃ³ Ä‘á»‹nh nghÄ©a cho chÃ­nh báº£n thÃ¢n nÃ³ cáº¥u trÃºc ná»™i bá»™, CSS trong pháº¡m vi vÃ  Ä‘Ã³ng gÃ³i toÃ n bá»™ cÃ¡c chi tiáº¿t vá» triá»ƒn khai.</p><h1 id="Flattened-DOM-tree-Cay-DOM-phang"><a href="#Flattened-DOM-tree-Cay-DOM-phang" class="headerlink" title="Flattened DOM tree (CÃ¢y DOM pháº³ng)"></a>Flattened DOM tree (CÃ¢y DOM pháº³ng)</h1><p>Káº¿t quáº£ cá»§a trÃ¬nh duyá»‡t khi phÃ¢n phá»‘i Light DOM - má»™t sáº£n pháº©m Ä‘Æ°á»£c táº¡o ra bá»Ÿi user vÃ  Ä‘áº·t vÃ o trong Shadow DOM cá»§a báº¡n cÃ¹ng vá»›i pháº§n Ä‘á»‹nh nghÄ©a cá»§a custom component, sáº½ render ra sáº£n pháº©m cuá»‘i cÃ¹ng. CÃ¢y pháº³ng (flattened tree) lÃ  nhá»¯ng gÃ¬ sau cuá»‘i mÃ  báº¡n tháº¥y trong DevTools vÃ  Ä‘Æ°á»£c render trÃªn trang.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">extended-button</span>&gt;</span></span><br><span class="line">  #shadow-root</span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined">â€¦</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"image"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"boot.png"</span> <span class="attr">slot</span>=<span class="string">"image"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>Launch<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">extended-button</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Templates"><a href="#Templates" class="headerlink" title="Templates"></a>Templates</h1><p>Khi báº¡n pháº£i tÃ¡i sá»­ dá»¥ng liÃªn tá»¥c 1 vÃ i Ä‘oáº¡n markup nÃ o Ä‘Ã³ trÃªn trang web, cÃ¡ch tá»‘t hÆ¡n lÃ  ta sá»­ dá»¥ng 1 kiá»ƒu template hÆ¡n lÃ  cá»© láº·p Ä‘i láº·p láº¡i cÃ¹ng 1 cáº¥u trÃºc Ä‘Ã³ háº¿t láº§n nÃ y Ä‘áº¿n láº§n khÃ¡c. TrÆ°á»›c Ä‘Ã¢y váº«n lÃ m Ä‘Æ°á»£c Ä‘iá»u nÃ y nhÆ°ng bÃ¢y giá» thÃ¬ dá»… hÆ¡n nhiá»u vá»›i element HTML <code>&lt;template&gt;</code> há»— trá»£ sáºµn bá»Ÿi ráº¥t nhiá»u trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i. Element nÃ y vÃ  ná»™i dung cá»§a nÃ³ khÃ´ng Ä‘Æ°á»£c render trÃªn DOM nhÆ°ng nÃ³ váº«n cÃ³ thá»ƒ tham chiáº¿u Ä‘áº¿n báº±ng Javascript.</p><p>CÃ¹ng xem 1 vÃ­ dá»¥ Ä‘Æ¡n giáº£n nÃ o:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"my-paragraph"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> Paragraph content. <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Äoáº¡n code Ä‘Ã³ sáº½ khÃ´ng hiá»ƒn thá»‹ trÃªn trang cá»§a báº¡n trá»« khi báº¡n tham chiáº¿u Ä‘áº¿n nÃ³ báº±ng Javascript vÃ  ná»‘i nÃ³ vÃ o DOM báº±ng 1 cÃ¡ch nÃ o Ä‘Ã³, cháº³ng háº¡n nhÆ°:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> template = <span class="built_in">document</span>.getElementById(<span class="string">'my-paragraph'</span>);</span><br><span class="line"><span class="keyword">var</span> templateContent = template.content;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(templateContent);</span><br></pre></td></tr></table></figure><p>Giá» Ä‘Ã¢y, Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c cÃ¹ng 1 má»¥c Ä‘Ã­ch chung thÃ¬ cÃ³ nhiá»u ká»¹ thuáº­t khÃ¡c nhau Ä‘á»ƒ lá»±a chá»n nhÆ°ng nhÆ° Ä‘Ã£ Ä‘á» cáº­p trÆ°á»›c Ä‘Ã¢y, sáº½ dá»… dÃ ng hÆ¡n nhiá»u náº¿u nhÆ° cÃ¡c ká»¹ thuáº­t Ä‘Ã³ Ä‘Æ°á»£c há»— trá»£ natively. template Ä‘Æ°á»£c cÃ¡c trÃ¬nh duyá»‡t há»— trá»£ khÃ¡ tá»‘t (trá»« IE)</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*3SRCEtv7rMhWpB5s" alt=""></p><p>Tá»± báº£n thÃ¢n template Ä‘Ã£ ráº¥t cÃ³ Ã­ch rá»“i, nhÆ°ng nÃ³ cÃ²n hoáº¡t Ä‘á»™ng tá»‘t hÆ¡n ná»¯a vá»›i cÃ¡c custom element. ChÃºng ta sáº½ Ä‘á»‹nh nghÄ©a vÃ i custom element trong 1 bÃ i viáº¿t khÃ¡c, cÃ²n bÃ¢y giá», trong lÃºc nÃ y thÃ¬ báº¡n nÃªn biáº¿t lÃ  cÃ³ 1 API customElement trÃªn trÃ¬nh duyá»‡t cho phÃ©p chÃºng ta Ä‘á»‹nh nghÄ©a tháº» (tag) riÃªng cá»§a ta vá»›i cÃ¡c tÃ¹y chá»n render.</p><p>Giá» ta sáº½ Ä‘á»‹nh nghÄ©a 1 web component sá»­ dá»¥ng template trÃªn lÃ m ná»™i dung cho Shadow DOM, chÃºng ta gá»i nÃ³ lÃ  <my-paragraph>:</my-paragraph></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">customElements.define(<span class="string">'my-paragraph'</span>,</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">   <span class="keyword">constructor</span>() &#123;</span><br><span class="line">     <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">let</span> template = <span class="built_in">document</span>.getElementById(<span class="string">'my-paragraph'</span>);</span><br><span class="line">     <span class="keyword">let</span> templateContent = template.content;</span><br><span class="line">     <span class="keyword">const</span> shadowRoot = <span class="keyword">this</span>.attachShadow(&#123;<span class="attr">mode</span>: <span class="string">'open'</span>&#125;).appendChild(templateContent.cloneNode(<span class="literal">true</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Äiá»ƒm then chá»‘t cáº§n chÃº Ã½ á»Ÿ Ä‘Ã¢y lÃ  chÃºng ta ná»‘i 1 báº£n sao cá»§a ná»™i dung template vÃ o shadow root - thá»© Ä‘Æ°á»£c táº¡o ra báº±ng phÆ°Æ¡ng thá»©c <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode" target="_blank" rel="noopener">Node.cloneNode()</a></p><p>VÃ  bá»Ÿi vÃ¬ ta ná»‘i ná»™i dung cá»§a nÃ³ vá»›i 1 Shadow DOM nÃªn ta cÃ³ thá»ƒ Ä‘Æ°a thÃªm 1 vÃ i thÃ´ng tin vá» style bÃªn trong template vá»›i element <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/style" target="_blank" rel="noopener"><code>&lt;style&gt;</code></a>, sau Ä‘Ã³ pháº§n style nÃ y sáº½ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i bÃªn trong custom element. Pháº§n nÃ y sáº½ khÃ´ng hoáº¡t Ä‘á»™ng náº¿u ta chá»‰ ná»‘i nÃ³ vÃ o 1 DOM bÃ¬nh thÆ°á»ng.</p><p>VÃ­ dá»¥ ta Ä‘á»•i template thÃ nh nhÆ° sau:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"my-paragraph"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    p &#123;</span></span><br><span class="line"><span class="undefined">      color: white;</span></span><br><span class="line"><span class="undefined">      background-color: #666;</span></span><br><span class="line"><span class="undefined">      padding: 5px;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Paragraph content. <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Giá» thÃ¬ component tÃ¹y chá»n ta Ä‘Ã£ Ä‘á»‹nh nghÄ©a vá»›i template trÃªn cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng nhÆ° tháº¿ nÃ y:<br><code>&lt;my-paragraph&gt;&lt;/my-paragraph&gt;</code></p><h1 id="Slots-khe-trong"><a href="#Slots-khe-trong" class="headerlink" title="Slots (khe trá»‘ng)"></a>Slots (khe trá»‘ng)</h1><p>Templates cÃ³ má»™t vÃ i nhÆ°á»£c Ä‘iá»ƒm, 1 trong sá»‘ Ä‘Ã³ lÃ  ná»™i dung cá»§a nÃ³ thuá»™c loáº¡i â€œtÄ©nhâ€, khÃ´ng cho phÃ©p ta render kÃ¨m theo cÃ¡c dá»¯ liá»‡u hoáº·c biáº¿n Ä‘á»ƒ lÃ m cho nÃ³ hoáº¡t Ä‘á»™ng theo cÃ¡ch bÃ¬nh thÆ°á»ng nhÆ° cÃ¡c template HTML tiÃªu chuáº©n mÃ  ta thÆ°á»ng sá»­ dá»¥ng.</p><p>VÃ  Ä‘Ã¢y lÃ  lÃºc mÃ  <code>&lt;slot&gt;</code> xuáº¥t hiá»‡n.</p><p>Báº¡n cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng ráº±ng slots giá»‘ng nhÆ° ngÆ°á»i giá»¯ chá»—, nÃ³ cho phÃ©p báº¡n Ä‘áº·t HTML riÃªng cá»§a mÃ¬nh vÃ o trong template. NÃ³ giÃºp cho báº¡n táº¡o ra cÃ¡c template HTML linh Ä‘á»™ng hÆ¡n, dá»… tÃ¹y biáº¿n hÆ¡n báº±ng cÃ¡ch thÃªm vÃ o nhiá»u slot.</p><p>Viáº¿t láº¡i template á»Ÿ pháº§n trÃªn vá»›i slot:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">"my-paragraph"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"my-text"</span>&gt;</span>Default text<span class="tag">&lt;/<span class="name">slot</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Náº¿u nhÆ° ná»™i dung cá»§a slot khÃ´ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a khi element Ä‘Æ°á»£c Ä‘Ã­nh kÃ¨m theo markup, hoáº·c náº¿u nhÆ° trÃ¬nh duyá»‡t khÃ´ng há»— trá»£ slot thÃ¬ <code>&lt;my-paragraph&gt;</code> sáº½ chá»‰ hiá»‡n dÃ²ng ná»™i dung backup â€œDefault textâ€.</p><p>Äá»ƒ Ä‘á»‹nh nghÄ©a ná»™i dung slot, ta cáº§n Ä‘Ã­nh kÃ¨m 1 cáº¥u trÃºc HTML bÃªn trong element <code>&lt;my-paragraph&gt;</code> vá»›i thuá»™c tÃ­nh <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes#attr-slot" target="_blank" rel="noopener">slot</a> vÃ  gÃ¡n giÃ¡ trá»‹ cá»§a nÃ³ vá»›i name cá»§a slot mÃ  ta muá»‘n nÃ³ truyá»n vÃ o.</p><p>Giá»‘ng nhÆ° code dÆ°á»›i Ä‘Ã¢y:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-paragraph</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">"my-text"</span>&gt;</span>Let's have some different text!<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">my-paragraph</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CÃ¡c element cÃ³ thá»ƒ Ä‘Æ°á»£c chÃ¨n vÃ o trong slot Ä‘Æ°á»£c gá»i lÃ  <a href="https://developer.mozilla.org/en-US/docs/Web/API/Slotable" target="_blank" rel="noopener">Slotable</a>; khi 1 element Ä‘Æ°á»£c chÃ¨n vÃ o trong slot thÃ¬ ta nÃ³i nÃ³ Ä‘Ã£ bá»‹ slotted.</p><p>Äá»ƒ Ã½ ráº±ng vÃ­ dá»¥ trÃªn chÃºng ta Ä‘Ã£ chÃ¨n 1 element <span> vÃ o, nÃ³ chÃ­nh lÃ  slotted element. NÃ³ cÃ³ 1 thuá»™c tÃ­nh slot giÃ¡ trá»‹ báº±ng my-text - cÃ¹ng giÃ¡ trá»‹ vá»›i thuá»™c tÃ­nh name trong pháº§n Ä‘á»‹nh nghÄ©a cá»§a slot á»Ÿ template.</span></p><p>Sau khi Ä‘Æ°á»£c render trÃªn trÃ¬nh duyá»‡t, Ä‘oáº¡n code trÃªn sáº½ táº¡o ra 1 cÃ¢y Flattened DOM nhÆ° sau:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-paragraph</span>&gt;</span></span><br><span class="line">  #shadow-root</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"my-text"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">"my-text"</span>&gt;</span>Let's have some different text!<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">my-paragraph</span>&gt;</span></span><br></pre></td></tr></table></figure><p>LÆ°u Ã½ Ä‘áº¿n pháº§n tá»­ #shadow-root - nÃ³ xuáº¥t hiá»‡n nhÆ° 1 chá»‰ thá»‹ ráº±ng Shadow DOM Ä‘ang tá»“n táº¡i á»Ÿ Ä‘Ã¢y.</p><h1 id="Styling"><a href="#Styling" class="headerlink" title="Styling"></a>Styling</h1><p>Má»™t component sá»­ dá»¥ng Shadow DOM cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¹y chá»‰nh style tá»« trang chÃ­nh, cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a style cá»§a riÃªng nÃ³ hoáº·c cung cáº¥p hook dÆ°á»›i dáº¡ng <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_variables" target="_blank" rel="noopener">thuá»™c tÃ­nh tÃ¹y chá»‰nh CSS</a> Ä‘á»ƒ user cÃ³ thá»ƒ ghi Ä‘Ã¨ nhá»¯ng thiáº¿t láº­p máº·c Ä‘á»‹nh.</p><h2 id="Dinh-nghia-style-cho-component"><a href="#Dinh-nghia-style-cho-component" class="headerlink" title="Äá»‹nh nghÄ©a style cho component"></a>Äá»‹nh nghÄ©a style cho component</h2><p><strong>Scoped CSS</strong> (CSS trong pháº¡m vi) lÃ  1 trong sá»‘ cÃ¡c tÃ­nh nÄƒng tuyá»‡t vá»i nháº¥t cá»§a Shadow DOM:</p><ul><li>CÃ¡c CSS selector tá»« trang bÃªn ngoÃ i sáº½ khÃ´ng Ã¡p dá»¥ng Ä‘Æ°á»£c vÃ o bÃªn trong component cá»§a báº¡n</li><li>CÃ¡c style Ä‘á»‹nh nghÄ©a bÃªn trong component sáº½ khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n toÃ n bá»™ trang. ChÃºng Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i trong pháº¡m vi cá»§a element chá»§.</li></ul><p>CÃ¡c CSS selector Ä‘Æ°á»£c dÃ¹ng bÃªn trong Shadow DOM Ã¡p dá»¥ng vá»›i component má»™t cÃ¡ch cá»¥c bá»™. Trong thá»±c tiá»…n thÃ¬ Ä‘iá»u nÃ y nghÄ©a lÃ  ta cÃ³ thá»ƒ dÃ¹ng nhiá»u láº§n cÃ¡c tÃªn id/class phá»• biáº¿n mÃ  khÃ´ng cáº§n lo vá» sá»± xung Ä‘á»™t giá»¯a chÃºng trÃªn trang. CSS selector cÃ ng Ä‘Æ¡n giáº£n thÃ¬ cÃ ng cÃ³ hiá»‡u nÄƒng tá»‘t hÆ¡n.</p><p>Giá» ta cÃ¹ng xem 1 Ä‘oáº¡n #shadow-root dÆ°á»›i Ä‘Ã¢y Ä‘á»‹nh nghÄ©a style:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#shadow-root</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  #container &#123;</span></span><br><span class="line"><span class="undefined">    background: white;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  #container-items &#123;</span></span><br><span class="line"><span class="undefined">    display: inline-flex;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container-items"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Táº¥t cáº£ style á»Ÿ vÃ­ dá»¥ trÃªn Ä‘á»u náº±m trong vÃ¹ng local cá»§a #shadow-root</p><p>Báº¡n cÃ³ thá»ƒ dÃ¹ng element <code>&lt;link&gt;</code> Ä‘á»ƒ chÃ¨n thÃªm stylesheets á»Ÿ ngoÃ i vÃ o trong #shadow-root vÃ  nÃ³ cÅ©ng sáº½ thuá»™c vá» vÃ¹ng local.</p><h1 id="pseudo-class-host"><a href="#pseudo-class-host" class="headerlink" title="pseudo-class :host"></a>pseudo-class :host</h1><p>_Ai chÆ°a biáº¿t vá» pseudo-class thÃ¬ cÃ³ thá»ƒ tham kháº£o á»Ÿ Ä‘Ã¢y: <a href="https://www.w3schools.com/css/css_pseudo_classes.asp" target="_blank" rel="noopener">https://www.w3schools.com/css/css_pseudo_classes.asp</a>_</p><p>:host cho phÃ©p báº¡n chá»n vÃ  chá»‰nh style cho element lÃ m host (chá»§) cá»§a shadow tree:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">  <span class="selector-pseudo">:host</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block; <span class="comment">/* máº·c Ä‘á»‹nh thÃ¬ cÃ¡c custom element cÃ³ thuá»™c tÃ­nh display: inline */</span></span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>CÃ³ 1 Ä‘iá»u báº¡n cáº§n pháº£i cáº©n tháº­n khi sá»­ dá»¥ng :host: pháº§n Ä‘á»‹nh nghÄ©a :host trong cÃ¡c trang cha (parent) sáº½ cÃ³ Æ°u tiÃªn cao hÆ¡n Ä‘á»‹nh :host Ä‘á»‹nh nghÄ©a trong element. Äiá»u nÃ y cho phÃ©p ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ ghi Ä‘Ã¨ pháº§n Ä‘á»‹nh nghÄ©a style cao nháº¥t tá»« bÃªn ngoÃ i. BÃªn cáº¡nh Ä‘Ã³, :host chá»‰ hoáº¡t Ä‘á»™ng trong ngá»¯ cáº£nh cá»§a 1 shadow root, vÃ¬ váº­y báº¡n khÃ´ng thá»ƒ dÃ¹ng nÃ³ bÃªn ngoÃ i Shadow DOM.</p><p>Dáº¡ng function :host(<selector>) cho phÃ©p báº¡n trá» trá»±c tiáº¿p Ä‘áº¿n host náº¿u nÃ³ khá»›p vá»›i 1 <selector>. ÄÃ¢y lÃ  1 cÃ¡ch ráº¥t tuyá»‡t vá»i Ä‘á»ƒ component cá»§a báº¡n cÃ³ thá»ƒ Ä‘Ã³ng gÃ³i cÃ¡c hÃ nh vi pháº£n há»“i Ä‘áº¿n cÃ¡c tÆ°Æ¡ng tÃ¡c hoáº·c tráº¡ng thÃ¡i ngÆ°á»i dÃ¹ng vÃ  chá»‰nh style cho cÃ¡c node bÃªn trong dá»±a trÃªn host:</selector></selector></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">  <span class="selector-pseudo">:host</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.4</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-pseudo">:host(</span><span class="selector-pseudo">:hover)</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-pseudo">:host(</span><span class="selector-attr">[disabled]</span>) &#123; <span class="comment">/* style khi host cÃ³ thuá»™c tÃ­nh disabled */</span></span><br><span class="line">    <span class="attribute">background</span>: grey;</span><br><span class="line">    <span class="attribute">pointer-events</span>: none;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.4</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-pseudo">:host(.pink)</span> &gt; <span class="selector-id">#tabs</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: pink; <span class="comment">/* tÃ´ mÃ u cho node #tabs khi host cÃ³ class="pink" */</span></span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h1 id="Dung-chu-de-theme-va-element-voi-pseudo-class-host-context-lt-selector-gt"><a href="#Dung-chu-de-theme-va-element-voi-pseudo-class-host-context-lt-selector-gt" class="headerlink" title="Dá»±ng chá»§ Ä‘á» (theme) vÃ  element vá»›i pseudo-class :host-context(&lt;selector&gt;)"></a>Dá»±ng chá»§ Ä‘á» (theme) vÃ  element vá»›i pseudo-class <code>:host-context(&lt;selector&gt;)</code></h1><p>Pseudo-class <code>:host-context(&lt;selector&gt;)</code> khá»›p host element náº¿u nÃ³ hoáº·c báº¥t ká»³ element cha (ancestor) nÃ o cá»§a nÃ³ khá»›p vá»›i <selector>.</selector></p><p>Má»™t vÃ­ dá»¥ phá»• biáº¿n cho trÆ°á»ng há»£p nÃ y lÃ  lÃ m viá»‡c vá»›i chá»§ Ä‘á»ƒ (theming). Thá»±c táº¿ lÃ  cÃ³ ráº¥t nhiá»u ngÆ°á»i khi lÃ m theme Ä‘á»u thÃªm class vÃ o tháº» <code>&lt;html&gt;</code> hoáº·c <code>&lt;body&gt;</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"lightheme"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">custom-container</span>&gt;</span></span><br><span class="line">  â€¦</span><br><span class="line">  <span class="tag">&lt;/<span class="name">custom-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>:host-context(.lightheme) sáº½ chá»‰nh style cho <fancy-tabs> khi nÃ³ lÃ  con chÃ¡u (descendant) cá»§a .lightheme:</fancy-tabs></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:host-context(.lightheme)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">  <span class="attribute">background</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>:host-context() cÃ³ thá»ƒ cÃ³ Ã­ch cho theming nhÆ°ng cÃ³ 1 cÃ¡ch khÃ¡c cÃ²n tá»‘t hÆ¡n ná»¯a, Ä‘Ã³ lÃ  Ä‘á»‹nh nghÄ©a 1 style hooks sá»­ dá»¥ng cÃ¡c thuá»™c tÃ­nh custom cá»§a CSS, báº¡n cÃ³ thá»ƒ xem á»Ÿ Ä‘Ã¢y: <a href="https://developers.google.com/web/fundamentals/web-components/shadowdom#stylehooks" target="_blank" rel="noopener">https://developers.google.com/web/fundamentals/web-components/shadowdom#stylehooks</a></p><h1 id="Chinh-style-cho-host-element-cua-component-tu-ben-ngoai"><a href="#Chinh-style-cho-host-element-cua-component-tu-ben-ngoai" class="headerlink" title="Chá»‰nh style cho host element cá»§a component tá»« bÃªn ngoÃ i"></a>Chá»‰nh style cho host element cá»§a component tá»« bÃªn ngoÃ i</h1><p>Báº¡n cÃ³ thá»ƒ chá»‰nh style cho host element cá»§a component tá»« bÃªn ngoÃ i vÃ o báº±ng cÃ¡ch dÃ¹ng tag name cá»§a nÃ³ nhÆ° 1 selector, kiá»ƒu váº­y nÃ¨:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">custom-container</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Style bÃªn ngoÃ i cÃ³ má»©c Æ°u tiÃªn cao hÆ¡n style Ä‘á»‹nh nghÄ©a bÃªn trong Shadow DOM.</p><p>VÃ­ dá»¥, náº¿u user viáº¿t 1 selector nhÆ° sau:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">custom-container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€¦thÃ¬ nÃ³ sáº½ ghi Ä‘Ã¨ lÃªn rule cá»§a component:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:host</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tá»©c lÃ  width lÃºc nÃ y cÃ³ giÃ¡ trá»‹ 500px</p><p>Styling chÃ­nh component thÃ¬ chá»‰ cÃ³ thá»ƒ Ä‘áº¿n má»©c nÃ y thÃ´i. Váº­y náº¿u báº¡n muá»‘n style cÃ¡c thÃ nh pháº§n sÃ¢u hÆ¡n bÃªn trong cá»§a component thÃ¬ sao? Ta sáº½ cáº§n Ä‘áº¿n cÃ¡c thuá»™c tÃ­nh custom cá»§a CSS.</p><h1 id="Tao-style-hook-su-dung-thuoc-tinh-custom-cua-CSS"><a href="#Tao-style-hook-su-dung-thuoc-tinh-custom-cua-CSS" class="headerlink" title="Táº¡o style hook sá»­ dá»¥ng thuá»™c tÃ­nh custom cá»§a CSS"></a>Táº¡o style hook sá»­ dá»¥ng thuá»™c tÃ­nh custom cá»§a CSS</h1><p>User cÃ³ thá»ƒ dÃ¹ng máº¹o Ä‘á»ƒ chá»‰nh style cho cÃ¡c thÃ nh pháº§n bÃªn trong náº¿u nhÆ° tÃ¡c giáº£ cá»§a component Ä‘Ã³ cÃ³ cung cáº¥p styling hook sá»­ dá»¥ng <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_variables" target="_blank" rel="noopener">thuá»™c tÃ­nh custom cá»§a CSS</a>.</p><p>Ã tÆ°á»Ÿng tÆ°Æ¡ng tá»± vá»›i <code>&lt;slot&gt;</code> nhÆ°ng Ã¡p dá»¥ng cho style.</p><p>CÃ¹ng xem vÃ­ dá»¥ bÃªn dÆ°á»›i:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--â€Šmain page --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  custom-container &#123;</span></span><br><span class="line"><span class="undefined">    margin-bottom: 60px;</span></span><br><span class="line"><span class="undefined">     -â€Šcustom-container-bg: black;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">custom-container</span> <span class="attr">background</span>&gt;</span>â€¦<span class="tag">&lt;/<span class="name">custom-container</span>&gt;</span></span><br></pre></td></tr></table></figure><p>bÃªn trong Shadow DOM cá»§a nÃ³:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:host(</span><span class="selector-attr">[background]</span>) &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(â€Š-â€Šcustom-container-bg, #CECECE);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Trong trÆ°á»ng há»£p nÃ y, component sáº½ sá»­ dá»¥ng mÃ u black lÃ m giÃ¡ trá»‹ cho background bá»Ÿi vÃ¬ user muá»‘n tháº¿. Náº¿u khÃ´ng thÃ¬ nÃ³ sáº½ dÃ¹ng giÃ¡ trá»‹ máº·c Ä‘á»‹nh lÃ  #CECECE.</p><p>Náº¿u lÃ  tÃ¡c giáº£ cá»§a component, báº¡n cÃ³ trÃ¡ch nhiá»‡m cho developer biáº¿t vá» nhá»¯ng thuá»™c tÃ­nh custom cá»§a CSS mÃ  há» cÃ³ thá»ƒ sá»­ dá»¥ng. HÃ£y xem nhÆ° Ä‘Ã³ lÃ  luáº­t báº¥t thÃ nh vÄƒn khi public má»™t component.</p><h1 id="Javascript-API-cho-slot"><a href="#Javascript-API-cho-slot" class="headerlink" title="Javascript API cho slot"></a>Javascript API cho slot</h1><p>Shadow DOM API cung cáº¥p nhiá»u tiá»‡n Ã­ch há»¯u dá»¥ng Ä‘á»ƒ lÃ m viá»‡c vá»›i slot</p><h2 id="Su-kien-slotchange"><a href="#Su-kien-slotchange" class="headerlink" title="Sá»± kiá»‡n slotchange"></a>Sá»± kiá»‡n slotchange</h2><p>Sá»± kiá»‡n slotchange Ä‘Æ°á»£c báº¯n ra khi node phÃ¢n phá»‘i cá»§a slot bá»‹ thay Ä‘á»•i. VÃ­ dá»¥, náº¿u user thÃªm/bá»›t children tá»« light DOM.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slot = <span class="keyword">this</span>.shadowRoot.querySelector(<span class="string">'#some_slot'</span>);</span><br><span class="line">slot.addEventListener(<span class="string">'slotchange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Light DOM change'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Äá»ƒ kiá»ƒm soÃ¡t cÃ¡c kiá»ƒu thay Ä‘á»•i khÃ¡c trÃªn light DOM, báº¡n cÃ³ thá»ƒ dÃ¹ng MutationObserver trong constructor cá»§a element. ChÃºng ta Ä‘Ã£ tá»«ng tháº£o luáº­n vá» nÃ³ trong <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-10---Quan-sat-thay-doi-tren-DOM-bang-MutationObserver" target="_blank" rel="noopener">Pháº§n 10</a> rá»“i.</p><h2 id="Phuong-thuc-assignedNodes"><a href="#Phuong-thuc-assignedNodes" class="headerlink" title="PhÆ°Æ¡ng thá»©c assignedNodes()"></a>PhÆ°Æ¡ng thá»©c assignedNodes()</h2><p>Sáº½ ráº¥t cÃ³ Ã­ch khi biáº¿t ráº±ng cÃ¡c element cÃ³ liÃªn káº¿t vá»›i slot. Gá»i slot.assignedNodes() sáº½ cho phÃ©p báº¡n biáº¿t nhá»¯ng element nÃ o mÃ  slot render. Option {flatten: true} cÅ©ng sáº½ tráº£ vá» ná»™i dung fallback cá»§a slot (náº¿u nhÆ° khÃ´ng cÃ³ node nÃ o Ä‘ang Ä‘Æ°á»£c phÃ¢n phá»‘i).</p><p>CÃ¹ng xem vÃ­ dá»¥ sau Ä‘Ã¢y:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">'slot1'</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Default content<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Giáº£ sá»­ nÃ³ náº±m trong 1 component gá»i lÃ  <code>&lt;my-container&gt;</code></p><p>Giá» ta sáº½ test thá»­ cÃ¡c cÃ¡ch sá»­ dá»¥ng khÃ¡c nhau cá»§a component nÃ y vÃ  káº¿t quáº£ tráº£ vá» cá»§a assignedNodes():</p><p>TrÆ°á»ng há»£p Ä‘áº§u tiÃªn, ta sáº½ thÃªm ná»™i dung vÃ o slot:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-container</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">"slot1"</span>&gt;</span> container text <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">my-container</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Gá»i assignedNodes() sáº½ cÃ³ káº¿t quáº£ <code>[&lt;span slot=&#39;slot1&#39;&gt; container text &lt;/span&gt;]</code>. Äá»ƒ Ã½ ráº±ng káº¿t quáº£ lÃ  1 array cÃ¡c node.</p><p>Trong trÆ°á»ng há»£p thá»© 2, ta Ä‘á»ƒ ná»™i dung trá»‘ng trÆ¡n:<br><code>&lt;my-container&gt; &lt;/my-container&gt;</code></p><p>Káº¿t quáº£ khi gá»i assignedNodes() lÃ  1 array rá»—ng [].</p><p>Tuy nhiÃªn náº¿u nhÆ° báº¡n Ä‘áº©y thÃªm option {flatten: true} thÃ¬ nÃ³ sáº½ láº¥y giÃ¡ trá»‹ máº·c Ä‘á»‹nh vÃ  tráº£ vá» [</p><p>Default content</p>].<p></p><p>NgoÃ i ra, Ä‘á»ƒ cÃ³ thá»ƒ cháº¡m tá»›i 1 element bÃªn trong slot, báº¡n cÃ³ thá»ƒ gá»i assignedNodes() Ä‘á»ƒ xem náº¿u cÃ³ element nÃ o Ä‘ang Ä‘Æ°á»£c gÃ¡n vÃ o component slot hay khÃ´ng.</p><h1 id="Mo-hinh-su-kien-event-model"><a href="#Mo-hinh-su-kien-event-model" class="headerlink" title="MÃ´ hÃ¬nh sá»± kiá»‡n (event model)"></a>MÃ´ hÃ¬nh sá»± kiá»‡n (event model)</h1><p>Tháº­t thÃº vá»‹ khi Ä‘á»ƒ Ã½ tháº¥y Ä‘iá»u gÃ¬ xáº£y ra khi 1 sá»± kiá»‡n náº±m trong Shadow DOM Ä‘Æ°á»£c báº¯n ra.</p><p>Má»¥c tiÃªu cá»§a sá»± kiá»‡n Ä‘Æ°á»£c Ä‘iá»u chá»‰nh Ä‘á»ƒ báº£o trÃ¬ sá»± Ä‘Ã³ng gÃ³i, cÃ´ láº­p bá»Ÿi Shadow DOM. Khi 1 sá»± kiá»‡n Ä‘Æ°á»£c tÃ¡i-má»¥c-tiÃªu (re-target), trÃ´ng giá»‘ng nhÆ° lÃ  nÃ³ xuáº¥t phÃ¡t tá»« chÃ­nh component hÆ¡n lÃ  tá»« cÃ¡c element bÃªn trong cá»§a Shadow DOM - vá»‘n lÃ  1 pháº§n cá»§a component.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  danh sÃ¡ch cÃ¡c sá»± kiá»‡n cÃ³ thá»ƒ phÃ¡t ra ngoÃ i Shadow DOM (1 sá»‘ thÃ¬ khÃ´ng):</p><ul><li><strong>Sá»± kiá»‡n Focus</strong>: blur, focus, focusin, focusout</li><li><strong>Sá»± kiá»‡n cho con trá» chuá»™t</strong>: click, dbclick, mousedown, mouseenter, mousemove, vÃ¢n vÃ¢n.</li><li><strong>Sá»± kiá»‡n cho con lÄƒn chuá»™t</strong>: wheel</li><li><strong>Sá»± kiá»‡n cho input</strong>: beforeinput, input</li><li><strong>Sá»± kiá»‡n cho bÃ n phÃ­m</strong>: keydown, keyup</li><li><strong>Sá»± kiá»‡n káº¿t há»£p</strong>: compositionstart, compositionupdate, compositionend</li><li><strong>Sá»± kiá»‡n kÃ©o-tháº£</strong>: dragstart, drag, dragend, drop, vÃ¢n vÃ¢n.</li></ul><h1 id="Cac-su-kien-custom"><a href="#Cac-su-kien-custom" class="headerlink" title="CÃ¡c sá»± kiá»‡n custom"></a>CÃ¡c sá»± kiá»‡n custom</h1><p>CÃ¡c sá»± kiá»‡n custom máº·c Ä‘á»‹nh thÃ¬ khÃ´ng phÃ¡t ra bÃªn ngoÃ i Shadow DOM. Náº¿u báº¡n muá»‘n Ä‘iá»u phá»‘i 1 sá»± kiá»‡n custom vÃ  muá»‘n nÃ³ phÃ¡t ra ngoÃ i, báº¡n cáº§n thÃªm 2 option: bubbles: true vÃ  composed: true</p><p>VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> container = <span class="keyword">this</span>.shadowRoot.querySelector(<span class="string">'#container'</span>);</span><br><span class="line">container.dispatchEvent(<span class="keyword">new</span> Event(<span class="string">'containerchanged'</span>, &#123;<span class="attr">bubbles</span>: <span class="literal">true</span>, <span class="attr">composed</span>: <span class="literal">true</span>&#125;));</span><br></pre></td></tr></table></figure><p>Sá»± há»— trá»£ trÃ¬nh duyá»‡t: Äá»ƒ xÃ¡c Ä‘á»‹nh xem trÃ¬nh duyá»‡t cÃ³ sáºµn há»— trá»£ cho Shadow DOM hay khÃ´ng thÃ¬ ta cÃ³ thá»ƒ kiá»ƒm tra sá»± tá»“n táº¡i cá»§a attachShadow:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> supportsShadowDOMV1 = !!HTMLElement.prototype.attachShadow;</span><br></pre></td></tr></table></figure><p>NhÆ°ng nÃ³i chung lÃ  khÃ´ng Ä‘Æ°á»£c nhiá»u cho láº¯m:</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*k0vSOmvdDkRJzcpW" alt=""></p><p>NhÃ¬n chung thÃ¬ Shadow DOM cÃ³ lá»‘i hÃ nh xá»­ ráº¥t khÃ¡c vá»›i DOM thÆ°á»ng. Team SessionStack cÃ³ 1 chÃºt kinh nghiá»‡m khi sá»­ dá»¥ng chÃºng trong thÆ° viá»‡n cá»§a há». ThÆ° viá»‡n Ä‘Ã³ khi Ä‘Æ°á»£c tÃ­ch há»£p vÃ o trong webapp thÃ¬ sáº½ báº¯t Ä‘áº§u thu tháº­p cÃ¡c thÃ´ng tin cháº³ng háº¡n nhÆ° sá»± kiá»‡n ngÆ°á»i dÃ¹ng, dá»¯ liá»‡u máº¡ng, biá»‡t lá»‡, thÃ´ng bÃ¡o debug, thay Ä‘á»•i trÃªn DOM, vÃ¢n vÃ¢n, vÃ  gá»­i chÃºng vá» cho server cá»§a há».</p><p>Sau Ä‘Ã³, há» sáº½ xá»­ lÃ½ cÃ¡c dá»¯ liá»‡u thu Ä‘Æ°á»£c Ä‘á»ƒ cho phÃ©p báº¡n cÃ³ thá»ƒ dÃ¹ng SessionStack Ä‘á»ƒ tÃ¡i hiá»‡n láº¡i cÃ¡c váº¥n Ä‘á» xáº£y ra trong sáº£n pháº©m cá»§a báº¡n. Sá»± khÃ³ khÄƒn há» gáº·p pháº£i trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn khi sá»­ dá»¥ng Shadow DOM: há» pháº£i kiá»ƒm soÃ¡t má»i thay Ä‘á»•i trÃªn DOM Ä‘á»ƒ cÃ³ thá»ƒ tÃ¡i táº¡o láº¡i sau nÃ y. Há» dÃ¹ng MutationObserver Ä‘á»ƒ lÃ m viá»‡c Ä‘Ã³. Tuy nhiÃªn, Shadow DOM khÃ´ng trigger cÃ¡c sá»± kiá»‡n MutationObserver trong pháº¡m vi toÃ n cá»¥c, nghÄ©a lÃ  há» pháº£i xá»­ lÃ½ cÃ¡c component nÃ y theo 1 cÃ¡ch hoÃ n toÃ n khÃ¡c.<br>Há» cÅ©ng nháº­n tháº¥y ráº±ng ngÃ y nay, cÃ³ ráº¥t nhiá»u webapp Ä‘ang táº­n dá»¥ng sá»©c máº¡nh cá»§a Shadow DOM nÃªn cÃ³ váº» nhÆ° cÃ´ng nghá»‡ nÃ y sáº½ cÃ³ 1 tÆ°Æ¡ng lai ráº¥t ráº¡ng ngá»i.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;&lt;em&gt;Trong bÃ i cÃ³ nhiá»u tá»« mÃ¬nh Ä‘á»ƒ nguyÃªn mÃ  khÃ´ng dá»‹ch nhÃ©, vÃ¬ dá»‹ch ra thÃ¬ bay máº¥t nghÄ©a @&lt;/em&gt;@_&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;element&lt;/strong&gt;: pháº§n tá»­&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;custom element&lt;/strong&gt;: pháº§n tá»­ tá»± táº¡o&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;component&lt;/strong&gt;: thÃ nh pháº§n&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;custom component&lt;/strong&gt;: thÃ nh pháº§n tá»± táº¡o&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;markup&lt;/strong&gt;: nÃ³i chung lÃ  ngÃ´n ngá»¯ Ä‘Ã¡nh dáº¥u, hay nÃ³i dá»… hiá»ƒu hÆ¡n lÃ  code HTML (Hyper Text &lt;strong&gt;Markup&lt;/strong&gt; Language)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 17 trong series khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P16: Engine lÆ°u trá»¯ + lá»±a chá»n API lÆ°u trá»¯ nÃ o cho phÃ¹ há»£p</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P16-Engine-luu-tru-lua-chon-API-luu-tru-nao-cho-phu-hop.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P16-Engine-luu-tru-lua-chon-API-luu-tru-nao-cho-phu-hop.html</id>
    <published>2018-11-25T09:42:00.000Z</published>
    <updated>2018-11-25T09:44:30.253Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 16 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>Lá»±a chá»n cÆ¡ cháº¿ lÆ°u trá»¯ Ä‘Ãºng Ä‘áº¯n cho thiáº¿t bá»‹ lÆ°u trá»¯ á»Ÿ local ráº¥t quan trá»ng khi thiáº¿t káº¿ webapp. Má»™t engine lÆ°u trá»¯ tá»‘t sáº½ Ä‘áº£m báº£o thÃ´ng tin cá»§a báº¡n Ä‘Æ°á»£c lÆ°u cháº¯c cháº¯n, giáº£m bÄƒng thÃ´ng vÃ  cáº£i thiá»‡n sá»± pháº£n há»“i. Chiáº¿n lÆ°á»£c lÆ°u trá»¯ bá»™ nhá»› Ä‘á»‡m phÃ¹ há»£p lÃ  thÃ nh pháº§n cá»‘t lÃµi cho phÃ©p tráº£i nghiá»‡m mobile web offline, cÃ ng ngÃ y cÃ ng cÃ³ nhiá»u ngÆ°á»i dÃ¹ng cáº£m tháº¥y ráº±ng nhÆ° Ä‘Ã³ lÃ  tráº£i nghiá»‡m máº·c Ä‘á»‹nh pháº£i cÃ³.</p><p>Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ tháº£o luáº­n vá» nhá»¯ng API lÆ°u trá»¯ cÃ³ sáºµn &amp; cÃ¡c service vÃ  cung cáº¥p má»™t sá»‘ hÆ°á»›ng dáº«n lÃ m tháº¿ nÃ o Ä‘á»ƒ lá»±a chá»n Ä‘Ãºng loáº¡i cho webapp cá»§a báº¡n.<br><a id="more"></a></p><h1 id="Data-model-mo-hinh-du-lieu"><a href="#Data-model-mo-hinh-du-lieu" class="headerlink" title="Data model (mÃ´ hÃ¬nh dá»¯ liá»‡u)"></a>Data model (mÃ´ hÃ¬nh dá»¯ liá»‡u)</h1><p>MÃ´ hÃ¬nh lÆ°u trá»¯ dá»¯ liá»‡u xÃ¡c Ä‘á»‹nh lÃ m tháº¿ nÃ o Ä‘á»ƒ dá»¯ liá»‡u Ä‘Æ°á»£c tá»• chá»©c ná»™i bá»™. Äiá»u nÃ y áº£nh hÆ°á»Ÿng toÃ n bá»™ thiáº¿t káº¿ cá»§a webapp, Ä‘á»‹nh nghÄ©a sá»± cÃ¢n báº±ng Ä‘á»ƒ lÃ m cho webapp hoáº¡t Ä‘á»™ng hiá»‡u quáº£ nhÆ°ng váº«n giáº£i quyáº¿t Ä‘Æ°á»£c váº¥n Ä‘á» cáº§n giáº£i quyáº¿t. Giá»‘ng nhÆ° báº¥t cá»© thá»© gÃ¬ liÃªn quan Ä‘áº¿n ká»¹ thuáº­t, khÃ´ng tá»“n táº¡i phÆ°Æ¡ng phÃ¡p nÃ o â€œtá»‘t hÆ¡nâ€ vÃ  cÅ©ng khÃ´ng cÃ³ giáº£i phÃ¡p má»™t-cho-táº¥t-cáº£ nÃ o háº¿t. CÃ¹ng xem qua 1 chÃºt vá» má»™t sá»‘ data model mÃ  ta cÃ³ thá»ƒ dÃ¹ng:</p><ul><li><strong>Kiá»ƒu cáº¥u trÃºc</strong>: Dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong cÃ¡c báº£ng kÃ¨m vá»›i cÃ¡c trÆ°á»ng Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a, giá»‘ng nhÆ° cÃ¡c há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘áº·c trÆ°ng dá»±a trÃªn SQL, chÃºng cÃ³ tÃ­nh linh hoáº¡t vÃ  cÃ¡c cÃ¢u truy váº¥n Ä‘á»™ng. Má»™t vÃ­ dá»¥ ná»•i báº­t vá» kho dá»¯ liá»‡u kiá»ƒu cáº¥u trÃºc trÃªn trÃ¬nh duyá»‡t chÃ­nh lÃ  IndexedDB.</li><li><strong>key/value</strong>: kho dá»¯ liá»‡u key/value, vÃ  cáº£ cÆ¡ sá»Ÿ dá»¯ liá»‡u NoSQL, cho phÃ©p lÆ°u trá»¯ vÃ  trÃ­ch xuáº¥t dá»¯ liá»‡u khÃ´ng cÃ³ cáº¥u trÃºc Ä‘Æ°á»£c Ä‘Ã¡nh index báº±ng 1 key duy nháº¥t. Kho dá»¯ liá»‡u kiá»ƒu key/value giá»‘ng nhÆ° báº£ng bÄƒm (hash table) á»Ÿ chá»— chÃºng cho phÃ©p truy cáº­p liÃªn tá»¥c vÃ o cÃ¡c dá»¯ liá»‡u áº©n Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã¡nh index. Má»™t vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh cho kho dá»¯ liá»‡u key/value lÃ  Cache API trÃªn trÃ¬nh duyá»‡t vÃ  Apache Cassandra trÃªn server.</li><li><strong>Byte Streams</strong>: mÃ´ hÃ¬nh Ä‘Æ¡n giáº£n nÃ y lÆ°u dá»¯ liá»‡u dÆ°á»›i dáº¡ng 1 biáº¿n Ä‘á»™ dÃ i, má»™t chuá»—i áº©n cÃ¡c byte, vÃ  nÃ³ Ä‘á»ƒ láº¡i báº¥t ká»³ hÃ¬nh thá»©c tá»• chá»©c ná»™i bá»™ nÃ o cho lá»›p á»©ng dá»¥ng. MÃ´ hÃ¬nh nÃ y Ä‘áº·c biá»‡t tá»‘t cho cÃ¡c há»‡ thá»‘ng táº­p tin (file) vÃ  cÃ¡c blob dá»¯ liá»‡u cÃ³ tá»• chá»©c dáº¡ng phÃ¢n cáº¥p. VÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh cá»§a kho dá»¯ liá»‡u byte stream bao gá»“m nhá»¯ng há»‡ thá»‘ng file vÃ  cÃ¡c dá»‹ch vá»¥ lÆ°u trá»¯ cloud.</li></ul><h1 id="Tinh-ben-vung"><a href="#Tinh-ben-vung" class="headerlink" title="TÃ­nh bá»n vá»¯ng"></a>TÃ­nh bá»n vá»¯ng</h1><p>CÃ³ thá»ƒ phÃ¢n tÃ­ch cÃ¡c phÆ°Æ¡ng phÃ¡p lÆ°u trá»¯ cho webapp vá»›i sá»± má»©c Ä‘á»™ Æ°u tiÃªn cho timeframe hÆ¡n lÃ  dá»¯ liá»‡u nÃ o cáº§n Ä‘Æ°á»£c bá»n vá»¯ng:</p><ul><li><strong>Session Persistence (Bá»n vá»¯ng phiÃªn)</strong>: dá»¯ liá»‡u trong má»¥c nÃ y chá»‰ Ä‘Æ°á»£c giá»¯ cá»‘ Ä‘á»‹nh miá»…n lÃ  má»™t session cá»§a web hoáº·c má»™t tab trÃªn trÃ¬nh duyá»‡t váº«n Ä‘ang hoáº¡t Ä‘á»™ng. VÃ­ dá»¥ vá» cÆ¡ cháº¿ lÆ°u trá»¯ vá»›i phiÃªn bá»n vá»¯ng chÃ­nh lÃ  <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage" target="_blank" rel="noopener">Session Storage API</a></li><li><strong>Device Persistence (Bá»n vá»¯ng thiáº¿t bá»‹)</strong>: dá»¯ liá»‡u trong má»¥c nÃ y Ä‘Æ°á»£c giá»¯ cá»‘ Ä‘á»‹nh xuyÃªn suá»‘t nhiá»u session vÃ  nhiá»u tab hoáº·c cá»­a sá»• trÃ¬nh duyá»‡t, trÃªn 1 thiáº¿t bá»‹ cá»¥ thá»ƒ. VÃ­ dá»¥: <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage" target="_blank" rel="noopener">Cache API</a></li><li><strong>Global Persistence (Bá»n vá»¯ng toÃ n cá»¥c)</strong>: dá»¯ liá»‡u trong má»¥c nÃ y Ä‘Æ°á»£c giá»¯ cá»‘ Ä‘á»‹nh xuyÃªn suá»‘t cÃ¡c session &amp; cÃ¡c thiáº¿t bá»‹. VÃ¬ tháº¿, Ä‘Ã¢y lÃ  dáº¡ng máº¡nh máº½ nháº¥t cá»§a bá»n vá»¯ng dá»¯ liá»‡u. NÃ³ khÃ´ng Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn chÃ­nh thiáº¿t bá»‹ vÃ  Ä‘iá»u Ä‘Ã³ nghÄ©a lÃ  báº¡n cáº§n pháº£i cÃ³ 1 kiá»ƒu lÆ°u trá»¯ á»Ÿ phÃ­a server. ChÃºng ta sáº½ khÃ´ng tháº£o luáº­n chi tiáº¿t vá» nÃ³ vÃ¬ bÃ i viáº¿t nÃ y chá»‰ táº­p trung vÃ o lÆ°u trá»¯ dá»¯ liá»‡u trÃªn thiáº¿t bá»‹.</li></ul><h1 id="Ben-vung-du-lieu-tren-trinh-duyet"><a href="#Ben-vung-du-lieu-tren-trinh-duyet" class="headerlink" title="Bá»n vá»¯ng dá»¯ liá»‡u trÃªn trÃ¬nh duyá»‡t"></a>Bá»n vá»¯ng dá»¯ liá»‡u trÃªn trÃ¬nh duyá»‡t</h1><p>NgÃ y nay cÃ³ ráº¥t Ã­t cÃ¡c browser API cho phÃ©p báº¡n lÆ°u trá»¯ dá»¯ liá»‡u. ChÃºng ta sáº½ tÃ¬m hiá»ƒu qua má»™t vÃ i thá»© nhÆ° tháº¿ vÃ  táº¡o 1 báº£n so sÃ¡nh Ä‘á»ƒ cÃ³ thá»ƒ dá»… dÃ ng lá»±a chá»n giáº£i phÃ¡p phÃ¹ há»£p.</p><p>Tuy nhiÃªn thÃ¬ Ä‘áº§u tiÃªn, cÃ³ vÃ i thá»© báº¡n cáº§n pháº£i cÃ¢n nháº¯c trÆ°á»›c khi chá»n lÃ m tháº¿ nÃ o Ä‘á»ƒ cá»‘ Ä‘á»‹nh dá»¯ liá»‡u. DÄ© nhiÃªn thÃ¬ thá»© Ä‘áº§u tiÃªn báº¡n cáº§n pháº£i hiá»ƒu ká»¹ chÃ­nh lÃ  webapp cá»§a báº¡n Ä‘Æ°á»£c dÃ¹ng nhÆ° tháº¿ nÃ o, sau Ä‘Ã³ cÃ²n cÃ³ báº£o trÃ¬ vÃ  nÃ¢ng cáº¥p. Tháº­m chÃ­ náº¿u báº¡n cÃ³ cÃ¢u tráº£ lá»i cho cÃ¡c cÃ¢u há»i Ä‘Ã³, báº¡n cÅ©ng sáº½ pháº£i káº¿t thÃºc vá»›i 1 sá»‘ lá»±a chá»n vÃ  chá»n chÃºng. VÃ¬ tháº¿ nÃªn dÆ°á»›i Ä‘Ã¢y lÃ  1 sá»‘ thá»© báº¡n nÃªn xem qua:</p><ul><li><strong>TrÃ¬nh duyá»‡t há»— trá»£</strong>: báº¡n cáº§n pháº£i nhá»› ká»¹ 1 sá»± tháº­t lÃ  cÃ¡c API Ä‘Æ°á»£c xÃ¢y dá»±ng tá»‘t &amp; Ä‘Æ°á»£c chuáº©n hÃ³a cÃ³ má»©c Ä‘á»™ Æ°u Ã¡i cao hÆ¡n, bá»Ÿi vÃ¬ chÃºng hÆ°á»›ng tá»›i sá»± tá»“n táº¡i lÃ¢u dÃ i vÃ  Ä‘Æ°á»£c há»— trá»£ rá»™ng rÃ£i. Nhá»¯ng API Ä‘Ã³ cÅ©ng thÆ°á»ng cÃ³ tÃ i liá»‡u rá»™ng hÆ¡n vÃ  cá»™ng Ä‘á»“ng developer há»— trá»£ giÃ u kinh nghiá»‡m hÆ¡n.</li><li><strong>Transactions (giao dá»‹ch)</strong>: Ä‘Ã´i khi transactions ráº¥t quan trá»ng Ä‘á»‘i vá»›i 1 táº­p há»£p cá»§a cÃ¡c hoáº¡t Ä‘á»™ng lÆ°u trá»¯ tá»± Ä‘á»™ng thÃ nh cÃ´ng hay tháº¥t báº¡i. CÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u theo truyá»n thá»‘ng luÃ´n há»— trá»£ tÃ­nh nÄƒng nÃ y sá»­ dá»¥ng 1 mÃ´ hÃ¬nh transaction, nhá»¯ng cáº­p nháº­t liÃªn quan Ä‘Æ°á»£c nhÃ³m láº¡i thÃ nh cÃ¡c Ä‘Æ¡n vá»‹ chuyÃªn biá»‡t.</li><li><strong>Sync/Async (Ä‘á»“ng bá»™/báº¥t Ä‘á»“ng bá»™)</strong>: má»™t vÃ i API lÆ°u trá»¯ thá»ƒ hiá»‡n sá»± Ä‘á»“ng bá»™ khi mÃ  cÃ¡c request lÆ°u trá»¯ hoáº·c láº¥y dá»¯ liá»‡u sáº½ cháº·n tiáº¿n trÃ¬nh Ä‘ang hoáº¡t Ä‘á»™ng cho tá»›i khi request Ä‘Æ°á»£c hoÃ n thÃ nh. Sá»­ dá»¥ng API lÆ°u trá»¯ Ä‘á»“ng bá»™ cÃ³ thá»ƒ cháº·n tiáº¿n trÃ¬nh chÃ­nh vÃ  lÃ m cho tráº£i nghiá»‡m UI trÃªn webapp bá»‹ Ä‘Ã´ng cá»©ng khÃ´ng hoáº¡t Ä‘á»™ng. Náº¿u cÃ³ thá»ƒ, hÃ£y dÃ¹ng cÃ¡c API báº¥t Ä‘á»“ng bá»™.</li></ul><h1 id="So-sanh"><a href="#So-sanh" class="headerlink" title="So sÃ¡nh"></a>So sÃ¡nh</h1><p>Trong pháº§n nÃ y, chÃºng ta sáº½ so sÃ¡nh cÃ¡c API hiá»‡n cÃ³ dÃ nh cho web developer vÃ  so sÃ¡nh chÃºng vá»›i cÃ¡c tiÃªu chÃ­ Ä‘Ã£ nÃ³i á»Ÿ trÃªn</p><table><thead><tr><th>API</th><th>MÃ´ hÃ¬nh dá»¯ liá»‡u (Data model)</th><th>TÃ­nh bá»n vá»¯ng (persistence)</th><th>TrÃ¬nh duyá»‡t há»— trá»£</th><th>Transactions</th><th>Sync/Async</th></tr></thead><tbody><tr><td>File System (há»‡ thá»‘ng file)</td><td>Byte stream</td><td>thiáº¿t bá»‹</td><td>52%</td><td>KhÃ´ng</td><td>Async</td></tr><tr><td>Local Storage</td><td>key/value</td><td>thiáº¿t bá»‹</td><td>93%</td><td>KhÃ´ng</td><td>Sync</td></tr><tr><td>Session Storage</td><td>key/value</td><td>session</td><td>93%</td><td>KhÃ´ng</td><td>Sync</td></tr><tr><td>Cookies</td><td>cáº¥u trÃºc</td><td>thiáº¿t bá»‹</td><td>100%</td><td>KhÃ´ng</td><td>Sync</td></tr><tr><td>Cache</td><td>key/value</td><td>thiáº¿t bá»‹</td><td>60%</td><td>KhÃ´ng</td><td>Async</td></tr><tr><td>IndexedDB</td><td>há»—n há»£p (hybrid)</td><td>thiáº¿t bá»‹</td><td>83%</td><td>CÃ³</td><td>Async</td></tr></tbody></table><h1 id="File-System-API-he-thong-file"><a href="#File-System-API-he-thong-file" class="headerlink" title="File System API (há»‡ thá»‘ng file)"></a>File System API (há»‡ thá»‘ng file)</h1><p><img src="https://cdn-images-1.medium.com/max/1000/0*9KPehy4mUb8f-hSp" alt=""></p><p>Vá»›i File System API, webapp cÃ³ thá»ƒ táº¡o, Ä‘á»c, Ä‘iá»u hÆ°á»›ng vÃ  ghi vÃ o 1 khu vá»±c sandbox thuá»™c há»‡ thá»‘ng local file cá»§a user.</p><p>API Ä‘Æ°á»£c chia nhá» thÃ nh nhiá»u chá»§ Ä‘á»:</p><ul><li>Äá»c vÃ  sá»­a file: File/Blob, FileList, FileReader</li><li>Táº¡o vÃ  ghi file: Blob(), FileWriter</li><li>CÃ¡c thÆ° má»¥c vÃ  truy cáº­p há»‡ thá»‘ng file: DirectoryReader, FileEntry/DirectoryEntry, LocalFileSystem</li></ul><p>File System API khÃ´ng pháº£i lÃ  1 há»‡ thá»‘ng API tiÃªu chuáº©n. Báº¡n khÃ´ng nÃªn dÃ¹ng nÃ³ trÃªn sáº£n pháº©m webapp production bá»Ÿi vÃ¬ nÃ³ sáº½ khÃ´ng hoáº¡t Ä‘á»™ng vá»›i táº¥t cáº£ user. CÃ³ ráº¥t sá»± khÃ´ng tÆ°Æ¡ng thÃ­ch lá»›n giá»¯a cÃ¡c triá»ƒn khai khÃ¡c nhau vÃ  hÃ nh vi cá»§a chÃºng sáº½ cháº¯c cháº¯n bá»‹ thay Ä‘á»•i trong tÆ°Æ¡ng lai.</p><p><strong>FileSystem</strong> - interface cá»§a File &amp; Directory Entries API Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ thá»ƒ hiá»‡n 1 há»‡ thá»‘ng file. Nhá»¯ng object nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c láº¥y tá»« thuá»™c tÃ­nh <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileSystemEntry/filesystem" target="_blank" rel="noopener">filesystem</a> cá»§a báº¥t ká»³ entry thuá»™c há»‡ thá»‘ng file nÃ o. Má»™t vÃ i trÃ¬nh duyá»‡t cung cáº¥p thÃªm cÃ¡c API Ä‘á»ƒ táº¡o &amp; quáº£n lÃ½ cÃ¡c há»‡ thá»‘ng file.</p><p>Interface nÃ y sáº½ khÃ´ng cáº¥p quyá»n cho báº¡n truy cáº­p vÃ o há»‡ thá»‘ng file cá»§a user. Thay vÃ o Ä‘Ã³, báº¡n sáº½ cÃ³ 1 â€œá»• Ä‘Ä©a áº£oâ€ (virtual drive) bÃªn trong sandbox cá»§a trÃ¬nh duyá»‡t. Náº¿u báº¡n muá»‘n truy cáº­p vÃ o há»‡ thá»‘ng file cá»§a user, báº¡n cáº§n pháº£i gá»i há»i user báº±ng cÃ¡ch vÃ­ dá»¥ nhÆ° cÃ i 1 Chrome extension.</p><h2 id="Yeu-cau-1-he-thong-file"><a href="#Yeu-cau-1-he-thong-file" class="headerlink" title="YÃªu cáº§u 1 há»‡ thá»‘ng file"></a>YÃªu cáº§u 1 há»‡ thá»‘ng file</h2><p>Má»™t webapp cÃ³ thá»ƒ yÃªu cáº§u truy cáº­p Ä‘áº¿n má»™t há»‡ thá»‘ng file sandbox báº±ng cÃ¡ch gá»i: window.requestFileSystem():</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LÆ°u Ã½: Há»‡ thá»‘ng file Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã¡nh tiá»n tá»‘ tÃ­nh Ä‘áº¿n Google Chrome 12.</span></span><br><span class="line"><span class="built_in">window</span>.requestFileSystem = <span class="built_in">window</span>.requestFileSystem || <span class="built_in">window</span>.webkitRequestFileSystem;</span><br><span class="line"><span class="built_in">window</span>.requestFileSystem(type, size, successCallback, opt_errorCallback)</span><br></pre></td></tr></table></figure><p>Náº¿u báº¡n gá»i hÃ m requestFileSystem() láº§n Ä‘áº§u tiÃªn thÃ¬ 1 vÃ¹ng lÆ°u trá»¯ má»›i Ä‘Æ°á»£c táº¡o ra. Quan trá»ng hÃ£y nhá»› ráº±ng há»‡ thá»‘ng file nÃ y Ä‘Æ°á»£c gÃ³i gá»n trong sandbox, nghÄ©a lÃ  1 webapp khÃ´ng thá»ƒ truy cáº­p file cá»§a webapp khÃ¡c.</p><p>Sau khi báº¡n cÃ³ quyá»n truy cáº­p vÃ o há»‡ thá»‘ng file, báº¡n cÃ³ thá»ƒ lÃ m táº¥t cáº£ cÃ¡c hoáº¡t Ä‘á»™ng cÆ¡ báº£n vá»›i file &amp; thÆ° má»¥c.</p><p>FileSystem lÃ  1 lá»±a chá»n lÆ°u trá»¯ khÃ¡ khÃ¡c biá»‡t vá»›i cÃ¡c loáº¡i khÃ¡c vÃ¬ nÃ³ hÆ°á»›ng Ä‘áº¿n thá»a mÃ£n nhÆ° cáº§u lÆ°u trá»¯ á»Ÿ phÃ­a client trong nhá»¯ng tÃ¬nh huá»‘ng khÃ´ng dÃ¹ng Ä‘Æ°á»£c cÆ¡ sá»Ÿ dá»¯ liá»‡u. Má»™t cÃ¡ch tá»•ng quÃ¡t thÃ¬ Ä‘Ã³ lÃ  nhá»¯ng á»©ng dá»¥ng hoáº¡t Ä‘á»™ng vá»›i nhá»¯ng cá»¥c blob nhá»‹ phÃ¢n cá»¡ bá»± vÃ /hoáº·c chia sáº» dá»¯ liá»‡u vá»›i cÃ¡c á»©ng dá»¥ng khÃ¡c bÃªn ngoÃ i trÃ¬nh duyá»‡t.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  nhá»¯ng trÆ°á»ng há»£p cÃ³ thá»ƒ sá»­ dá»¥ng FileSystem API:</p><ul><li>Táº£i lÃªn (upload) liÃªn tá»¥c: khi 1 file hay thÆ° má»¥c Ä‘Æ°á»£c chá»n Ä‘á»ƒ upload, nÃ³ copy cÃ¡c file vÃ o trong 1 vÃ¹ng local sandbox vÃ  upload tá»«ng pháº§n, tá»«ng pháº§n.</li><li>Video game, Ã¢m nháº¡c hoáº·c cÃ¡c app khÃ¡c mÃ  cÃ³ nhiá»u tÃ i nguyÃªn media.</li><li>Chá»‰nh sá»­a Ã¢m thanh/hÃ¬nh áº£nh vá»›i truy cáº­p offline hoáº·c lÃ  lÆ°u Ä‘á»‡m local Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ - nhá»¯ng cá»¥c blob dá»¯ liá»‡u nhÆ° tháº¿ thÆ°á»ng ráº¥t lá»›n khi Ä‘á»c-ghi.</li><li>Xem video offline - cáº§n pháº£i download 1 lÆ°á»£ng lá»›n file Ä‘á»ƒ xem sau hoáº·c seek + streaming hiá»‡u quáº£.</li><li>á»¨ng dá»¥ng Web Mail offline - download cÃ¡c file Ä‘Ã­nh kÃ¨m vÃ  lÆ°u chÃºng á»Ÿ local.</li></ul><p>TÃ¬nh hÃ¬nh há»— trá»£ cá»§a API:<br><img src="https://cdn-images-1.medium.com/max/1000/0*ndU4N8xQF6QEQmSY" alt=""></p><h1 id="Local-Storage"><a href="#Local-Storage" class="headerlink" title="Local Storage"></a>Local Storage</h1><p><img src="https://cdn-images-1.medium.com/max/1000/0*AsoHzlowoLItnUEL" alt=""></p><p>API localstorage cho phÃ©p báº¡n truy cáº­p object <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage" target="_blank" rel="noopener">Storage</a> dÃ nh cho origin cá»§a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document" target="_blank" rel="noopener">Document</a>. Dá»¯ liá»‡u lÆ°u trá»¯ xuyÃªn suá»‘t nhiá»u session trÃ¬nh duyá»‡t. localstorage tÆ°Æ¡ng tá»± nhÆ° <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.sessionStorage" target="_blank" rel="noopener">sessionStorage</a>, ngoáº¡i trá»« viá»‡c dá»¯ liá»‡u lÆ°u á»Ÿ trong dataStorage khÃ´ng bá»‹ háº¿t háº¡n, dá»¯ liá»‡u trong sessionStorage sáº½ bá»‹ dá»n dáº¹p khi session cá»§a trang káº¿t thÃºc, tá»©c lÃ  khi Ä‘Ã³ng tab trang Ä‘Ã³.</p><p>Äá»ƒ Ã½ ráº±ng dá»¯ liá»‡u lÆ°u trong localStorage hay sessionStorage lÃ  cá»¥ thá»ƒ cho origin cá»§a tá»«ng trang, bao gá»“m sá»± káº¿t há»£p cá»§a giao thá»©c (protocol), host vÃ  cá»•ng (port).</p><p>TÃ¬nh hÃ¬nh há»— trá»£ sÃ¡ng sá»§a cá»§a nÃ³:<br><img src="https://cdn-images-1.medium.com/max/1000/0*hxC_NUPNycUBhj-L" alt=""></p><h1 id="Session-Storage"><a href="#Session-Storage" class="headerlink" title="Session Storage"></a>Session Storage</h1><p><img src="https://cdn-images-1.medium.com/max/1000/0*-IMsNws_L1g0Syla" alt=""></p><p>sessionStorage cho phÃ©p báº¡n truy cáº­p vÃ o 1 object <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage" target="_blank" rel="noopener">Storage</a> cá»§a session cho origin hiá»‡n táº¡i. sessionStorage tÆ°Æ¡ng tá»± nhÆ° <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" target="_blank" rel="noopener">localStorage</a>, nhÆ° Ä‘Ã£ giáº£i thÃ­ch ngáº¯n gá»n á»Ÿ trÃªn. Äiá»ƒm khÃ¡c biá»‡t duy nháº¥t lÃ  dá»¯ liá»‡u lÆ°u trong localStorage khÃ´ng bá»‹ háº¿t háº¡n, cÃ²n trong sessionStorage thÃ¬ bá»‹ xÃ³a khi session cá»§a trang káº¿t thÃºc. Má»™t session cá»§a trang tá»“n táº¡i miá»…n lÃ  cá»­a sá»• trÃ¬nh duyá»‡t váº«n cÃ²n má»Ÿ vÃ  tá»“n táº¡i khi trang reload hoáº·c restore. <strong>Má»Ÿ trang trong 1 tab má»›i hoáº·c cá»­a sá»• má»›i sáº½ táº¡o ra session má»›i</strong>, khÃ¡c vá»›i cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a session cookies.</p><p>Dá»¯ liá»‡u lÆ°u trong sessionStorage hay localStorage lÃ  <strong>dÃ nh riÃªng cho origin cá»§a trang</strong>.</p><p>TÃ¬nh hÃ¬nh há»— trá»£ cá»§a sessionStorage:<br><img src="https://cdn-images-1.medium.com/max/1000/0*PTDs1BkbMgekizit" alt=""></p><h1 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h1><p><img src="https://cdn-images-1.medium.com/max/1000/0*VKQINIYfu2O7d7BH" alt=""></p><p>Má»™t cookie (hay web cookie, cookie trÃ¬nh duyá»‡t) lÃ  1 cá»¥c dá»¯ liá»‡u nhá» xÃ­u mÃ  server gá»­i Ä‘áº¿n trÃ¬nh duyá»‡t cá»§a user. TrÃ¬nh duyá»‡t cÃ³ thá»ƒ lÆ°u nÃ³ vÃ  gá»­i ngÆ°á»£c vá» cÃ¹ng server Ä‘Ã³ trong request tiáº¿p theo. ThÃ´ng thÆ°á»ng, nÃ³ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ cho biáº¿t náº¿u 2 request Ä‘áº¿n tá»« cÃ¹ng 1 trÃ¬nh duyá»‡t - vÃ­ dá»¥: giá»¯ cho user tiáº¿p tá»¥c Ä‘Äƒng nháº­p. NÃ³ ghi nhá»› thÃ´ng tin tráº¡ng thÃ¡i cho giao thá»©c HTTP <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview#HTTP_is_stateless_but_not_sessionless" target="_blank" rel="noopener">khÃ´ng tráº¡ng thÃ¡i</a> (stateless).</p><p>Cookies cÃ³ 3 trÆ°á»ng há»£p dÃ¹ng chÃ­nh:</p><ul><li><strong>Quáº£n lÃ½ session</strong>: login, giá» hÃ ng online, lÆ°u Ä‘iá»ƒm game hay báº¥t cá»© thá»© gÃ¬ server cáº§n nhá»›.</li><li><strong>CÃ¡ nhÃ¢n hÃ³a (Personalization)</strong>: cÃ¡c thiáº¿t Ä‘áº·t cá»§a ngÆ°á»i dÃ¹ng, chá»§ Ä‘á»ƒ vÃ  nhá»¯ng cÃ i Ä‘áº·t khÃ¡c.</li><li><strong>Theo dÃµi</strong>: ghi láº¡i vÃ  phÃ¢n tÃ­ch hÃ nh vi cá»§a ngÆ°á»i dÃ¹ng.</li></ul><p>Cookies Ä‘Ã£ tá»«ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ tá»•ng quÃ¡t á»Ÿ phÃ­a client. NhÆ° váº­y váº«n há»£p phÃ¡p vÃ¬ lÃºc Ä‘Ã³ nÃ³ lÃ  giáº£i phÃ¡p duy nháº¥t Ä‘á»ƒ lÆ°u trá»¯ thÃ´ng tin á»Ÿ phÃ­a client, ngÃ y nay thÃ¬ ngÆ°á»i ta thÆ°á»ng chá»n cÃ¡c API lÆ°u trá»¯ hiá»‡n Ä‘áº¡i hÆ¡n. Cookies Ä‘Æ°á»£c gá»­i vá» vá»›i má»—i request nÃªn cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng xáº¥u Ä‘áº¿n hiá»‡u nÄƒng (Ä‘áº·c biá»‡t vá»›i cÃ¡c káº¿t ná»‘i trÃªn thiáº¿t bá»‹ di Ä‘á»™ng).</p><p>CÃ³ 2 loáº¡i cookies:</p><ul><li><strong>Cookie phiÃªn (session cookies</strong>: ChÃºng bá»‹ xÃ³a khi client táº¯t. TrÃ¬nh duyá»‡t web cÃ³ thá»ƒ dÃ¹ng <strong>khÃ´i phá»¥c session</strong> Ä‘á»ƒ láº¥y láº¡i gáº§n háº¿t session cookies, giá»‘ng nhÆ° lÃ  trÃ¬nh duyá»‡t chÆ°a bao giá» bá»‹ táº¯t váº­y.</li><li><strong>Cookie dÃ i háº¡n (permanent cookie)</strong>: thay vÃ¬ háº¿t háº¡n khi ngÆ°á»i dÃ¹ng táº¯t trÃ¬nh duyá»‡t, <em>permanent cookie</em> háº¿t háº¡n táº¡i 1 ngÃ y nháº¥t Ä‘á»‹nh (Expires) hoáº·c lÃ  sau 1 khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh (Max-Age).</li></ul><p>LÆ°u Ã½ ráº±ng cÃ¡c thÃ´ng tin bÃ­ máº­t vÃ  nháº¡y cáº£m khÃ´ng nÃªn lÆ°u hoáº·c váº­n chuyá»ƒn vá»›i HTTP Cookies bá»Ÿi vÃ¬ rÃµ rÃ ng toÃ n bá»™ cÆ¡ cháº¿ nÃ y vá»‘n khÃ´ng an toÃ n.</p><p>VÃ  rÃµ rÃ ng lÃ  cookies hoáº¡t Ä‘á»™ng tá»‘t vá»›i táº¥t cáº£ cÃ¡c trÃ¬nh duyá»‡t.</p><h1 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h1><p><img src="https://cdn-images-1.medium.com/max/1000/0*XZ2U-ztABhWJOSky" alt=""></p><p>Interface <strong>Cache</strong> cung cáº¥p cÆ¡ cháº¿ lÆ°u trá»¯ cho cáº·p object <a href="http://fetch.spec.whatwg.org/#request" target="_blank" rel="noopener">Request</a>/<a href="http://fetch.spec.whatwg.org/#response" target="_blank" rel="noopener">Response</a> Ä‘Æ°á»£c lÆ°u Ä‘á»‡m. LÆ°u Ã½ ráº±ng interface Cache Ä‘Æ°á»£c dÃ¹ng trong pháº¡m vi window giá»‘ng nhÆ° workers. Báº¡n khÃ´ng pháº£i dÃ¹ng nÃ³ cÃ¹ng vá»›i service worker máº·c dÃ¹ nÃ³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong thÃ´ng tin cá»§a service worker.</p><p>Má»™t origin cÃ³ thá»ƒ cÃ³ nhiá»u object Cache (cÃ³ tÃªn cá»¥ thá»ƒ). Báº¡n cÃ³ trÃ¡ch nhiá»‡m triá»ƒn khai code (vÃ­ dá»¥ nhÆ° trong <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker" target="_blank" rel="noopener">ServiceWorker</a>) Ä‘á»ƒ xá»­ lÃ½ cáº­p nháº­t cho Cache. CÃ¡c item trong Cache khÃ´ng Ä‘Æ°á»£c cáº­p nháº­t trá»« khi Ä‘Æ°á»£c yÃªu cáº§u tÆ°á»ng minh; chÃºng khÃ´ng háº¿t háº¡n trá»« khi bá»‹ xÃ³a. DÃ¹ng hÃ m <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/open" target="_blank" rel="noopener">CacheStorage.open()</a> Ä‘á»ƒ má»Ÿ 1 object Cache vá»›i tÃªn cá»¥ thá»ƒ vÃ  gá»i báº¥t ká»³ phÆ°Æ¡ng thá»©c Cache nÃ o Ä‘á»ƒ báº£o trÃ¬ Cache.</p><p>Báº¡n cÅ©ng cÃ³ trÃ¡ch nhiá»‡m dá»n dáº¹p Ä‘á»‹nh ká»³ cÃ¡c cache entry. Má»—i trÃ¬nh duyá»‡t cÃ³ 1 giá»›i háº¡n cá»©ng vá»›i sá»‘ lÆ°á»£ng cache lÆ°u trá»¯ cáº¥p cho 1 origin. Háº¡n má»©c sá»­ dá»¥ng Cache Æ°á»›c tÃ­nh tá»“n táº¡i trong API <a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageEstimate" target="_blank" rel="noopener">StorageEstimate</a>. TrÃ¬nh duyá»‡t lÃ m cÃ´ng viá»‡c tá»‘t nháº¥t cá»§a nÃ³ Ä‘á»ƒ quáº£n lÃ½ dung lÆ°á»£ng Ä‘Ä©a nhá»› nhÆ°ng nÃ³ cÃ³ thá»ƒ xÃ³a lÆ°u trá»¯ Cache cá»§a 1 origin. Äáº¡i khÃ¡i lÃ  trÃ¬nh duyá»‡t hoáº·c sáº½ xÃ³a táº¥t cáº£ dá»¯ liá»‡u cá»§a 1 origin hoáº·c khÃ´ng lÃ m gÃ¬ cáº£. Äáº£m báº£o Ä‘Ã¡nh phiÃªn báº£n cá»§a cache báº±ng tÃªn vÃ  chá»‰ dÃ¹ng phiÃªn báº£n cache nÃ o mÃ  code cá»§a báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng an toÃ n. Báº¡n cÃ³ thá»ƒ xem thÃªm bÃ i <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API/Using_Service_Workers#Deleting_old_caches" target="_blank" rel="noopener">XÃ³a cache cÅ©</a> Ä‘á»ƒ hiá»ƒu thÃªm.</p><p>Interface <strong>CacheStorage</strong> thá»ƒ hiá»‡n sá»± lÆ°u trá»¯ cho cÃ¡c object <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" target="_blank" rel="noopener">Cache</a></p><p>Interface:</p><ul><li>Cung cáº¥p thÆ° má»¥c master cá»§a táº¥t cáº£ cÃ¡c cache cÃ³ tÃªn mÃ  cÃ³ thá»ƒ truy xuáº¥t bá»Ÿi <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker" target="_blank" rel="noopener">ServiceWorker</a> hoáº·c cÃ¡c loáº¡i worker khÃ¡c hoáº·c pháº¡m vi <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window" target="_blank" rel="noopener">window</a> (báº¡n khÃ´ng bá»‹ giá»›i háº¡n chá»‰ sá»­ dá»¥ng vá»›i service worker ká»ƒ cáº£ thÃ´ng tin cá»§a <a href="https://w3c.github.io/ServiceWorker/" target="_blank" rel="noopener">Service Worker</a> cÃ³ Ä‘á»‹nh nghÄ©a nhÆ° váº­y).</li><li>Duy trÃ¬ kháº£ nÄƒng Ã¡nh xáº¡ (mapping) tÃªn tÆ°Æ¡ng á»©ng vá»›i object <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" target="_blank" rel="noopener">Cache</a></li></ul><p>DÃ¹ng phÆ°Æ¡ng thá»©c <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/open" target="_blank" rel="noopener">CacheStorage.open()</a> Ä‘á»ƒ láº¥y 1 instance cá»§a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" target="_blank" rel="noopener">Cache</a></p><p>DÃ¹ng phÆ°Æ¡ng thá»©c <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/match" target="_blank" rel="noopener">CacheStorage.match()</a> Ä‘á»ƒ kiá»ƒm tra náº¿u 1 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request" target="_blank" rel="noopener">Request</a> cÃ³ pháº£i lÃ  1 key trong báº¥t ká»³ object <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" target="_blank" rel="noopener">Cache</a> nÃ o mÃ  object CacheStorage theo dÃµi.</p><p>Báº¡n cÃ³ thá»ƒ truy cáº­p CacheStorage thÃ´ng qua thuá»™c tÃ­nh toÃ n cá»¥c <a href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/caches" target="_blank" rel="noopener">caches</a></p><h1 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h1><p><img src="https://cdn-images-1.medium.com/max/1000/0*HP66Xm7oe9u8Ofk1" alt=""></p><p>IndexedDB lÃ  1 cÃ¡ch Ä‘á»ƒ báº¡n lÆ°u trá»¯ dá»¯ liá»‡u má»™t cÃ¡ch bá»n vá»¯ng bÃªn trong trÃ¬nh duyá»‡t cá»§a ngÆ°á»i dÃ¹ng. Bá»Ÿi vÃ¬ nÃ³ cho phÃ©p báº¡n táº¡o cÃ¡c webapp vá»›i kháº£ nÄƒng viáº¿t cÃ¢u truy váº¥n Ä‘a dáº¡ng báº¥t ká»ƒ tÃ¬nh tráº¡ng máº¡ng. Nhá»¯ng á»©ng dá»¥ng nÃ y cÃ³ thá»ƒ lÃ m viá»‡c online &amp; offline. IndexedDB cÃ³ Ã­ch cho cÃ¡c á»©ng dá»¥ng cáº§n lÆ°u trá»¯ 1 lÆ°á»£ng lá»›n dá»¯ liá»‡u (vÃ­ dá»¥: danh sÃ¡ch cÃ¡c DVD cho mÆ°á»£n trong thÆ° viá»‡n) vÃ  cÃ¡c á»©ng dá»¥ng khÃ´ng cáº§n sá»± káº¿t ná»‘i internet á»•n Ä‘á»‹nh Ä‘á»ƒ hoáº¡t Ä‘á»™ng (vÃ­ dá»¥: á»©ng dá»¥ng mail, danh sÃ¡ch to-do, notepad).</p><p>Trong bÃ i nÃ y, nÃ³ lÃ  cÆ¡ sá»Ÿ dá»¯ liá»‡u lÆ°u trá»¯ mÃ  chÃºng ta sáº½ tháº£o luáº­n chi tiáº¿t hÆ¡n 1 chÃºt bá»Ÿi vÃ¬ cÃ¡c API lÆ°u trá»¯ khÃ¡c Ä‘á»u Ä‘Æ°á»£c hiá»ƒu biáº¿t khÃ¡ rá»™ng. ThÃªm ná»¯a, IndexedDB cÃ ng ngÃ y cÃ ng phá»• biáº¿n vá»›i cÃ¡c webapp phá»©c táº¡p ngÃ y cÃ ng gia tÄƒng.</p><h2 id="Ben-trong-IndexedDB"><a href="#Ben-trong-IndexedDB" class="headerlink" title="BÃªn trong IndexedDB"></a>BÃªn trong IndexedDB</h2><p>IndexedDB cho phÃ©p báº¡n lÆ°u trá»¯ vÃ  láº¥y cÃ¡c object Ä‘Æ°á»£c lÆ°u báº±ng cÃ¡ch dÃ¹ng key. Táº¥t cáº£ thay Ä‘á»•i báº¡n thá»±c hiá»‡n vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘á»u xáº£y ra trong pháº¡m vi transaction. Giá»‘ng nhÆ° nhiá»u giáº£i phÃ¡p lÆ°u trá»¯ web khÃ¡c, IndexedDB bÃ¡m sÃ¡t nguyÃªn táº¯c cÃ¹ng origin (<a href="http://www.w3.org/Security/wiki/Same_Origin_Policy" target="_blank" rel="noopener">same-origin policy</a>). VÃ¬ tháº¿ báº¡n cÃ³ thá»ƒ truy cáº­p dá»¯ liá»‡u lÆ°u trá»¯ trong pháº¡m vi 1 domain nhÆ°ng khÃ´ng thá»ƒ truy cáº­p dá»¯ liá»‡u cá»§a cÃ¡c domain khÃ¡c.</p><p>IndexedDB lÃ  API báº¥t Ä‘á»“ng bá»™ (<a href="https://developer.mozilla.org/en/IndexedDB#Asynchronous_API" target="_blank" rel="noopener">asynchronous</a>) cÃ³ thá»ƒ sá»­ dá»¥ng trong háº§u háº¿t cÃ¡c ngá»¯ cáº£nh, bao gá»“m cáº£ <a href="https://developer.mozilla.org/En/DOM/Using_web_workers" target="_blank" rel="noopener">WebWorkers</a>. NÃ³ thÆ°á»ng bao gá»“m cáº£ 1 phiÃªn báº£n Ä‘á»“ng bá»™ (<a href="https://developer.mozilla.org/en/IndexedDB#Synchronous_API" target="_blank" rel="noopener">synchronous</a>) ná»¯a Ä‘á»ƒ dÃ¹ng trong web worker nhÆ°ng Ä‘Ã£ bá»‹ xÃ³a bá» bá»Ÿi vÃ¬ cá»™ng Ä‘á»“ng web khÃ´ng cÃ³ há»©ng thÃº vá»›i nÃ³.</p><p>IndexedDB thÆ°á»ng cáº¡nh tranh vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u WebSQL nhÆ°ng nÃ³ Ä‘Ã£ bá»‹ há»§y bá»Ÿi W3C. Trong khi cáº£ 2 IndexedDB vÃ  WebSQL lÃ  cÃ¡c giáº£i phÃ¡p lÆ°u trá»¯, chÃºng láº¡i khÃ´ng cung cáº¥p cÃ¹ng tÃ­nh nÄƒng. CSDL WebSQL lÃ  1 há»‡ truy cáº­p CSDL quan há»‡ trong khi IndexedDB lÃ  há»‡ báº£ng Ä‘Ã¡nh sá»‘ (indexed table).</p><p>Äá»«ng báº¯t Ä‘áº§u vá»›i IndexedDB náº¿u nhÆ° báº¡n chá»‰ nghe nÃ³i hoáº·c giáº£ Ä‘á»‹nh ráº±ng nÃ³ tá»‘t hÆ¡n cÃ¡c loáº¡i CSDL khÃ¡c. Thay vÃ¬ tháº¿ hÃ£y Ä‘á»c tháº­t ká»¹ tÃ i liá»‡u cá»§a nÃ³. DÆ°á»›i Ä‘Ã¢y lÃ  1 vÃ i Ã½ tÆ°á»Ÿng cáº§n thiáº¿t mÃ  báº¡n cáº§n pháº£i biáº¿t:</p><ul><li><strong>CSDL IndexedDB lÆ°u theo cáº·p key-value</strong>: giÃ¡ trá»‹ cÃ³ thá»ƒ lÃ  object cáº¥u trÃºc phá»©c táº¡p vÃ  key cÃ³ thá»ƒ lÃ  thuá»™c tÃ­nh cá»§a nhá»¯ng object Ä‘Ã³. Báº¡n cÃ³ thá»ƒ táº¡o index dÃ¹ng báº¥t ká»³ thuá»™c tÃ­nh nÃ o cá»§a object Ä‘á»ƒ dá»… tÃ¬m kiáº¿m cÅ©ng nhÆ° khi cáº§n sáº¯p xáº¿p. Key cÅ©ng cÃ³ thá»ƒ lÃ  object nhá»‹ phÃ¢n.</li><li><strong>API IndexedDB Ä‘a pháº§n lÃ  báº¥t Ä‘á»“ng bá»™</strong>: API khÃ´ng Ä‘Æ°a dá»¯ liá»‡u cho báº¡n báº±ng cÃ¡ch tráº£ vá» giÃ¡ trá»‹. Thay vÃ¬ tháº¿ nÃ³ truyá»n vÃ o 1 hÃ m callback. Báº¡n khÃ´ng â€œlÆ°uâ€ 1 giÃ¡ trá»‹ vÃ o trong CSDL hoáº·c â€œláº¥yâ€ nÃ³ ra theo nghÄ©a Ä‘á»“ng bá»™. Thay vÃ o Ä‘Ã³, báº¡n â€œyÃªu cáº§uâ€ (request) má»™t hÃ nh Ä‘á»™ng trÃªn CSDL. Má»™t sá»± kiá»‡n thÃ´ng bÃ¡o cho báº¡n khi hÃ nh Ä‘á»™ng hoÃ n thÃ nh vÃ  kiá»ƒu sá»± kiá»‡n báº¡n nháº­n Ä‘Æ°á»£c náº¿u nhÆ° cÃ³ hÃ nh Ä‘á»™ng thÃ nh cÃ´ng hay tháº¥t báº¡i. KhÃ´ng khÃ¡c máº¥y so vá»›i cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a <a href="https://developer.mozilla.org/en/DOM/XMLHttpRequest" target="_blank" rel="noopener">XMLHttpRequest</a> (hoáº·c lÃ  cáº£ tÃ¡ thá»© khÃ¡c vá» Javascript)</li><li><strong>IndexedDB dÃ¹ng ráº¥t nhiá»u request</strong>: request lÃ  object nháº­n cÃ¡c sá»± kiá»‡n thÃ nh cÃ´ng hay tháº¥t báº¡i nhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn. ChÃºng cÃ³ thuá»™c tÃ­nh onsuccess vÃ  onerror cÅ©ng nhÆ° readyState, result vÃ  errorCode sáº½ cho báº¡n biáº¿t vá» tráº¡ng thÃ¡i cá»§a request.</li><li><strong>IndexedDB hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng</strong>: IndexedDB khÃ´ng pháº£i CSDL quan há»‡ vá»›i cÃ¡c báº£ng thá»ƒ hiá»‡n táº­p há»£p hÃ ng &amp; cá»™t. Äiá»ƒm khÃ¡c biá»‡t cÆ¡ báº£n nÃ y áº£nh hÆ°á»Ÿng Ä‘áº¿n giai Ä‘oáº¡n thiáº¿t káº¿ vÃ  xÃ¢y dá»±ng á»©ng dá»¥ng cá»§a báº¡n.</li><li><strong>IndexedDB khÃ´ng dÃ¹ng ngÃ´n ngá»¯ truy váº¥n cáº¥u trÃºc (SQL)</strong>: nÃ³ dÃ¹ng kiá»ƒu truy váº¥n trÃªn index Ä‘á»ƒ táº¡o ra con trá», chÃ­nh con trá» nÃ y dÃ¹ng Ä‘á»ƒ láº·p xuyÃªn suá»‘t táº­p káº¿t quáº£. Náº¿u báº¡n khÃ´ng quen vá»›i há»‡ thá»‘ng NoSQL thÃ¬ cÃ³ thá»ƒ xem thÃªm <a href="https://en.wikipedia.org/wiki/NoSQL" target="_blank" rel="noopener">bÃ i nÃ y trÃªn Wikipedia</a></li><li><strong>IndexedDBâ€ŠdÃ¹ng nguyÃªn táº¯c cÃ¹ng origin</strong>: má»™t origin lÃ  domain, giao thá»©c táº§ng á»©ng dá»¥ng vÃ  cá»•ng (port) cá»§a URL cá»§a vÄƒn báº£n lÃ  nÆ¡i mÃ  code Ä‘Æ°á»£c thá»±c thi. Má»—i origin cÃ³ 1 táº­p cÃ¡c CSDL riÃªng cá»§a nÃ³. Má»—i CSDL cÃ³ 1 cÃ¡i tÃªn Ä‘á»‹nh danh nÃ³ trong origin.</li></ul><h2 id="Gioi-han-cua-IndexedDB"><a href="#Gioi-han-cua-IndexedDB" class="headerlink" title="Giá»›i háº¡n cá»§a IndexedDB"></a>Giá»›i háº¡n cá»§a IndexedDB</h2><p>IndexedDB Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ dÃ¹ng vá»›i háº§u háº¿t cÃ¡c tÃ¬nh huá»‘ng cáº§n lÆ°u trá»¯ á»Ÿ phÃ­a client. NÃ³ khÃ´ng Ä‘Æ°á»£c thiáº¿t káº¿ cho 1 vÃ i trÆ°á»ng há»£p dÆ°á»›i Ä‘Ã¢y:</p><ul><li><strong>Sáº¯p xáº¿p toÃ n cáº§u (Internationalized sorting)</strong>: khÃ´ng pháº£i táº¥t cáº£ ngÃ´n ngá»¯ Ä‘á»u sáº¯p xáº¿p array theo cÃ¹ng 1 cÃ¡ch, vÃ¬ tháº¿ mÃ  Internationalized sorting khÃ´ng Ä‘Æ°á»£c há»— trá»£. CSDL khÃ´ng thá»ƒ lÆ°u dá»¯ liá»‡u theo 1 thá»© tá»± toÃ n cáº§u cá»¥ thá»ƒ, báº¡n cÃ³ thá»ƒ tá»± tay sáº¯p xáº¿p dá»¯ liá»‡u Ä‘á»c tá»« CSDL ra.</li><li><strong>Äá»“ng bá»™ hÃ³a</strong>: API khÃ´ng Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ thá»±c hiá»‡n Ä‘á»“ng bá»™ hÃ³a vá»›i CSDL á»Ÿ phÃ­a server. Báº¡n pháº£i viáº¿t code riÃªng Ä‘á»ƒ Ä‘á»“ng bá»™ CSDL IndexedDB á»Ÿ client vá»›i CSDL á»Ÿ server.</li><li><strong>TÃ¬m kiáº¿m toÃ n vÄƒn báº£n (Full text searchingâ€Š)</strong>: API khÃ´ng cung cáº¥p giáº£i phÃ¡p tÆ°Æ¡ng tá»± nhÆ° LIKE trong SQL.</li></ul><p>ThÃªm vÃ o Ä‘Ã³, hÃ£y cáº©n tháº­n trÃ¬nh duyá»‡t cÃ³ thá»ƒ xÃ³a CSDL trong nhá»¯ng trÆ°á»ng há»£p sau Ä‘Ã¢y:</p><ul><li><strong>User yÃªu cáº§u xÃ³a</strong>: nhiá»u trÃ¬nh duyá»‡t cÃ³ cÃ i Ä‘áº·t cho phÃ©p user xÃ³a táº¥t cáº£ dá»¯ liá»‡u lÆ°u trá»¯ cho 1 website, bao gá»“m cáº£ cookies, bookmarks, máº­t kháº©u Ä‘Æ°á»£c lÆ°u vÃ  dá»¯ liá»‡u IndexedDB.</li><li><strong>TrÃ¬nh duyá»‡t Ä‘ang cháº¡y cháº¿ Ä‘á»™ riÃªng tÆ°</strong>: má»™t vÃ i trÃ¬nh duyá»‡t cÃ³ cháº¿ Ä‘á»™ riÃªng tÆ° nhÆ° private browsing (Firefox) hay incognito (Chrome). Táº¡i cuá»‘i session, trÃ¬nh duyá»‡t sáº½ xÃ³a toÃ n bá»™ CSDL.</li><li><strong>á»” cá»©ng hoáº·c giá»›i háº¡n cho phÃ©p bá»‹ Ä‘áº§y</strong></li><li><strong>Dá»¯ liá»‡u bá»‹ há»ng</strong></li></ul><p>CÃ¡c trÆ°á»ng há»£p chÃ­nh xÃ¡c vÃ  kháº£ nÄƒng cá»§a trÃ¬nh duyá»‡t thay Ä‘á»•i theo thá»i gian, nhÆ°ng nguyÃªn lÃ½ chung cá»§a cÃ¡c nhÃ  phÃ¡t triá»ƒn trÃ¬nh duyá»‡t lÃ  táº¡o ra ná»— lá»±c tá»‘t nháº¥t Ä‘á»ƒ lÆ°u giá»¯ dá»¯ liá»‡u khi cÃ³ thá»ƒ.</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*kGDQYE70_z58D7na" alt=""></p><h1 id="Lua-chon-API-luu-tru"><a href="#Lua-chon-API-luu-tru" class="headerlink" title="Lá»±a chá»n API lÆ°u trá»¯"></a>Lá»±a chá»n API lÆ°u trá»¯</h1><p>NhÆ° Ä‘Ã£ Ä‘á» cáº­p á»Ÿ trÃªn, sáº½ tá»‘t hÆ¡n náº¿u chá»n cÃ¡c API Ä‘Æ°á»£c há»— trá»£ rá»™ng rÃ£i trong nhiá»u trÃ¬nh duyá»‡t vÃ  cung cáº¥p mÃ´ hÃ¬nh gá»i báº¥t Ä‘á»“ng bá»™ nháº±m nÃ¢ng tá»‘i Ä‘a kháº£ nÄƒng pháº£n há»“i cá»§a UI. NhÆ° 1 cÃ¡ch tá»± nhiÃªn, ngá»¯ cáº£nh nhÆ° tháº¿ nÃ y sáº½ dáº«n Ä‘áº¿n cÃ¡c lá»±a chá»n cÃ´ng nghá»‡:</p><ul><li>Vá»›i lÆ°u trá»¯ offline, dÃ¹ng <a href="https://developers.google.com/web/fundamentals/instant-and-offline/web-storage/cache-api" target="_blank" rel="noopener">Cache API</a>. API nÃ y tá»“n táº¡i trong cÃ¡c trÃ¬nh duyá»‡t há»— trá»£ cÃ´ng nghá»‡ <a href="https://jakearchibald.github.io/isserviceworkerready/" target="_blank" rel="noopener">Service Worker</a>, cáº§n thiáº¿t Ä‘á»ƒ xÃ¢y dá»±ng app offline.</li><li>Äá»ƒ lÆ°u trá»¯ tráº¡ng thÃ¡i cá»§a á»©ng dá»¥ng vÃ  cÃ¡c dá»¯ liá»‡u do ngÆ°á»i dÃ¹ng táº¡o ra, sá»­ dá»¥ng IndexedDB. NÃ³ cho phÃ©p user lÃ m viá»‡c offline trÃªn nhiá»u trÃ¬nh duyá»‡t hÆ¡n so vá»›i nhá»¯ng trÃ¬nh duyá»‡t chá»‰ há»— trá»£ Cache API.</li></ul><p><a href="https://www.sessionstack.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_content=classes-inheritance-transpiling-outro" target="_blank" rel="noopener">SessionStack</a> sá»­ dá»¥ng cÃ¡c API lÆ°u trá»¯ khÃ¡c nhau. VÃ­ dá»¥, thÆ° viá»‡n tÃ­ch há»£p vÃ o trong webapp cá»§a khÃ¡ch hÃ ng dÃ¹ng cáº£ cookies &amp; session storage. LÃ½ do lÃ  thÆ° viá»‡n Ä‘Ã³ cáº§n thu tháº­p cÃ¡c dá»¯ liá»‡u cháº³ng háº¡n nhÆ° cÃ¡c sá»± kiá»‡n, thay Ä‘á»•i trÃªn DOM, dá»¯ liá»‡u máº¡ng, biá»‡t lá»‡, thÃ´ng tin debug, vÃ¢n vÃ¢n, rá»“i sau Ä‘Ã³ gá»­i vá» server. Há» thu tháº­p dá»¯ liá»‡u nhÆ° váº­y tá»« session cá»§a ngÆ°á»i dÃ¹ng nhÆ°ng há» cáº§n 1 cÃ¡ch chÃ­nh xÃ¡c Ä‘á»ƒ xÃ¡c Ä‘á»‹nh khi nÃ o session cá»§a user báº¯t Ä‘áº§u vÃ  káº¿t thÃºc.</p><p>Há» cÃ¢n nháº¯c 1 session sáº½ lÃ  toÃ n bá»™ chu ká»³ sá»­ dá»¥ng webapp tá»« lÃºc báº¯t Ä‘áº§u, bao gá»“m cáº£ xem trang vÃ  Ä‘iá»u hÆ°á»›ng cho Ä‘áº¿n khi user Ä‘Ã³ng trÃ¬nh duyá»‡t hay tab vÃ  khÃ´ng quay trá»Ÿ láº¡i trong vÃ i phÃºt, pháº§n nÃ y há» dÃ¹ng 1 sá»± káº¿t há»£p cá»§a session storage &amp; logic á»Ÿ phÃ­a server. CÃ²n gÃ¬ ná»¯a nÃ o, há» cho phÃ©p báº¡n xÃ¡c Ä‘á»‹nh tá»«ng ngÆ°á»i dÃ¹ng cuá»‘i Ä‘á»ƒ cÃ³ thá»ƒ cung cáº¥p cho báº¡n dá»¯ liá»‡u ngÆ°á»i dÃ¹ng trÃªn má»—i session. Há» dá»±a vÃ o cookies Ä‘á»ƒ lÃ m viá»‡c nÃ y (giá»‘ng nhÆ° cÃ¡c cÃ´ng cá»¥ giÃ¡m sÃ¡t/phÃ¢n tÃ­ch).</p><p>Trong á»©ng dá»¥ng cá»§a há», báº¡n cÃ³ thá»ƒ xem (xem theo yÃªu cáº§u hoáº·c thá»i gian thá»±c) nhá»¯ng sá»± kiá»‡n Ä‘Ã£ thu táº­p dÆ°á»›i dáº¡ng video Ä‘Æ°á»£c tÃ¡i táº¡o láº¡i cÃ¡ch mÃ  user gáº·p pháº£i cÃ¡c váº¥n Ä‘á»u, há» sá»­ dá»¥ng chá»§ yáº¿u lÃ  cookies bá»Ÿi vÃ¬ serivce RESTful cá»§a há» vá» cÆ¡ báº£n thÃ¬ cáº§n authentication token Ä‘á»ƒ authenticate, authorize vÃ  xÃ¡c nháº­n request.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 16 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;h1 id=&quot;Khai-quat&quot;&gt;&lt;a href=&quot;#Khai-quat&quot; class=&quot;headerlink&quot; title=&quot;KhÃ¡i quÃ¡t&quot;&gt;&lt;/a&gt;KhÃ¡i quÃ¡t&lt;/h1&gt;&lt;p&gt;Lá»±a chá»n cÆ¡ cháº¿ lÆ°u trá»¯ Ä‘Ãºng Ä‘áº¯n cho thiáº¿t bá»‹ lÆ°u trá»¯ á»Ÿ local ráº¥t quan trá»ng khi thiáº¿t káº¿ webapp. Má»™t engine lÆ°u trá»¯ tá»‘t sáº½ Ä‘áº£m báº£o thÃ´ng tin cá»§a báº¡n Ä‘Æ°á»£c lÆ°u cháº¯c cháº¯n, giáº£m bÄƒng thÃ´ng vÃ  cáº£i thiá»‡n sá»± pháº£n há»“i. Chiáº¿n lÆ°á»£c lÆ°u trá»¯ bá»™ nhá»› Ä‘á»‡m phÃ¹ há»£p lÃ  thÃ nh pháº§n cá»‘t lÃµi cho phÃ©p tráº£i nghiá»‡m mobile web offline, cÃ ng ngÃ y cÃ ng cÃ³ nhiá»u ngÆ°á»i dÃ¹ng cáº£m tháº¥y ráº±ng nhÆ° Ä‘Ã³ lÃ  tráº£i nghiá»‡m máº·c Ä‘á»‹nh pháº£i cÃ³.&lt;/p&gt;
&lt;p&gt;Trong chÆ°Æ¡ng nÃ y, chÃºng ta sáº½ tháº£o luáº­n vá» nhá»¯ng API lÆ°u trá»¯ cÃ³ sáºµn &amp;amp; cÃ¡c service vÃ  cung cáº¥p má»™t sá»‘ hÆ°á»›ng dáº«n lÃ m tháº¿ nÃ o Ä‘á»ƒ lá»±a chá»n Ä‘Ãºng loáº¡i cho webapp cá»§a báº¡n.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P15: BÃªn trong Class &amp; Inheritance + Transpiling vá»›i Babel &amp; Typescript</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P15-Ben-trong-Class-Inheritance-Transpiling-voi-Babel-Typescript.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P15-Ben-trong-Class-Inheritance-Transpiling-voi-Babel-Typescript.html</id>
    <published>2018-11-25T09:37:00.000Z</published>
    <updated>2018-11-25T09:40:14.437Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 15 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p>NgÃ y nay, cÃ¡ch phá»• biáº¿n nháº¥t Ä‘á»ƒ dá»±ng cáº¥u trÃºc cá»§a báº¥t ká»³ dá»± Ã¡n pháº§n má»m nÃ o lÃ  sá»­ dá»¥ng class. Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ cÃ¹ng khÃ¡m phÃ¡ cÃ¡c cÃ¡ch khÃ¡c nhau Ä‘á»ƒ triá»ƒn khai class trong Javascript vÃ  lÃ m tháº¿ nÃ o ta cÃ³ thá»ƒ xÃ¢y dá»±ng cÃ¢y thá»© báº­c cá»§a class (class hierarchy). ChÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng cÃ¡ch Ä‘Ã o sÃ¢u tÃ¬m hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a prototype vÃ  phÃ¢n tÃ­ch nhá»¯ng cÃ¡ch Ä‘á»ƒ giáº£ láº­p káº¿ thá»«a class trong cÃ¡c thÆ° viá»‡n ná»•i tiáº¿ng. Tiáº¿p Ä‘áº¿n ta sáº½ xem lÃ m cÃ¡ch nÃ o mÃ  transpiling cÃ³ thá»ƒ thÃªm nhá»¯ng tÃ­nh nÄƒng khÃ´ng Ä‘Æ°á»£c há»— trá»£ chÃ­nh thá»©c cho ngÃ´n ngá»¯ vÃ  cÃ¡ch mÃ  nÃ³ Ä‘Æ°á»£c dÃ¹ng trong Babel &amp; Typescript Ä‘á»ƒ giá»›i thiá»‡u vá» sá»± há»— trá»£ cá»§a class trong ECMAScript 2015. Cuá»‘i cÃ¹ng, ta sáº½ káº¿t thÃºc vá»›i má»™t vÃ i vÃ­ dá»¥ vá» class Ä‘Æ°á»£c triá»ƒn khai native trong V8.<br><a id="more"></a></p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>Trong Javascript, vá» báº£n cháº¥t khÃ´ng cÃ³ kiá»ƒu dá»¯ liá»‡u nguyÃªn thá»§y vÃ  má»i thá»© táº¡o ra Ä‘á»u lÃ  object. VÃ­ dá»¥, náº¿u ta táº¡o 1 string:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">"SessionStack"</span>;</span><br></pre></td></tr></table></figure><p>ThÃ¬ chÃºng ta cÃ³ thá»ƒ gá»i nhiá»u phÆ°Æ¡ng thá»©c khÃ¡c nhau trÃªn object vá»«a má»›i Ä‘Æ°á»£c táº¡o ra:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a.repeat(<span class="number">2</span>)); <span class="comment">// SessionStackSessionStack</span></span><br><span class="line"><span class="built_in">console</span>.log(a.toLowerCase()); <span class="comment">// sessionstack</span></span><br></pre></td></tr></table></figure><p>KhÃ´ng giá»‘ng nhÆ° cÃ¡c ngÃ´n ngá»¯ khÃ¡c, trong Javascript, khai bÃ¡o string hay number sáº½ tá»± Ä‘á»™ng táº¡o ra má»™t object mÃ  nÃ³ sáº½ Ä‘Ã³ng gÃ³i giÃ¡ trá»‹ Ä‘Ã³ vÃ  cung cáº¥p nhiá»u phÆ°Æ¡ng thá»©c khÃ¡c nhau cÃ³ thá»ƒ thá»±c thi Ä‘Æ°á»£c ká»ƒ cáº£ vá»›i cÃ¡c kiá»ƒu dá»¯ liá»‡u nguyÃªn thá»§y.</p><p>Má»™t sá»± tháº­t thÃº vá»‹ khÃ¡c lÃ  nhá»¯ng kiá»ƒu dá»¯ liá»‡u phá»©c táº¡p, cháº³ng háº¡n nhÆ° array, cÅ©ng lÃ  object. Náº¿u báº¡n nhÃ¬n ká»¹ hÆ¡n vÃ o typeof cá»§a má»™t array, báº¡n sáº½ tháº¥y nÃ³ lÃ  object. Sá»‘ index cá»§a má»—i pháº§n tá»­ trong danh sÃ¡ch chÃ­nh lÃ  thuá»™c tÃ­nh cá»§a object. VÃ¬ tháº¿ khi báº¡n truy xuáº¥t má»™t pháº§n tá»­ báº±ng sá»‘ index trong array, báº¡n thá»±c ra chá»‰ truy xuáº¥t vÃ o thuá»™c tÃ­nh cá»§a object array vÃ  tráº£ vá» giÃ¡ trá»‹ cá»§a nÃ³. Khi nÃ³i vá» váº¥n Ä‘á» lÆ°u trá»¯ dá»¯ liá»‡u thÃ¬ 2 Ä‘á»‹nh nghÄ©a sau lÃ  giá»‘ng há»‡t nhau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names = [â€œSessionStackâ€];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> names = &#123;</span><br><span class="line">  â€œ<span class="number">0</span>â€: â€œSessionStackâ€,</span><br><span class="line">  â€œlengthâ€: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Káº¿t quáº£ lÃ  thá»i gian cáº§n Ä‘á»ƒ truy xuáº¥t 1 pháº§n tá»­ trong array vÃ  1 thuá»™c tÃ­nh cá»§a object lÃ  nhÆ° nhau. Tháº­t khÃ³ Ä‘á»ƒ nháº­n ra. TrÆ°á»›c Ä‘Ã¢y, trong 1 project, tÃ¡c giáº£ pháº£i thá»±c hiá»‡n quÃ¡ trÃ¬nh tá»‘i Æ°u hÃ³a ráº¥t lá»›n cho má»™t Ä‘oáº¡n code quan trá»ng. Sau khi thá»­ táº¥t cáº£ cÃ¡c lá»±a chá»n dá»…, tÃ¡c giáº£ Ä‘Ã£ thay tháº¿ toÃ n bá»™ object Ä‘Æ°á»£c dÃ¹ng trong project báº±ng array. Vá» lÃ½ thuyáº¿t, truy xuáº¥t 1 pháº§n tá»­ trong 1 array thÃ¬ nhanh hÆ¡n truy xuáº¥t 1 key trong hash map (báº£n Ä‘á»“ bÄƒm). TÃ¡c giáº£ Ä‘Ã£ ngáº¡c nhiÃªn ráº±ng cÃ¡ch lÃ m nÃ y khÃ´ng mang láº¡i má»™t chÃºt hiá»‡u quáº£ hÆ¡n vá»›i hiá»‡u nÄƒng. Trong Javascript, cáº£ array vÃ  object Ä‘á»u Ä‘Æ°á»£c triá»ƒn khai vá» viá»‡c truy xuáº¥t 1 key trong hash map vÃ  sáº½ tá»‘n cÃ¹ng 1 lÆ°á»£ng thá»i gian nhÆ° nhau.</p><h1 id="Gia-lap-class-voi-prototype"><a href="#Gia-lap-class-voi-prototype" class="headerlink" title="Giáº£ láº­p class vá»›i prototype"></a>Giáº£ láº­p class vá»›i prototype</h1><p>Khi nghÄ© vá» object, thá»© Ä‘áº§u tiÃªn xuáº¥t hiá»‡n chÃ­nh lÃ  class. Táº¥t cáº£ chÃºng ta thÃ´ng thÆ°á»ng Ä‘á»u xÃ¢y dá»±ng cáº¥u trÃºc cá»§a á»©ng dá»¥ng dá»±a trÃªn class vÃ  cÃ¡c má»‘i quan há»‡ giá»¯a chÃºng vá»›i nhau. Máº·c dÃ¹ object trong Javascript xuáº¥t hiá»‡n kháº¯p nÆ¡i, ngÃ´n ngá»¯ nÃ y láº¡i khÃ´ng sá»­ dá»¥ng kiá»ƒu káº¿ thá»«a truyá»n thá»‘ng dá»±a trÃªn class. Thay vÃ o Ä‘Ã³ nÃ³ dÃ¹ng <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Details_of_the_Object_Model" target="_blank" rel="noopener">prototype</a>.<br>[<img src="https://cdn-images-1.medium.com/max/1000/0*SufKRGfPZIDlw1OG" alt=""></p><p>Trong Javascript, má»i object Ä‘Æ°á»£c káº¿t ná»‘i Ä‘áº¿n object khÃ¡c - chÃ­nh lÃ  prototype cá»§a nÃ³. Khi báº¡n thá»­ truy xuáº¥t 1 thuá»™c tÃ­nh hoáº·c phÆ°Æ¡ng thá»©c trÃªn 1 object, quÃ¡ trÃ¬nh tÃ¬m kiáº¿m (thuá»™c tÃ­nh/phÆ°Æ¡ng thá»©c) sáº½ báº¯t Ä‘áº§u vá»›i chÃ­nh object Ä‘Ã³ trÆ°á»›c. Náº¿u khÃ´ng tÃ¬m tháº¥y thÃ¬ nÃ³ sáº½ tiáº¿p tá»¥c vá»›i prototype cá»§a object Ä‘Ã³.</p><p>ChÃºng ta sáº½ thá»­ vá»›i 1 vÃ­ dá»¥ Ä‘Æ¡n giáº£n vá» Ä‘á»‹nh nghÄ©a constructor cho 1 class:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.content = content;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Component.prototype.render = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Ta thÃªm hÃ m render vÃ o prototype bá»Ÿi vÃ¬ chÃºng ta muá»‘n má»—i instance cá»§a Component Ä‘á»u cÃ³ thá»ƒ tÃ¬m tháº¥y nÃ³. Khi báº¡n gá»i phÆ°Æ¡ng thá»©c nÃ y trÃªn má»—i instance cá»§a class Component, quÃ¡ trÃ¬nh tÃ¬m kiáº¿m Ä‘áº§u tiÃªn sáº½ thá»±c hiá»‡n trÃªn chÃ­nh instance Ä‘Ã³. Sau Ä‘Ã³ nÃ³ tiáº¿p tá»¥c thá»±c hiá»‡n tÃ¬m trÃªn prototype vÃ  táº¡i Ä‘Ã¢y thÃ¬ phÆ°Æ¡ng thá»©c render Ä‘Æ°á»£c tÃ¬m tháº¥y.<br><img src="https://cdn-images-1.medium.com/max/1000/0*hZbijxS0vXu8vUmz" alt=""></p><p>Giá» ta thá»­ má»Ÿ rá»™ng class Component ra, ta sáº½ thÃªm vÃ o má»™t class con:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">InputField</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.content = <span class="string">`&lt;input type="text" value="<span class="subst">$&#123;value&#125;</span>" /&gt;`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Náº¿u ta muá»‘n InputField má»Ÿ rá»™ng chá»©c nÄƒng cá»§a class Component vÃ  cÃ³ thá»ƒ gá»i phÆ°Æ¡ng thá»©c render cá»§a nÃ³ thÃ¬ ta cáº§n pháº£i thay Ä‘á»•i prototype. Khi 1 phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c gá»i trÃªn instance cá»§a class con, ta khÃ´ng muá»‘n tÃ¬m kiáº¿m trong prototype trá»‘ng rá»—ng cá»§a nÃ³. QuÃ¡ trÃ¬nh tÃ¬m kiáº¿m sáº½ tiáº¿p tá»¥c á»Ÿ class Component.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InputField.prototype = <span class="built_in">Object</span>.create(<span class="keyword">new</span> Component());</span><br></pre></td></tr></table></figure><p>Báº±ng cÃ¡ch nÃ y, phÆ°Æ¡ng thá»©c render cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m tháº¥y trong prototype cá»§a class Component. Äá»ƒ cÃ³ thá»ƒ káº¿ thá»«a, ta cáº§n káº¿t ná»‘i prototype cá»§a InputField Ä‘áº¿n 1 instance cá»§a class Component. Nhiá»u thÆ° viá»‡n sá»­ dá»¥ng phÆ°Æ¡ng thá»©c <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf" target="_blank" rel="noopener">Object.setPrototypeOf</a> Ä‘á»ƒ lÃ m viá»‡c nÃ y.</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*avLiOV_zXLxOgBee" alt=""></p><p>Tuy nhiÃªn Ä‘Ã¢y khÃ´ng pháº£i lÃ  viá»‡c duy nháº¥t mÃ  ta cáº§n lÃ m. Má»—i khi má»Ÿ rá»™ng 1 class, ta cáº§n chÃº Ã½:</p><ul><li>Äáº·t prototype cá»§a class con lÃ  1 instance cá»§a class cha</li><li>Gá»i constructor cá»§a class cha trong constructor cá»§a class con Ä‘á»ƒ quÃ¡ trÃ¬nh khá»Ÿi táº¡o logic trong constructor cá»§a class cha cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi.</li><li>Giá»›i thiá»‡u cÃ¡ch truy xuáº¥t phÆ°Æ¡ng thá»©c tá»« class cha. Báº¡n cáº§n pháº£i lÃ m tháº¿ khi muá»‘n ghi Ä‘Ã¨ 1 phÆ°Æ¡ng thá»©c vÃ  báº¡n muá»‘n gá»i Ä‘áº¿n pháº§n triá»ƒn khai gá»‘c trong phÆ°Æ¡ng thá»©c á»Ÿ class cha.</li></ul><p>NhÆ° báº¡n tháº¥y thÃ¬ náº¿u muá»‘n sá»­ dá»¥ng táº¥t cáº£ tÃ­nh nÄƒng cá»§a káº¿ thá»«a dá»±a trÃªn class thÃ¬ báº¡n cáº§n thá»±c thi pháº§n logic phá»©c táº¡p nÃ y má»—i láº§n káº¿ thá»«a. Má»—i khi báº¡n cáº§n táº¡o ra nhiá»u class thÃ¬ tá»‘t nháº¥t lÃ  Ä‘Ã³ng gÃ³i má»› logic áº¥y trong 1 (hoáº·c vÃ i) hÃ m Ä‘á»ƒ cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng. ÄÃ¢y lÃ  cÃ¡ch mÃ  cÃ¡c developer trÆ°á»›c Ä‘Ã¢y giáº£i quyáº¿t váº¥n Ä‘á» káº¿ thá»«a dá»±a trÃªn class - báº±ng cÃ¡ch giáº£ láº­p vá»›i nhiá»u thÆ° viá»‡n khÃ¡c nhau. Nhá»¯ng giáº£i phÃ¡p nÃ y trá»Ÿ nÃªn ráº¥t phá»• biáº¿n vÃ  rÃµ rÃ ng lÃ  cÃ³ thiáº¿u sÃ³t trong ngÃ´n ngá»¯ Javascript. ÄÃ³ lÃ  lÃ½ do mÃ  cÃº phÃ¡p má»›i Ä‘á»ƒ táº¡o class vÃ  há»— trá»£ káº¿ thá»«a class Ä‘Æ°á»£c giá»›i thiá»‡u trong báº£n sá»­a Ä‘á»•i lá»›n Ä‘áº§u tiÃªn cá»§a ECMAScript 2015.</p><h1 id="Transpiling-class"><a href="#Transpiling-class" class="headerlink" title="Transpiling class"></a>Transpiling class</h1><p>Khi tÃ­nh nÄƒng má»›i cá»§a ES6 (hay ECMAScript 2015) Ä‘Æ°á»£c Ä‘á» xuáº¥t, cá»™ng Ä‘á»“ng Javascript developer khÃ´ng ngá»“i yÃªn chá» Ä‘á»£i táº¥t cáº£ cÃ¡c engine vÃ  trÃ¬nh duyá»‡t báº¯t Ä‘áº§u há»— trá»£ nÃ³. Má»™t cÃ¡ch tá»‘t hÆ¡n Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c lÃ  thÃ´ng qua transpile. NÃ³ cho phÃ©p 1 Ä‘oáº¡n code viáº¿t trong ECMAScript 2015 Ä‘Æ°á»£c biáº¿n Ä‘á»•i thÃ nh Javascript mÃ  táº¥t cáº£ trÃ¬nh duyá»‡t Ä‘á»u cÃ³ thá»ƒ hiá»ƒu. Bao gá»“m cáº£ kháº£ nÄƒng viáº¿t class vá»›i káº¿ thá»«a dá»±a trÃªn class vÃ  transpile chÃºng thÃ nh code hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c.<br><img src="https://cdn-images-1.medium.com/max/1000/0*QhRSzkngh6Aty-nD" alt=""></p><p>Má»™t trong sá»‘ nhá»¯ng transpiler ná»•i tiáº¿ng nháº¥t cho Javascript lÃ  Babel. Giá» thÃ¬ cÃ¹ng xem transpile hoáº¡t Ä‘á»™ng tháº¿ nÃ o, ta sáº½ Ã¡p dá»¥ng nÃ³ cho Ä‘oáº¡n code vá» Component viáº¿t á»Ÿ trÃªn nhÃ©:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(content) &#123;</span><br><span class="line">    <span class="keyword">this</span>.content = content;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.content)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> component = <span class="keyword">new</span> Component(<span class="string">'SessionStack'</span>);</span><br><span class="line">component.render();</span><br></pre></td></tr></table></figure><p>VÃ  Ä‘Ã¢y lÃ  nhá»¯ng gÃ¬ Babel transpile ra:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Component = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">    _classCallCheck(<span class="keyword">this</span>, Component);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.content = content;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _createClass(Component, [&#123;</span><br><span class="line">    key: <span class="string">'render'</span>,</span><br><span class="line">    value: <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.content);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Component;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure><p>NhÆ° báº¡n tháº¥y, code Ä‘Æ°á»£c biáº¿n Ä‘á»•i thÃ nh ECMAScript 5, loáº¡i cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi trÃªn báº¥t ká»³ mÃ´i trÆ°á»ng nÃ o. NgoÃ i ra cÃ²n cÃ³ 1 sá»‘ hÃ m Ä‘Æ°á»£c thÃªm vÃ o. ChÃºng lÃ  1 pháº§n cá»§a thÆ° viá»‡n Babel tiÃªu chuáº©n.</p><p>HÃ m _classCallCheck vÃ  _createClass cÃ³ máº·t nhÆ° 1 pháº§n trong káº¿t quáº£ biÃªn dá»‹ch. HÃ m Ä‘áº§u tiÃªn Ä‘áº£m báº£o hÃ m constructor khÃ´ng bao giá» Ä‘Æ°á»£c gá»i nhÆ° 1 hÃ m bÃ¬nh thÆ°á»ng. Äiá»u nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n báº±ng viá»‡c kiá»ƒm tra cÃ³ hay khÃ´ng ngá»¯ cáº£nh mÃ  trong Ä‘Ã³ hÃ m Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ lÃ  1 instance cá»§a object Component. Code sáº½ kiá»ƒm tra náº¿u<br>nÃ³ trá» Ä‘áº¿n instance. HÃ m thá»© 2 _createClass xá»­ lÃ½ viá»‡c táº¡o ra cÃ¡c thuá»™c tÃ­nh cho object vÃ  Ä‘Æ°á»£c truyá»n vÃ o dÆ°á»›i dáº¡ng danh sÃ¡ch cÃ¡c object vá»›i key &amp; value.</p><p>Äá»ƒ khÃ¡m phÃ¡ vá» cÃ¡ch káº¿ thá»«a hoáº¡t Ä‘á»™ng ra sao thÃ¬ ta cÃ¹ng phÃ¢n tÃ­ch class InputField Ä‘Æ°á»£c káº¿ thá»«a tá»« Component</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputField</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(value) &#123;</span><br><span class="line">        <span class="keyword">const</span> content = <span class="string">`&lt;input type="text" value="<span class="subst">$&#123;value&#125;</span>" /&gt;`</span>;</span><br><span class="line">        <span class="keyword">super</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Káº¿t quáº£ sau khi xá»­ lÃ½ transpile vá»›i Babel:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> InputField = <span class="function"><span class="keyword">function</span> (<span class="params">_Component</span>) </span>&#123;</span><br><span class="line">  _inherits(InputField, _Component);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">InputField</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    _classCallCheck(<span class="keyword">this</span>, InputField);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> content = <span class="string">'&lt;input type="text" value="'</span> + value + <span class="string">'" /&gt;'</span>;</span><br><span class="line">    <span class="keyword">return</span> _possibleConstructorReturn(<span class="keyword">this</span>, (InputField.__proto__ || <span class="built_in">Object</span>.getPrototypeOf(InputField)).call(<span class="keyword">this</span>, content));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> InputField;</span><br><span class="line">&#125;(Component);</span><br></pre></td></tr></table></figure><p>Trong vÃ­ dá»¥ trÃªn, logic káº¿ thá»«a Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i trong hÃ m _inherits. NÃ³ thá»±c hiá»‡n cÃ¹ng y chang hÃ nh Ä‘á»™ng mÃ  chÃºng ta Ä‘Ã£ mÃ´ táº£ trong pháº§n trÆ°á»›c báº±ng cÃ¡ch cÃ i Ä‘áº·t prototype cá»§a class con trá»Ÿ thÃ nh 1 instance cá»§a class cha.</p><p>Äá»ƒ transpile code, Babel thá»±c hiá»‡n nhiá»u quÃ¡ trÃ¬nh chuyá»ƒn Ä‘á»•i. Äáº§u tiÃªn code ECMAScript 2015 Ä‘Æ°á»£c parse vÃ  biáº¿n Ä‘á»•i thÃ nh má»™t dáº¡ng thá»ƒ hiá»‡n trung gian, gá»i lÃ  <strong>Abstract Syntax Tree</strong>, chÃ­nh lÃ  chá»§ Ä‘á» ta Ä‘Ã£ tháº£o luáº­n á»Ÿ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-14---Parsing--Abstract-Syntax-Tree---meo-giam-toi-da-thoi-gian-parse" target="_blank" rel="noopener">bÃ i trÆ°á»›c</a>. Sau Ä‘Ã³ cÃ¢y nÃ y Ä‘Æ°á»£c biáº¿n Ä‘á»•i láº§n ná»¯a thÃ nh 1 cÃ¢y AST khÃ¡c mÃ  má»—i node cá»§a nÃ³ Ä‘Æ°á»£c biáº¿n Ä‘á»•i thÃ nh pháº§n tÆ°Æ¡ng á»©ng trong ECMAScript 5. Cuá»‘i cÃ¹ng cÃ¢y AST Ä‘Æ°á»£c chuyá»ƒn ngÆ°á»£c láº¡i thÃ nh code.</p><h1 id="AST-trong-Babel"><a href="#AST-trong-Babel" class="headerlink" title="AST trong Babel"></a>AST trong Babel</h1><p>Má»™t cÃ¢y AST sáº½ cÃ³ nhiá»u node, má»—i node chá»‰ cÃ³ duy nháº¥t 1 node cha. Trong Babel, tá»“n táº¡i 1 kiá»ƒu cÆ¡ báº£n cho cÃ¡c node. NÃ³ chÆ°a thÃ´ng tin vá» loáº¡i node vÃ  vá»‹ trÃ­ cá»§a chÃºng trong code. CÃ³ nhiá»u loáº¡i node khÃ¡c nhau, cháº³ng háº¡n nhÆ° Literals thá»ƒ hiá»‡n string, number, null, vÃ¢n vÃ¢n. CÅ©ng cÃ³ cáº£ node Statements dÃ nh cho cÃ¡c luá»“ng kiá»ƒm soÃ¡t (if) vÃ  vÃ²ng láº·p (for, while). CÃ³ cáº£ node Ä‘áº·c biá»‡t dÃ nh cho class. NÃ³ lÃ  1 con (child) cá»§a class Node cÆ¡ báº£n. NÃ³ má»Ÿ rá»™ng báº±ng cÃ¡ch thÃªm cÃ¡c trÆ°á»ng Ä‘á»ƒ lÆ°u tham chiáº¿u Ä‘áº¿n class cÆ¡ báº£n vÃ  body cá»§a class nhÆ° lÃ  1 node riÃªng biá»‡t.</p><p>Giá» ta sáº½ biáº¿n Ä‘á»•i Ä‘oáº¡n code sau thÃ nh cÃ¢y AST</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(content) &#123;</span><br><span class="line">    <span class="keyword">this</span>.content = content;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.content)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ÄÃ¢y lÃ  káº¿t quáº£:<br><img src="https://cdn-images-1.medium.com/max/1000/0*-OqUfzpRtgDJQjXY" alt=""></p><p>Sau khi táº¡o ra cÃ¢y AST, má»—i node Ä‘Æ°á»£c biáº¿n Ä‘á»•i thÃ nh node ECMAScript 5 tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i nÃ³ vÃ  chuyá»ƒn ngÆ°á»£c láº¡i thÃ nh code thÆ°á»ng theo tiÃªu chuáº©n cá»§a ECMAScript 5. QuÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n báº±ng 1 tiáº¿n trÃ¬nh tÃ¬m kiáº¿m node náº±m á»Ÿ vá»‹ trÃ­ xa nháº¥t vá»›i root node vÃ  biáº¿n Ä‘á»•i chÃºng thÃ nh code. Sau Ä‘Ã³ node cha cá»§a nÃ³ sáº½ Ä‘Æ°á»£c biáº¿n Ä‘á»•i báº±ng Ä‘oáº¡n code Ä‘Ã£ sinh ra cho cÃ¡c node con cá»§a nÃ³. QuÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c gá»i lÃ  <a href="https://en.wikipedia.org/wiki/Depth-first_search" target="_blank" rel="noopener">depth-first traversal</a></p><p>Trong vÃ­ dá»¥ trÃªn, Ä‘áº§u tiÃªn code cá»§a 2 node MethodDefinition sáº½ Ä‘Æ°á»£c sinh ra, theo sau nÃ³ lÃ  code cá»§a node ClassBody vÃ  cuá»‘i cÃ¹ng lÃ  node ClassDeclaration</p><h1 id="Transpile-voi-TypeScript"><a href="#Transpile-voi-TypeScript" class="headerlink" title="Transpile vá»›i TypeScript"></a>Transpile vá»›i TypeScript</h1><p>Má»™t framework phá»• biáº¿n khÃ¡c há»— trá»£ kháº£ nÄƒng transpile chÃ­nh lÃ  TypeScript. NÃ³ giá»›i thiá»‡u cÃº phÃ¡p kiá»ƒu má»›i Ä‘á»ƒ viáº¿t á»©ng dá»¥ng Javascript vÃ  Ä‘Æ°á»£c biáº¿n Ä‘á»•i thÃ nh ECMAScript 5 mÃ  cÃ³ thá»ƒ cháº¡y trÃªn báº¥t ká»³ trÃ¬nh duyá»‡t hay engine nÃ o. DÆ°á»›i Ä‘Ã¢y lÃ  pháº§n triá»ƒn khai cá»§a class Component trong TypeScript:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    content: string;</span><br><span class="line">    <span class="keyword">constructor</span>(content: string) &#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>VÃ  Ä‘Ã¢y lÃ  cÃ¢y AST Ä‘Æ°á»£c sinh ra:<br><img src="https://cdn-images-1.medium.com/max/1000/0*j3zkSjnrL4fnCK3A" alt=""></p><p>NÃ³ há»— trá»£ káº¿ thá»«a:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InputField</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(value: string) &#123;</span><br><span class="line">        <span class="keyword">const</span> content = <span class="string">`&lt;input type="text" value="<span class="subst">$&#123;value&#125;</span>" /&gt;`</span>;</span><br><span class="line">        <span class="keyword">super</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Káº¿t quáº£ transpile ra:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> InputField = <span class="comment">/** @class */</span> (<span class="function"><span class="keyword">function</span> (<span class="params">_super</span>) </span>&#123;</span><br><span class="line">    __extends(InputField, _super);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">InputField</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">var</span> content = <span class="string">"&lt;input type=\"text\" value=\""</span> + value + <span class="string">"\" /&gt;"</span>;</span><br><span class="line">        _this = _super.call(<span class="keyword">this</span>, content) || <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> _this;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> InputField;</span><br><span class="line">&#125;(Component));</span><br></pre></td></tr></table></figure><p>Káº¿t quáº£ cuá»‘i cÃ¹ng má»™t láº§n ná»¯a láº¡i lÃ  ECMAScript 5 vá»›i 1 sá»‘ hÃ m thÃªm vÃ o tá»« thÆ° viá»‡n cá»§a TypeScript. Logic Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i trong __extends lÃ  giá»‘ng y há»‡t nhÆ° nhá»¯ng gÃ¬ chÃºng ta Ä‘Ã£ tháº£o luáº­n á»Ÿ pháº§n trÆ°á»›c.</p><p>Vá»›i Babel vÃ  TypeScript cÃ ng ngÃ y cÃ ng Ä‘Æ°á»£c Ä‘Ã³n nháº­n ná»“ng nhiá»‡t, class tiÃªu chuáº©n vÃ  káº¿ thá»«a dá»±a trÃªn class trá»Ÿ thÃ nh 1 cÃ¡ch chuáº©n cá»§a pháº§n cáº¥u trÃºc nhá»¯ng á»©ng dá»¥ng Javascript. Äiá»u nÃ y Ä‘áº©y nhanh tiáº¿n Ä‘á»™ vá» native support (há»— trá»£ tá»± nhiÃªn) cho class trÃªn trÃ¬nh duyá»‡t.</p><h1 id="Native-support-ho-tro-tu-nhien"><a href="#Native-support-ho-tro-tu-nhien" class="headerlink" title="Native support (há»— trá»£ tá»± nhiÃªn)"></a>Native support (há»— trá»£ tá»± nhiÃªn)</h1><p>VÃ o nÄƒm 2014, <a href="https://www.chromestatus.com/feature/4633745457938432" target="_blank" rel="noopener">native support cho class</a> Ä‘Æ°á»£c giá»›i thiá»‡u trong Chrome. NÃ³ cho phÃ©p cÃº phÃ¡p khai bÃ¡o class Ä‘Æ°á»£c thá»±c hiá»‡n mÃ  khÃ´ng cáº§n pháº£i dÃ¹ng Ä‘áº¿n cÃ¡c thÆ° viá»‡n hay transpiler.<br><img src="https://cdn-images-1.medium.com/max/1000/0*jJuHfRMipW8PPcb0" alt=""></p><p>QuÃ¡ trÃ¬nh triá»ƒn khai class má»™t cÃ¡ch tá»± nhiÃªn Ä‘Æ°á»£c gá»i lÃ  syntax sugar (cÃº phÃ¡p ngá»t ngÃ o). ÄÃ¢y chá»‰ lÃ  1 cÃº phÃ¡p dá»… chá»‹u cÃ³ thá»ƒ biÃªn dá»‹ch xuá»‘ng thÃ nh cÃ¹ng loáº¡i vá»›i kiá»ƒu nguyÃªn thá»§y Ä‘ang Ä‘Æ°á»£c há»— trá»£ máº·c Ä‘á»‹nh trong ngÃ´n ngá»¯. Báº¡n cÃ³ thá»ƒ dÃ¹ng kiá»ƒu Ä‘á»‹nh nghÄ©a class má»›i, dá»… dÃ¹ng hÆ¡n, nhÆ°ng cuá»‘i cÃ¹ng nÃ³ cÅ©ng quay vá» táº¡o constructor vÃ  gÃ¡n prototypes</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*c2HpOiUYMimMXHv2" alt=""></p><h1 id="Su-ho-tro-cua-V8"><a href="#Su-ho-tro-cua-V8" class="headerlink" title="Sá»± há»— trá»£ cá»§a V8"></a>Sá»± há»— trá»£ cá»§a V8</h1><p>CÃ¹ng xem cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a native support cho class trong ECMAScript 2015 trÃªn V8. NhÆ° ta Ä‘Ã£ tháº£o luáº­n á»Ÿ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-14---Parsing--Abstract-Syntax-Tree---meo-giam-toi-da-thoi-gian-parse" target="_blank" rel="noopener">bÃ i trÆ°á»›c</a>, Ä‘áº§u tiÃªn cÃº phÃ¡p má»›i cáº§n Ä‘Æ°á»£c parse thÃ nh code Javascript cÅ© vÃ  thÃªm vÃ o cÃ¢y AST. VÃ¬ tháº¿ káº¿t quáº£ cá»§a Ä‘á»‹nh nghÄ©a class lÃ  1 node má»›i (loáº¡i <a href="https://github.com/v8/v8/blob/a86fa968136f0ec6237f51a0d535fbd932868d4d/src/ast/ast.h#L2421" target="_blank" rel="noopener">ClassLiteral</a>) Ä‘Æ°á»£c thÃªm vÃ o cÃ¢y.</p><p>Node nÃ y chá»©a 1 vÃ i thá»©. Äáº§u tiÃªn, nÃ³ giá»¯ constructor á»Ÿ 1 hÃ m khÃ¡c. NÃ³ cÅ©ng chá»©a 1 danh sÃ¡ch cÃ¡c thuá»™c tÃ­nh cá»§a class. ChÃºng cÃ³ thá»ƒ lÃ  phÆ°Æ¡ng thá»©c, getter, setter, cÃ¡c trÆ°á»ng public hay private. Node nÃ y cÅ©ng chá»©a luÃ´n tham chiáº¿u Ä‘áº¿n class cha mÃ  chÃ­nh class cha nÃ y láº¡i ná»¯a chá»©a constructor &amp; danh sÃ¡ch cÃ¡c thuá»™c tÃ­nh vÃ  class cha khÃ¡c (cá»§a nÃ³).</p><p>Má»™t khi ClassLiteral nÃ y Ä‘Æ°á»£c <a href="https://github.com/v8/v8/blob/be3a1df9008ee78d1101855d3044db54a203f515/src/interpreter/bytecode-generator.cc#L1818" target="_blank" rel="noopener">chuyá»ƒn thÃ nh code</a>, nÃ³ Ä‘Æ°á»£c dá»‹ch 1 láº§n ná»¯a thÃ nh cÃ¡c hÃ m vÃ  prototypes.</p><p>Vá»›i team táº¡i <a href="https://www.sessionstack.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_content=classes-inheritance-transpiling-outro" target="_blank" rel="noopener">SessionStack</a>, tá»‘i Æ°u hÃ³a tá»«ng pháº§n nhá» cá»§a code lÃ  cá»±c ká»³ quan trá»ng nhá»¯ng cÅ©ng lÃ  1 cÃ´ng viá»‡c ráº¥t thÃ¡ch thá»©c. CÃ³ 2 lÃ½ do cho viá»‡c cáº§n thiáº¿t pháº£i tá»‘i Æ°u hÃ³a má»©c Ä‘á»™ cao.</p><p>Äáº§u tiÃªn, thÆ° viá»‡n cá»§a há» sáº½ tÃ­ch há»£p vá»›i trong webapp, nÃ³ thu tháº­p dá»¯ liá»‡u tá»« phiÃªn lÃ m viá»‡c cá»§a user, cháº³ng háº¡n nhÆ° sá»± kiá»‡n, thay Ä‘á»•i trÃªn DOM, dá»¯ liá»‡u máº¡ng, biá»‡t lá»‡, thÃ´ng bÃ¡o lá»—i, vÃ¢n vÃ¢n. Thu tháº­p thÃ´ng tin mÃ  khÃ´ng lÃ m áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng cá»§a webapp lÃ  1 thÃ¡ch thá»©c khÃ³ mÃ  team cá»§a tÃ¡c giáº£ Ä‘Ã£ giáº£i quyáº¿t thÃ nh cÃ´ng.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 15 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;NgÃ y nay, cÃ¡ch phá»• biáº¿n nháº¥t Ä‘á»ƒ dá»±ng cáº¥u trÃºc cá»§a báº¥t ká»³ dá»± Ã¡n pháº§n má»m nÃ o lÃ  sá»­ dá»¥ng class. Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ cÃ¹ng khÃ¡m phÃ¡ cÃ¡c cÃ¡ch khÃ¡c nhau Ä‘á»ƒ triá»ƒn khai class trong Javascript vÃ  lÃ m tháº¿ nÃ o ta cÃ³ thá»ƒ xÃ¢y dá»±ng cÃ¢y thá»© báº­c cá»§a class (class hierarchy). ChÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng cÃ¡ch Ä‘Ã o sÃ¢u tÃ¬m hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a prototype vÃ  phÃ¢n tÃ­ch nhá»¯ng cÃ¡ch Ä‘á»ƒ giáº£ láº­p káº¿ thá»«a class trong cÃ¡c thÆ° viá»‡n ná»•i tiáº¿ng. Tiáº¿p Ä‘áº¿n ta sáº½ xem lÃ m cÃ¡ch nÃ o mÃ  transpiling cÃ³ thá»ƒ thÃªm nhá»¯ng tÃ­nh nÄƒng khÃ´ng Ä‘Æ°á»£c há»— trá»£ chÃ­nh thá»©c cho ngÃ´n ngá»¯ vÃ  cÃ¡ch mÃ  nÃ³ Ä‘Æ°á»£c dÃ¹ng trong Babel &amp;amp; Typescript Ä‘á»ƒ giá»›i thiá»‡u vá» sá»± há»— trá»£ cá»§a class trong ECMAScript 2015. Cuá»‘i cÃ¹ng, ta sáº½ káº¿t thÃºc vá»›i má»™t vÃ i vÃ­ dá»¥ vá» class Ä‘Æ°á»£c triá»ƒn khai native trong V8.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P14: Parsing, Abstract Syntax Tree &amp; máº¹o giáº£m tá»‘i Ä‘a thá»i gian parse</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P14-Parsing-Abstract-Syntax-Tree-meo-giam-toi-da-thoi-gian-parse.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P14-Parsing-Abstract-Syntax-Tree-meo-giam-toi-da-thoi-gian-parse.html</id>
    <published>2018-11-25T09:32:00.000Z</published>
    <updated>2018-11-25T09:35:26.778Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 14 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>ChÃºng ta Ä‘á»u biáº¿t ráº±ng nhá»¯ng thá»© lá»™n xá»™n cÃ³ thá»ƒ há»£p thÃ nh 1 thá»© lá»›n hÆ¡n gá»i lÃ  Javascript. Má»™t Ä‘oáº¡n code khÃ´ng chá»‰ cÃ³ thá»ƒ di chuyá»ƒn qua máº¡ng mÃ  nÃ³ cÃ²n pháº£i Ä‘Æ°á»£c parse, biÃªn dá»‹ch sang bytecode vÃ  cuá»‘i cÃ¹ng thá»±c thi. Trong cÃ¡c bÃ i trÆ°á»›c, chÃºng ta Ä‘Ã£ tháº£o luáº­n vá» nhá»¯ng thá»© cháº³ng háº¡n nhÆ° JS engine, runtime, callstack cÅ©ng nhÆ° engine V8 Ä‘Æ°á»£c dÃ¹ng chá»§ yáº¿u trong Chrome vÃ  NodeJS. Táº¥t cáº£ Ä‘á»u Ä‘Ã³ng vai trÃ² quan trá»ng trong toÃ n bá»™ quÃ¡ trÃ¬nh thá»±c thi cá»§a Javascript. Chá»§ Ä‘á» mÃ  chÃºng ta sáº½ tÃ¬m hiá»ƒu hÃ´m nay cÅ©ng khÃ´ng kÃ©m quan trá»ng: chÃºng ta sáº½ nghiÃªn cá»©u xem lÃ m tháº¿ nÃ o mÃ  Ä‘a sá»‘ cÃ¡c engine JS parse vÄƒn báº£n thÃ nh má»™t thá»© gÃ¬ Ä‘Ã³ cÃ³ nghÄ©a Ä‘á»‘i vá»›i mÃ¡y mÃ³c, nhá»¯ng gÃ¬ xáº£y ra sau Ä‘Ã³ vÃ  lÃ m tháº¿ nÃ o Ä‘á»ƒ web developer nhÆ° chÃºng ta cÃ³ thá»ƒ táº­n dá»¥ng nhá»¯ng kiáº¿n thá»©c Ä‘Ã³ lÃ m Ä‘iá»ƒm máº¡nh.<br><a id="more"></a></p><h1 id="Ngon-ngu-lap-trinh-hoat-dong-nhu-the-nao"><a href="#Ngon-ngu-lap-trinh-hoat-dong-nhu-the-nao" class="headerlink" title="NgÃ´n ngá»¯ láº­p trÃ¬nh hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?"></a>NgÃ´n ngá»¯ láº­p trÃ¬nh hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?</h1><p>CÃ¹ng lÃ¹i láº¡i 1 chÃºt vÃ  xem xem ngÃ´n ngá»¯ láº­p trÃ¬nh hoáº¡t Ä‘á»™ng tháº¿ nÃ o. KhÃ´ng cáº§n biáº¿t lÃ  báº¡n Ä‘ang xÃ i ngÃ´n ngá»¯ gÃ¬, báº¡n sáº½ luÃ´n cáº§n má»™t pháº§n má»m cÃ³ thá»ƒ Ä‘á»c mÃ£ nguá»“n vÃ  khiáº¿n cho mÃ¡y tÃ­nh thá»±c hiá»‡n má»™t Ä‘iá»u gÃ¬ Ä‘Ã³. Pháº§n má»m nÃ y cÃ³ thá»ƒ lÃ  trÃ¬nh thÃ´ng dá»‹ch hoáº·c trÃ¬nh biÃªn dá»‹ch.</p><p>KhÃ´ng cáº§n biáº¿t báº¡n Ä‘ang xÃ i ngÃ´n ngá»¯ thÃ´ng dá»‹ch (Javascript, Python, Ruby) hay ngÃ´n ngá»¯ biÃªn dá»‹ch (C#, Java, Rust), luÃ´n luÃ´n cÃ³ 1 Ä‘iá»ƒm chung giá»¯a chÃºng: parse Ä‘oáº¡n mÃ£ nguá»“n tá»« vÄƒn báº£n gá»‘c thÃ nh má»™t cáº¥u trÃºc dá»¯ liá»‡u Ä‘Æ°á»£c gá»i lÃ  Abstract Syntax Tree (AST).</p><p>CÃ¡c AST khÃ´ng chá»‰ thá»ƒ hiá»‡n mÃ£ nguá»“n dÆ°á»›i dáº¡ng cáº¥u trÃºc mÃ  chÃºng cÃ²n Ä‘Ã³ng vai trÃ² quan trá»ng trong phÃ¢n tÃ­ch ngá»¯ nghÄ©a, chÃ­nh lÃ  nÆ¡i mÃ  trÃ¬nh biÃªn dá»‹ch xÃ¡c nháº­n tÃ­nh Ä‘Ãºng Ä‘áº¯n vÃ  cÃ¡ch sá»­ dá»¥ng phÃ¹ há»£p cá»§a chÆ°Æ¡ng trÃ¬nh cÅ©ng nhÆ° cÃ¡c pháº§n tá»­ cá»§a ngÃ´n ngá»¯. Vá» sau, cÃ¡c AST Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ sinh ra bytecode hoáº·c mÃ£ mÃ¡y.</p><h1 id="Cac-ung-dung-AST"><a href="#Cac-ung-dung-AST" class="headerlink" title="CÃ¡c á»©ng dá»¥ng AST"></a>CÃ¡c á»©ng dá»¥ng AST</h1><p>AST khÃ´ng chá»‰ Ä‘Æ°á»£c dÃ¹ng trong trÃ¬nh thÃ´ng dá»‹ch vÃ  trÃ¬nh biÃªn dá»‹ch ngÃ´n ngá»¯, chÃºng cÃ²n cÃ³ nhiá»u á»©ng dá»¥ng trong tháº¿ giá»›i mÃ¡y tÃ­nh. Má»™t trong sá»‘ Ä‘Ã³ lÃ  dÃ¹ng chÃºng lÃ  phÃ¢n tÃ­ch code tÄ©nh. CÃ¡c nhÃ  phÃ¢n tÃ­ch tÄ©nh khÃ´ng thá»±c thi code, há» cáº§n hiá»ƒu cáº¥u trÃºc cá»§a code. VÃ­ dá»¥: báº¡n muá»‘n triá»ƒn khai má»™t cÃ´ng cá»¥ tÃ¬m sá»± giá»‘ng nhau giá»¯a cÃ¡c kiáº¿n trÃºc code Ä‘á»ƒ tá»« Ä‘Ã³ báº¡n cÃ³ thá»ƒ refactor nháº±m giáº£m sá»± trÃ¹ng láº·p. Báº¡n cÃ³ thá»ƒ lÃ m viá»‡c nÃ y báº±ng cÃ¡ch so sÃ¡nh string bÃ¬nh thÆ°á»ng nhÆ°ng cÃ¡ch triá»ƒn khai thÃ¬ khÃ¡ cÆ¡ báº£n vÃ  giá»›i háº¡n.</p><p>Má»™t cÃ¡ch tá»± nhiÃªn, náº¿u báº¡n cÃ³ há»©ng thÃº triá»ƒn khai má»™t cÃ´ng cá»¥ thÃ¬ báº¡n khÃ´ng cáº§n pháº£i viáº¿t riÃªng cho nÃ³ 1 cÃ¡i parser. CÃ³ ráº¥t nhiá»u triá»ƒn khai mÃ£ nguá»“n má»Ÿ cÃ³ sáºµn cÃ³ kháº£ nÄƒng tÆ°Æ¡ng thÃ­ch toÃ n diá»‡n vá»›i thÃ´ng sá»‘ ká»¹ thuáº­t cá»§a Ecmascript. VÃ­ dá»¥: Esprima vÃ  Acorn. CÅ©ng cÃ³ ráº¥t nhiá»u cÃ´ng cá»¥ cÃ³ thá»ƒ giÃºp ta vá»›i sáº£n pháº©m nháº­n Ä‘Æ°á»£c tá»« parser, hay cÃ²n gá»i lÃ  AST. CÃ¡c AST cÅ©ng Ä‘Æ°á»£c dÃ¹ng nhiá»u trong pháº§n triá»ƒn khai cá»§a cÃ¡c code transpiler. VÃ­ dá»¥: báº¡n cáº§n triá»ƒn khai má»™t bá»™ transpiler Ä‘á»ƒ chuyá»ƒn code Python thÃ nh Javascript. Ã tÆ°á»Ÿng cÆ¡ báº£n lÃ  ta cáº§n má»™t Python transpiler Ä‘á»ƒ sinh ra cÃ¢y AST - thá»© mÃ  ta cáº§n Ä‘á»ƒ cÃ³ thá»ƒ sinh ra code Javascript sau nÃ y.</p><p>Báº¡n cÃ³ thá»ƒ tá»± há»i, lÃ m sao nhÆ° váº­y Ä‘Æ°á»£c? Äiá»ƒm máº¥u chá»‘t lÃ  cÃ¡c AST chá»‰ lÃ  má»™t Ä‘iá»ƒm khÃ¡c biá»‡t vá» cÃ¡ch thá»ƒ hiá»‡n má»™t vÃ i ngÃ´n ngá»¯. TrÆ°á»›c khi parse, nÃ³ thá»ƒ hiá»‡n dÆ°á»›i dáº¡ng vÄƒn báº£n Ä‘i kÃ¨m theo má»™t sá»‘ quy luáº­t nháº¥t Ä‘á»‹nh Ä‘á»ƒ hÃ¬nh thÃ nh nÃªn 1 ngÃ´n ngá»¯. Sau khi parse, nÃ³ thá»ƒ hiá»‡n dÆ°á»›i dáº¡ng má»™t kiáº¿n trÃºc dáº¡ng cÃ¢y chá»©a chÃ­nh xÃ¡c cÃ¹ng 1 thÃ´ng tin vá»›i vÄƒn báº£n Ä‘áº§u vÃ o. VÃ¬ tháº¿, báº¡n cÃ³ thá»ƒ luÃ´n luÃ´n cÃ³ thá»ƒ lÃ m ngÆ°á»£c láº¡i vÃ  go back vá» dáº¡ng biá»ƒu diá»…n vÄƒn báº£n.</p><h1 id="Javascript-parsing"><a href="#Javascript-parsing" class="headerlink" title="Javascript parsing"></a>Javascript parsing</h1><p>Giá» thÃ¬ cÃ¹ng tÃ¬m hiá»ƒu cÃ¢y AST Ä‘Æ°á»£c xÃ¢y dá»±ng nhÆ° tháº¿ nÃ o. Äáº§u tiÃªn ta cÃ³ má»™t hÃ m Javascript Ä‘Æ¡n giáº£n nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> a * x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Parser sáº½ sáº£n sinh ra cÃ¢y AST nhÆ° sau:<br><img src="https://cdn-images-1.medium.com/max/1000/0*mSOIiWpkctkD0Gfg." alt=""></p><p>LÆ°u Ã½ ráº±ng vÃ¬ má»¥c Ä‘Ã­ch dá»… nhÃ¬n vÃ  Ä‘áº¹p thÃ¬ hÃ¬nh trÃªn chá»‰ lÃ  phiÃªn báº£n tá»‘i giáº£n cá»§a sáº£n pháº©m thá»±c sá»± tá»« parser. CÃ¢y AST tháº­t sáº½ phá»©c táº¡p hÆ¡n ráº¥t nhiá»u. Tuy nhiÃªn, má»¥c Ä‘Ã­ch cá»§a chÃºng ta lÃ  cÃ³ Ä‘Æ°á»£c Ã½ tÆ°á»Ÿng cÆ¡ báº£n vá» viá»‡c mÃ£ nguá»“n sáº½ biáº¿n thÃ nh cÃ¡i gÃ¬ trÆ°á»›c khi nÃ³ Ä‘Æ°á»£c thá»±c thi. Náº¿u báº¡n muá»‘n xem cÃ¢y AST thá»© thiá»‡t trÃ´ng nhÆ° tháº¿ nÃ o thÃ¬ báº¡n cÃ³ thá»ƒ <a href="https://astexplorer.net/" target="_blank" rel="noopener">vÃ o Ä‘Ã¢y</a>. ÄÃ³ lÃ  1 cÃ´ng cá»¥ online, báº¡n chá»‰ cáº§n nháº­p code Javascript vÃ o vÃ  nÃ³ sáº½ sinh ra cÃ¢y AST cho Ä‘oáº¡n code Ä‘Ã³.</p><p>Báº¡n sáº½ tá»± há»i táº¡i sao chÃºng ta cáº§n biáº¿t vá» cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Javascript parser. Sau táº¥t cáº£ thÃ¬ nÃ³ thuá»™c vá» trÃ¡ch nhiá»‡m cá»§a trÃ¬nh duyá»‡t. VÃ  vá» máº·t nÃ o Ä‘Ã³ thÃ¬ Ä‘Ãºng lÃ  nhÆ° tháº¿. Tuy nhiÃªn, báº¡n cÃ³ thá»ƒ xem hÃ¬nh bÃªn dÆ°á»›i, Ä‘Ã³ lÃ  Ä‘á»“ thá»‹ biá»ƒu diá»…n tá»•ng thá»i gian phÃ¢n phá»‘i cho tá»«ng bÆ°á»›c trong quÃ¡ trÃ¬nh thá»±c thi code Javascript. HÃ£y nhÃ¬n ká»¹ hÆ¡n vÃ  thá»­ xem cÃ³ tháº¥y Ä‘Æ°á»£c gÃ¬ thÃº vá»‹ khÃ´ng.<br><img src="https://cdn-images-1.medium.com/max/1000/0*eEArxn147Ev8xf5n." alt=""></p><p>Báº¡n cÃ³ tháº¥y Ä‘Æ°á»£c khÃ´ng? NhÃ¬n ká»¹ xem. Trung bÃ¬nh thÃ¬ trÃ¬nh duyá»‡t chiáº¿m khoáº£ng 15-20% tá»•ng thá»i gian thá»±c thi Ä‘á»ƒ parse Javascript. Nhá»¯ng con sá»‘ nÃ y khÃ´ng pháº£i lÃ  bá»‹a Ä‘áº·t. ChÃºng lÃ  sá»‘ liá»‡u thá»‘ng kÃª tá»« nhá»¯ng á»©ng dá»¥ng vÃ  website cÃ³ tháº­t Ä‘ang báº±ng cÃ¡ch nÃ y hay cÃ¡ch khÃ¡c sá»­ dá»¥ng Javascript. Giá» thÃ¬ 15% cÃ³ váº» nhÆ° khÃ´ng nhiá»u láº¯m, nhÆ°ng tin tÃ´i Ä‘i, nÃ³ cÃ³ giÃ¡ trá»‹ Ä‘áº¥y. Má»™t app SPA tiÃªu chuáº©n sáº½ load khoáº£ng 0.4MB code Javascript vÃ  trÃ¬nh duyá»‡t tiÃªu tá»‘n xáº¥p xá»‰ 370ms Ä‘á»ƒ parse nÃ³.</p><p>ThÃªm má»™t láº§n ná»¯a, báº¡n sáº½ nÃ³i ráº±ng nÃ³ cháº³ng Ä‘Ã¡ng bao nhiÃªu thá»i gian cáº£. VÃ  rÃµ rÃ ng con sá»‘ Ä‘Ã³ quÃ¡ nhá». Tuy nhiÃªn nhá»› ká»¹ ráº±ng Ä‘Ã¢y chá»‰ lÃ  thá»i gian cáº§n Ä‘á»ƒ parse code Javascript thÃ nh cÃ¢y AST. ChÆ°a bao gá»“m thá»i gian thá»±c thi chÃ­nh nÃ³ hay báº¥t ká»³ tiáº¿n trÃ¬nh nÃ o diá»…n ra trong khi load trang (vÃ­ dá»¥ nhÆ° <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-11---Render-engine---meo-toi-uu-hoa-hieu-nang-render" target="_blank" rel="noopener">CSS &amp; HTML rendering</a>). VÃ  táº¥t cáº£ thÃ´ng sá»‘ nÃ y má»›i chá»‰ thá»ƒ hiá»‡n cho desktop. Khi chÃºng ta Ä‘i sÃ¢u hÆ¡n trÃªn mobile, má»i thá»© sáº½ trá»Ÿ nÃªn phá»©c táº¡p hÆ¡n nhiá»u. <strong>Thá»i gian dÃ nh cho viá»‡c parse trÃªn mobile thÆ°á»ng cÃ³ thá»ƒ nhiá»u hÆ¡n 2-5 láº§n so vá»›i trÃªn desktop.</strong></p><p><img src="https://cdn-images-1.medium.com/max/1000/0*3R6-AyKY1831P10d." alt=""></p><p>Äá»“ thá»‹ trÃªn thá»ƒ hiá»‡n thá»i gian parse cá»§a 1 gÃ³i code Javascript 1MB trÃªn ráº¥t nhiá»u thiáº¿t bá»‹ mobile &amp; desktop thuá»™c nhiá»u phÃ¢n khÃºc khÃ¡c nhau.</p><p>GÃ¬ ná»¯a nÃ o? Web app Ä‘ang cÃ ng trá»Ÿ nÃªn phá»©c táº¡p theo tá»«ng phÃºt cÅ©ng nhÆ° cÃ ng cÃ³ nhiá»u business logic pháº£i xá»­ lÃ½ á»Ÿ phÃ­a client Ä‘á»ƒ cÃ³ thá»ƒ mang láº¡i tráº£i nghiá»‡m giá»‘ng há»‡t nhÆ° native app. Báº¡n cÃ³ thá»ƒ dá»… dÃ ng hiá»ƒu Ä‘Æ°á»£c nhá»¯ng Ä‘iá»u Ä‘Ã³ áº£nh hÆ°á»Ÿng nhÆ° tháº¿ nÃ o Ä‘áº¿n website/wepapp cá»§a báº¡n. Táº¥t cáº£ nhá»¯ng gÃ¬ báº¡n cáº§n lÃ  má»Ÿ dev tool cá»§a trÃ¬nh duyá»‡t lÃªn vÃ  Ä‘á»ƒ nÃ³ Ä‘o Ä‘áº¡c lÆ°á»£ng thá»i gian dÃ nh cho parsing, biÃªn dá»‹ch vÃ  má»i thá»© diá»…n ra trÃªn trÃ¬nh duyá»‡t cho tá»›i khi trang web Ä‘Æ°á»£c load hoÃ n toÃ n.<br><img src="https://cdn-images-1.medium.com/max/1000/0*A5ucCHOZsxXyHMfN." alt=""></p><p>Tháº­t khÃ´ng may, khÃ´ng cÃ³ dev tool nÃ o cho cÃ¡c trÃ¬nh duyá»‡t mobile. NhÆ°ng Ä‘á»«ng lo láº¯ng, Ä‘iá»u nÃ y khÃ´ng cÃ³ nghÄ©a ráº±ng báº¡n khÃ´ng thá»ƒ lÃ m gÃ¬ Ä‘Æ°á»£c. ÄÃ¢y lÃ  lÃ½ do nhá»¯ng cÃ´ng cá»¥ nhÆ° <a href="https://github.com/danielmendel/DeviceTiming" target="_blank" rel="noopener">DeviceTiming</a> tá»“n táº¡i. NÃ³ cÃ³ thá»ƒ giÃºp báº¡n Ä‘o Ä‘áº¡c thá»i gian parse vÃ  thá»±c thi cho cÃ¡c Ä‘oáº¡n code trong má»™t mÃ´i trÆ°á»ng kiá»ƒm soÃ¡t. NÃ³ hoáº¡t Ä‘á»™ng báº±ng cÃ¡ch gÃ³i gá»n code local vá»›i Ä‘oáº¡n code Ä‘o lÆ°á»ng, vÃ¬ tháº¿ nÃªn má»—i láº§n trang web cá»§a báº¡n Ä‘Æ°á»£c truy cáº­p tá»« cÃ¡c thiáº¿t bá»‹ khÃ¡c nhau, báº¡n cÃ³ thá»ƒ Ä‘o Ä‘áº¡c thá»i gian parse vÃ  thá»±c thi.</p><p>Äiá»u tá»‘t lÃ  engine Javascript Ä‘Ã£ lÃ m ráº¥t nhiá»u thá»© nháº±m trÃ¡nh cÃ¡ch cÃ´ng viá»‡c thá»«a thÃ£i vÃ  tá»‘i hÆ°u hÃ³a nhiá»u hÆ¡n. DÆ°á»›i Ä‘Ã¢y lÃ  1 vÃ i thá»© mÃ  cÃ¡c engine cá»§a nhá»¯ng trÃ¬nh duyá»‡t lá»›n Ä‘Ã£ lÃ m.</p><p>VÃ­ dá»¥ vá»›i V8, nÃ³ thá»±c hiá»‡n script streaming &amp; code caching. Script streaming nghÄ©a lÃ  cÃ¡c Ä‘oáº¡n code báº¥t Ä‘á»“ng bá»™ &amp; bá»‹ trÃ¬ hoÃ£n sáº½ Ä‘Æ°á»£c parse trong 1 tiáº¿n trÃ¬nh riÃªng ngay khi quÃ¡ trÃ¬nh download báº¯t Ä‘áº§u. NÃ³ giÃºp cho quÃ¡ trÃ¬nh parsing gáº§n nhÆ° hoÃ n thÃ nh ngay láº­p tá»©c sau khi Ä‘oáº¡n code (script) Ä‘Æ°á»£c táº£i xong. Káº¿t quáº£ lÃ  cÃ¡c trang sáº½ load nhanh hÆ¡n khoáº£ng 10%.</p><p>Code Javascript thÆ°á»ng Ä‘Æ°á»£c biÃªn dá»‹ch thÃ nh bytecode má»—i khi cÃ³ má»™t lÆ°á»£t truy cáº­p trang. Tuy nhiÃªn, cá»¥c bytecode nÃ y láº¡i bá»‹ bá» Ä‘i khi ngÆ°á»i dÃ¹ng truy cáº­p Ä‘áº¿n trang khÃ¡c. Äiá»u nÃ y xáº£y ra vÃ¬ code Ä‘Æ°á»£c biÃªn dá»‹ch phá»¥ thuá»™c ráº¥t nhiá»u vÃ o tráº¡ng thÃ¡i vÃ  ngá»¯ cáº£nh cá»§a mÃ¡y táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch. ÄÃ¢y lÃ  lÃ½ do Chrome 42 giá»›i thiá»‡u bytecode caching (bá»™ Ä‘á»‡m bytecode). ÄÃ¢y lÃ  má»™t ká»¹ thuáº­t lÆ°u trá»¯ code Ä‘Ã£ biÃªn dá»‹ch á»Ÿ local Ä‘á»ƒ khi user quay trá»Ÿ láº¡i trang cÅ© trÆ°á»›c Ä‘Ã³ thÃ¬ táº¥t cáº£ má»i hoáº¡t Ä‘á»™ng nhÆ° download, parse, biÃªn dá»‹châ€¦ cÃ³ thá»ƒ bá» qua. NÃ³ cho phÃ©p Chrome tiáº¿t kiá»‡m 40% thá»i gian parse &amp; thá»±c thi. ThÃªm ná»¯a, káº¿t quáº£ nÃ³ tiáº¿t kiá»‡m pin nhiá»u hÆ¡n náº¿u cháº¡y trÃªn cÃ¡c thiáº¿t bá»‹ mobile.</p><p>Trong Opera, engine <a href="https://dev.opera.com/blog/carakan/" target="_blank" rel="noopener">Carakan</a> cÃ³ thá»ƒ dÃ¹ng láº¡i káº¿t quáº£ biÃªn dá»‹ch tá»« chÆ°Æ¡ng trÃ¬nh khÃ¡c vá»«a má»›i Ä‘Æ°á»£c biÃªn dá»‹ch gáº§n Ä‘Ã¢y. KhÃ´ng cÃ³ cÃ¡c yÃªu cáº§u cá»¥ thá»ƒ nÃ o vá» viá»‡c code pháº£i Ä‘áº¿n tá»« cÃ¹ng 1 trang hay domain. Ká»¹ thuáº­t caching nÃ y thá»±c sá»± ráº¥t há»¯u Ã­ch vÃ  cÃ³ thá»ƒ hoÃ n toÃ n bá» qua bÆ°á»›c biÃªn dá»‹ch. NÃ³ phá»¥ thuá»™c vÃ o hÃ nh vi tiÃªu chuáº©n cá»§a user vÃ  ngá»¯ cáº£nh lÆ°Æ¡t web: má»—i khi user thá»±c hiá»‡n cÃ¹ng chuá»—i hÃ nh trÃ¬nh vá»›i má»™t user khÃ¡ch trÃªn app/website thÃ¬ cÃ¹ng 1 Ä‘oáº¡n code Javascript sáº½ Ä‘Æ°á»£c táº£i. Tuy nhiÃªn, Opera Ä‘Ã£ sá»›m thay tháº¿ Carakan báº±ng Google V8.</p><p>Bá»™ engine <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey" target="_blank" rel="noopener">SpiderMonkey</a> cá»§a Firefox khÃ´ng lÆ°u cache báº¥t ká»³ thá»© gÃ¬. NÃ³ Ä‘áº¡i khÃ¡i lÃ  chuyá»ƒn qua dÃ¹ng má»™t thao tÃ¡c giÃ¡m sÃ¡t Ä‘á»ƒ Ä‘áº¿m xem 1 Ä‘oáº¡n code Javascript Ä‘Æ°á»£c thá»±c thi bao nhiÃªu láº§n. Dá»±a trÃªn sá»‘ Ä‘áº¿m nÃ y nÃ³ xÃ¡c Ä‘á»‹nh pháº§n nÃ o cá»§a code Ä‘ang hot vÃ  cáº§n Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a.</p><p>RÃµ rÃ ng cÃ³ má»™t sá»‘ ngÆ°á»i lá»±a chá»n khÃ´ng lÃ m gÃ¬ cáº£. <a href="http://en.wikipedia.org/wiki/Maciej_Stachowiak" target="_blank" rel="noopener">Maciej Stachowiak</a>, lead developer cá»§a Safari, chá»‰ Ä‘á»‹nh ráº±ng Safari khÃ´ng thá»±c hiá»‡n báº¥t ká»³ hoáº¡t Ä‘á»™ng cache nÃ o cho bytecode Ä‘Ã£ biÃªn dá»‹ch. CÃ³ váº» nhÆ° há» Ä‘Ã£ cÃ³ cÃ¢n nháº¯c vá» viá»‡c nÃ y nhÆ°ng khÃ´ng triá»ƒn khai nÃ³ bá»Ÿi vÃ¬ nÃ³ chá»‰ nhá» hÆ¡n 2% tá»•ng thá»i gian thá»±c thi.</p><p>Nhá»¯ng hoáº¡t Ä‘á»™ng tá»‘i Æ°u hÃ³a khÃ´ng trá»±c tiáº¿p áº£nh hÆ°á»Ÿng Ä‘áº¿n chuyá»‡n parsing cá»§a code Javascript nhÆ°ng chÃºng cháº¯c cháº¯n Ä‘ang lÃ m tá»‘t nháº¥t cÃ³ thá»ƒ Ä‘á»ƒ bá» qua nÃ³ má»™t cÃ¡ch hoÃ n toÃ n. CÃ²n cÃ¡ch tá»‘i Æ°u hÃ³a nÃ o tá»‘t hÆ¡n lÃ  tá»‘i Æ°u hÃ³a hoÃ n toÃ n?</p><p>CÃ³ nhiá»u thá»© chÃºng ta cÃ³ thá»ƒ lÃ m Ä‘á»ƒ cáº£i thiá»‡n thá»i gian load app ban Ä‘áº§u. Ta cÃ³ thá»ƒ lÃ m tá»‘i giáº£n lÆ°á»£ng code Javascript Ä‘ang sá»­ dá»¥ng: Ã­t code, Ã­t parse, Ã­t thá»±c hi. Äá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u nÃ y, ta cáº§n Ä‘Æ°a ra vá»«a Ä‘Ãºng lÆ°á»£ng code cáº§n thiáº¿t cho má»™t tÃ­nh nÄƒng cá»¥ thá»ƒ thay vÃ¬ load 1 cá»¥c thiá»‡t to lá»›n vÃ  dÃ¹ng nÃ³ vÃ o má»i thá»©. VÃ­ dá»¥, pattern <a href="https://developers.google.com/web/fundamentals/performance/prpl-pattern/" target="_blank" rel="noopener">PRPL</a> cÃ³ thuyáº¿t giáº£ng vá» mÃ´ hÃ¬nh chuyá»ƒn giao code nhÆ° váº­y. NÃ³i cÃ¡ch khÃ¡c, ta cÃ³ thá»ƒ kiá»ƒm tra cÃ¡c dependency vÃ  xem náº¿u nhÆ° cÃ³ gÃ¬ Ä‘Ã³ thá»«a thÃ£i khÃ´ng cáº§n thiáº¿t lÃ m cháº­m code cá»§a chÃºng ta. Vá» pháº§n nÃ y thÃ¬ hi vá»ng lÃ  sáº½ cÃ³ 1 topic riÃªng Ä‘á»ƒ nÃ³i vá» nÃ³.</p><p>Má»¥c Ä‘Ã­ch cá»§a bÃ i viáº¿t nÃ y lÃ  Ä‘á»ƒ tháº£o luáº­n chÃºng ta - nhá»¯ng web developer - cÃ³ thá»ƒ lÃ m Ä‘Æ°á»£c gÃ¬ Ä‘á»ƒ giÃºp cho Javascript parser cÃ³ thá»ƒ cháº¡y nhanh hÆ¡n. VÃ  chÃ­nh lÃ  Ä‘Ã¢y, cÃ¡c Javascript parser hiá»‡n Ä‘áº¡i sá»­ dá»¥ng cÃ¡c phá»ng Ä‘oÃ¡n Ä‘á»ƒ xÃ¡c Ä‘á»‹nh náº¿u má»™t Ä‘oáº¡n code cá»¥ thá»ƒ nÃ o Ä‘Ã³ chuáº©n bá»‹ Ä‘Æ°á»£c thá»±c thi ngay hoáº·c quÃ¡ trÃ¬nh thá»±c thi sáº½ bá»‹ táº¡m ngÆ°ng vÃ  dá»i láº¡i trong má»™t thá»i Ä‘iá»ƒm khÃ¡c.</p><p>Dá»±a trÃªn cÃ¡c phá»ng Ä‘oÃ¡n, parser sáº½ lÃ m hoáº·c lÃ  eager parsing (parse nhanh) hoáº·c lÃ  lazy parsing (parse tá»« tá»«). Eager parsing cháº¡y xuyÃªn suá»‘t cÃ¡c hÃ m nÃ o cáº§n Ä‘Æ°á»£c biÃªn dá»‹ch tá»©c thá»i. NÃ³ thá»±c hiá»‡n 3 viá»‡c chÃ­nh: xÃ¢y dá»±ng cÃ¢y AST, xÃ¢y dá»±ng há»‡ thá»‘ng cáº¥p báº­c (hierarchy) cho scope vÃ  tÃ¬m táº¥t cáº£ cÃ¡c lá»—i cÃº phÃ¡p.</p><p>Lazy parsing thÃ¬ ngÆ°á»£c láº¡i, nÃ³ chá»‰ Ä‘Æ°á»£c dÃ¹ng cho cÃ¡c hÃ m chÆ°a cáº§n Ä‘Æ°á»£c biÃªn dá»‹ch. NÃ³ khÃ´ng xÃ¢y dá»±ng cÃ¢y AST vÃ  cÅ©ng khÃ´ng tÃ¬m lá»—i cÃº phÃ¡p. NÃ³ chá»‰ xÃ¢y dá»±ng há»‡ thá»‘ng cáº¥p báº­c cho scope vÃ  tiáº¿t kiá»‡m Ä‘Æ°á»£c má»™t ná»­a thá»i gian so vá»›i eager.</p><p>RÃµ rÃ ng Ä‘Ã¢y khÃ´ng pháº£i lÃ  Ã½ tÆ°á»Ÿng má»›i. Ká»ƒ cáº£ trÃ¬nh duyá»‡t nhÆ° IE9 cÅ©ng há»— trá»£ tá»‘i Æ°u hÃ³a máº·c dÃ¹ nÃ³ cháº¡y hÆ¡i thÃ´ sÆ¡ náº¿u nhÆ° so vá»›i cÃ¡ch mÃ  parser ngÃ y nay hoáº¡t Ä‘á»™ng.</p><p>Giá» thÃ¬ cÃ¹ng xem má»™t vÃ­ dá»¥ vá» cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng. Giáº£ sá»­ ta cÃ³ Ä‘oáº¡n code sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(baz(<span class="number">100</span>, <span class="number">200</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Giá»‘ng nhÆ° vÃ­ dá»¥ trÆ°á»›c, code Ä‘Æ°á»£c Ä‘Æ°a vÃ o parser Ä‘á»ƒ phÃ¢n tÃ­ch cÃº phÃ¡p vÃ  tráº£ ra cÃ¢y AST. Váº­y thÃ¬ Ä‘Ã¢y lÃ  nhá»¯ng gÃ¬ thá»±c hiá»‡n theo tá»«ng dÃ²ng:</p><p>Äá»‹nh nghÄ©a hÃ m bar nháº­n 1 biáº¿n x vÃ  nÃ³ cÃ³ 1 cÃ¢u lá»‡nh return tráº£ vá» káº¿t quáº£ cá»§a phÃ©p tÃ­nh cá»™ng giá»¯a x vÃ  10.</p><p>Äá»‹nh nghÄ©a hÃ m baz nháº­n 2 biáº¿n (x vÃ  y). NÃ³ cÃ³ 1 cÃ¢u lá»‡nh return. HÃ m nÃ y tráº£ vá» káº¿t quáº£ cá»§a phÃ©p tÃ­nh cá»™ng giá»¯a x vÃ  y.</p><p>Gá»i hÃ m baz vá»›i 2 Ä‘á»‘i sá»‘ lÃ  100 vÃ  200.</p><p>Táº¡o ra 1 lá»i gá»i hÃ m Ä‘áº¿n console.log vá»›i giÃ¡ trá»‹ lÃ  káº¿t quáº£ cá»§a lá»i gá»i hÃ m trÆ°á»›c Ä‘Ã³.</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*60xiqW7kPsQg5ssn." alt=""></p><p>Äiá»u gÃ¬ vá»«a xáº£y ra váº­y? Parser tháº¥y cÃ³ má»™t Ä‘á»‹nh nghÄ©a hÃ m foo, Ä‘á»‹nh nghÄ©a bar vÃ  1 hÃ m baz, má»™t lá»i gá»i Ä‘áº¿n hÃ m baz, má»™t lá»i gá»i Ä‘áº¿n hÃ m console.log. Chá» Ä‘Ã£â€¦ cÃ³ má»™t sá»‘ thá»© parser Ä‘Ã£ lÃ m hoÃ n toÃ n khÃ´ng liÃªn quan. ÄÃ³ lÃ  viá»‡c parse hÃ m bar. Táº¡i sao láº¡i khÃ´ng liÃªn quan? Bá»Ÿi vÃ¬ hÃ m bar chÆ°a bao giá» Ä‘Æ°á»£c gá»i (Ã­t nháº¥t lÃ  cho tá»›i thá»i Ä‘iá»ƒm nÃ y). ÄÃ¢y chá»‰ lÃ  má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n vÃ  cÃ³ váº» nhÆ° khÃ´ng bÃ¬nh thÆ°á»ng nhÆ°ng nÃ³ xuáº¥t hiá»‡n trÃªn ráº¥t nhiá»u app thá»±c, cÃ³ ráº¥t nhiá»u hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ°ng khÃ´ng bao giá» dÃ¹ng Ä‘áº¿n.</p><p>Thay vÃ¬ parse hÃ m bar, chÃºng ta cÃ³ thá»ƒ Ä‘Ã¡nh dáº¥u nÃ³ Ä‘Ã£ Ä‘Æ°á»£c khai bÃ¡o nhÆ°ng khÃ´ng chá»‰ ra cá»¥ thá»ƒ nÃ³ lÃ m gÃ¬. Parsing sáº½ diá»…n ra khi cáº§n thiáº¿t ngay trÆ°á»›c khi hÃ m Ä‘Æ°á»£c thá»±c thi. VÃ  dÄ© nhiÃªn lÃ  lazy parsing cÅ©ng váº«n cáº§n thiáº¿t Ä‘á»ƒ tÃ¬m toÃ n bá»™ body cá»§a hÃ m vÃ  táº¡o má»™t khai bÃ¡o cho hÃ m Ä‘Ã³. NÃ³ khÃ´ng cáº§n cÃ¢y cÃº phÃ¡p bá»Ÿi vÃ¬ nÃ³ váº«n chÆ°a Ä‘Æ°á»£c xá»­ lÃ½. ThÃªm ná»¯a, bá»™ nhá»› heap váº«n chÆ°a Ä‘Æ°á»£c cáº¥p phÃ¡t (pháº§n nÃ y cÅ©ng chiáº¿m 1 lÆ°á»£ng tÆ°Æ¡ng Ä‘á»‘i trong tÃ i nguyÃªn há»‡ thá»‘ng). NÃ³i ngáº¯n gá»n thÃ¬ bá» qua má»™t sá»‘ bÆ°á»›c trÃªn sáº½ cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ hiá»‡u nÄƒng.</p><p>Váº­y nÃªn nhÃ¬n láº¡i vÃ­ dá»¥ trÃªn, ta cÃ³ cÃ¢y AST má»›i sáº½ nhÆ° tháº¿ nÃ y:<br><img src="https://cdn-images-1.medium.com/max/1000/0*IN688nPbgu8zYETe." alt=""></p><p>LÆ°u Ã½ ráº±ng hÃ m bar Ä‘Æ°á»£c khai bÃ¡o vÃ  cháº¥p nháº­n, nhÆ°ng chá»‰ cÃ³ tháº¿ thÃ´i. ChÃºng ta khÃ´ng lÃ m gÃ¬ vá»›i body cá»§a hÃ m. Trong trÆ°á»ng há»£p nÃ y, body cá»§a hÃ m chá»‰ cÃ³ 1 cÃ¢u lá»‡nh return. Tuy nhiÃªn, trong háº§u háº¿t cÃ¡c á»©ng dá»¥ng thá»±c táº¿, nÃ³ cÃ³ thá»ƒ lá»›n hÆ¡n ráº¥t nhiá»u, bao gá»“m nhiá»u cÃ¢u lá»‡nh return, Ä‘iá»n kiá»‡n, vÃ²ng láº·p, Ä‘á»‹nh nghÄ©a cÃ¡c biáº¿n vÃ  ká»ƒ cáº£ cÃ¡c khai bÃ¡o hÃ m lá»“ng nhau. Táº¥t cáº£ nhá»¯ng thá»© nÃ y sáº½ gÃ¢y tá»‘n thá»i gian cÅ©ng nhÆ° tÃ i nguyÃªn há»‡ thá»‘ng bá»Ÿi vÃ¬ hÃ m khÃ´ng bao giá» Ä‘Æ°á»£c gá»i.</p><p>ÄÃ¢y lÃ  má»™t Ã½ tÆ°á»Ÿng cá»±c ká»³ Ä‘Æ¡n giáº£n nhÆ°ng trong thá»±c táº¿ cÃ´ng viá»‡c thÃ¬ viá»‡c triá»ƒn khai nÃ³ láº¡i khÃ´ng Ä‘Æ¡n giáº£n. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ­ dá»¥ mÃ  cháº¯c cháº¯n khÃ´ng pháº£i lÃ  trÆ°á»ng há»£p duy nháº¥t. ToÃ n bá»™ phÆ°Æ¡ng thá»©c sá»­ dá»¥ng cÃ¡c hÃ m, vÃ²ng láº·p, Ä‘iá»u kiá»‡n, object, vÃ¢n vÃ¢n. CÆ¡ báº£n lÃ  toÃ n bá»™ code cáº§n Ä‘Æ°á»£c parse.</p><p>VÃ­ dá»¥ má»™t mÃ´ hÃ¬nh phá»• biáº¿n Ä‘á»ƒ triá»ƒn khai Javascript module:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myModule = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// toÃ n bá»™ logic cá»§a module</span></span><br><span class="line">    <span class="comment">// return vá» module.</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>MÃ´ hÃ¬nh nÃ y dá»… dÃ ng nháº­n ra bá»Ÿi cÃ¡c Javascript parser hiá»‡n Ä‘áº¡i vÃ  lÃ  má»™t dáº¥u hiá»‡u cho tháº¥y code bÃªn trong cÃ³ thá»ƒ dÃ¹ng eager parsing.</p><p>Váº­y táº¡i sao parser khÃ´ng máº·c Ä‘á»‹nh lazy parsing? Náº¿u cÃ³ gÃ¬ Ä‘Ã³ Ä‘Æ°á»£c parse lazy thÃ¬ nÃ³ pháº£i Ä‘Æ°á»£c thá»±c thi ngay láº­p tá»©c vÃ  Ä‘iá»u nÃ y thá»±c sá»± gÃ¢y ra sá»± cháº­m cháº¡p. Má»™t lazy parse Ä‘Æ°á»£c thá»±c hiá»‡n vÃ  ngay sau Ä‘Ã³ lÃ  eager parse. Káº¿t quáº£ lÃ  tá»‘c Ä‘á»™ cháº­m hÆ¡n 50% khi so sÃ¡nh vá»›i chá»‰ dÃ¹ng 1 eager parse.</p><p>Äáº¿n lÃºc nÃ y ta Ä‘Ã£ cÃ³ kiáº¿n thá»©c cÆ¡ báº£n vá» phÃ­a háº­u trÆ°á»ng, giá» thÃ¬ thá»­ xem chÃºng ta cÃ³ giÃºp gÃ¬ cho parser Ä‘Æ°á»£c khÃ´ng. Ta cÃ³ thá»ƒ viáº¿t code theo cÃ¡ch mÃ  cÃ¡c hÃ m cÃ³ thá»ƒ Ä‘Æ°á»£c parse táº¡i thá»i Ä‘iá»ƒm phÃ¹ há»£p. CÃ³ má»™t pattern Ä‘Æ°á»£c xÃ i chung giá»¯a cÃ¡c parser: Ä‘Ã³ng gÃ³i hÃ m bÃªn trong dáº¥u ngoáº·c (). ÄÃ¢y luÃ´n lÃ  má»™t dáº¥u hiá»‡u tÃ­ch cá»±c cho parser hiá»ƒu ráº±ng hÃ m sáº½ Ä‘Æ°á»£c thá»±c thi ngay láº­p tá»©c. Náº¿u parser báº¯t gáº·p má»™t dáº¥u má»Ÿ ngoáº·c ( vÃ  ngay liá»n sau Ä‘Ã³ lÃ  má»™t Ä‘á»‹nh nghÄ©a hÃ m, nÃ³ sáº½ parse eager hÃ m Ä‘Ã³. ChÃºng ta cÃ³ thá»ƒ giÃºp parser báº±ng cÃ¡ch khai bÃ¡o hÃ m má»™t cÃ¡ch tÆ°á»ng minh nhÆ° váº­y hÃ m sáº½ Ä‘Æ°á»£c thá»±c thi ngay láº­p tá»©c.</p><p>Giáº£ sá»­ ta cÃ³ hÃ m Javascript nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Bá»Ÿi vÃ¬ khÃ´ng cÃ³ dáº¥u hiá»‡u rÃµ rÃ ng ráº±ng hÃ m sáº½ Ä‘Æ°á»£c thá»±c thi ngay láº­p tá»©c nÃªn trÃ¬nh duyá»‡t sáº½ thá»±c hiá»‡n lazy parse. Tuy nhiÃªn, chÃºng ta biáº¿t ráº±ng nhÆ° váº­y lÃ  khÃ´ng Ä‘Ãºng nÃªn ta cÃ³ thá»ƒ lÃ m 2 viá»‡c.</p><p>Äáº§u tiÃªn, ta lÆ°u hÃ m vÃ o trong 1 biáº¿n:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">10</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>LÆ°u Ã½ ráº±ng ta váº«n giá»¯ láº¡i tÃªn hÃ m foo giá»¯a tá»« khÃ³a function vÃ  dáº¥u má»Ÿ ngoáº·c (. Äiá»u nÃ y tuy khÃ´ng cáº§n thiáº¿t nhÆ°ng báº¡n bÃªn lÃ m vÃ¬ trong trÆ°á»ng há»£p xá»­ lÃ½ biá»‡t lá»‡, stacktrace sáº½ hiá»‡n ra tÃªn cá»¥ thá»ƒ cá»§a hÃ m thay vÃ¬ má»™t chá»¯ <anonymous> khÃ´ khan.</anonymous></p><p>Parser váº«n thá»±c hiá»‡n lazy parse. Ta cÃ³ thá»ƒ ngÄƒn cháº·n Ä‘iá»u nÃ y báº±ng cÃ¡ch thÃªm má»™t chi tiáº¿t nhá»: gÃ³i hÃ m Ä‘Ã³ láº¡i trong dáº¥u ngoáº·c.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = (<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Táº¡i thá»i Ä‘iá»ƒm nÃ y, khi parser tháº¥y dáº¥u má»Ÿ ngoáº·c ( ngay trÆ°á»›c tá»« khÃ³a function nÃ³ sáº½ ngay láº­p tá»©c thá»±c hiá»‡n eager parsing.</p><p>Sáº½ hÆ¡i khÃ³ Ä‘á»ƒ quáº£n lÃ½ bá»Ÿi vÃ¬ chÃºng ta sáº½ cáº§n pháº£i biáº¿t trong trÆ°á»ng há»£p nÃ o thÃ¬ parser chá»n parse lazy hay eager. ThÃªm ná»¯a ta cáº§n pháº£i suy nghÄ© vÃ  tÃ¬m hiá»ƒu má»™t hÃ m cá»¥ thá»ƒ nÃ o Ä‘Ã³ cÃ³ Ä‘Æ°á»£c gá»i ngay láº­p tá»©c hay khÃ´ng. ChÃºng ta cháº¯c cháº¯n khÃ´ng muá»‘n lÃ m váº­y. Ãt nháº¥t thÃ¬ nÃ³ sáº½ lÃ m cho code khÃ³ Ä‘á»c &amp; khÃ³ hiá»ƒu hÆ¡n. CÃ´ng cá»¥ nhÆ° Optimize.js cÃ³ thá»ƒ giÃºp ta ráº¥t nhiá»u. Má»¥c Ä‘Ã­ch duy nháº¥t cá»§a nÃ³ lÃ  tá»‘i Æ°u hÃ³a thá»i gian loaing ban Ä‘áº§u cá»§a code Javascript. ChÃºng thá»±c hiá»‡n phÃ¢n tÃ­ch code tÄ©nh vÃ  chá»‰nh sá»­a láº¡i Ä‘á»ƒ Ä‘Ã³ng gÃ³i nhá»¯ng hÃ m nÃ o cáº§n Ä‘Æ°á»£c thá»±c thi bÃªn trong dáº¥u ngoáº·c (), trÃ¬nh duyá»‡t sáº½ cÃ³ thá»ƒ parse eager vÃ  chuáº©n bá»‹ chÃºng sáºµn sÃ ng Ä‘á»ƒ thá»±c thi.</p><p>ChÃºng ta cÃ³ thá»ƒ tiáº¿p tá»¥c code bÃ¬nh thÆ°á»ng vÃ  cÃ³ Ä‘c Ä‘oáº¡n code sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello, World!'</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>Má»i thá»© cÃ³ váº» tá»‘t, hoáº¡t Ä‘á»™ng Ä‘Ãºng nhÆ° mong Ä‘á»£i vÃ  nhanh ná»¯a. Bá»Ÿi vÃ¬ cÃ³ dáº¥u má»Ÿ ngoáº·c ( trÆ°á»›c khi khai bÃ¡o hÃ m. Ráº¥t tuyá»‡t. DÄ© nhiÃªn rá»“i, trÆ°á»›c khi Ä‘Æ°a lÃªn production ta cáº§n minify Ä‘á»ƒ tiáº¿t kiá»‡m dung lÆ°á»£ng. Äoáº¡n code sau lÃ  sáº£n pháº©m cuá»‘i cÃ¹ng:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'Hello, World!'</span>)&#125;();</span><br></pre></td></tr></table></figure><p>Má»™t láº§n ná»¯a, chÃºng cÃ³ váº» tá»‘t pháº£i khÃ´ng? Code hoáº¡t Ä‘á»™ng y nhÆ° cÅ©. NhÆ°ng cÃ³ gÃ¬ Ä‘Ã³ thiáº¿u thiáº¿u. TrÃ¬nh minify Ä‘Ã£ gá»¡ dáº¥u ngoáº·c Ä‘Ã³ng gÃ³i bÃªn ngoÃ i hÃ m vÃ  thay vÃ o Ä‘Ã³ thÃªm 1 dáº¥u cháº¥m than ! ngay trÆ°á»›c hÃ m. Äiá»u nÃ y nghÄ©a lÃ  parser sáº½ bá» qua nÃ³ vÃ  thá»±c hiá»‡n lazy parse. TrÃªn háº¿t thÃ¬ Ä‘á»ƒ cÃ³ thá»ƒ thá»±c thi hÃ m nÃ³ sáº½ thá»±c hiá»‡n eager parse ngay sau khi lazy parse. Váº­y thÃ¬ láº¡i lÃ m code cháº¡y cháº­m hÆ¡n. May máº¯n thay, chÃºng ta cÃ³ nhá»¯ng cÃ´ng cá»¥ nhÆ° Optimize.js giÃºp ta trong nhá»¯ng trÆ°á»ng há»£p nÃ y. Truyá»n Ä‘oáº¡n code Ä‘Ã£ minify vÃ o Optimize.js vÃ  Ä‘Ã¢y lÃ  káº¿t quáº£ Ä‘áº§u ra:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'Hello, World!'</span>)&#125;)();</span><br></pre></td></tr></table></figure><p>Giá» thÃ¬ ta Ä‘Ã£ cÃ³ thÃ nh pháº©m tá»‘t nháº¥t: code Ä‘Æ°á»£c minify vÃ  parser dá»… dÃ ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c nhá»¯ng hÃ m nÃ o cáº§n parse eager hÃ m nÃ o cáº§n parse lazy.</p><h1 id="Bien-dich-truoc-Pre-compilation"><a href="#Bien-dich-truoc-Pre-compilation" class="headerlink" title="BiÃªn dá»‹ch trÆ°á»›c (Pre-compilation)"></a>BiÃªn dá»‹ch trÆ°á»›c (Pre-compilation)</h1><p>Váº­y táº¡i sao ta khÃ´ng thá»±c hiá»‡n toÃ n bá»™ cÃ¡c bÆ°á»›c nÃ y á»Ÿ phÃ­a server. DÄ© nhiÃªn thÃ¬ sáº½ tá»‘t hÆ¡n náº¿u chÃºng ta thá»±c hiá»‡n 1 láº§n rá»“i triá»ƒn khai káº¿t quáº£ cho táº¥t cáº£ client, thay vÃ¬ báº¯t má»—i client pháº£i thá»±c hiá»‡n nÃ³ má»—i láº§n cháº¡y. Tháº­t ra thÃ¬ cÃ³ nhá»¯ng tháº£o luáº­n vá» viá»‡c engine nÃªn cung cáº¥p má»™t cÃ¡ch Ä‘á»ƒ thá»±c thi nhá»¯ng Ä‘oáº¡n code Ä‘Ã£ Ä‘Æ°á»£c biÃªn dá»‹ch trÆ°á»›c Ä‘á»ƒ Ä‘á»¡ tá»‘n thá»i gian cho trÃ¬nh duyá»‡t.</p><p>Vá» báº£n cháº¥t thÃ¬ Ã½ tÆ°á»Ÿng chÃ­nh lÃ  cÃ³ má»™t cÃ´ng cá»¥ á»Ÿ phÃ­a server cÃ³ thá»ƒ sinh ra bytecode rá»“i truyá»n trá»±c tiáº¿p vá» phÃ­a client vÃ  thá»±c thi. Náº¿u thá»±c sá»± Ä‘Æ°á»£c nhÆ° váº­y thÃ¬ thá»i gian khá»Ÿi Ä‘á»™ng app phÃ­a client sáº½ Ä‘Æ°á»£c cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ. Nghe ráº¥t háº¥p dáº«n, nhÆ°ng má»i viá»‡c khÃ´ng Ä‘Æ¡n giáº£n nhÆ° váº­y.</p><p>Äiá»u nÃ y cÃ³ thá»ƒ gÃ¢y ra hiá»‡u á»©ng ngÆ°á»£c láº¡i, hiá»‡u á»©ng lá»›n lÃ  Ä‘áº±ng khÃ¡c, vÃ¬ háº§u háº¿t code cÃ³ thá»ƒ sáº½ cáº§n pháº£i Ä‘Æ°á»£c kÃ½ &amp; xá»­ lÃ½ vÃ¬ nhá»¯ng lÃ½ do báº£o máº­t. Äá»™i ngÅ© V8 Ä‘ang lÃ m viá»‡c ná»™i bá»™ vá»›i nhau Ä‘á»ƒ trÃ¡nh re-parsing Ä‘á»ƒ quÃ¡ trÃ¬nh biÃªn dá»‹ch trÆ°á»›c sáº½ cÃ³ lá»£i Ã­ch nhÆ° tháº¿.</p><h1 id="Mot-vai-meo-vat-ban-co-the-thuc-hien-de-app-chay-nhanh-hon"><a href="#Mot-vai-meo-vat-ban-co-the-thuc-hien-de-app-chay-nhanh-hon" class="headerlink" title="Má»™t vÃ i máº¹o váº·t báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n Ä‘á»ƒ app cháº¡y nhanh hÆ¡n"></a>Má»™t vÃ i máº¹o váº·t báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n Ä‘á»ƒ app cháº¡y nhanh hÆ¡n</h1><ul><li>Kiá»ƒm tra cÃ¡c dependency. Loáº¡i bá» nhá»¯ng thá»© khÃ´ng cáº§n thiáº¿t.</li><li>Chia nhá» code thÃ nh nhiá»u pháº§n nhá» hÆ¡n thay vÃ¬ load nguyÃªn 1 cá»¥c bá»±.</li><li>TrÃ¬ hoÃ£n quÃ¡ trÃ¬nh load Javascript náº¿u cÃ³ thá»ƒ. Báº¡n chá»‰ cáº§n load pháº§n code nÃ o cáº§n thiáº¿t dá»±a trÃªn route hiá»‡n táº¡i mÃ  thÃ´i.</li><li>DÃ¹ng dev tool &amp; DeviceTiming Ä‘á»ƒ tÃ¬m hiá»ƒu pháº§n nÃ o Ä‘ang bá»‹ tháº¯t cá»• chai.</li><li>DÃ¹ng cÃ´ng cá»¥ nhÆ° Optimize.js Ä‘á»ƒ giÃºp parser quyáº¿t Ä‘á»‹nh khi nÃ o nÃªn parse eager &amp; lazy.</li></ul><p>SessionStack lÃ  cÃ´ng cá»¥ há»— trá»£ tÃ¡i táº¡o láº¡i má»i thá»© xáº£y ra Ä‘á»‘i vá»›i ngÆ°á»i dÃ¹ng cuá»‘i táº¡i thá»i Ä‘iá»ƒm há» gáº·p pháº£i váº¥n Ä‘á» khi Ä‘ang tÆ°Æ¡ng tÃ¡c vá»›i webapp. CÃ´ng cá»¥ nÃ y khÃ´ng dá»±ng láº¡i phiÃªn lÃ m viá»‡c Ä‘Ã³ thÃ nh 1 video tháº­t mÃ  chá»‰ giáº£ láº­p táº¥t cáº£ cÃ¡c sá»± kiá»‡n trong má»™t mÃ´i trÆ°á»ng sandbox trÃªn trÃ¬nh duyá»‡t. Äiá»u nÃ y cÃ³ Ã½ nghÄ©a nháº¥t Ä‘á»‹nh, vÃ­ dá»¥ trong trÆ°á»ng há»£p codebase cá»§a page hiá»‡n táº¡i lá»›n vÃ  phá»©c táº¡p.</p><p>Nhá»¯ng ká»¹ thuáº­t trÃªn lÃ  nhá»¯ng thá»© mÃ  team tÃ¡c giáº£ gáº§n Ä‘Ã¢y káº¿t há»£p trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn SessionStack. Nhá»¯ng tá»‘i Æ°u hÃ³a Ä‘Ã³ cho phÃ©p há» load SessionStack nhanh hÆ¡n. SessionStack cháº¡y cÃ ng nhanh nÃ³ cÃ ng cÃ³ thá»ƒ giáº£i phÃ³ng tÃ i nguyÃªn cá»§a trÃ¬nh duyá»‡t nhanh hÆ¡n vÃ  mang láº¡i tráº£i nghiá»‡m má»™t cÃ¡ch liÃªn tá»¥c &amp; tá»± nhiÃªn cho ngÆ°á»i dÃ¹ng khi há» load &amp; xem láº¡i cÃ¡c session lÃ m viá»‡c.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 14 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;h1 id=&quot;Khai-quat&quot;&gt;&lt;a href=&quot;#Khai-quat&quot; class=&quot;headerlink&quot; title=&quot;KhÃ¡i quÃ¡t&quot;&gt;&lt;/a&gt;KhÃ¡i quÃ¡t&lt;/h1&gt;&lt;p&gt;ChÃºng ta Ä‘á»u biáº¿t ráº±ng nhá»¯ng thá»© lá»™n xá»™n cÃ³ thá»ƒ há»£p thÃ nh 1 thá»© lá»›n hÆ¡n gá»i lÃ  Javascript. Má»™t Ä‘oáº¡n code khÃ´ng chá»‰ cÃ³ thá»ƒ di chuyá»ƒn qua máº¡ng mÃ  nÃ³ cÃ²n pháº£i Ä‘Æ°á»£c parse, biÃªn dá»‹ch sang bytecode vÃ  cuá»‘i cÃ¹ng thá»±c thi. Trong cÃ¡c bÃ i trÆ°á»›c, chÃºng ta Ä‘Ã£ tháº£o luáº­n vá» nhá»¯ng thá»© cháº³ng háº¡n nhÆ° JS engine, runtime, callstack cÅ©ng nhÆ° engine V8 Ä‘Æ°á»£c dÃ¹ng chá»§ yáº¿u trong Chrome vÃ  NodeJS. Táº¥t cáº£ Ä‘á»u Ä‘Ã³ng vai trÃ² quan trá»ng trong toÃ n bá»™ quÃ¡ trÃ¬nh thá»±c thi cá»§a Javascript. Chá»§ Ä‘á» mÃ  chÃºng ta sáº½ tÃ¬m hiá»ƒu hÃ´m nay cÅ©ng khÃ´ng kÃ©m quan trá»ng: chÃºng ta sáº½ nghiÃªn cá»©u xem lÃ m tháº¿ nÃ o mÃ  Ä‘a sá»‘ cÃ¡c engine JS parse vÄƒn báº£n thÃ nh má»™t thá»© gÃ¬ Ä‘Ã³ cÃ³ nghÄ©a Ä‘á»‘i vá»›i mÃ¡y mÃ³c, nhá»¯ng gÃ¬ xáº£y ra sau Ä‘Ã³ vÃ  lÃ m tháº¿ nÃ o Ä‘á»ƒ web developer nhÆ° chÃºng ta cÃ³ thá»ƒ táº­n dá»¥ng nhá»¯ng kiáº¿n thá»©c Ä‘Ã³ lÃ m Ä‘iá»ƒm máº¡nh.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P13: BÃªn trong CSS &amp; JS animation &amp; cÃ¡c giáº£i phÃ¡p tá»‘i Æ°u hiá»‡u nÄƒng cá»§a nÃ³</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P13-Ben-trong-CSS-JS-animation-cac-giai-phap-toi-uu-hieu-nang-cua-no.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P13-Ben-trong-CSS-JS-animation-cac-giai-phap-toi-uu-hieu-nang-cua-no.html</id>
    <published>2018-11-25T09:11:00.000Z</published>
    <updated>2018-11-25T09:14:13.336Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 13 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>Má»i ngÆ°á»i Ä‘Ã£ biáº¿t rÃµ animation Ä‘Ã³ng vai trÃ² cáº§n thiáº¿t trong viá»‡c táº¡o ra cÃ¡c webapp háº¥p dáº«n. Khi ngÆ°á»i dÃ¹ng dáº§n dáº§n chuyá»ƒn sá»± chÃº Ã½ cá»§a há» sang UX vÃ  cÃ¡c doanh nghiá»‡p báº¯t Ä‘áº§u nháº­n ra sá»± quan trá»ng cá»§a tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng thÃº vá»‹ &amp; hoÃ n háº£o thÃ¬ cÃ¡c á»©ng dá»¥ng web dáº§n trá»Ÿ nÃªn náº·ng ná» hÆ¡n &amp; cáº§n thá»ƒ hiá»‡n nhiá»u UI Ä‘á»™ng hÆ¡n. Táº¥t cáº£ nhá»¯ng thá»© nÃ y cáº§n Ä‘áº¿n cÃ¡c animation phá»©c táº¡p Ä‘á»ƒ táº¡o ra cÃ¡c chuyá»ƒn dá»‹ch tráº¡ng thÃ¡i mÆ°á»£t mÃ  xuyÃªn suá»‘t hÃ nh trÃ¬nh tráº£i nghiá»‡m cá»§a ngÆ°á»i dÃ¹ng. Giá» Ä‘Ã¢y thÃ¬ Ä‘iá»u Ä‘Ã³ khÃ´ng cÃ²n lÃ  thá»© gÃ¬ Ä‘áº·c biá»‡t ná»¯a. User cÃ ng lÃºc cÃ ng giá»i vÃ  há» mong Ä‘á»£i á»Ÿ nhá»¯ng giao diá»‡n ngÆ°á»i dÃ¹ng cÃ³ tÃ­nh tÆ°Æ¡ng tÃ¡c vÃ  pháº£n há»“i cao.</p><p>Tuy nhiÃªn animating giao diá»‡n khÃ´ng nháº¥t thiáº¿t pháº£i Ä‘Æ¡n giáº£n, minh báº¡ch. Thá»© gÃ¬ cáº§n Ä‘Æ°á»£c animated, khi nÃ o vÃ  cáº£m giÃ¡c mÃ  má»™t animation mang láº¡i, Ä‘Ã³ má»›i lÃ  nhá»¯ng cÃ¢u há»i khÃ³ tráº£ lá»i.<br><a id="more"></a></p><h1 id="So-sanh-Javascript-amp-CSS-animation"><a href="#So-sanh-Javascript-amp-CSS-animation" class="headerlink" title="So sÃ¡nh Javascript &amp; CSS animation"></a>So sÃ¡nh Javascript &amp; CSS animation</h1><p>CÃ³ 2 phÆ°Æ¡ng phÃ¡p chÃ­nh Ä‘á»ƒ táº¡o web animation lÃ  dÃ¹ng Javascript hoáº·c CSS. KhÃ´ng cÃ³ lá»±a chá»n nÃ o Ä‘Ãºng hay sai cáº£, táº¥t cáº£ tÃ¹y thuá»™c vÃ o thá»© mÃ  báº¡n muá»‘n Ä‘áº¡t Ä‘Æ°á»£c.</p><h2 id="Animate-voi-CSS"><a href="#Animate-voi-CSS" class="headerlink" title="Animate vá»›i CSS"></a>Animate vá»›i CSS</h2><p>Animating vá»›i CSS lÃ  cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t Ä‘á»ƒ lÃ m má»™t thá»© gÃ¬ Ä‘Ã³ chuyá»ƒn Ä‘á»™ng trÃªn mÃ n hÃ¬nh.</p><p>ChÃºng ta sáº½ báº¯t Ä‘áº§u vá»›i má»™t vÃ­ dá»¥ nhanh vá» viá»‡c di chuyá»ƒn má»™t pháº§n tá»­ 50px theo cáº£ 2 trá»¥c X vÃ  Y. CÃ³ thá»ƒ thá»±c hiá»‡n báº±ng cÃ¡ch Ä‘áº·t má»™t CSS transition vá»›i thá»i gian 1000ms.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">translate</span>(0, 0);</span><br><span class="line">  <span class="attribute">-webkit-transition</span>: -webkit-transform <span class="number">1000ms</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(0, 0);</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">1000ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span><span class="selector-class">.move</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">translate</span>(50px, 50px);</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(50px, 50px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Khi class move Ä‘Æ°á»£c thÃªm vÃ o, giÃ¡ trá»‹ transform bá»‹ thay Ä‘á»•i vÃ  transition báº¯t Ä‘áº§u.</p><p>BÃªn cáº¡nh transition duration (thá»i gian dá»‹ch chuyá»ƒn), cÃ³ nhá»¯ng tÃ¹y chá»n cho <strong>easing</strong>, vá» báº£n cháº¥t thÃ¬ Ä‘Ã¢y lÃ  cáº£m giÃ¡c cá»§a animation. ChÃºng ta sáº½ tÃ¬m hiá»ƒu easing chi tiáº¿t hÆ¡n trong cÃ¡c pháº§n sau cá»§a bÃ i viáº¿t nÃ y.</p><p>Náº¿u nhÆ° trong Ä‘oáº¡n code trÃªn, báº¡n táº¡o ra nhá»¯ng class CSS riÃªng biá»‡t Ä‘á»ƒ quáº£n lÃ½ animation thÃ¬ báº¡n cÃ³ thá»ƒ dÃ¹ng Javascript Ä‘á»ƒ táº¯t/má»Ÿ má»—i animation.</p><p>Náº¿u nhÆ° báº¡n cÃ³ pháº§n tá»­ sau:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">  Sample content.</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Báº¡n cÃ³ thá»ƒ dÃ¹ng Javascript Ä‘á»ƒ táº¯t/má»Ÿ animation cá»§a nÃ³:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> boxElements = <span class="built_in">document</span>.getElementsByClassName(<span class="string">'box'</span>),</span><br><span class="line">    boxElementsLength = boxElements.length,</span><br><span class="line">    i;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; boxElementsLength; i++) &#123;</span><br><span class="line">  boxElements[i].classList.add(<span class="string">'move'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Äoáº¡n code trÃªn láº¥y táº¥t cáº£ nhá»¯ng pháº§n tá»­ cÃ³ class box vÃ  thÃªm class move vÃ o Ä‘á»ƒ trigger animation.</p><p>LÃ m nhÆ° tháº¿ nÃ y táº¡o sá»± cÃ¢n báº±ng cho app cá»§a báº¡n. Báº¡n cÃ³ thá»ƒ táº­p trung vÃ o quáº£n lÃ½ tráº¡ng thÃ¡i vá»›i Javascript vÃ  chá»‰ cáº§n Ä‘Æ¡n giáº£n Ä‘áº·t nhá»¯ng class thÃ­ch há»£p vÃ o pháº§n tá»­ cáº§n pháº£i Ä‘áº·t, Ä‘á»ƒ cho trÃ¬nh duyá»‡t xá»­ lÃ½ cÃ¡c animation. Náº¿u báº¡n tiáº¿p tá»¥c tÃ¬m hiá»ƒu theo hÆ°á»›ng nÃ y, báº¡n cÃ³ thá»ƒ listen sá»± kiá»‡n transitioned trÃªn má»—i pháº§n tá»­, nhÆ°ng chá»‰ náº¿u nhÆ° báº¡n pháº£i support cho máº¥y phiÃªn báº£n cÅ© cá»§a IE:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*Qm9OFPq3siW0tCKfa03DqQ.png" alt=""></p><p>Listen sá»± kiá»‡n transitioned (Ä‘Æ°á»£c báº¯n ra táº¡i cuá»‘i thá»i Ä‘iá»ƒm transition) giá»‘ng nhÆ° tháº¿ nÃ y:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> boxElement = <span class="built_in">document</span>.querySelector(<span class="string">'.box'</span>); <span class="comment">// Láº¥y pháº§n tá»­ Ä‘áº§u tiÃªn cÃ³ class `box`</span></span><br><span class="line">boxElement.addEventListener(<span class="string">'transitionend'</span>, onTransitionEnd, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onTransitionEnd</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Xá»­ lÃ½ sá»± kiá»‡n transition Ä‘Ã£ hoÃ n thÃ nh.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ThÃªm ná»¯a, khi sá»­ dá»¥ng CSS transition, báº¡n cÃ³ thá»ƒ dÃ¹ng CSS animation, nÃ³ cho phÃ©p báº¡n cÃ³ quyá»n nhiá»u hÆ¡n Ä‘á»ƒ kiá»ƒm soÃ¡t má»—i animation keyframe, duration vÃ  iteration.</p><blockquote><p>Keyframes Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ hÆ°á»›ng dáº«n chá»‰ Ä‘á»‹nh trÃ¬nh duyá»‡t nhá»¯ng giÃ¡ trá»‹ cá»§a thuá»™c tÃ­nh CSS cáº§n pháº£i cÃ³ táº¡i má»—i thá»i Ä‘iá»ƒm nháº¥t Ä‘á»‹nh vÃ  nÃ³ sáº½ giÃºp xá»­ lÃ½ pháº§n cÃ²n láº¡i.</p></blockquote><p>VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ÄÃ¢y lÃ  phiÃªn báº£n Ä‘Æ¡n giáº£n, khÃ´ng cÃ³ </span></span><br><span class="line"><span class="comment"> * tiá»n tá»‘ vendor. Náº¿u cÃ³ thÃªm chÃºng thÃ¬ </span></span><br><span class="line"><span class="comment"> * sáº½ cÃ²n dÃ i dÃ²ng hÆ¡n ná»¯a.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">.box &#123;</span><br><span class="line">  <span class="comment">/* Chá»n animation */</span></span><br><span class="line">  animation-name: movingBox;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* duration cá»§a animation */</span></span><br><span class="line">  animation-duration: <span class="number">2300</span>ms;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* sá»‘ láº§n mÃ  ta muá»‘n animation cháº¡y */</span></span><br><span class="line">  animation-iteration-count: infinite;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* lÃ m cho animation Ä‘áº£o ngÆ°á»£c vÃ o má»—i vÃ²ng láº·p láº» */</span></span><br><span class="line">  animation-direction: alternate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@keyframes movingBox &#123;</span><br><span class="line">  <span class="number">0</span>% &#123;</span><br><span class="line">    transform: translate(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    opacity: <span class="number">0.4</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">25</span>% &#123;</span><br><span class="line">    opacity: <span class="number">0.9</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">50</span>% &#123;</span><br><span class="line">    transform: translate(<span class="number">150</span>px, <span class="number">200</span>px);</span><br><span class="line">    opacity: <span class="number">0.2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">100</span>% &#123;</span><br><span class="line">    transform: translate(<span class="number">40</span>px, <span class="number">30</span>px);</span><br><span class="line">    opacity: <span class="number">0.8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Animation trÃ´ng nhÆ° tháº¿ nÃ y Ä‘Ã¢y: <a href="https://sessionstack.github.io/blog/demos/keyframes/" target="_blank" rel="noopener">https://sessionstack.github.io/blog/demos/keyframes/</a></p><p>Vá»›i CSS animation, báº¡n Ä‘á»‹nh nghÄ©a chÃ­nh animation Ä‘á»™c láº­p vá»›i pháº§n tá»­ Ä‘Ã­ch vÃ  sá»­ dá»¥ng thuá»™c tÃ­nh animation-name Ä‘á»ƒ chá»n animation Ä‘Æ°á»£c yÃªu cáº§u.</p><p>CÃ¡c CSS animation pháº§n nÃ o Ä‘Æ°á»£c Ä‘áº·t sáºµn tiá»n tá»‘ vender, vá»›i -webkit- Ä‘ang Ä‘Æ°á»£c sá»­ dá»¥ng trong Safari, Safari Mobile vÃ  Android. Chrome, Opera, Internet Explorer vÃ  Firefox táº¥t cáº£ Ä‘á»u khÃ´ng cÃ³ sáºµn tiá»n tá»‘. Nhiá»u cÃ´ng cá»¥ cÃ³ thá»ƒ giÃºp báº¡n thÃªm phiÃªn báº£n tiá»n tá»‘ cá»§a CSS mÃ  báº¡n cáº§n, cho phÃ©p báº¡n viáº¿t code mÃ  khÃ´ng cáº§n pháº£i thÃªm tiá»n tá»‘.</p><h2 id="Animate-voi-Javascript"><a href="#Animate-voi-Javascript" class="headerlink" title="Animate vá»›i Javascript"></a>Animate vá»›i Javascript</h2><p>Táº¡o animation vá»›i Javascript phá»©c táº¡p hÆ¡n nhiá»u so vá»›i sá»­ dá»¥ng CSS transition hay animation nhÆ°ng thÆ°á»ng thÃ¬ nÃ³ cung cáº¥p cho developer nhiá»u sá»©c máº¡nh Ä‘Ã¡ng ká»ƒ.</p><p>Javascript animation Ä‘Æ°á»£c viáº¿t ná»™i tuyáº¿n nhÆ° lÃ  1 pháº§n cá»§a code. Báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘Ã³ng gÃ³i nÃ³ bÃªn trong cÃ¡c object. BÃªn dÆ°á»›i lÃ  code Javascript mÃ  báº¡n cáº§n Ä‘á»ƒ viáº¿t láº¡i Ä‘oáº¡n CSS transition á»Ÿ pháº§n trÃªn:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> boxElement = <span class="built_in">document</span>.querySelector(<span class="string">'.box'</span>);</span><br><span class="line"><span class="keyword">var</span> animation = boxElement.animate([</span><br><span class="line">  &#123;<span class="attr">transform</span>: <span class="string">'translate(0)'</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">transform</span>: <span class="string">'translate(150px, 200px)'</span>&#125;</span><br><span class="line">], <span class="number">500</span>);</span><br><span class="line">animation.addEventListener(<span class="string">'finish'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  boxElement.style.transform = <span class="string">'translate(150px, 200px)'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Máº·c Ä‘á»‹nh thÃ¬ Web Animation chá»‰ chá»‰nh sá»­a pháº§n trÃ¬nh bÃ y cá»§a má»™t pháº§n tá»­. Náº¿u nhÆ° báº¡n muá»‘n object cá»§a mÃ¬nh váº«n giá»¯ nguyÃªn vá»‹ trÃ­ lÃºc nÃ³ Ä‘Æ°á»£c di chuyá»ƒn tá»›i thÃ¬ báº¡n nÃªn sá»­a láº¡i style cá»§a nÃ³ khi animation káº¿t thÃºc. ÄÃ¢y lÃ  lÃ½ do táº¡i sao chÃºng ta listen sá»± kiá»‡n finish trong code trÃªn, Ä‘áº·t thuá»™c tÃ­nh box.style.transform báº±ng giÃ¡ trá»‹ translate(150px, 200px) thÃ¬ nÃ³ sáº½ thá»ƒ hiá»‡n giá»‘ng nhÆ° trÆ°á»ng há»£p transform thá»© 2 trong CSS animation á»Ÿ trÃªn.</p><p>Vá»›i Javascript animation, báº¡n hoÃ n toÃ n kiá»ƒm soÃ¡t style cá»§a pháº§n tá»­ táº¡i thá»i Ä‘iá»ƒm báº¥t ká»³. NghÄ©a lÃ  báº¡n cÃ³ thá»ƒ lÃ m animation cháº­m láº¡i, táº¡m ngÆ°ng, dá»«ng háº³n, Ä‘áº£o ngÆ°á»£c vÃ  Ä‘iá»u khiá»ƒn pháº§n tá»­ cho tá»›i khi phÃ¹ há»£p. Äiá»u nÃ y cá»±c ká»³ há»¯u Ã­ch náº¿u báº¡n muá»‘n xÃ¢y dá»±ng cÃ¡c á»©ng dá»¥ng hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng phá»©c táº¡p bá»Ÿi vÃ¬ báº¡n cÃ³ thá»ƒ Ä‘Ã³ng gÃ³i cÃ¡c hÃ nh vi cá»§a app má»™t cÃ¡ch chÃ­nh xÃ¡c.</p><h1 id="Easing-la-gi"><a href="#Easing-la-gi" class="headerlink" title="Easing lÃ  gÃ¬?"></a>Easing lÃ  gÃ¬?</h1><p>Chuyá»ƒn Ä‘á»™ng tá»± nhiÃªn lÃ m cho user cáº£m tháº¥y dá»… chá»‹u hÆ¡n vá»›i webapp cá»§a báº¡n vÃ  mang Ä‘áº¿n tráº£i nghiá»‡m UX tá»‘t hÆ¡n.</p><p>Má»™t cÃ¡ch tá»± nhiÃªn, khÃ´ng cÃ³ thá»© gÃ¬ di chuyá»ƒn theo Ä‘Æ°á»ng tháº³ng tá»« Ä‘iá»ƒm nÃ y Ä‘áº¿n Ä‘iá»ƒm khÃ¡c. Tháº­t ra thÃ¬ má»i thá»© Ä‘á»u cÃ³ xu hÆ°á»›ng tÄƒng tá»‘c vÃ  giáº£m tá»‘c khi chÃºng di chuyá»ƒn trong tháº¿ giá»›i váº­t lÃ½ cá»§a chÃºng ta vÃ  cÃ³ ráº¥t nhiá»u yáº¿u tá»‘ khÃ¡c nhau áº£nh hÆ°á»Ÿng. Bá»™ nÃ£o con ngÆ°á»i Ä‘Æ°á»£c thiáº¿t káº¿ báº©m sinh Ä‘á»ƒ cáº£m nháº­n nhá»¯ng chuyá»ƒn Ä‘á»™ng nÃªn khi báº¡n thá»±c hiá»‡n animation trÃªn webapp hÃ£y nhá»› nhá»¯ng kiáº¿n thá»©c nÃ y.</p><p>Má»™t vÃ i thuáº­t ngá»¯ báº¡n cáº§n hiá»ƒu:</p><ul><li><strong>ease in</strong>: lÃ  khi chuyá»ƒn Ä‘á»™ng báº¯t Ä‘áº§u cháº­m vÃ  tÄƒng tá»‘c dáº§n lÃªn.</li><li><strong>ease out</strong>: chuyá»ƒn Ä‘á»™ng báº¯t Ä‘áº§u nhanh vÃ  giáº£m tá»‘c dáº§n.</li></ul><p>Easing cho phÃ©p báº¡n táº¡o cÃ¡c animation cho cáº£m giÃ¡c tá»± nhiÃªn hÆ¡n.</p><h2 id="Cac-tu-khoa-cho-easing"><a href="#Cac-tu-khoa-cho-easing" class="headerlink" title="CÃ¡c tá»« khÃ³a cho easing"></a>CÃ¡c tá»« khÃ³a cho easing</h2><p>CSS transition vÃ  animation cho phÃ©p báº¡n chá»n loáº¡i easing mÃ  báº¡n muá»‘n. CÃ³ nhiá»u tá»« khÃ³a khÃ¡c nhau áº£nh hÆ°á»Ÿng Ä‘áº¿n easing cá»§a animation. Báº¡n cÅ©ng cÃ³ thá»ƒ táº¡o ra easing hoÃ n toÃ n cá»§a riÃªng báº¡n.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  1 sá»‘ tá»« khÃ³a báº¡n cÃ³ thá»ƒ dÃ¹ng trong CSS Ä‘á»ƒ Ä‘iá»u khiá»ƒn easing:</p><ul><li>linear</li><li>ease-in</li><li>ease-out</li><li>ease-in-out</li></ul><p>Giá» thÃ¬ cÃ¹ng tÃ¬m hiá»ƒu vá» chÃºng nÃ o.</p><h2 id="Linear-animation"><a href="#Linear-animation" class="headerlink" title="Linear animation"></a>Linear animation</h2><p>CÃ¡c animation khÃ´ng cÃ³ báº¥t cá»© kiá»ƒu easing nÃ o thÃ¬ Ä‘Æ°á»£c gá»i lÃ  <strong>linear</strong> (tháº³ng hÃ ng, cÃ²n hÃ n lÃ¢m hÆ¡n thÃ¬ â€œTuyáº¿n tÃ­nhâ€).<br>Äá»“ thá»‹ thá»ƒ hiá»‡n má»™t linear animation:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*M5htfOGgza04ISv_l-69zg.png" alt=""></p><p>Thá»i gian cÃ ng tÄƒng thÃ¬ giÃ¡ trá»‹ cÅ©ng tÄƒng vá»›i lÆ°á»£ng tÆ°Æ¡ng á»©ng. Vá»›i chuyá»ƒn Ä‘á»™ng linear, má»i thá»© cÃ³ xu hÆ°á»›ng thiáº¿u tá»± nhiÃªn. NÃ³i chung báº¡n nÃªn trÃ¡nh sá»­ dá»¥ng chuyá»ƒn Ä‘á»™ng linear.</p><p>ÄÃ¢y lÃ  cÃ¡ch triá»ƒn khai má»™t linear animation Ä‘Æ¡n giáº£n:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">transform</span> 500<span class="selector-tag">ms</span> <span class="selector-tag">linear</span>;</span><br></pre></td></tr></table></figure><h2 id="Ease-out-animation"><a href="#Ease-out-animation" class="headerlink" title="Ease-out animation"></a>Ease-out animation</h2><p>NhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn, ease out lÃ m cho animation báº¯t Ä‘áº§u nhanh hÆ¡n so vá»›i kiá»ƒu linear trong khi Ä‘Ã³ nÃ³ láº¡i cháº­m dáº§n khi káº¿t thÃºc. Äá»“ thá»‹ trÃ´ng nhÆ° tháº¿ nÃ y:<br><img src="https://cdn-images-1.medium.com/max/1000/1*VDWQl67cmbyAFC5xL9Og4g.png" alt=""></p><p>NhÃ¬n chung, ease out lÃ  sá»± lá»±a chá»n tá»‘t nháº¥t cho UI bá»Ÿi vÃ¬ khá»Ÿi Ä‘á»™ng nhanh lÃ m cho animation cá»§a báº¡n cÃ³ cáº£m giÃ¡c pháº£n há»“i tá»‘t trong khi cháº­m dáº§n khi káº¿t thÃºc mang láº¡i cáº£m giÃ¡c tá»± nhiÃªn do sá»± chuyá»ƒn Ä‘á»™ng khÃ´ng Ä‘á»“ng nháº¥t.</p><p>CÃ³ nhiá»u cÃ¡ch Ä‘á»ƒ triá»ƒn khai hiá»‡u á»©ng ease out nhÆ°ng cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t lÃ  tá»« khÃ³a ease-out trong CSS:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">transform</span> 500<span class="selector-tag">ms</span> <span class="selector-tag">ease-out</span>;</span><br></pre></td></tr></table></figure><h2 id="Ease-in-animation"><a href="#Ease-in-animation" class="headerlink" title="Ease-in animation"></a>Ease-in animation</h2><p>ÄÃ¢y lÃ  kiá»ƒu Ä‘á»‘i láº­p láº¡i vá»›i ease-out animation: báº¯t Ä‘áº§u cháº­m cháº¡p vÃ  káº¿t thÃºc nhanh. Äá»“ thá»‹ mÃ´ táº£:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*rWh8YlBn8SypiMduLiYDhA.png" alt=""></p><p>So vá»›i ease-out animation thÃ¬ ease-in cÃ³ hÆ¡i khÃ´ng bÃ¬nh thÆ°á»ng vÃ¬ chÃºng táº¡o ra cáº£m giÃ¡c thiáº¿u sá»± pháº£n há»“i, bá»Ÿi vÃ¬ chÃºng khá»Ÿi Ä‘á»™ng cháº­m. Káº¿t thÃºc nhanh cÃ³ thá»ƒ cÅ©ng táº¡o ra cáº£m giÃ¡c láº¡ tÆ°Æ¡ng tá»±, toÃ n bá»™ animation Ä‘á»u tÄƒng tá»‘c trong khi Ä‘á»‘i tÆ°á»£ng á»Ÿ tháº¿ giá»›i thá»±c cÃ³ xu hÆ°á»›ng giáº£m tá»‘c khi dá»«ng láº¡i Ä‘á»™t ngá»™t.</p><p>Äá»ƒ dÃ¹ng ease-in animation thÃ¬ báº¡n cÃ³ thá»ƒ dÃ¹ng tá»« khÃ³a tÆ°Æ¡ng tá»± nhÆ° trÃªn:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">transform</span> 500<span class="selector-tag">ms</span> <span class="selector-tag">ease-in</span>;</span><br></pre></td></tr></table></figure><h2 id="Ease-in-out-animation"><a href="#Ease-in-out-animation" class="headerlink" title="Ease-in-out animation"></a>Ease-in-out animation</h2><p>ÄÃ¢y lÃ  animation káº¿t há»£p cá»§a ease-in vÃ  ease-out. Äá»“ thá»‹:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*tGXhNroe8KxGN7r4UTVSHw.png" alt=""></p><p>KhÃ´ng nÃªn sá»­ dá»¥ng anmation-duration quÃ¡ lÃ¢u bá»Ÿi vÃ¬ nÃ³ mang láº¡i cáº£m giÃ¡c ráº±ng UI cá»§a báº¡n thiáº¿u sá»± pháº£n há»“i.</p><p>CÃ¡ch sá»­ dá»¥ng ease-in-out animation:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">transform</span> 500<span class="selector-tag">ms</span> <span class="selector-tag">ease-in-out</span>;</span><br></pre></td></tr></table></figure><h2 id="Tuy-bien-easing"><a href="#Tuy-bien-easing" class="headerlink" title="TÃ¹y biáº¿n easing"></a>TÃ¹y biáº¿n easing</h2><p>Báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a Ä‘Æ°á»ng cung easing cho riÃªng báº¡n Ä‘á»ƒ cÃ³ thá»ƒ kiá»ƒm soÃ¡t nhiá»u hÆ¡n nhá»¯ng cáº£m giÃ¡c mÃ  animation cÃ³ thá»ƒ táº¡o ra.</p><p>TrÃªn thá»±c táº¿, cÃ¡c tá»« khÃ³a ease-in, ease-out, liner, ease Ä‘Æ°á»£c ná»‘i vá»›i nhá»¯ng Ä‘Æ°á»ng cung Bezier (<a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve" target="_blank" rel="noopener">BÃ©zier curves</a>) Ä‘Ã£ Ä‘á»‹nh nghÄ©a sáºµn, báº¡n cÃ³ thá»ƒ xem chi tiáº¿t á»Ÿ <a href="http://www.w3.org/TR/css3-transitions/" target="_blank" rel="noopener">ThÃ´ng sá»‘ ká»¹ thuáº­t cá»§a CSS transition</a> hoáº·c cá»§a <a href="https://w3c.github.io/web-animations/#scaling-using-a-cubic-bezier-curve" target="_blank" rel="noopener">Web Animation</a></p><h2 id="Duong-cung-Bezier"><a href="#Duong-cung-Bezier" class="headerlink" title="ÄÆ°á»ng cung Bezier"></a>ÄÆ°á»ng cung Bezier</h2><p>CÃ¹ng tÃ¬m hiá»ƒu vá» cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Ä‘Æ°á»ng cung Bezier nÃ o.<br>Má»™t cung Bezier nháº­n 4 giÃ¡ trá»‹, hoáº·c nÃ³i rÃµ hÆ¡n thÃ¬ nÃ³ nháº­n vÃ o 2 cáº·p sá»‘. Má»—i cáº·p Ä‘á»‹nh nghÄ©a tá»a Ä‘á»™ X vÃ  Y cá»§a 1 Ä‘iá»ƒm kiá»ƒm soÃ¡t thuá»™c khá»‘i cung Bezier. Äiá»ƒm báº¯t Ä‘áº§u cá»§a cung Bezier cÃ³ tá»a Ä‘á»™ (0, 0) vÃ  káº¿t thÃºc lÃ  á»Ÿ (1, 1). Báº¡n cÃ³ thá»ƒ Ä‘áº·t cáº£ 2 cáº·p sá»‘. GiÃ¡ trá»‹ X cho 2 kiá»ƒm kiá»ƒm soÃ¡t pháº£i náº±m trong khoáº£ng [0, 1] cÃ²n giÃ¡ trá»‹ cá»§a Y thÃ¬ cÃ³ thá»ƒ vÆ°á»£t quÃ¡ giá»›i háº¡n [0, 1], máº·c dÃ¹ thÃ´ng sá»‘ ká»¹ thuáº­t khÃ´ng nÃ³i rÃµ lÃ  bao nhiÃªu.</p><p>Ká»ƒ cáº£ nhá»¯ng thay Ä‘á»•i nhá» trong giÃ¡ trá»‹ X vÃ  Y cá»§a má»—i Ä‘iá»ƒm kiá»ƒm soÃ¡t mang Ä‘áº¿n cho báº¡n má»™t cung hoÃ n toÃ n khÃ¡c biá»‡t. á» 2 Ä‘á»“ thá»‹ bÃªn dÆ°á»›i, cung Bezier cÃ³ cÃ¡c Ä‘iá»ƒm gáº§n nhau nhÆ°ng khÃ¡c tá»a Ä‘á»™.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*2v7G1ZJ1C-y_mWHOYQfQKQ.png" alt=""></p><p>vÃ </p><p><img src="https://cdn-images-1.medium.com/max/1000/1*P5nzyldL4rg36dZmt2RViQ.png" alt=""></p><p>NhÆ° báº¡n tháº¥y thÃ¬ Ä‘á»“ thá»‹ khÃ¡ lÃ  khÃ¡c nhau. Äiá»ƒm kiá»ƒm soÃ¡t Ä‘áº§u tiÃªn cÃ³ vector vá»›i giÃ¡ trá»‹ sai khÃ¡c lÃ  (0.045, 0.183) cÃ²n Ä‘iá»ƒm thá»© 2 lÃ  (-0.427, -0.054)</p><p>CÃ²n Ä‘Ã¢y lÃ  pháº§n CSS cho Ä‘Æ°á»ng cung thá»© 2:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transition</span>: <span class="selector-tag">transform</span> 500<span class="selector-tag">ms</span> <span class="selector-tag">cubic-bezier</span>(0<span class="selector-class">.465</span>, 0<span class="selector-class">.183</span>, 0<span class="selector-class">.153</span>, 0<span class="selector-class">.946</span>);</span><br></pre></td></tr></table></figure><p>2 sá»‘ Ä‘áº§u tiÃªn lÃ  tá»a Ä‘á»™ X vÃ  Y cá»§a Ä‘iá»ƒm kiá»ƒm soÃ¡t thá»© nháº¥t, 2 sá»‘ tiáº¿p theo lÃ  cá»§a Ä‘iá»ƒm kiá»ƒm soÃ¡t thá»© 2.</p><h1 id="Toi-uu-hoa-hieu-nang"><a href="#Toi-uu-hoa-hieu-nang" class="headerlink" title="Tá»‘i Æ°u hÃ³a hiá»‡u nÄƒng"></a>Tá»‘i Æ°u hÃ³a hiá»‡u nÄƒng</h1><p>Báº¡n cáº§n pháº£i duy trÃ¬ 60 khung hÃ¬nh/giÃ¢y (60 fps - game thá»§ hiá»ƒu cÃ¡i nÃ y láº¯m nÃ¨ :D) khi lÃ m animation náº¿u khÃ´ng thÃ¬ nÃ³ sáº½ áº£nh hÆ°á»Ÿng tiÃªu cá»±c Ä‘áº¿n UX.</p><p>VÃ  nhÆ° 1 láº½ dÄ© nhiÃªn thÃ¬ animation khÃ´ng há» miá»…n phÃ­. KhÃ´ng pháº£i lÃ  chuyá»‡n tiá»n nong, mÃ  lÃ  hiá»‡u nÄƒng. Animate má»™t vÃ i thuá»™c tÃ­nh cÃ³ thá»ƒ khÃ´ng tá»‘n kÃ©m nhÆ° má»™t sá»‘ khÃ¡c. VÃ­ dá»¥: animate width vÃ  height cá»§a 1 pháº§n tá»­ sáº½ thay Ä‘á»•i tráº¡ng thÃ¡i hÃ¬nh há»c cá»§a nÃ³ vÃ  lÃ  nguyÃªn nhÃ¢n áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c pháº§n tá»­ khÃ¡c trÃªn trang bá»‹ thay Ä‘á»•i vá»‹ trÃ­ hoáº·c kÃ­ch thÆ°á»›c. QuÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c gá»i lÃ  layout. ChÃºng ta cÅ©ng Ä‘Ã£ tháº£o luáº­n chi tiáº¿t vá» layout vÃ  rendering trong <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-11---Render-engine---meo-toi-uu-hoa-hieu-nang-render" target="_blank" rel="noopener">bÃ i trÆ°á»›c rá»“i</a>.</p><p>NÃ³i chung, báº¡n cáº§n trÃ¡nh animate nhá»¯ng thuá»™c tÃ­nh nÃ o cÃ³ thá»ƒ trigger quÃ¡ trÃ¬nh layout hoáº·c tÃ´ mÃ u (paint). Vá»›i Ä‘a sá»‘ cÃ¡c trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i thÃ¬ Ä‘iá»u nÃ y nghÄ©a lÃ  háº¡n cháº¿ animation vá»›i opacity vÃ  transform</p><h2 id="Will-change"><a href="#Will-change" class="headerlink" title="Will-change"></a>Will-change</h2><p>Báº¡n cÃ³ thá»ƒ dÃ¹ng <a href="https://dev.w3.org/csswg/css-will-change/" target="_blank" rel="noopener">will-change</a> Ä‘á»ƒ thÃ´ng bÃ¡o cho trÃ¬nh duyá»‡t biáº¿t báº¡n cÃ³ Ã½ Ä‘á»‹nh thay Ä‘á»•i thuá»™c tÃ­nh cá»§a 1 pháº§n tá»­. NÃ³ cho phÃ©p trÃ¬nh duyá»‡t cÃ i Ä‘áº·t sáºµn sÃ ng trÆ°á»›c nhá»¯ng tá»‘i hÆ°u hÃ³a thÃ­ch há»£p nháº¥t khi báº¡n cáº§n thay Ä‘á»•i. Tuy nhiÃªn cÅ©ng Ä‘á»«ng láº¡m dá»¥ng will-change, bá»Ÿi vÃ¬ lÃ m nhÆ° tháº¿ cÃ³ thá»ƒ lÃ m cho trÃ¬nh duyá»‡t hao tá»‘n tÃ i nguyÃªn vÃ  quay ngÆ°á»£c láº¡i gÃ¢y ra nhiá»u váº¥n Ä‘á» hÆ¡n vá» hiá»‡u nÄƒng.</p><p>CÃ¡ch Ä‘á»ƒ thÃªm will-change cho transform vÃ  opacity:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">will-change</span>: transform, opacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TrÃ¬nh duyá»‡t há»— trá»£:<br><img src="https://cdn-images-1.medium.com/max/1000/1*eyaMLcORDVsCFIf5h_ygjA.png" alt=""></p><h2 id="Chon-Javascript-hay-CSS"><a href="#Chon-Javascript-hay-CSS" class="headerlink" title="Chá»n Javascript hay CSS"></a>Chá»n Javascript hay CSS</h2><p>CÃ³ láº½ báº¡n cÅ©ng Ä‘Ã£ tháº¥y ráº±ng khÃ´ng cÃ³ cÃ¢u tráº£ lá»i Ä‘Ãºng cho cÃ¢u há»i nÃ y, tÃ¹y thuá»™c vÃ o nhiá»u yáº¿u tá»‘, dÆ°á»›i Ä‘Ã¢y lÃ  nhá»¯ng thá»© báº¡n cáº§n cÃ¢n nháº¯c má»—i khi lá»±a chá»n:</p><ul><li>CÃ¡c animation dá»±a trÃªn CSS vÃ  Web Animation Ä‘Æ°á»£c há»— trá»£ native vÃ  Ä‘Æ°á»£c xá»­ lÃ½ trong tiáº¿n trÃ¬nh gá»i lÃ  â€œtiáº¿n trÃ¬nh tá»•ng há»£pâ€ (compositor thread). KhÃ¡c vá»›i â€œtiáº¿n trÃ¬nh chÃ­nhâ€ cá»§a trÃ¬nh duyá»‡t, nÆ¡i mÃ  styling, layout, painting vÃ  code Javascript Ä‘Æ°á»£c thá»±c thi. NghÄ©a lÃ  náº¿u nhÆ° trÃ¬nh duyá»‡t Ä‘ang báº­n xá»­ lÃ½ 1 sá»‘ tÃ¡c vá»¥ náº·ng kÃ½ trÃªn tiáº¿n trÃ¬nh chÃ­nh thÃ¬ nhá»¯ng animation Ä‘Ã³ váº«n cÃ³ thá»ƒ tiáº¿p tá»¥c thá»±c hiá»‡n mÃ  khÃ´ng bá»‹ can thiá»‡p.</li><li>Trong má»™t vÃ i trÆ°á»ng há»£p. cÃ¡c thay Ä‘á»•i Ä‘á»‘i vá»›i transform vÃ  opacity cÃ³ thá»ƒ Ä‘Æ°á»£c xá»­ lÃ½ bá»Ÿi tiáº¿n trÃ¬nh tá»•ng há»£p.</li><li>Náº¿u animation trigger paint, layout hoáº·c cáº£ 2 thÃ¬ tiáº¿n trÃ¬nh chÃ­nh sáº½ cáº§n pháº£i tham gia xá»­ lÃ½. TrÆ°á»ng há»£p nÃ y xáº£y ra cho cáº£ CSS vÃ  Javascript animation, vÃ  dÄ© nhiÃªn lÃ  viá»‡c thá»±c hiá»‡n layout hoáº·c paint nhÆ° váº­y sáº½ lÃ m cháº­m báº¥t ká»³ tÃ¡c vá»¥ nÃ o liÃªn quan Ä‘áº¿n thá»±c thi CSS hay Javascript</li></ul><h2 id="Chon-dung-thu-de-animate"><a href="#Chon-dung-thu-de-animate" class="headerlink" title="Chá»n Ä‘Ãºng thá»© Ä‘á»ƒ animate"></a>Chá»n Ä‘Ãºng thá»© Ä‘á»ƒ animate</h2><p>Nhá»¯ng animation tuyá»‡t vá»i thÆ°á»ng táº¡o nÃªn sá»± thÃ­ch thÃº vÃ  gáº¯n káº¿t giá»¯a project cá»§a báº¡n vá»›i ngÆ°á»i dÃ¹ng. Báº¡n cÃ³ thá»ƒ animate báº¥t cá»© thá»© gÃ¬ báº¡n muá»‘n, dÃ¹ lÃ  width, height, position, color, background, vÃ¢n vÃ¢n, nhÆ°ng cáº§n pháº£i chÃº Ã½ Ä‘áº¿n nhá»¯ng nÃºt tháº¯t cá»• chai tiá»m tÃ ng vá» hiá»‡u nÄƒng. Nhá»¯ng animation Ä‘Æ°á»£c chá»n lá»±a 1 cÃ¡ch báº¥t cáº©n cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng tiÃªu cá»±c Ä‘áº¿n UX, vÃ¬ váº­y animation cáº§n pháº£i vá»«a phÃ¹ há»£p vá»«a tá»‘t cho hiá»‡u nÄƒng. Animate cÃ ng Ã­t cÃ ng tá»‘t, chá»‰ nÃªn animate khi báº¡n cáº§n UX trá»Ÿ nÃªn tá»± nhiÃªn hÆ¡n nhÆ°ng Ä‘á»«ng láº¡m dá»¥ng nÃ³.</p><h2 id="Dung-animation-de-ho-tro-tuong-tac"><a href="#Dung-animation-de-ho-tro-tuong-tac" class="headerlink" title="DÃ¹ng animation Ä‘á»ƒ há»— trá»£ tÆ°Æ¡ng tÃ¡c"></a>DÃ¹ng animation Ä‘á»ƒ há»— trá»£ tÆ°Æ¡ng tÃ¡c</h2><p>KhÃ´ng nÃªn animate chá»‰ vÃ¬ báº¡n thÃ­ch tháº¿. Thay vÃ¬ váº­y, sá»­ dá»¥ng animation táº¡i nhá»¯ng vá»‹ trÃ­ chiáº¿n lÆ°á»£c Ä‘á»ƒ <em>cá»§ng cá»‘</em> thÃªm vá» tÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng. TrÃ¡nh animation lÃ m ngáº¯t quÃ£ng hoáº·c cáº£n trá»Ÿ má»™t cÃ¡ch khÃ´ng cáº§n thiáº¿t cÃ¡c hoáº¡t Ä‘á»™ng cá»§a user</p><h2 id="Tranh-animate-nhung-thuoc-tinh-phuc-tap"><a href="#Tranh-animate-nhung-thuoc-tinh-phuc-tap" class="headerlink" title="TrÃ¡nh animate nhá»¯ng thuá»™c tÃ­nh phá»©c táº¡p"></a>TrÃ¡nh animate nhá»¯ng thuá»™c tÃ­nh phá»©c táº¡p</h2><p>Chá»‰ cÃ³ duy nháº¥t 1 thá»© tá»‡ hÆ¡n cáº£ animation Ä‘áº·t sai chá»— chÃ­nh lÃ  nhá»¯ng animation lÃ m cho trang web bá»‹ lag. Kiá»ƒu animation nÃ y lÃ m cho user cáº£m tháº¥y bá»±c bá»™i vÃ  chÃ¡n náº£n.</p><p>Team tÃ¡c giáº£ sá»­ dá»¥ng animation khÃ¡ dá»… dÃ ng vá»›i <a href="https://www.sessionstack.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_content=js-series-rendering-engine-outro" target="_blank" rel="noopener">SessionStack</a>. NÃ³i chung, há» theo sÃ¡t nhá»¯ng nguyÃªn táº¯c Ä‘Ã£ nÃªu á»Ÿ trÃªn nhÆ°ng cÅ©ng cÃ³ má»™t sá»‘ trÆ°á»ng há»£p mÃ  há» pháº£i dÃ¹ng animation vÃ¬ sá»± phá»©c táº¡p cá»§a UI. SessionStack pháº£i tÃ¡i táº¡o láº¡i dÆ°á»›i dáº¡ng video toÃ n bá»™ nhá»¯ng thá»© xáº£y ra vá»›i ngÆ°á»i dÃ¹ng cuá»‘i táº¡i thá»i Ä‘iá»ƒm há» gáº·p pháº£i váº¥n Ä‘á» khi Ä‘ang lÆ°á»›t web hay dÃ¹ng webapp. Äá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u nÃ y SessionStack táº­n dá»¥ng duy nháº¥t nhá»¯ng dá»¯ liá»‡u thu tháº­p Ä‘Æ°á»£c xuyÃªn suá»‘t phiÃªn lÃ m viá»‡c: sá»± kiá»‡n tá»« user, thay Ä‘á»•i trÃªn DOM, request máº¡ng, biá»‡t lá»‡, thÃ´ng bÃ¡o debug, vÃ¢n vÃ¢n. TrÃ¬nh chÆ¡i cá»§a há» Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a khÃ¡ tá»‘t Ä‘á»ƒ cÃ³ thá»ƒ render má»™t cÃ¡ch chÃ­nh xÃ¡c vÃ  sá»­ dá»¥ng toÃ n bá»™ dá»¯ liá»‡u thu tháº­p Ä‘Æ°á»£c Ä‘á»ƒ giáº£ láº­p chÃ­nh xÃ¡c Ä‘áº¿n tá»«ng pixel trÃ¬nh duyá»‡t cá»§a ngÆ°á»i dÃ¹ng vÃ  nhá»¯ng thá»© xáº£y ra trÃªn nÃ³, cáº£ vá» khÃ­a cáº¡nh nhÃ¬n tháº¥y Ä‘Æ°á»£c vÃ  gÃ³c nhÃ¬n ká»¹ thuáº­t.</p><p>Äá»ƒ Ä‘áº£m báº£o quÃ¡ trÃ¬nh tÃ¡i táº¡o diá»…n ra má»™t cÃ¡ch tá»± nhiÃªn, Ä‘áº·c biá»‡t vá»›i nhá»¯ng phiÃªn lÃ m viá»‡c kÃ©o dÃ i vÃ  náº·ng dá»¯ liá»‡u, team tÃ¡c giáº£ sá»­ dá»¥ng cÃ¡c animation Ä‘á»ƒ chá»‰ Ä‘á»‹nh chÃ­nh xÃ¡c hoáº¡t Ä‘á»™ng loading/buffering vÃ  bÃ¡m sÃ¡t cÃ¡c nguyÃªn táº¯c tá»‘t nháº¥t Ä‘á»ƒ triá»ƒn khai chÃºng, do Ä‘Ã³ há» khÃ´ng cáº§n quÃ¡ nhiá»u CPU vÃ  váº«n cÃ³ thá»ƒ Ä‘á»ƒ cho event loop Ä‘Æ°á»£c ráº£nh tay render cÃ¡c session.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 13 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;h1 id=&quot;Khai-quat&quot;&gt;&lt;a href=&quot;#Khai-quat&quot; class=&quot;headerlink&quot; title=&quot;KhÃ¡i quÃ¡t&quot;&gt;&lt;/a&gt;KhÃ¡i quÃ¡t&lt;/h1&gt;&lt;p&gt;Má»i ngÆ°á»i Ä‘Ã£ biáº¿t rÃµ animation Ä‘Ã³ng vai trÃ² cáº§n thiáº¿t trong viá»‡c táº¡o ra cÃ¡c webapp háº¥p dáº«n. Khi ngÆ°á»i dÃ¹ng dáº§n dáº§n chuyá»ƒn sá»± chÃº Ã½ cá»§a há» sang UX vÃ  cÃ¡c doanh nghiá»‡p báº¯t Ä‘áº§u nháº­n ra sá»± quan trá»ng cá»§a tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng thÃº vá»‹ &amp;amp; hoÃ n háº£o thÃ¬ cÃ¡c á»©ng dá»¥ng web dáº§n trá»Ÿ nÃªn náº·ng ná» hÆ¡n &amp;amp; cáº§n thá»ƒ hiá»‡n nhiá»u UI Ä‘á»™ng hÆ¡n. Táº¥t cáº£ nhá»¯ng thá»© nÃ y cáº§n Ä‘áº¿n cÃ¡c animation phá»©c táº¡p Ä‘á»ƒ táº¡o ra cÃ¡c chuyá»ƒn dá»‹ch tráº¡ng thÃ¡i mÆ°á»£t mÃ  xuyÃªn suá»‘t hÃ nh trÃ¬nh tráº£i nghiá»‡m cá»§a ngÆ°á»i dÃ¹ng. Giá» Ä‘Ã¢y thÃ¬ Ä‘iá»u Ä‘Ã³ khÃ´ng cÃ²n lÃ  thá»© gÃ¬ Ä‘áº·c biá»‡t ná»¯a. User cÃ ng lÃºc cÃ ng giá»i vÃ  há» mong Ä‘á»£i á»Ÿ nhá»¯ng giao diá»‡n ngÆ°á»i dÃ¹ng cÃ³ tÃ­nh tÆ°Æ¡ng tÃ¡c vÃ  pháº£n há»“i cao.&lt;/p&gt;
&lt;p&gt;Tuy nhiÃªn animating giao diá»‡n khÃ´ng nháº¥t thiáº¿t pháº£i Ä‘Æ¡n giáº£n, minh báº¡ch. Thá»© gÃ¬ cáº§n Ä‘Æ°á»£c animated, khi nÃ o vÃ  cáº£m giÃ¡c mÃ  má»™t animation mang láº¡i, Ä‘Ã³ má»›i lÃ  nhá»¯ng cÃ¢u há»i khÃ³ tráº£ lá»i.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P12: BÃªn trong lá»›p Network + LÃ m sao Ä‘á»ƒ tá»‘i Æ°u hÃ³a hiá»‡u nÄƒng vÃ  báº£o máº­t Javascript</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P12-Ben-trong-lop-Network-Lam-sao-de-toi-uu-hoa-hieu-nang-va-bao-mat-Javascript.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P12-Ben-trong-lop-Network-Lam-sao-de-toi-uu-hoa-hieu-nang-va-bao-mat-Javascript.html</id>
    <published>2018-11-25T09:06:00.000Z</published>
    <updated>2018-11-25T09:10:31.361Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 12 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p>NhÆ° Ä‘Ã£ nÃ³i trong bÃ i trÆ°á»›c vá» <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-11---Render-engine---meo-toi-uu-hoa-hieu-nang-render" target="_blank" rel="noopener">render engine</a>, tÃ¡c giáº£ bÃ i viáº¿t tin ráº±ng sá»± khÃ¡c biá»‡t giá»¯a má»™t Javascript developer tá»‘t (good) vÃ  tuyá»‡t vá»i (great) lÃ  dev tuyá»‡t vá»i khÃ´ng nhá»¯ng hiá»ƒu vá» cÃ¡c thÃ nh pháº§n cÆ¡ báº£n cá»§a má»™t ngÃ´n ngá»¯ mÃ  cÃ²n cáº£ pháº§n cá»‘t lÃµi cÅ©ng nhÆ° mÃ´i trÆ°á»ng xung quanh nÃ³.<br><a id="more"></a></p><h1 id="Nhac-so-qua-ve-lich-su-mot-chut"><a href="#Nhac-so-qua-ve-lich-su-mot-chut" class="headerlink" title="Nháº¯c sÆ¡ qua vá» lá»‹ch sá»­ má»™t chÃºt"></a>Nháº¯c sÆ¡ qua vá» lá»‹ch sá»­ má»™t chÃºt</h1><p>49 nÄƒm trÆ°á»›c, má»™t thá»© gá»i lÃ  ARPAnet Ä‘Æ°á»£c táº¡o ra. NÃ³ chÃ­nh lÃ  má»™t <a href="https://en.wikipedia.org/wiki/Packet_switching" target="_blank" rel="noopener">máº¡ng chuyá»ƒn Ä‘á»•i gÃ³i tin sá»›m</a> vÃ  cÅ©ng lÃ  <a href="https://en.wikipedia.org/wiki/Internet_protocol_suite" target="_blank" rel="noopener">máº¡ng Ä‘áº§u tiÃªn triá»ƒn khai bá»™ TCP/IP</a>. Máº¡ng nÃ y cÃ i Ä‘áº·t má»™t liÃªn káº¿t giá»¯a trÆ°á»ng Ä‘áº¡i há»c California vÃ  Há»c viá»‡n nghiÃªn cá»©u Stanford. 20 nÄƒm sau, Tim Berners-Lee phÃ¡t hÃ nh má»™t lá»i Ä‘á» nghá»‹ cho â€œMeshâ€ - thá»© mÃ  sau nÃ y Ä‘Æ°á»£c biáº¿t Ä‘áº¿n lÃ  World Wide Web. Trong 49 nÄƒm Ä‘Ã³, internet Ä‘Ã£ Ä‘i Ä‘Æ°á»£c má»™t quÃ£ng Ä‘Æ°á»ng dÃ i, báº¯t Ä‘áº§u chá»‰ vá»›i 2 mÃ¡y tÃ­nh trao Ä‘á»•i cÃ¡c gÃ³i dá»¯ liá»‡u vÃ  giá» Ä‘áº¡t tá»›i hÆ¡n 75 triá»‡u server, 3.8 tá»‰ ngÆ°á»i dÃ¹ng internet vÃ  1.3 tá»‰ websites.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*x8P3OcgcgKrEEDpgT2IKkQ.jpeg" alt=""></p><p>Trong bÃ i nÃ y, chÃºng ta sáº½ thá»­ phÃ¢n tÃ­ch nhá»¯ng ká»¹ thuáº­t nÃ o trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i sá»­ dá»¥ng Ä‘á»ƒ tá»± Ä‘á»™ng Ä‘áº©y máº¡nh hiá»‡u nÄƒng (tháº­m chÃ­ báº¡n khÃ´ng biáº¿t Ä‘áº¿n Ä‘iá»u Ä‘Ã³), vÃ  chÃºng ta sáº½ Ä‘áº·c biá»‡t soi ká»¹ vÃ o lá»›p networking cá»§a trÃ¬nh duyá»‡t. á» cuá»‘i bÃ i, tÃ¡c giáº£ sáº½ cung cáº¥p má»™t sá»‘ Ã½ tÆ°á»Ÿng lÃ m tháº¿ nÃ o Ä‘á»ƒ giÃºp trÃ¬nh duyá»‡t Ä‘áº©y máº¡nh hÆ¡n ná»¯a hiá»‡u nÄƒng cá»§a webapp cá»§a báº¡n.</p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>TrÃ¬nh duyá»‡t web hiá»‡n Ä‘áº¡i Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘áº·c trá»‹ cho viá»‡c truyá»n táº£i webapp/website má»™t cÃ¡ch nhanh chÃ³ng, hiá»‡u quáº£ vÃ  an toÃ n báº£o máº­t. Vá»›i hÃ ng trÄƒm component cÃ¹ng hoáº¡t Ä‘á»™ng trÃªn nhiá»u layer khÃ¡c nhau, tá»« quáº£n lÃ½ tiáº¿n trÃ¬nh vÃ  báº£o máº­t sandbox Ä‘áº¿n cÃ¡c GPU pipeline, audio vÃ  video, vÃ  cÃ²n nhiá»u thá»© khÃ¡c ná»¯a, trÃ¬nh duyá»‡t trÃ´ng giá»‘ng nhÆ° má»™t há»‡ Ä‘iá»u hÃ nh hÆ¡n lÃ  má»™t pháº§n má»m bÃ¬nh thÆ°á»ng.</p><p>Hiá»‡u nÄƒng tá»•ng quÃ¡t cá»§a trÃ¬nh duyá»‡t Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh báº±ng má»™t cÆ¡ sá»‘ cÃ¡c component lá»›n: parsing (phÃ¢n giáº£i), layout, tÃ­nh toÃ¡n style, quÃ¡ trÃ¬nh thá»±c thi Javascript &amp; WebAssembly, rendering vÃ  dÄ© nhiÃªn lÃ  cáº£ <strong>networking stack</strong> (ngÄƒn xáº¿p máº¡ng).</p><p>CÃ¡c ká»¹ sÆ° thÆ°á»ng nghÄ© ráº±ng networking stack lÃ  má»™t nÃºt cá»• chai. Äiá»u nÃ y xáº£y ra thÆ°á»ng xuyÃªn vÃ¬ táº¥t cáº£ cÃ¡c tÃ i nguyÃªn Ä‘á»u cáº§n pháº£i Ä‘Æ°á»£c láº¥y vá» tá»« internet trÆ°á»›c khi cÃ¡c bÆ°á»›c cÃ²n láº¡i Ä‘Æ°á»£c thá»±c hiá»‡n. Vá»›i networking layer, Ä‘á»ƒ hoáº¡t Ä‘á»™ng hiá»‡u quáº£ nÃ³ cáº§n pháº£i Ä‘Ã³ng vai trÃ² nhiá»u hÆ¡n lÃ  má»™t bá»™ quáº£n lÃ½ socket Ä‘Æ¡n giáº£n. Vá»›i chÃºng ta, nÃ³ nhÆ° má»™t thá»© nÃºp dÆ°á»›i dáº¡ng má»™t cÆ¡ cháº¿ ráº¥t Ä‘Æ¡n giáº£n Ä‘á»ƒ kÃ©o tÃ i nguyÃªn vá» nhÆ°ng Ä‘Ã³ thá»±c sá»± lÃ  má»™t ná»n táº£ng (platform) Ä‘áº§y Ä‘á»§ vá»›i cÃ¡c tiÃªu chÃ­ tá»‘i Æ°u hÃ³a, APIs vÃ  service cá»§a riÃªng nÃ³.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*WqInzMPQGGcMX9AOONN76g.jpeg" alt=""></p><p>LÃ  web developer, chÃºng ta khÃ´ng cáº§n pháº£i lo nghÄ© vá» tá»«ng gÃ³i tin TCP hay UDP, Ä‘á»‹nh dáº¡ng request, caching vÃ  táº¥t cáº£ nhá»¯ng thá»© liÃªn quan. ToÃ n bá»™ sá»± phá»©c táº¡p nÃ y Ä‘Æ°á»£c trÃ¬nh duyá»‡t gÃ¡nh dÃ¹m nÃªn ta chá»‰ cáº§n táº­p trung vÃ o á»©ng dá»¥ng mÃ  chÃºng ta Ä‘ang táº¡o ra. Tuy nhiÃªn, hiá»ƒu rÃµ Ä‘iá»u gÃ¬ thá»±c sá»± Ä‘ang diá»…n ra bÃªn trong cÃ³ thá»ƒ giÃºp chÃºng ta táº¡o ra app nhanh hÆ¡n vÃ  báº£o máº­t tá»‘t hÆ¡n.</p><p>Vá» báº£n cháº¥t thÃ¬ dÆ°á»›i Ä‘Ã¢y lÃ  nhá»¯ng gÃ¬ xáº£y ra khi user báº¯t Ä‘áº§u tÆ°Æ¡ng tÃ¡c vá»›i trÃ¬nh duyá»‡t:</p><ul><li>User nháº­p má»™t URL vÃ o thanh Ä‘á»‹a chá»‰ trÃªn trÃ¬nh duyá»‡t</li><li>Giáº£ sá»­ URL Ä‘Ã³ chá»‰ Ä‘áº¿n 1 tÃ i nguyÃªn trÃªn máº¡ng, trÃ¬nh duyá»‡t sáº½ báº¯t Ä‘áº§u kiá»ƒm tra local cache vÃ  cache cá»§a á»©ng dá»¥ng vÃ  cá»‘ thá»­ sá»­ dá»¥ng má»™t pháº£i copy cÃ³ sáºµn á»Ÿ local Ä‘á»ƒ Ä‘Ã¡p á»©ng request.</li><li>Náº¿u cache khÃ´ng dÃ¹ng Ä‘Æ°á»£c, tÃ¬nh duyá»‡t sáº½ láº¥y tÃªn miá»n tá»« URL vÃ  yÃªu cáº§u Ä‘á»‹a chá»‰ IP cá»§a server tá»« má»™t <a href="https://en.wikipedia.org/wiki/Domain_Name_System" target="_blank" rel="noopener">DNS</a>. Náº¿u tÃªn miá»n Ä‘Ã£ Ä‘Æ°á»£c cache sáºµn thÃ¬ khÃ´ng cáº§n truy váº¥n Ä‘áº¿n DNS.</li><li>TrÃ¬nh duyá»‡t táº¡o ra má»™t gÃ³i tin HTTP nÃ³i ráº±ng nÃ³ yÃªu cáº§u má»™t trang web Ä‘ang cÆ° trÃº táº¡i má»™t server tá»« xa.</li><li>GÃ³i tin Ä‘Æ°á»£c gá»­i Ä‘áº¿n TCP layer, layer nÃ y sáº½ thÃªm thÃ´ng tin cá»§a chÃ­nh nÃ³ vÃ o vá»‹ trÃ­ trÃªn cÃ¹ng cá»§a gÃ³i tin HTTP. ThÃ´ng tin nÃ y cáº§n thiáº¿t Ä‘á»ƒ duy trÃ¬ phiÃªn khá»Ÿi Ä‘á»™ng.</li><li>GÃ³i tin sau Ä‘Ã³ Ä‘Æ°á»£c trao cho IP layer vá»›i cÃ´ng viá»‡c chÃ­nh lÃ  tÃ¬m hiá»ƒu má»™t cÃ¡ch Ä‘á»ƒ gá»­i gÃ³i tin tá»« user Ä‘áº¿n server tá»« xa. ThÃ´ng tin nÃ y cÅ©ng Ä‘Æ°á»£c lÆ°u vÃ o vá»‹ trÃ­ trÃªn cÃ¹ng cá»§a gÃ³i tin.</li><li>GÃ³i tin Ä‘Æ°á»£c gá»­i Ä‘áº¿n server tá»« xa.</li><li>Khi Ä‘Ã£ nháº­n gÃ³i tin, má»™t pháº£n há»“i Ä‘Æ°á»£c gá»­i ngÆ°á»£c láº¡i theo cÃ¡ch thá»©c tÆ°Æ¡ng tá»±.</li></ul><p><a href="http://www.w3.org/TR/navigation-timing/" target="_blank" rel="noopener">Äáº·c tÃ­nh ká»¹ thuáº­t cá»§a Navigation Timing</a> tá»« W3C cung cáº¥p má»™t API trÃ¬nh duyá»‡t cÅ©ng nhÆ° kháº£ nÄƒng hiá»ƒn thá»‹ dá»¯ liá»‡u vá» thá»i gian vÃ  hiá»‡u nÄƒng Ä‘áº±ng sau má»—i request trÃªn trÃ¬nh duyá»‡t. Giá» thÃ¬ cÃ¹ng quan sÃ¡t cÃ¡c component, má»—i pháº§n sáº½ Ä‘Ã³ng má»™t vai trÃ² quan trá»ng trong viá»‡c cung cáº¥p cÃ¡c tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng (UX) tá»‘i Æ°u:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*rjBdCBwOx5Gp_A6b6FQgfw.png" alt=""></p><p>ToÃ n bá»™ tiáº¿n trÃ¬nh networking ráº¥t phá»©c táº¡p vÃ  cÃ³ nhiá»u layer khÃ¡c nhau cÃ³ thá»ƒ trá»Ÿ thÃ nh má»™t nÃºt cá»• chai. ÄÃ¢y lÃ  lÃ½ do cÃ¡c trÃ¬nh duyá»‡t cá»‘ gáº¯ng pháº¥n Ä‘áº¥u Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u nÄƒng báº£n thÃ¢n báº±ng cÃ¡ch sá»­ dá»¥ng ráº¥t nhiá»u ká»¹ thuáº­t Ä‘a dáº¡ng Ä‘á»ƒ giáº£m thiá»ƒu tá»‘i Ä‘a sá»± áº£nh hÆ°á»Ÿng cá»§a toÃ n bá»™ giao tiáº¿p network.</p><h1 id="Quan-ly-socket"><a href="#Quan-ly-socket" class="headerlink" title="Quáº£n lÃ½ socket"></a>Quáº£n lÃ½ socket</h1><p>CÃ¹ng khá»Ÿi Ä‘á»™ng vá»›i má»™t sá»‘ thuáº­t ngá»¯ nÃ o:</p><ul><li><strong>Origin</strong>: má»™t bá»™ 3 chá»©a cÃ¡c giao thá»©c á»©ng dá»¥ng, tÃªn miá»n vÃ  sá»‘ port (vÃ­ dá»¥: https, <a href="http://www.example.com" target="_blank" rel="noopener">www.example.com</a>, 443)</li><li><strong>Socket pool</strong>: má»™t nhÃ³m cÃ¡c socket thuá»™c vá» cÃ¹ng origin (táº¥t cáº£ cÃ¡c trÃ¬nh duyá»‡t lá»›n Ä‘á»u giá»›i háº¡n pool size lá»›n nháº¥t lÃ  6 socket).</li></ul><p>Javascript vÃ  WebAssembly <strong>khÃ´ng cho phÃ©p</strong> chÃºng ta quáº£n lÃ½ vÃ²ng Ä‘á»i cá»§a cÃ¡c network socket riÃªng tÆ°, vÃ  dÄ© nhiÃªn nhÆ° váº­y lÃ  tá»‘t! Äiá»u nÃ y khÃ´ng nhá»¯ng giÃºp chÃºng ta dá»… dÃ ng hÆ¡n mÃ  cÃ²n cho phÃ©p trÃ¬nh duyá»‡t tá»± Ä‘á»™ng thá»±c hiá»‡n ráº¥t nhiá»u tá»‘i Æ°u hÃ³a hiá»‡u nÄƒng, má»™t trong sá»‘ Ä‘Ã³ bao gá»“m: sá»­ dá»¥ng láº¡i socket, yÃªu cáº§u sá»± Æ°u tiÃªn vÃ  rÃ ng buá»™c muá»™n (late binding), giao dá»‹ch giao thá»©c, Ã©p buá»™c giá»›i háº¡n káº¿t ná»‘i, vÃ¢n vÃ¢n.</p><p>Tháº­t ra cÃ¡c trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i Ä‘Ã£ lÃ m tá»‘t trong viá»‡c chia tÃ¡ch vÃ²ng quáº£n lÃ½ request khá»i pháº§n quáº£n lÃ½ socket. CÃ¡c socket Ä‘Æ°á»£c tá»• chá»©c trong cÃ¡c pool vÃ  Ä‘Æ°á»£c nhÃ³m láº¡i theo origin, má»—i pool báº¯t buá»™c pháº£i giá»›i háº¡n káº¿t ná»‘i vÃ  cÃ¡c rÃ ng buá»™c báº£o máº­t. CÃ¡c request chá» Ä‘Æ°á»£c xáº¿p vÃ o trong hÃ ng Ä‘á»£i, Ä‘Ã¡nh thá»© tá»± Æ°u tiÃªn vÃ  sau Ä‘Ã³ gáº¯n káº¿t vá»›i nhá»¯ng socket riÃªng tÆ° trong pool. Trá»« khi server cÃ³ Ã½ Ä‘á»‹nh Ä‘Ã³ng káº¿t ná»‘i thÃ¬ cÃ¹ng má»™t socket cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng láº¡i má»™t cÃ¡ch tá»± Ä‘á»™ng xuyÃªn suá»‘t nhiá»u request.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*0e8X3UTBpsiBSZKa3l1hXA.png" alt=""></p><p>Bá»Ÿi vÃ¬ má»Ÿ má»›i 1 káº¿t ná»‘i TCP thÆ°á»ng kÃ¨m theo chi phÃ­ tá»‘n kÃ©m cho nÃªn tÃ¡i sá»­ dá»¥ng láº¡i cÃ¡c káº¿t ná»‘i cÅ© sáº½ Ä‘áº£m báº£o hiá»‡u nÄƒng tá»‘t hÆ¡n nhiá»u. Máº·c Ä‘á»‹nh thÃ¬ trÃ¬nh duyá»‡t sá»­ dá»¥ng cÆ¡ cháº¿ gá»i lÃ  â€œkeepaliveâ€ (giá»¯ cho sá»‘ng) Ä‘á»ƒ tiáº¿t kiá»‡m thá»i gian tá»« viá»‡c má»Ÿ má»›i káº¿t ná»‘i Ä‘áº¿n server khi cÃ³ request Ä‘Æ°á»£c táº¡o ra. Thá»i gian trung bÃ¬nh Ä‘á»ƒ má»Ÿ 1 káº¿t ná»‘i TCP lÃ :</p><ul><li>Request Ä‘áº¿n mÃ¡y local: 23ms</li><li>Request trong ná»™i bá»™ chÃ¢u lá»¥c: 120ms</li><li>Request giá»¯a cÃ¡c chÃ¢u lá»¥c vá»›i nhau: 225ms</li></ul><p>Kiá»ƒu kiáº¿n trÃºc nÃ y má»Ÿ ra cÃ¡nh cá»­a Ä‘áº¿n vá»›i ráº¥t nhiá»u cÆ¡ há»™i Ä‘á»ƒ tá»‘i Æ°u hÃ³a. Request cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi vá»›i nhá»¯ng thá»© tá»± khÃ¡c nhau tÃ¹y thuá»™c vÃ o Ä‘á»™ Æ°u tiÃªn cá»§a nÃ³. TrÃ¬nh duyá»‡t cÃ³ thá»ƒ tá»‘i Æ°u hÃ³a sá»± phÃ¢n chia bÄƒng thÃ´ng giá»¯a toÃ n bá»™ cÃ¡c socket hoáº·c lÃ  nÃ³ cÃ³ thá»ƒ má»Ÿ socket khi dá»± Ä‘oÃ¡n trÆ°á»›c vá» má»™t request.</p><p>NhÆ° Ä‘Ã£ nÃ³i trÆ°á»›c Ä‘Ã³, toÃ n bá»™ Ä‘á»u Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi trÃ¬nh duyá»‡t vÃ  khÃ´ng yÃªu cáº§u chÃºng ta giÃºp báº¥t cá»© thá»© gÃ¬. NhÆ°ng nÃ³ khÃ´ng nháº¥t thiáº¿t nghÄ©a lÃ  chÃºng ta khÃ´ng thá»ƒ lÃ m gÃ¬. Chá»n lá»±a Ä‘Ãºng pattern vá» giao tiáº¿p máº¡ng, loáº¡i vÃ  táº§n suáº¥t transfer, lá»±a chá»n cÃ¡c giao thá»©c vÃ  tinh chá»‰nh/tá»‘i Æ°u hÃ³a server stack cÃ³ thá»ƒ Ä‘Ã³ng vai trÃ² ráº¥t lá»›n trong viá»‡c cáº£i thiá»‡n hiá»‡u nÄƒng tá»•ng thá»ƒ cá»§a á»©ng dá»¥ng.</p><p>Má»™t vÃ i trÃ¬nh duyá»‡t tháº­m chÃ­ cÃ²n Ä‘i xa hÆ¡n. VÃ­ dá»¥, Chrome cÃ³ thá»ƒ tá»± dáº¡y cho chÃ­nh nÃ³ hoáº¡t Ä‘á»™ng nhanh hÆ¡n khi báº¡n sá»­ dá»¥ng nÃ³. NÃ³ há»c há»i dá»±a trÃªn nhá»¯ng trang báº¡n Ä‘Ã£ ghÃ© thÄƒm vÃ  kiá»ƒu duyá»‡t web Ä‘iá»ƒn hÃ¬nh cho nÃªn nÃ³ cÃ³ thá»ƒ dá»± Ä‘oÃ¡n hÃ nh vi ngÆ°á»i dÃ¹ng cÃ³ kháº£ nÄƒng vÃ  thá»±c hiá»‡n hÃ nh Ä‘á»™ng trÆ°á»›c khi user lÃ m gÃ¬ Ä‘Ã³. VÃ­ dá»¥ Ä‘Æ¡n giáº£n nháº¥t lÃ  tá»± Ä‘á»™ng render trÆ°á»›c ná»™i dung cá»§a trang khi user rÃª chuá»™t lÃªn 1 link. Náº¿u báº¡n tháº¥y há»©ng thÃº vá» chá»§ Ä‘á» tá»‘i Æ°u hÃ³a cá»§a Chrome thÃ¬ cÃ³ thá»ƒ Ä‘á»c thÃªm chÆ°Æ¡ng nÃ y <a href="https://www.igvita.com/posa/high-performance-networking-in-google-chrome/" target="_blank" rel="noopener">https://www.igvita.com/posa/high-performance-networking-in-google-chrome/</a> náº±m trong quyá»ƒn sÃ¡ch <a href="https://hpbn.co/" target="_blank" rel="noopener">High-Performance Browser Networking</a></p><h1 id="Bao-mat-mang-va-dong-goi-sandbox"><a href="#Bao-mat-mang-va-dong-goi-sandbox" class="headerlink" title="Báº£o máº­t máº¡ng vÃ  Ä‘Ã³ng gÃ³i sandbox"></a>Báº£o máº­t máº¡ng vÃ  Ä‘Ã³ng gÃ³i sandbox</h1><p>Cho phÃ©p trÃ¬nh duyá»‡t quáº£n lÃ½ cÃ¡c socket riÃªng biá»‡t cÃ³ má»™t Ã½ nghÄ©a ráº¥t quan trá»ng: báº±ng cÃ¡ch nÃ y trÃ¬nh duyá»‡t cho phÃ©p Ã¡p Ä‘áº·t má»™t há»‡ thá»‘ng Ä‘á»“ng nháº¥t cÃ¡c rÃ ng buá»™c vá» chÃ­nh sÃ¡ch vÃ  báº£o máº­t lÃªn nhá»¯ng nguá»“n tÃ i nguyÃªn á»©ng dá»¥ng khÃ´ng Ä‘Ã¡ng tin cáº­y. VÃ­ dá»¥ nhÆ° trÃ¬nh duyá»‡t sáº½ khÃ´ng cháº¥p nháº­n API truy xuáº¥t trá»±c tiáº¿p vÃ o network socket thÃ´ vÃ¬ nhÆ° váº­y cÃ³ thá»ƒ cho phÃ©p cÃ¡c á»©ng dá»¥ng Ä‘á»™c háº¡i táº¡o káº¿t ná»‘i tÃ¹y tiá»‡n Ä‘áº¿n báº¥t cá»© host nÃ o. TrÃ¬nh duyá»‡t cÅ©ng Ã¡p Ä‘áº·t cÃ¡c giá»›i háº¡n káº¿t ná»‘i Ä‘á»ƒ báº£o vá»‡ server cÅ©ng nhÆ° client khá»i cáº¡n kiá»‡t tÃ i nguyÃªn.</p><p>TrÃ¬nh duyá»‡t Ä‘á»‹nh dáº¡ng táº¥t cáº£ cÃ¡c request Ä‘i ra Ä‘á»ƒ Ã¡p Ä‘áº·t sá»± Ä‘á»“ng nháº¥t vÃ  cÃ¡c ngá»¯ nghÄ©a giao thá»©c tá»‘t Ä‘á»ƒ báº£o vá»‡ server. TÆ°Æ¡ng tá»±, giáº£i mÃ£ response Ä‘Æ°á»£c thá»±c hiá»‡n má»™t cÃ¡ch tá»± Ä‘á»™ng Ä‘á»ƒ báº£o vá»‡ user tá»« nhá»¯ng server Ä‘á»™c háº¡i.</p><h2 id="Trao-doi-TLS"><a href="#Trao-doi-TLS" class="headerlink" title="Trao Ä‘á»•i TLS"></a>Trao Ä‘á»•i TLS</h2><p><a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener">Transport Layer Security (TLS)</a> lÃ  má»™t giao thá»©c máº­t mÃ£ cung cáº¥p giao tiáº¿p báº£o máº­t trong máº¡ng mÃ¡y tÃ­nh. NÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i trong nhiá»u á»©ng dá»¥ng, má»™t trong sá»‘ Ä‘Ã³ lÃ  trÃ¬nh duyá»‡t web. Website cÃ³ thá»ƒ dÃ¹ng TLS Ä‘á»ƒ báº£o Ä‘áº£m an ninh cho táº¥t cáº£ cÃ¡c giao tiáº¿p giá»¯a server vÃ  trÃ¬nh duyá»‡t web.</p><p>ToÃ n bá»™ quÃ¡ trÃ¬nh báº¯t tay TLS bao gá»“m cÃ¡c bÆ°á»›c sau:</p><ol><li>Client gá»­i má»™t lá»i nháº¯n â€œClient helloâ€ Ä‘áº¿n server, cÃ¹ng vá»›i má»™t giÃ¡ trá»‹ ngáº«u nhiÃªn cá»§a client vÃ  bá»™ mÃ£ hÃ³a Ä‘Æ°á»£c há»— trá»£.</li><li>Server tráº£ lá»i báº±ng cÃ¡ch gá»­i lá»i nháº¯n â€œServer helloâ€ vá» cho client, cÃ¹ng vá»›i giÃ¡ trá»‹ ngáº«u nhiÃªn cá»§a server.</li><li>Server gá»­i chá»©ng chá»‰ xÃ¡c thá»±c cá»§a nÃ³ vá» cho client vÃ  cÃ³ thá»ƒ yÃªu cáº§u má»™t chá»©ng chá»‰ tÆ°Æ¡ng tá»± tá»« phÃ­a client. Server gá»­i lá»i nháº¯n â€œServer hello doneâ€.</li><li>Náº¿u server Ä‘Ã£ yÃªu cáº§u má»™t chá»©ng chá»‰ tá»« client thÃ¬ client pháº£i gá»­i nÃ³.</li><li>Client táº¡o ra má»™t Pre-Master Secret ngáº«u nhiÃªn vÃ  mÃ£ hÃ³a nÃ³ vá»›i public key tá»« chá»©ng chá»‰ cá»§a server, gá»­i Pre-Master Secret Ä‘Ã£ Ä‘Æ°á»£c mÃ£ hÃ³a vá» cho server.</li><li>Server nháº­n Pre-Master Secret. Server vÃ  client má»—i bÃªn sáº½ sinh ra Master Secret vÃ  session key (chÃ¬a khÃ³a phiÃªn) dá»±a trÃªn Pre-Master Secret.</li><li>Client gá»­i thÃ´ng bÃ¡o â€œChange cipher specâ€ Ä‘áº¿n server Ä‘á»ƒ xÃ¡c Ä‘á»‹nh ráº±ng client sáº½ báº¯t Ä‘áº§u sá»­ dá»¥ng session key má»›i Ä‘á»ƒ bÄƒm vÃ  mÃ£ hÃ³a message. Client cÅ©ng Ä‘á»“ng thá»i gá»­i tin nháº¯n â€œClient finishedâ€.</li><li>Server nháº­n â€œChange cipher specâ€ vÃ  chuyá»ƒn Ä‘á»•i tráº¡ng thÃ¡i báº£o máº­t cá»§a record layer cá»§a nÃ³ sang tráº¡ng thÃ¡i báº£o máº­t mÃ£ hÃ³a Ä‘á»‘i xá»©ng báº±ng session key. Server gá»­i lá»i nháº¯n â€œserver finishedâ€ vá» cho client.</li><li>Client vÃ  server giá» cÃ³ thá»ƒ trao Ä‘á»•i dá»¯ liá»‡u á»©ng dá»¥ng thÃ´ng qua kÃªnh báº£o máº­t mÃ  chÃºng Ä‘Ã£ thiáº¿t láº­p. Táº¥t cáº£ message Ä‘Æ°á»£c gá»­i tá»« client Ä‘áº¿n server vÃ  ngÆ°á»£c láº¡i Ä‘á»u Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng session key.</li></ol><p>User Ä‘Æ°á»£c cáº£nh bÃ¡o trong trÆ°á»ng há»£p má»™t trong sá»‘ xÃ¡c thá»±c nÃ o Ä‘Ã³ bá»‹ sai, vÃ­ dá»¥: server Ä‘ang dÃ¹ng má»™t chá»©ng chá»‰ tá»± cáº¥p.</p><h2 id="Chinh-sach-cung-origin"><a href="#Chinh-sach-cung-origin" class="headerlink" title="ChÃ­nh sÃ¡ch cÃ¹ng origin"></a>ChÃ­nh sÃ¡ch cÃ¹ng origin</h2><p>Hai trang cÃ³ cÃ¹ng origin náº¿u nhÆ° giao thá»©c, cá»•ng (náº¿u Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh) vÃ  host Ä‘á»u giá»‘ng nhau giá»¯a 2 trang</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  má»™t vÃ i vÃ­ dá»¥ vá» cÃ¡c tÃ i nguyÃªn cÃ³ thá»ƒ Ä‘Æ°á»£c nhÃºng cross-origin (xuyÃªn origin):</p><ul><li>Javascript vá»›i code <code>&lt;script src=&quot;â€¦&quot;&gt;&lt;/script&gt;</code>. ThÃ´ng bÃ¡o lá»—i cÃº phÃ¡p chá»‰ tá»“n táº¡i cho nhá»¯ng Ä‘oáº¡n script cÃ¹ng origin.</li><li>CSS vá»›i <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;â€¦&quot;&gt;</code>. Do quy táº¯c cÃº phÃ¡p thoáº£i mÃ¡i cá»§a CSS nÃªn CSS cross-origin cáº§n má»™t header Content-Type Ä‘Ãºng loáº¡i. Sá»± háº¡n cháº¿ thÃ¬ tÃ¹y thuá»™c vÃ o trÃ¬nh duyá»‡t.</li><li>HÃ¬nh áº£nh vá»›i tháº» <code>&lt;img /&gt;</code></li><li>File Ä‘a phÆ°Æ¡ng tiá»‡n vá»›i <code>&lt;video&gt;</code> vÃ  <code>&lt;audio&gt;</code></li><li>Plug in vá»›i <code>&lt;object&gt;</code>, <code>&lt;embed&gt;</code> and <code>&lt;applet&gt;</code></li><li>Fonts vá»›i @font-face. VÃ i trÃ¬nh duyá»‡t cho phÃ©p cÃ¡c font cross-origin, má»™t sá»‘ khÃ¡c thÃ¬ yÃªu cáº§u fonts trong cÃ¹ng origin.</li><li>Báº¥t cá»© thá»© gÃ¬ vá»›i <code>&lt;frame&gt;</code> vÃ  <code>&lt;iframe&gt;</code>. Má»™t trang cÃ³ thá»ƒ sá»­ dá»¥ng header X-Frame-Options Ä‘á»ƒ ngÄƒn cháº·n trÆ°á»ng há»£p tÆ°Æ¡ng tÃ¡c cross-origin nÃ y.</li></ul><p>Danh sÃ¡ch trÃªn váº«n cÃ²n thiáº¿u sÃ³t nhiá»u, má»¥c Ä‘Ã­ch cá»§a nÃ³ lÃ  lÃ m ná»•i báº­t nguyÃªn táº¯c â€œquyá»n háº¡n tá»‘i thiá»ƒuâ€ (least privilege). TrÃ¬nh duyá»‡t chá»‰ phÃ´ ra nhá»¯ng API vÃ  tÃ i nguyÃªn cáº§n thiáº¿t cho code cá»§a chÆ°Æ¡ng trÃ¬nh: á»©ng dá»¥ng há»— trá»£ dá»¯ liá»‡u vÃ  URL, trÃ¬nh duyá»‡t Ä‘á»‹nh dáº¡ng cÃ¡c request vÃ  xá»­ lÃ½ toÃ n bá»™ vÃ²ng Ä‘á»i cá»§a má»—i káº¿t ná»‘i.</p><p>Ráº¥t Ä‘Ã¡ng Ä‘á»ƒ lÆ°u tÃ¢m ráº±ng hoÃ n toÃ n khÃ´ng cÃ³ má»™t concept cá»¥ thá»ƒ nÃ o cá»§a â€œchÃ­nh sÃ¡ch cÃ¹ng originâ€ (same-origin policy). Thay vÃ o Ä‘Ã³, chá»‰ cÃ³ 1 bá»™ cÆ¡ cháº¿ liÃªn quan Ã¡p Ä‘áº·t cÃ¡c rÃ ng buá»™c lÃªn viá»‡c truy xuáº¥t DOM, cookie vÃ  quáº£n lÃ½ tráº¡ng thÃ¡i cá»§a session, máº¡ng vÃ  cÃ¡c thÃ nh pháº§n khÃ¡c cá»§a trÃ¬nh duyá»‡t.</p><h1 id="Luu-dem-tai-nguyen-va-trang-thai-cua-client"><a href="#Luu-dem-tai-nguyen-va-trang-thai-cua-client" class="headerlink" title="LÆ°u Ä‘á»‡m tÃ i nguyÃªn vÃ  tráº¡ng thÃ¡i cá»§a client"></a>LÆ°u Ä‘á»‡m tÃ i nguyÃªn vÃ  tráº¡ng thÃ¡i cá»§a client</h1><p>Request nhanh nháº¥t vÃ  tá»‘t nháº¥t chÃ­nh lÃ  khÃ´ng gá»i request nÃ o cáº£. TrÆ°á»›c khi Ä‘iá»u phá»‘i má»™t request, trÃ¬nh duyá»‡t tá»± Ä‘á»™ng kiá»ƒm tra bá»™ Ä‘á»‡m tÃ i nguyÃªn cá»§a nÃ³, thá»±c hiá»‡n cÃ¡c kiá»ƒm tra xÃ¡c nháº­n cáº§n thiáº¿t vÃ  tráº£ vá» má»™t báº£n copy local cá»§a tÃ i nguyÃªn Ä‘Ã³ náº¿u phÃ¹ há»£p vá»›i nhá»¯ng Ä‘iá»u kiá»‡n cá»¥ thá»ƒ. Náº¿u tÃ i nguyÃªn á»Ÿ local khÃ´ng tá»“n táº¡i trong cache thÃ¬ request lÃªn máº¡ng Ä‘Æ°á»£c gá»i vÃ  response sáº½ Ä‘Æ°á»£c chÃ¨n tá»± Ä‘á»™ng vÃ o trong cache Ä‘á»ƒ cho láº§n truy cáº­p tiáº¿p theo náº¿u Ä‘Æ°á»£c phÃ©p.</p><ul><li>TrÃ¬nh duyá»‡t tá»± Ä‘á»™ng Ä‘Ã¡nh giÃ¡ cÃ¡c chá»‰ thá»‹ lÆ°u Ä‘á»‡m (cache directives) cho má»—i tÃ i nguyÃªn.</li><li>TrÃ¬nh duyá»‡t tá»± Ä‘á»™ng xÃ¡c nháº­n láº¡i cÃ¡c tÃ i nguyÃªn háº¿t háº¡n khi nÃ³ cÃ³ thá»ƒ.</li><li>TrÃ¬nh duyá»‡t tá»± Ä‘á»™ng quáº£n lÃ½ kÃ­ch cá»¡ cá»§a bá»™ Ä‘á»‡m vÃ  thu há»“i tÃ i nguyÃªn.</li></ul><p>Quáº£n lÃ½ bá»™ Ä‘á»‡m tÃ i nguyÃªn má»™t cÃ¡ch hiá»‡u quáº£ vÃ  tá»‘i Æ°u lÃ  ráº¥t khÃ³. Æ n trá»i trÃ¬nh duyá»‡t Ä‘Ã£ xá»­ lÃ½ toÃ n bá»™ nhá»¯ng thá»© phá»©c táº¡p áº¥y giÃºp chÃºng ta rá»“i, táº¥t cáº£ nhá»¯ng gÃ¬ ta cáº§n lÃ m lÃ  Ä‘áº£m báº£o server cá»§a mÃ¬nh tráº£ vá» cache directive phÃ¹ há»£p, Ä‘á»ƒ hiá»ƒu rÃµ hÆ¡n thÃ¬ báº¡n cÃ³ thá»ƒ Ä‘á»c bÃ i <a href="https://hpbn.co/optimizing-application-delivery/#cache-resources-on-the-client" target="_blank" rel="noopener">Cache Resources on the Client</a>. Báº¡n cung cáº¥p cÃ¡c response headers nhÆ° Cache-Control, ETag vÃ  Last-Modified cho táº¥t cáº£ nguá»“n tÃ i nguyÃªn trÃªn trang cá»§a báº¡n, pháº£i khÃ´ng?</p><p>Cuá»‘i cÃ¹ng, má»™t chá»©c nÄƒng thÆ°á»ng bá»‹ bá» quáº£ nhÆ°ng khÃ¡ quan trá»ng cá»§a trÃ¬nh duyá»‡t chÃ­nh lÃ  nhiá»‡m vá»¥ cung cáº¥p xÃ¡c thá»±c, session vÃ  quáº£n lÃ½ cookie. TrÃ¬nh duyá»‡t duy trÃ¬ cÃ¡c gÃ³i cookie (cookie jars - tÃ¡c giáº£ chÆ¡i chá»¯ â€œcookie - bÃ¡nh quyâ€) riÃªng biá»‡t cho má»—i origin, cung cáº¥p cÃ¡c á»©ng dá»¥ng cáº§n thiáº¿t vÃ  server APIs Ä‘á»ƒ Ä‘á»c/ghi cookie, session vÃ  dá»¯ liá»‡u xÃ¡c thá»±c má»›i, tá»± Ä‘á»™ng ná»‘i &amp; xá»­ lÃ½ cÃ¡c header HTTP phÃ¹ há»£p Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a toÃ n bá»™ quÃ¡ trÃ¬nh thay cho chÃºng ta.</p><p>VÃ­ dá»¥:<br>Má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n nhÆ°ng dá»… minh há»a nháº¥t vá» sá»± tiá»‡n dá»¥ng cá»§a viá»‡c hoÃ£n quáº£n lÃ½ tráº¡ng thÃ¡i session vá»›i trÃ¬nh duyá»‡t: má»™t session Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c thá»±c cÃ³ thá»ƒ chia sáº» giá»¯a nhiá»u tab vá»›i nhau hoáº·c nhiá»u cá»­a sá»• trÃ¬nh duyá»‡t vÃ  ngÆ°á»£c láº¡i; má»™t hÃ nh Ä‘á»™ng Ä‘Äƒng xuáº¥t (sign-out) á»Ÿ 1 tab sáº½ vÃ´ hiá»‡u hÃ³a cÃ¡c session Ä‘ang má»Ÿ á»Ÿ toÃ n bá»™ cÃ¡c cá»­a sá»• Ä‘ang má»Ÿ khÃ¡c.</p><h1 id="Cac-API-ung-dung-va-giao-thuc"><a href="#Cac-API-ung-dung-va-giao-thuc" class="headerlink" title="CÃ¡c API á»©ng dá»¥ng vÃ  giao thá»©c"></a>CÃ¡c API á»©ng dá»¥ng vÃ  giao thá»©c</h1><p>CÃ ng Ä‘i sÃ¢u tÃ¬m hiá»ƒu vá» cÃ¡c dá»‹ch vá»¥ network sáºµn cÃ³ thÃ¬ cuá»‘i cÃ¹ng chÃºng ta cÅ©ng Ä‘Ã£ tiáº¿n Ä‘áº¿n cÃ¡c API á»©ng dá»¥ng vÃ  giao thá»©c (Application APIs &amp; Protocols). NhÆ° ta Ä‘Ã£ biáº¿t, nhá»¯ng layer tháº¥p thÃ¬ cung cáº¥p má»™t máº£ng rá»™ng cÃ¡c dá»‹ch vá»¥ quan trá»ng: quáº£n lÃ½ socket &amp; káº¿t ná»‘i, xá»­ lÃ½ request &amp; response, Ã¡p Ä‘áº·t nhiá»u chÃ­nh sÃ¡ch báº£o máº­t, lÆ°u Ä‘á»‡m &amp; cÃ²n nhiá»u ná»¯a. Má»—i khi chÃºng ta khá»Ÿi táº¡o HTTP hay XMLHttpRequest, sá»± kiá»‡n long-lived Server-Sent hay WebSocket session, hoáº·c má»Ÿ káº¿t ná»‘i WebRTCâ€¦ chÃºng ta Ä‘ang tÆ°Æ¡ng tÃ¡c vá»›i má»™t hoáº·c nhiá»u cÃ¡c dá»‹ch vá»¥ Ä‘Ã³.</p><p>KhÃ´ng cÃ³ giao thá»©c hay API nÃ o tá»‘t nháº¥t. Má»—i á»©ng dá»¥ng phá»©c táº¡p sáº½ cáº§n má»™t tá»• há»£p cÃ¡c giao váº­n (transports) khÃ¡c nhau dá»±a trÃªn sá»± Ä‘a dáº¡ng cá»§a cÃ¡c yÃªu cáº§u: giao tiáº¿p vá»›i bá»™ Ä‘á»‡m trÃ¬nh duyá»‡t, protocol overhead (metadata hoáº·c thÃ´ng tin Ä‘iá»u hÆ°á»›ng máº¡ng Ä‘Æ°á»£c gá»­i bá»Ÿi á»©ng dá»¥ng), Ä‘á»™ trá»… cá»§a message, Ä‘á»™ tin cáº­y, kiá»ƒu truyá»n táº£i dá»¯ liá»‡u, vÃ¢n vÃ¢n. Má»™t sá»‘ giao thá»©c cÃ³ thá»ƒ Ä‘Ã¡p á»©ng vá»›i Ä‘á»™ trá»… tháº¥p (vÃ­ dá»¥: Server-Sent Events, WebSocket), nhÆ°ng khÃ´ng yÃªu cáº§u cÃ¡c tiÃªu chÃ­ quan trá»ng khÃ¡c, cháº³ng háº¡n nhÆ° kháº£ nÄƒng táº­n dá»¥ng bá»™ Ä‘á»‡m trÃ¬nh duyá»‡t hoáº·c há»— trá»£ truyá»n táº£i nhá»‹ phÃ¢n hiá»‡u quáº£ trong má»i trÆ°á»ng há»£p.</p><h1 id="Mot-vai-thu-ban-co-the-lam-de-cai-thien-hieu-nang-va-bao-mat-cua-Webapp"><a href="#Mot-vai-thu-ban-co-the-lam-de-cai-thien-hieu-nang-va-bao-mat-cua-Webapp" class="headerlink" title="Má»™t vÃ i thá»© báº¡n cÃ³ thá»ƒ lÃ m Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u nÄƒng vÃ  báº£o máº­t cá»§a Webapp"></a>Má»™t vÃ i thá»© báº¡n cÃ³ thá»ƒ lÃ m Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u nÄƒng vÃ  báº£o máº­t cá»§a Webapp</h1><ul><li>LuÃ´n luÃ´n sá»­ dá»¥ng header <code>Connection: Keep-Alive</code> trong cÃ¡c request. TrÃ¬nh duyá»‡t Ä‘Ã£ máº·c Ä‘á»‹nh sáºµn rá»“i. Äáº£m báº£o server sá»­ dá»¥ng cÆ¡ cháº¿ tÆ°Æ¡ng tá»±.</li><li>Sá»­ dá»¥ng header Cache-Control, Etag vÃ  Last-Modified phÃ¹ há»£p Ä‘á»ƒ tiáº¿t kiá»‡m thá»i gian download cho trÃ¬nh duyá»‡t.</li><li>DÃ nh thá»i gian Ä‘á»ƒ tinh chá»‰nh vÃ  tá»‘i Æ°u hÃ³a web server, phÃ©p mÃ u sáº½ xáº£y ra! Nhá»› ráº±ng quÃ¡ trÃ¬nh nÃ y ráº¥t cá»¥ thá»ƒ cho tá»«ng loáº¡i webapp vÃ  kiá»ƒu dá»¯ liá»‡u mÃ  báº¡n trao Ä‘á»•i.</li><li>LuÃ´n luÃ´n dÃ¹ng TLS! Äáº·c biá»‡t náº¿u nhÆ° báº¡n cÃ³ báº¥t ká»³ xÃ¡c thá»±c nÃ o trong á»©ng dá»¥ng cá»§a báº¡n.</li><li>NghiÃªn cá»©u trÃ¬nh duyá»‡t cung cáº¥p cÃ¡c chÃ­nh sÃ¡ch báº£o máº­t nÃ o vÃ  Ã¡p Ä‘áº·t chÃºng vÃ o trong á»©ng dá»¥ng cá»§a báº¡n.</li></ul><p>Hiá»‡u nÄƒng vÃ  báº£o máº­t lÃ  Æ°u tiÃªn hÃ ng Ä‘áº§u trong <a href="https://www.sessionstack.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_content=js-series-networking-layer-outro" target="_blank" rel="noopener">SessionStack</a>. LÃ½ do táº¡i sao team tÃ¡c giáº£ khÃ´ng thá»ƒ nghiÃªng vá» má»™t bÃªn nÃ o hÆ¡n lÃ  bá»Ÿi vÃ¬ má»™t khi Ä‘Ã£ tÃ­ch há»£p SessionStack vÃ o webapp, nÃ³ báº¯t Ä‘áº§u giÃ¡m sÃ¡t má»i thá»© tá»« thay Ä‘á»•i trÃªn DOM, tÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng Ä‘áº¿n request máº¡ng, biá»‡t lá»‡ vÃ  thÃ´ng bÃ¡o debug. Táº¥t cáº£ thÃ´ng tin nÃ y Ä‘Æ°á»£c truyá»n vá» server theo thá»i gian thá»±c vÃ  cho phÃ©p user cÃ³ thá»ƒ cháº¡y láº¡i cÃ¡c váº¥n Ä‘á» Ä‘Ã£ xáº£y ra dÆ°á»›i dáº¡ng video &amp; xem má»i thá»© xáº£y ra vá»›i ngÆ°á»i dÃ¹ng cá»§a báº¡n. Táº¥t cáº£ hoáº¡t Ä‘á»™ng nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n vá»›i Ä‘á»™ trá»… tá»‘i thiá»ƒu vÃ  khÃ´ng áº£nh hÆ°á»Ÿng tá»›i hiá»‡u nÄƒng cá»§a app cá»§a báº¡n.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 12 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;NhÆ° Ä‘Ã£ nÃ³i trong bÃ i trÆ°á»›c vá» &lt;a href=&quot;https://kipalog.com/posts/Duc-khoet-Javascript--Phan-11---Render-engine---meo-toi-uu-hoa-hieu-nang-render&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;render engine&lt;/a&gt;, tÃ¡c giáº£ bÃ i viáº¿t tin ráº±ng sá»± khÃ¡c biá»‡t giá»¯a má»™t Javascript developer tá»‘t (good) vÃ  tuyá»‡t vá»i (great) lÃ  dev tuyá»‡t vá»i khÃ´ng nhá»¯ng hiá»ƒu vá» cÃ¡c thÃ nh pháº§n cÆ¡ báº£n cá»§a má»™t ngÃ´n ngá»¯ mÃ  cÃ²n cáº£ pháº§n cá»‘t lÃµi cÅ©ng nhÆ° mÃ´i trÆ°á»ng xung quanh nÃ³.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P11: Render engine &amp; máº¹o tá»‘i Æ°u hÃ³a hiá»‡u nÄƒng render</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P11-Render-engine-meo-toi-uu-hoa-hieu-nang-render.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P11-Render-engine-meo-toi-uu-hoa-hieu-nang-render.html</id>
    <published>2018-11-25T08:29:00.000Z</published>
    <updated>2018-11-25T08:33:25.317Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 11 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p>Trong nhá»¯ng bÃ i trÆ°á»›c cá»§a series â€œÄá»¥c khoÃ©t Javascriptâ€, chÃºng ta Ä‘Ã£ táº­p trung vÃ o tÃ¬m hiá»ƒu <strong>ngÃ´n ngá»¯</strong> Javascript, cÃ¡c tÃ­nh nÄƒng cá»§a nÃ³, cÃ¡ch chÃºng Ä‘Æ°á»£c thá»±c thi trÃªn trÃ¬nh duyá»‡t, lÃ m tháº¿ nÃ o Ä‘á»ƒ tá»‘i Æ°u hÃ³a, vÃ¢n vÃ¢n.</p><p>Tuy nhiÃªn, khi báº¡n xÃ¢y dá»±ng webapp, báº¡n khÃ´ng chá»‰ viáº¿t code Javascript. Code cá»§a báº¡n cÃ²n tÆ°Æ¡ng tÃ¡c vá»›i mÃ´i trÆ°á»ng. Tháº¥u hiá»ƒu mÃ´i trÆ°á»ng, cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³ sáº½ cho phÃ©p báº¡n xÃ¢y dá»±ng app tá»‘t hÆ¡n vÃ  cÃ³ ná»n táº£ng chuáº©n bá»‹ tá»‘t Ä‘á»ƒ Ä‘á» phÃ²ng nhá»¯ng nguy cÆ¡ tiá»m tÃ ng cÃ³ thá»ƒ xáº£y Ä‘áº¿n báº¥t cá»© lÃºc nÃ o khi lÃªn production.<br><a id="more"></a><br><img src="https://cdn-images-1.medium.com/max/1000/1*lMBu87MtEsVFqqbfMum-kA.png" alt=""></p><p>CÃ¡c thÃ nh pháº§n chÃ­nh cá»§a trÃ¬nh duyá»‡t:</p><ul><li><strong>Giao diá»‡n (User interface)</strong>: pháº§n nÃ y bao gá»“m thanh Ä‘á»‹a chá»‰ (address bar), nÃºt back &amp; forward, menu bookmark, vÃ¢n vÃ¢n. Vá» báº£n cháº¥t, Ä‘Ã¢y lÃ  nhá»¯ng pháº§n thuá»™c vá» trÃ¬nh duyá»‡t hiá»ƒn thá»‹ lÃªn cho báº¡n tháº¥y, ngoáº¡i trá»« khung hiá»ƒn thá»‹ trang web.</li><li><strong>Engine trÃ¬nh duyá»‡t (Browser engine)</strong>: nÃ³ xá»­ lÃ½ cÃ¡c giao tiáº¿p giá»¯a user interface vÃ  rendering engine</li><li><strong>Engine dá»±ng hÃ¬nh (Rendering engine)</strong>: chá»‹u trÃ¡ch nhiá»‡m hiá»ƒn thá»‹ trang web. Rendering engine sáº½ phÃ¢n giáº£i HTML &amp; CSS vÃ  hiá»ƒn thá»‹ ná»™i dung Ä‘Ã³ lÃªn mÃ n hÃ¬nh.</li><li><strong>Máº¡ng (Networking)</strong>: Ä‘Ã¢y lÃ  nhá»¯ng lá»i gá»i máº¡ng cháº³ng háº¡n nhÆ° XHR request, chÃºng Ä‘Æ°á»£c táº¡o ra báº±ng cÃ¡ch sá»­ dá»¥ng nhiá»u triá»ƒn khai khÃ¡c nhau cho nhiá»u ná»n táº£ng khÃ¡c nhau náº±m phÃ­a sau má»™t interface Ä‘á»™c láº­p ná»n táº£ng (platform-independent interface). ChÃºng ta sáº½ tháº£o luáº­n vá» lá»›p network chi tiáº¿t hÆ¡n á»Ÿ bÃ i tiáº¿p theo (sá»‘ 12) trong series nÃ y nhÃ©.</li><li><strong>Giao diá»‡n á»Ÿ backend (UI Backend)</strong>: dÃ¹ng Ä‘á»ƒ váº½ nÃªn cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, vÃ­ dá»¥ nhÆ° checkbox hay cá»­a sá»•. Pháº§n nÃ y thá»ƒ hiá»‡n má»™t interface chung khÃ´ng phá»¥ thuá»™c hay Ä‘áº·c trÆ°ng cho ná»n táº£ng. NÃ³ sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c vá» UI cá»§a há»‡ Ä‘iá»u hÃ nh.</li><li><strong>Javascript engine</strong>: ChÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu vá» pháº§n nÃ y trong <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-2---Ben-trong-engine-V8---5-meo-de-toi-uu-hoa-code" target="_blank" rel="noopener">bÃ i trÆ°á»›c</a>. Vá» cÆ¡ báº£n, Ä‘Ã¢y lÃ  nÆ¡i code Javascript Ä‘Æ°á»£c thá»±c thi.</li><li><strong>Cá»‘ Ä‘á»‹nh dá»¯ liá»‡u (Data persistence)</strong>: app cá»§a báº¡n cÃ³ thá»ƒ cáº§n lÆ°u trá»¯ dá»¯ liá»‡u á»Ÿ phÃ­a local. CÃ¡c loáº¡i kiáº¿n trÃºc lÆ°u trá»¯ Ä‘Æ°á»£c há»— trá»£ á»Ÿ Ä‘Ã¢y gá»“m cÃ³ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" target="_blank" rel="noopener">localStorage</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank" rel="noopener">indexDB</a>, <a href="https://en.wikipedia.org/wiki/Web_SQL_Database" target="_blank" rel="noopener">WebSQL</a> vÃ  <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileSystem" target="_blank" rel="noopener">FileSystem</a></li></ul><p>Trong bÃ i nÃ y, chÃºng ta sáº½ táº­p trung vÃ o rendering engine (engine dá»±ng hÃ¬nh), bá»Ÿi vÃ¬ nÃ³ xá»­ lÃ½ quÃ¡ trÃ¬nh phÃ¢n giáº£i vÃ  hÃ¬nh áº£nh hÃ³a (visualization) code HTML &amp; CSS, lÃ  pháº§n mÃ  Ä‘a sá»‘ app Javascript cáº§n tÆ°Æ¡ng tÃ¡c liÃªn tá»¥c.</p><h1 id="Khai-quat-ve-rendering-engine"><a href="#Khai-quat-ve-rendering-engine" class="headerlink" title="KhÃ¡i quÃ¡t vá» rendering engine"></a>KhÃ¡i quÃ¡t vá» rendering engine</h1><p>CÃ´ng viá»‡c chÃ­nh cá»§a rendering engine lÃ  hiá»ƒn thá»‹ trang Ä‘Æ°á»£c yÃªu cáº§u lÃªn mÃ n hÃ¬nh cá»§a trÃ¬nh duyá»‡t.</p><p>Rendering engine cÃ³ thá»ƒ hiá»ƒn thá»‹ HTML, vÄƒn báº£n XML vÃ  áº£nh. Náº¿u báº¡n sá»­ dá»¥ng thÃªm plugin á»Ÿ ngoÃ i thÃ¬ engine cÃ³ thá»ƒ hiá»ƒn thá»‹ cÃ¡c loáº¡i vÄƒn báº£n khÃ¡c, cháº³ng háº¡n nhÆ° PDF.</p><h1 id="Rendering-engines"><a href="#Rendering-engines" class="headerlink" title="Rendering engines"></a>Rendering engines</h1><p>TÆ°Æ¡ng tá»± nhÆ° Javascript engine, trÃ¬nh duyá»‡t khÃ¡c nhau cÅ©ng sá»­ dá»¥ng cÃ¡c rendering engine khÃ¡c nhau. Má»™t vÃ i bá»™ engine ná»•i tiáº¿ng:</p><ul><li><strong>Gecko</strong>â€Šâ€”â€ŠFirefox</li><li><strong>WebKit</strong>â€Šâ€”â€ŠSafari</li><li><strong>Blink</strong>â€Šâ€”â€ŠChrome, Opera (tá»« phiÃªn báº£n 15 trá»Ÿ Ä‘i)</li></ul><h1 id="Qua-trinh-render"><a href="#Qua-trinh-render" class="headerlink" title="QuÃ¡ trÃ¬nh render"></a>QuÃ¡ trÃ¬nh render</h1><p>Rendering engine nháº­n ná»™i dung cá»§a vÄƒn báº£n Ä‘Æ°á»£c yÃªu cáº§u tá»« lá»›p networking.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*9b1uEMcZLWuGPuYcIn7ZXQ.png" alt=""></p><h1 id="Xay-dung-DOM-tree"><a href="#Xay-dung-DOM-tree" class="headerlink" title="XÃ¢y dá»±ng DOM tree"></a>XÃ¢y dá»±ng DOM tree</h1><p>BÆ°á»›c Ä‘áº§u tiÃªn cá»§a cÃ´ng cuá»™c rendering lÃ  phÃ¢n giáº£i vÄƒn báº£n HTML vÃ  chuyá»ƒn nhá»¯ng pháº§n tá»­ Ä‘Ã£ phÃ¢n giáº£i thÃ nh nhá»¯ng DOM node thá»±c sá»± trong DOM tree.</p><p>Giáº£ sá»­ báº¡n cÃ³ Ä‘oáº¡n input nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"theme.css"</span>&gt;</span><br><span class="line">  &lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">  &lt;body&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt; Hello, &lt;span&gt; friend! &lt;/</span>span&gt; &lt;/p&gt;</span><br><span class="line">    &lt;div&gt; </span><br><span class="line">      &lt;img src=<span class="string">"smiley.gif"</span> alt=<span class="string">"Smiley face"</span> height=<span class="string">"42"</span> width=<span class="string">"42"</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure><p>DOM tree cá»§a Ä‘oáº¡n HTML trÃªn sáº½ giá»‘ng nhÆ° sau:<br><img src="https://cdn-images-1.medium.com/max/1000/1*ezFoXqgf91umls9FqO0HsQ.png" alt=""></p><p>Vá» cÆ¡ báº£n thÃ¬ má»—i pháº§n tá»­ Ä‘Æ°á»£c thá»ƒ hiá»‡n nhÆ° lÃ  má»™t node cha cá»§a táº¥t cáº£ cÃ¡c element khÃ¡c náº±m trá»±c tiáº¿p ngay bÃªn dÆ°á»›i (bÃªn trong) nÃ³. NguyÃªn táº¯c nÃ y Ä‘Æ°á»£c Ã¡p dá»¥ng má»™t cÃ¡ch Ä‘á»‡ quy.</p><h1 id="Xay-dung-CSSOM-tree"><a href="#Xay-dung-CSSOM-tree" class="headerlink" title="XÃ¢y dá»±ng CSSOM tree"></a>XÃ¢y dá»±ng CSSOM tree</h1><p>CSSOM viáº¿t táº¯t cá»§a <strong>CSS Object Model</strong>. Trong khi trÃ¬nh duyá»‡t Ä‘ang xÃ¢y dá»±ng DOM, nÃ³ báº¯t gáº·p má»™t tháº» link trong pháº§n head vÃ  dáº«n tá»›i má»™t file CSS tÃªn lÃ  theme.css á»Ÿ bÃªn ngoÃ i. Dá»± Ä‘oÃ¡n ráº±ng nÃ³ cÃ³ thá»ƒ cáº§n Ä‘áº¿n tÃ i nguyÃªn nÃ y Ä‘á»ƒ render trang, ngay láº­p tá»©c nÃ³ Ä‘iá»u phá»‘i 1 request Ä‘áº¿n. Giáº£ sá»­ file theme.css cÃ³ ná»™i dung nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">body &#123; </span><br><span class="line">  font-size: <span class="number">16</span>px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p &#123; </span><br><span class="line">  font-weight: bold; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">span &#123; </span><br><span class="line">  color: red; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p span &#123; </span><br><span class="line">  display: none; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">img &#123; </span><br><span class="line">  float: right; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TÆ°Æ¡ng tá»± HTML, engine cáº§n chuyá»ƒn táº¥t cáº£ CSS sang má»™t thá»© gÃ¬ Ä‘Ã³ mÃ  trÃ¬nh duyá»‡t cÃ³ thá»ƒ xá»­ lÃ½, chÃ­nh lÃ  CSSOM. DÆ°á»›i Ä‘Ã¢y lÃ  mÃ´ phá»ng cá»§a CSSOM tree:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*5YU1su2mdzHEQ5iDisKUyw.png" alt=""></p><p>Báº¡n cÃ³ tá»± há»i táº¡i sao CSSOM láº¡i cÃ³ cáº¥u trÃºc dáº¡ng cÃ¢y (tree)? Khi tÃ­nh toÃ¡n bá»™ style cuá»‘i cÃ¹ng cho má»—i object tren trang, trÃ¬nh duyá»‡t sáº½ báº¯t Ä‘áº§u vá»›i rule Ã¡p dá»¥ng toÃ n cá»¥c nháº¥t cho node Ä‘Ã³ (vÃ­ dá»¥: náº¿u nÃ³ lÃ  con cá»§a pháº§n tá»­ body thÃ¬ Ã¡p dá»¥ng táº¥t cáº£ style cá»§a body) vÃ  tinh chá»‰nh má»™t cÃ¡ch Ä‘á»‡ quy nhá»¯ng style Ä‘Ã£ Ä‘Æ°á»£c tÃ­nh toÃ¡n báº±ng cÃ¡ch Ã¡p dá»¥ng cÃ¡c rule cá»¥ thá»ƒ hÆ¡n.</p><p>Vá»›i vÃ­ dá»¥ á»Ÿ trÃªn, báº¥t ká»³ text nÃ o náº±m bÃªn trong tháº» span mÃ  span náº±m trong pháº§n tá»­ body thÃ¬ Ä‘á»u cÃ³ font-size 16 vÃ  mÃ u Ä‘á». Nhá»¯ng style nÃ y Ä‘Æ°á»£c káº¿ thá»«a tá»« pháº§n tá»­ body. Náº¿u nhÆ° span lÃ  con cá»§a pháº§n tá»­ p thÃ¬ ná»™i dung cá»§a nÃ³ sáº½ bá»‹ áº©n bá»Ÿi vÃ¬ cÃ³ style khÃ¡c cá»¥ thá»ƒ hÆ¡n Ä‘Ã£ Ä‘Æ°á»£c Ã¡p dá»¥ng cho nÃ³ (á»Ÿ Ä‘Ã¢y lÃ  display: none).</p><p>ThÃªm ná»¯a, lÆ°u Ã½ ráº±ng tree á»Ÿ trÃªn chÆ°a pháº£i lÃ  CSSOM tree hoÃ n chá»‰nh vÃ  chá»‰ thá»ƒ hiá»‡n nhá»¯ng style mÃ  ta Ä‘Ã£ ghi Ä‘Ã¨ trong style sheet. Má»—i trÃ¬nh duyá»‡t cung cáº¥p 1 bá»™ style máº·c Ä‘á»‹nh, cÃ²n Ä‘Æ°á»£c biáº¿t tá»›i lÃ  <strong>user agent styles</strong> - Ä‘Ã¢y chÃ­nh nhá»¯ng gÃ¬ ta tháº¥y náº¿u nhÆ° khÃ´ng cung cáº¥p style cá»¥ thá»ƒ. Style cá»§a chÃºng ta thÃªm vÃ o chá»‰ Ä‘Æ¡n giáº£n lÃ  ghi Ä‘Ã¨ láº¡i nhá»¯ng pháº§n máº·c Ä‘á»‹nh nÃ y.</p><h1 id="Xay-dung-render-tree"><a href="#Xay-dung-render-tree" class="headerlink" title="XÃ¢y dá»±ng render tree"></a>XÃ¢y dá»±ng render tree</h1><p>CÃ¹ng vá»›i pháº§n thá»ƒ hiá»‡n trá»±c quan trong HTML káº¿t há»£p vá»›i dá»¯ liá»‡u style tá»« CSSOM tree lÃ  chÃºng ta Ä‘Ã£ cÃ³ Ä‘á»§ nguyÃªn liá»‡u Ä‘á»ƒ táº¡o ra render tree.</p><p>Báº¡n sáº½ tháº¯c máº¯c â€œrender treeâ€ lÃ  gÃ¬? NÃ³ lÃ  1 cÃ¢y (tree) cá»§a cÃ¡c pháº§n tá»­ trá»±c quan Ä‘Æ°á»£c xÃ¢y dá»±ng theo thá»© tá»± trong Ä‘Ã³ chÃºng Ä‘Æ°á»£c hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh. ÄÃ³ lÃ  sá»± thá»ƒ hiá»‡n 1 cÃ¡ch trá»±c quan cá»§a HTML cÃ¹ng vá»›i CSS tÆ°Æ¡ng á»©ng. Má»¥c Ä‘Ã­ch cá»§a cÃ¢y nÃ y lÃ  cho phÃ©p tÃ´ mÃ u ná»™i dung theo Ä‘Ãºng thá»© tá»±.</p><p>Má»—i node trong render tree Ä‘Æ°á»£c gá»i lÃ  1 renderer hoáº·c render object trong Webkit.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch mÃ  render tree cá»§a DOM &amp; CSSOM á»Ÿ trÃªn thá»ƒ hiá»‡n:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*WHR_08AD8APDITQ-4CFDgg.png" alt=""></p><p>Äá»ƒ xÃ¢y dá»±ng render tree, trÃ¬nh duyá»‡t vá» cÆ¡ báº£n sáº½ lÃ m nhá»¯ng bÆ°á»›c sau Ä‘Ã¢y:</p><ul><li>Báº¯t Ä‘áº§u tá»« root cá»§a DOM tree, nÃ³ sáº½ Ä‘i qua má»—i <strong>node tháº¥y Ä‘Æ°á»£c</strong>. VÃ i node cÃ³ thá»ƒ bá»‹ áº©n Ä‘i (vÃ­ dá»¥ nhÆ° tag script, meta, vÃ¢n vÃ¢n) hoáº·c bá» qua bá»Ÿi vÃ¬ chÃºng khÃ´ng pháº£n chiáº¿u trong káº¿t quáº£ render Ä‘áº§u ra. VÃ i node bá»‹ áº©n bá»Ÿi CSS vÃ  cÅ©ng bá»‹ bá» qua khá»i render tree. VÃ­ dá»¥ nhÆ° node span trong vÃ­ dá»¥ trÃªn thÃ¬ nÃ³ sáº½ khÃ´ng cÃ³ máº·t trong render tree vÃ¬ Ä‘Ã£ Ä‘Æ°á»£c set style display: none rá»“i.</li><li>Vá»›i má»—i node tháº¥y Ä‘Æ°á»£c, trÃ¬nh duyá»‡t sáº½ tÃ¬m cÃ¡c rule CSSOM phÃ¹ há»£p vÃ  khá»›p vá»›i nÃ³ rá»“i Ã¡p dá»¥ng vÃ o.</li><li>TrÃ¬nh duyá»‡t sáº½ xuáº¥t ra cÃ¡c node tháº¥y Ä‘Æ°á»£c vá»›i ná»™i dung vÃ  style tÆ°Æ¡ng á»©ng.</li></ul><p>Báº¡n cÃ³ thá»ƒ xem qua source code cá»§a RenderObject (WebKit) á»Ÿ Ä‘Ã¢y: <a href="https://github.com/WebKit/webkit/blob/fde57e46b1f8d7dde4b2006aaf7ebe5a09a6984b/Source/WebCore/rendering/RenderObject.h" target="_blank" rel="noopener">https://github.com/WebKit/webkit/blob/fde57e46b1f8d7dde4b2006aaf7ebe5a09a6984b/Source/WebCore/rendering/RenderObject.h</a></p><p>CÃ¹ng nghÃ­a qua má»™t vÃ i dÃ²ng cá»‘t lÃµi trong class nÃ y nhÃ©:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class RenderObject : public CachedImageClient &#123;</span><br><span class="line">  <span class="comment">// TÃ´ mÃ u láº¡i toÃ n bá»™ object. NÃ³ sáº½ Ä‘Æ°á»£c gá»i khi border color thay Ä‘á»•i hoáº·c</span></span><br><span class="line">  <span class="comment">// border style thay Ä‘á»•i.</span></span><br><span class="line"></span><br><span class="line">  Node* node() <span class="keyword">const</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">  RenderStyle* style;  <span class="comment">// the computed style</span></span><br><span class="line">  <span class="keyword">const</span> RenderStyle&amp; style() <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Má»—i renderer thá»ƒ hiá»‡n má»™t khu vá»±c hÃ¬nh chá»¯ nháº­t tÆ°Æ¡ng á»©ng vá»›i CSS box cá»§a má»™t node. NÃ³ bao gá»“m cáº£ thÃ´ng tin hÃ¬nh há»c nhÆ° Ä‘á»™ rá»™ng (width), chiá»u cao (height) hay vá»‹ trÃ­ (position).</p><h1 id="Cach-bo-tri-cua-render-tree"><a href="#Cach-bo-tri-cua-render-tree" class="headerlink" title="CÃ¡ch bá»‘ trÃ­ cá»§a render tree"></a>CÃ¡ch bá»‘ trÃ­ cá»§a render tree</h1><p>Khi renderer Ä‘Æ°á»£c táº¡o ra vÃ  thÃªm vÃ o tree, nÃ³ khÃ´ng cÃ³ thÃ´ng tin vá»‹ trÃ­ hay kÃ­ch thÆ°á»›c, pháº§n tÃ­nh toÃ¡n cÃ¡c giÃ¡ trá»‹ nÃ y Ä‘Æ°á»£c gá»i lÃ  layout.</p><p>HTML sá»­ dá»¥ng mÃ´ hÃ¬nh layout theo dÃ²ng (flow-based layout), nghÄ©a lÃ  háº§u nhÆ° toÃ n bá»™ thá»i gian nÃ³ cÃ³ thá»ƒ tÃ­nh toÃ¡n thÃ´ng sá»‘ hÃ¬nh há»c chá»‰ trong 1 láº§n duyá»‡t. Há»‡ thá»‘ng tá»a Ä‘á»™ cÃ³ liÃªn quan Ä‘áº¿n root renderer. ThÃ´ng sá»‘ tá»a Ä‘á»™ top vÃ  left Ä‘Æ°á»£c sá»­ dá»¥ng.</p><p>Layout lÃ  1 quÃ¡ trÃ¬nh Ä‘á»‡ quy, nÃ³ báº¯t Ä‘áº§u á»Ÿ root renderer, chÃ­nh lÃ  thá»© tÆ°Æ¡ng á»©ng vá»›i pháº§n tá»­ <html> trong vÄƒn báº£n HTML. Layout tiáº¿p tá»¥c duyá»‡t Ä‘á»‡ quy qua má»™t hoáº·c toÃ n bá»™ cÃ¢y cáº¥p báº­c(hierarchy) renderer, tÃ­nh toÃ¡n cÃ¡c thÃ´ng tin hÃ¬nh há»c cáº§n thiáº¿t cho má»—i renderer.</html></p><p>Vá»‹ trÃ­ cá»§a root renderer lÃ  0,0 vÃ  kÃ­ch thÆ°á»›c cá»§a nÃ³ báº±ng pháº§n nhÃ¬n tháº¥y Ä‘Æ°á»£c cá»§a cá»­a sá»• hiá»ƒn thá»‹ trÃªn trÃ¬nh duyá»‡t (cÃ²n gá»i lÃ  viewport).</p><p>Báº¯t Ä‘áº§u quÃ¡ trÃ¬nh táº¡o layout chÃ­nh lÃ  truyá»n Ä‘áº¡t láº¡i cho má»—i node tá»a Ä‘á»™ chÃ­nh xÃ¡c mÃ  nÃ³ cáº§n pháº£i xuáº¥t hiá»‡n trÃªn mÃ n hÃ¬nh lÃ  á»Ÿ Ä‘Ã¢u.</p><h1 id="To-mau-cho-render-tree"><a href="#To-mau-cho-render-tree" class="headerlink" title="TÃ´ mÃ u cho render tree"></a>TÃ´ mÃ u cho render tree</h1><p>Trong giai Ä‘oáº¡n nÃ y, renderer tree Ä‘Ã£ Ä‘Æ°á»£c duyá»‡t qua vÃ  phÆ°Æ¡ng thá»©c paint() cá»§a renderer Ä‘Æ°á»£c gá»i Ä‘á»ƒ hiá»ƒn thá»‹ ná»™i dung lÃªn mÃ n hÃ¬nh.</p><p>TÃ´ mÃ u cÃ³ thá»ƒ theo cÃ¡ch global hoáº·c incremantal tÆ°Æ¡ng tá»± nhÆ° layout):</p><ul><li><strong>Global (toÃ n cá»¥c)</strong>: toÃ n bá»™ tree Ä‘Æ°á»£c lÃªn mÃ u.</li><li><strong>Incremental (gia tÄƒng)</strong>: chá»‰ cÃ³ má»™t vÃ i renderer thay Ä‘á»•i theo cÃ¡ch khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n toÃ n bá»™ tree. Renderer vÃ´ hiá»‡u hÃ³a khung chá»¯ nháº­t cá»§a chÃ­nh nÃ³ trÃªn mÃ n hÃ¬nh. Äiá»u nÃ y lÃ m cho OS (há»‡ Ä‘iá»u thÃ nh) hiá»ƒu ráº±ng vÃ¹ng Ä‘Ã³ cáº§n pháº£i Ä‘Æ°á»£c tÃ´ mÃ u láº¡i vÃ  sinh ra má»™t paint event. OS thá»±c hiá»‡n Ä‘iá»u Ä‘Ã³ má»™t cÃ¡ch thÃ´ng minh báº±ng cÃ¡ch gá»™p nhiá»u vÃ¹ng thÃ nh má»™t.</li></ul><p>Vá» tá»•ng quÃ¡t thÃ¬ quan trá»ng lÃ  cáº§n pháº£i hiá»ƒu ráº±ng tÃ´ mÃ u lÃ  quÃ¡ trÃ¬nh diá»…n ra tá»« tá»«. Äá»ƒ cÃ³ UX tá»‘t hÆ¡n, render engine sáº½ cá»‘ hiá»ƒn thá»‹ ná»™i dung trÃªn mÃ n hÃ¬nh ngay khi cÃ³ thá»ƒ. NÃ³ sáº½ khÃ´ng ngá»“i yÃªn Ä‘á»£i cho tá»›i khi toÃ n bá»™ HTML Ä‘Æ°á»£c parse Ä‘á»ƒ báº¯t Ä‘áº§u xÃ¢y dá»±ng vÃ  bá»‘ trÃ­ render tree. Tá»«ng pháº§n cá»§a ná»™i dung sáº½ Ä‘Æ°á»£c parse vÃ  hiá»ƒn thá»‹ lÃªn trong khi tiáº¿n trÃ¬nh tiáº¿p tá»¥c vá»›i nhá»¯ng item ná»™i dung tiáº¿p theo Ä‘ang Ä‘Æ°á»£c truyá»n vá» trÃªn máº¡ng.</p><h1 id="Thu-tu-xu-ly-script-va-style"><a href="#Thu-tu-xu-ly-script-va-style" class="headerlink" title="Thá»© tá»± xá»­ lÃ½ script vÃ  style"></a>Thá»© tá»± xá»­ lÃ½ script vÃ  style</h1><p>CÃ¡c script Ä‘Æ°á»£c parse vÃ  thá»±c thi ngay láº­p tá»©c khi parser vá»«a gáº·p tháº» <code>&lt;script&gt;</code>. QuÃ¡ trÃ¬nh parse cá»§a toÃ n bá»™ vÄƒn báº£n sáº½ táº¡m dá»«ng cho Ä‘áº¿n khi script thá»±c thi xong. NghÄ©a lÃ  tiáº¿n trÃ¬nh nÃ y diá»…n ra Ä‘á»“ng bá»™.</p><p>Náº¿u nhÆ° script lÃ  file á»Ÿ ngoÃ i thÃ¬ viá»‡c Ä‘áº§u tiÃªn nÃ³ cáº§n pháº£i Ä‘Æ°á»£c láº¥y vá» tá»« máº¡ng (báº¥t Ä‘á»“ng bá»™). Táº¥t cáº£ cÃ´ng viá»‡c parse sáº½ dá»«ng láº¡i cho Ä‘áº¿n khi láº¥y xong file.</p><p>HTML5 cÃ³ thÃªm 1 tÃ¹y chá»n Ä‘á»ƒ Ä‘Ã¡nh dáº¥u script lÃ  báº¥t Ä‘á»“ng bá»™, do Ä‘Ã³ nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c parse vÃ  thá»±c thi trong 1 tiáº¿n trÃ¬nh khÃ¡c.</p><h1 id="Toi-uu-hoa-hieu-suat-render"><a href="#Toi-uu-hoa-hieu-suat-render" class="headerlink" title="Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t render"></a>Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t render</h1><p>Náº¿u báº¡n muá»‘n tá»‘i Æ°u hÃ³a app thÃ¬ cÃ³ 5 Ä‘iá»ƒm chÃ­nh mÃ  báº¡n cáº§n táº­p trung vÃ o dÆ°á»›i Ä‘Ã¢y:</p><ol><li><strong>Javascript</strong> - trong cÃ¡c bÃ i trÆ°á»›c chÃºng ta Ä‘Ã£ nghiÃªn cá»©u vá» chá»§ Ä‘á» viáº¿t code tá»‘i Æ°u vÃ  cÃ³ hiá»‡u quáº£ bá»™ nhá»› cao mÃ  khÃ´ng lÃ m áº£nh hÆ°á»Ÿng Ä‘áº¿n UI. Vá»›i trÆ°á»ng há»£p cá»§a render, chÃºng ta cáº§n pháº£i suy nghÄ© vá» cÃ¡ch mÃ  code Javascript sáº½ tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c pháº§n tá»­ DOM trÃªn trang. Javascript cÃ³ thá»ƒ táº¡o ra ráº¥t nhiá»u thay Ä‘á»•i vá»›i UI, Ä‘áº·c biá»‡t lÃ  cÃ¡c app SPA.</li><li><strong>TÃ­nh toÃ¡n Style</strong> - Ä‘Ã¢y lÃ  tiáº¿n trÃ¬nh xÃ¡c Ä‘á»‹nh CSS rule nÃ o sáº½ Ã¡p dá»¥ng vÃ o pháº§n tá»­ nÃ o dá»±a trÃªn cÃ¡c selector. Má»™t khi cÃ¡c rule Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a, chÃºng sáº½ Ä‘Æ°á»£c Ã¡p dá»¥ng vÃ  tÃ­nh toÃ¡n style cuá»‘i cÃ¹ng cho má»—i pháº§n tá»­.</li><li><strong>Layout</strong> - khi trÃ¬nh duyá»‡t biáº¿t rule nÃ o Ã¡p dá»¥ng cho pháº§n tá»­ nÃ o, nÃ³ cÃ³ thá»ƒ báº¯t Ä‘áº§u tÃ­nh toÃ¡n bao nhiÃªu khÃ´ng gian má»™t pháº§n tá»­ sáº½ chiáº¿m dá»¥ng vÃ  vá»‹ trÃ­ cá»§a nÃ³ sáº½ náº±m á»Ÿ Ä‘Ã¢u trÃªn mÃ n hÃ¬nh cá»§a trÃ¬nh duyá»‡t. MÃ´ hÃ¬nh layout cá»§a trang web xÃ¡c Ä‘á»‹nh má»™t pháº§n tá»­ cÃ³ thá»ƒ gÃ¢y áº£nh hÆ°á»Ÿng Ä‘áº¿n pháº§n tá»­ khÃ¡c. VÃ­ dá»¥, Ä‘á»™ rá»™ng cá»§a <body> cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng Ä‘á»™ rá»™ng cá»§a pháº§n tá»­ con cá»§a nÃ³. Äiá»u nÃ y nghÄ©a lÃ  quÃ¡ trÃ¬nh layout sáº½ lÃ  quÃ¡ trÃ¬nh náº·ng vá» tÃ­nh toÃ¡n sá»‘ há»c. Pháº§n â€œváº½â€ Ä‘Æ°á»£c thá»±c hiá»‡n trong nhiá»u layer khÃ¡c nhau.</body></li><li><strong>TÃ´ mÃ u</strong> - Ä‘Ã¢y lÃ  lÃºc mÃ  cÃ¡c pixel thá»±c sá»± Ä‘Æ°á»£c lÃªn mÃ u. Tiáº¿n trÃ¬nh bao gá»“m cáº£ pháº§n váº½ cÃ¡c cÃ¢u chá»¯, mÃ u sáº¯c, hÃ¬nh áº£nh, viá»n, Ä‘á»• bÃ³ng, váº¥n vÃ¢n, tá»«ng pháº§n nhÃ¬n tháº¥y Ä‘Æ°á»£c cá»§a tá»«ng pháº§n tá»­.</li><li><strong>Káº¿t há»£p (Compositing)</strong> - Bá»Ÿi vÃ¬ cÃ¡c pháº§n nhá» cá»§a webpage Ä‘Æ°á»£c váº½ vÃ o trong nhiá»u lá»›p khÃ¡c nhau, chÃºng cáº§n Ä‘Æ°á»£c káº¿t há»£p vÃ o má»™t mÃ n hÃ¬nh theo Ä‘Ãºng thá»© tá»± Ä‘á»ƒ page cÃ³ thá»ƒ render má»™t cÃ¡ch chÃ­nh xÃ¡c. Äiá»u nÃ y ráº¥t quan trá»ng, Ä‘áº·c biá»‡t lÃ  vá»›i cÃ¡c pháº§n tá»­ chá»“ng nhau.</li></ol><h1 id="Toi-uu-hoa-JavaScript"><a href="#Toi-uu-hoa-JavaScript" class="headerlink" title="Tá»‘i Æ°u hÃ³a JavaScript"></a>Tá»‘i Æ°u hÃ³a JavaScript</h1><p>Javascript thÆ°á»ng trigger nhá»¯ng thay Ä‘á»•i nhÃ¬n tháº¥y Ä‘Æ°á»£c trÃªn trÃ¬nh duyá»‡t. VÃ  nhá»¯ng tÃ¡c vá»¥ Ä‘Ã³ nhÃ¢n lÃªn nhiá»u láº§n khi xÃ¢y dá»±ng á»©ng dá»¥ng SPA.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  1 sá»‘ máº¹o nhá» Ä‘á»ƒ báº¡n biáº¿t nÃªn tá»‘i Æ°u pháº§n nÃ o cá»§a code Javascript nháº±m cáº£i thiá»‡n render:</p><ul><li>TrÃ¡nh sá»­ dá»¥ng setTimeout vÃ  setInterval Ä‘á»‘i vá»›i nhá»¯ng cáº­p nháº­t nhÃ¬n tháº¥y Ä‘Æ°á»£c. Hai hÃ m nÃ y sáº½ gá»i callback táº¡i 1 thá»i Ä‘iá»ƒm nÃ o Ä‘Ã³ trong frame, cÃ³ thá»ƒ lÃ  cuá»‘i frame. Thá»© chÃºng ta cáº§n lÃ  trigger thay Ä‘á»•i ngay khi báº¯t Ä‘áº§u frame Ä‘á»ƒ trÃ¡nh bá»‹ sÃ³t.</li><li>ÄÆ°a nhá»¯ng tÃ­nh toÃ¡n Javascript phá»©c táº¡p vÃ  tá»‘n thá»i gian vÃ o trong Web Workers nhÆ° chÃºng ta Ä‘Ã£ tháº£o luáº­n á»Ÿ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-7---Thanh-phan-cua-WebWorker---5-truong-hop-su-dung" target="_blank" rel="noopener">bÃ i trÆ°á»›c</a>.</li><li>Sá»­ dá»¥ng cÃ¡c tÃ¡c vá»¥ siÃªu nhá» (micro-tasks) Ä‘á»ƒ thÃ´ng bÃ¡o sá»± thay Ä‘á»•i cá»§a DOM vá»›i nhiá»u frame. DÃ¹ng trong trÆ°á»ng há»£p cÃ¡c tÃ¡c vá»¥ cáº§n truy xuáº¥t vÃ o DOM, Ä‘iá»u nÃ y Web Workers khÃ´ng lÃ m Ä‘Æ°á»£c. Vá» cÆ¡ báº£n thÃ¬ nÃ³ nghÄ©a lÃ  báº¡n cáº§n chia nhá» 1 tÃ¡c vá»¥ lá»›n thÃ nh nhiá»u pháº§n nhá» hÆ¡n vÃ  cháº¡y chÃºng bÃªn trong cÃ¡c hÃ m requestAnimationFrame, setTimeout, setInterval tÃ¹y thuá»™c vÃ o Ä‘áº·c tÃ­nh cá»§a má»—i tÃ¡c vá»¥.</li></ul><h1 id="Toi-uu-hoa-CSS"><a href="#Toi-uu-hoa-CSS" class="headerlink" title="Tá»‘i Æ°u hÃ³a CSS"></a>Tá»‘i Æ°u hÃ³a CSS</h1><p>Chá»‰nh sá»­a DOM báº±ng cÃ¡ch thÃªm bá»›t cÃ¡c pháº§n tá»­, thay Ä‘á»•i cÃ¡c thuá»™c tÃ­nhâ€¦ sáº½ lÃ m cho trÃ¬nh duyá»‡t pháº£i tÃ­nh toÃ¡n láº¡i style cá»§a pháº§n tá»­ vÃ  trong nhiá»u trÆ°á»ng há»£p, lÃ  pháº£i tÃ­nh láº¡i layout cá»§a toÃ n bá»™ trang hoáº·c 1 pháº§n cá»§a trang.</p><p>Äá»ƒ tá»‘i Æ°u quÃ¡ trÃ¬nh render, báº¡n cáº§n cÃ¢n nháº¯c nhá»¯ng Ä‘iá»u sau:</p><ul><li>Giáº£m thiá»ƒu sá»± phá»©c táº¡p trong cÃ¡c selector. Sá»± phá»©c táº¡p cá»§a selector cÃ³ thá»ƒ chiáº¿m Ä‘áº¿n hÆ¡n 50% thá»i gian cáº§n thiáº¿t Ä‘á»ƒ tÃ­nh toÃ¡n style cho 1 pháº§n tá»­ (pháº§n cÃ²n láº¡i lÃ  thá»i gian Ä‘á»ƒ xÃ¢y dá»±ng style).</li><li>Giáº£m sá»‘ lÆ°á»£ng pháº§n tá»­ cáº§n Ä‘Æ°á»£c tÃ­nh toÃ¡n style. Vá» báº£n cháº¥t thÃ¬ thay Ä‘á»•i style trá»±c tiáº¿p cho 1 vÃ i pháº§n tá»­ thÃ¬ tá»‘t hÆ¡n lÃ  vÃ´ hiá»‡u toÃ n bá»™ page.</li></ul><h1 id="Toi-uu-hoa-layout"><a href="#Toi-uu-hoa-layout" class="headerlink" title="Tá»‘i Æ°u hÃ³a layout"></a>Tá»‘i Æ°u hÃ³a layout</h1><p>TÃ­nh toÃ¡n láº¡i layout cÃ³ thá»ƒ ngá»‘n nhiá»u tÃ i nguyÃªn cá»§a trÃ¬nh duyá»‡t nÃªn báº¡n cáº§n cÃ¢n nháº¯c nhá»¯ng Ä‘iá»u sau:</p><ul><li>Giáº£m sá»‘ lÆ°á»£ng layout báº¥t cá»© khi nÃ o cÃ³ thá»ƒ. Khi báº¡n thay Ä‘á»•i style thÃ¬ trÃ¬nh duyá»‡t kiá»ƒm tra Ä‘á»ƒ xem thá»­ cÃ³ thay Ä‘á»•i nÃ o cáº§n layout pháº£i Ä‘Æ°á»£c tÃ­nh toÃ¡n láº¡i khÃ´ng. CÃ¡c thay Ä‘á»•i vá» property nhÆ° width, height, left, top vÃ  trÃªn háº¿t lÃ  nhá»¯ng property nÃ o liÃªn quan Ä‘áº¿n hÃ¬nh há»c, cáº§n cÃ³ layout. VÃ¬ tháº¿ trÃ¡nh thay Ä‘á»•i chÃºng háº¿t má»©c cÃ³ thá»ƒ.</li><li>DÃ¹ng flexbox báº¥t cá»© khi nÃ o cÃ³ thá»ƒ dÃ¹ng. NÃ³ cháº¡y nhanh hÆ¡n vÃ  cÃ³ thá»ƒ cáº£i thiá»‡n hiá»‡u nÄƒng má»™t cÃ¡ch Ä‘Ã¡ng ká»ƒ.</li><li>TrÃ¡nh Ã©p buá»™c layout Ä‘á»“ng bá»™. Nhá»› ráº±ng khi Javascript cháº¡y, táº¥t cáº£ giÃ¡ trá»‹ cá»§a layout cÅ© tá»« frame trÆ°á»›c Ä‘Ã³ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh vÃ  sáºµn sÃ ng cho báº¡n truy váº¥n. KhÃ´ng váº¥n Ä‘á» gÃ¬ náº¿u nhÆ° báº¡n muá»‘n truy xuáº¥t box.offsetHeight. Tuy nhiÃªn, náº¿u báº¡n thay Ä‘á»•i style cá»§a box trÆ°á»›c khi nÃ³ Ä‘Æ°á»£c truy xuáº¥t (vÃ­ dá»¥: cá»‘ tÃ¬nh thÃªm CSS class vÃ o 1 pháº§n tá»­), trÃ¬nh duyá»‡t Ä‘áº§u tiÃªn sáº½ Ã¡p dá»¥ng thay Ä‘á»•i cá»§a style rá»“i sau Ä‘Ã³ má»›i cháº¡y Ä‘áº¿n pháº§n layout. Äiá»u cÃ³ cÃ³ thá»ƒ gÃ¢y tá»‘n thá»i gian vÃ  lÃ m áº£nh hÆ°á»Ÿng náº·ng Ä‘áº¿n tÃ i nguyÃªn mÃ¡y tÃ­nh, vÃ¬ tháº¿ nÃªn trÃ¡nh cÃ ng xa nÃ³ cÃ ng tá»‘t.</li></ul><h1 id="Toi-uu-hoa-to-mau"><a href="#Toi-uu-hoa-to-mau" class="headerlink" title="Tá»‘i Æ°u hÃ³a tÃ´ mÃ u"></a>Tá»‘i Æ°u hÃ³a tÃ´ mÃ u</h1><p>ÄÃ¢y thÆ°á»ng lÃ  tÃ¡c vá»¥ cháº¡y lÃ¢u nháº¥t trong sá»‘ cÃ¡c tÃ¡c vá»¥ nÃªn quan trá»ng lÃ  trÃ¡nh máº·t nÃ³ cÃ ng xa cÃ ng tá»‘t. Nhá»¯ng gÃ¬ báº¡n cÃ³ thá»ƒ lÃ m:</p><ul><li>Thay Ä‘á»•i báº¥t ká»³ property nÃ o khÃ¡c ngoÃ i transform hay opacity sáº½ trigger tÃ¡c vá»¥ tÃ´ mÃ u. Nhá»› sá»­ dá»¥ng tiáº¿t kiá»‡m nhÃ©.</li><li>Náº¿u báº¡n trigger má»™t layout, báº¡n cÅ©ng sáº½ trigger luÃ´n tÃ¡c vá»¥ tÃ´ mÃ u bá»Ÿi vÃ¬ thay Ä‘á»•i vá» kÃ­ch thÆ°á»›c hÃ¬nh há»c cÅ©ng sáº½ thay Ä‘á»•i pháº§n nhÃ¬n tháº¥y Ä‘Æ°á»£c cá»§a pháº§n tá»­.</li><li>Giáº£m diá»‡n tÃ­ch tÃ´ mÃ u thÃ´ng qua thÄƒng cáº¥p layer vÃ  dÃ n dá»±ng cÃ¡c animation.</li></ul><p>Render lÃ  má»™t khÃ­a cáº¡nh quan trá»ng trong cÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a <a href="https://www.sessionstack.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_content=js-series-rendering-engine-outro" target="_blank" rel="noopener">SessionStack</a>. SessionStack pháº£i tÃ¡i táº¡o láº¡i má»™t video vá» má»i thá»© Ä‘Ã£ diá»…n ra vá»›i user táº¡i thá»i Ä‘iá»ƒm há» tráº£i nghiá»‡m qua má»™t váº¥n Ä‘á» khi Ä‘ang lÆ°á»›t webapp cá»§a báº¡n. Äá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u nÃ y, SessionStack chá»‰ xá»­ lÃ½ duy nháº¥t nhá»¯ng dá»¯ liá»‡u mÃ  thÆ° viá»‡n cá»§a nÃ³ thu tháº­p Ä‘Æ°á»£c: cÃ¡c sá»± kiá»‡n tá»« user, thay Ä‘á»•i trÃªn DOM, request lÃªn máº¡ng, biá»‡t lá»‡, thÃ´ng bÃ¡o debug, vÃ¢n vÃ¢n. TrÃ¬nh phÃ¡t video Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a tá»‘i Ä‘a Ä‘á»ƒ cÃ³ thá»ƒ render má»™t cÃ¡ch chÃ­nh xÃ¡c vÃ  sá»­ dá»¥ng toÃ n bá»™ nhá»¯ng dá»¯ liá»‡u thu tháº­p Ä‘Æ°á»£c Ä‘á»ƒ cÃ³ thá»ƒ Ä‘Æ°a ra má»™t báº£n giáº£ láº­p trÃ¬nh duyá»‡t cá»§a user hoÃ n-háº£o-Ä‘áº¿n-tá»«ng-pixel cÅ©ng nhÆ° nhá»¯ng gÃ¬ Ä‘Ã£ xáº£y ra trÃªn Ä‘Ã³, cáº£ vá» máº·t ká»¹ thuáº­t láº«n quan sÃ¡t.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 11 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;Trong nhá»¯ng bÃ i trÆ°á»›c cá»§a series â€œÄá»¥c khoÃ©t Javascriptâ€, chÃºng ta Ä‘Ã£ táº­p trung vÃ o tÃ¬m hiá»ƒu &lt;strong&gt;ngÃ´n ngá»¯&lt;/strong&gt; Javascript, cÃ¡c tÃ­nh nÄƒng cá»§a nÃ³, cÃ¡ch chÃºng Ä‘Æ°á»£c thá»±c thi trÃªn trÃ¬nh duyá»‡t, lÃ m tháº¿ nÃ o Ä‘á»ƒ tá»‘i Æ°u hÃ³a, vÃ¢n vÃ¢n.&lt;/p&gt;
&lt;p&gt;Tuy nhiÃªn, khi báº¡n xÃ¢y dá»±ng webapp, báº¡n khÃ´ng chá»‰ viáº¿t code Javascript. Code cá»§a báº¡n cÃ²n tÆ°Æ¡ng tÃ¡c vá»›i mÃ´i trÆ°á»ng. Tháº¥u hiá»ƒu mÃ´i trÆ°á»ng, cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³ sáº½ cho phÃ©p báº¡n xÃ¢y dá»±ng app tá»‘t hÆ¡n vÃ  cÃ³ ná»n táº£ng chuáº©n bá»‹ tá»‘t Ä‘á»ƒ Ä‘á» phÃ²ng nhá»¯ng nguy cÆ¡ tiá»m tÃ ng cÃ³ thá»ƒ xáº£y Ä‘áº¿n báº¥t cá»© lÃºc nÃ o khi lÃªn production.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P10: Quan sÃ¡t thay Ä‘á»•i trÃªn DOM báº±ng MutationObserver</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P10-Quan-sat-thay-doi-tren-DOM-bang-MutationObserver.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P10-Quan-sat-thay-doi-tren-DOM-bang-MutationObserver.html</id>
    <published>2018-11-25T08:24:00.000Z</published>
    <updated>2018-11-25T08:29:18.823Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 10 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*mPXf5zRCdEQ42Hn0." alt=""></p><p>Webapp cÃ ng ngÃ y cÃ ng náº·ng hÆ¡n á»Ÿ phÃ­a client bá»Ÿi vÃ¬ nhiá»u lÃ½ do Ä‘áº¡i loáº¡i nhÆ° UI pháº£i â€œphÃ¬ nhiÃªuâ€ Ä‘á»ƒ chá»©a Ä‘á»±ng nhá»¯ng thá»© logic phá»©c táº¡p bÃªn trong bao gá»“m cáº£ tÃ­nh toÃ¡n theo thá»i gian thá»±c (real-time), vÃ  nhiá»u nhiá»u thá»© khÃ¡c ná»¯a.</p><p>Sá»± phá»©c táº¡p gia tÄƒng lÃ m cho chÃºng ta khÃ³ náº¯m báº¯t chÃ­nh xÃ¡c tráº¡ng thÃ¡i cá»§a UI táº¡i má»—i thá»i Ä‘iá»ƒm trong vÃ²ng Ä‘á»i cá»§a webapp.</p><p>Äiá»u nÃ y cÃ ng khÃ³ hÆ¡n ná»¯a náº¿u chÃºng ta xÃ¢y dá»±ng má»™t vÃ i thá»© cháº³ng háº¡n nhÆ° library hay framework mÃ  cáº§n pháº£i pháº£n á»©ng cÅ©ng nhÆ° xá»­ lÃ½ nhá»¯ng hÃ nh Ä‘á»™ng dá»±a trÃªn DOM.<br><a id="more"></a></p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver" target="_blank" rel="noopener">MutationObserver</a> (táº¡m dá»‹ch: NgÆ°á»i quan sÃ¡t sá»± biáº¿n Ä‘á»•i) lÃ  má»™t WebAPI Ä‘Æ°á»£c cÃ¡c trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i cung cáº¥p Ä‘á»ƒ phÃ¡t hiá»‡n cÃ¡c thay Ä‘á»•i trÃªn DOM. Vá»›i API nÃ y má»™t ngÆ°á»i cÃ³ thá»ƒ listen cÃ¡c node má»›i Ä‘Æ°á»£c thÃªm vÃ o hoáº·c gá»¡ ra, thuá»™c tÃ­nh thay Ä‘á»•i hoáº·c nhá»¯ng thay Ä‘á»•i vá» ná»™i dung vÄƒn báº£n trong má»™t text node.</p><p>Táº¡i sao pháº£i cáº§n lÃ m tháº¿?</p><p>CÃ³ má»™t sá»‘ Ã­t trÆ°á»ng há»£p trong Ä‘Ã³ MutationObserver API thá»±c sá»± há»¯u Ã­ch. VÃ­ dá»¥:</p><ul><li>Báº¡n muá»‘n thÃ´ng bÃ¡o cho ngÆ°á»i dÃ¹ng webapp ráº±ng má»™t vÃ i sá»± thay Ä‘á»•i Ä‘Ã£ xáº£y ra trÃªn trang mÃ  ngÆ°á»i Ä‘Ã³ Ä‘ang sá»­ dá»¥ng.</li><li>Báº¡n Ä‘ang lÃ m viá»‡c vá»›i 1 Javascript framework sang cháº£nh má»›i, nÃ³ cáº§n load ráº¥t nhiá»u JS module má»™t cÃ¡ch tá»± Ä‘á»™ng dá»±a trÃªn sá»± thay Ä‘á»•i cá»§a DOM.</li><li>Báº¡n Ä‘ang lÃ m viá»‡c vá»›i bá»™ soáº¡n tháº£o WYSIWYG vÃ  thá»­ triá»ƒn khai tÃ­nh nÄƒng undo/redo. Báº±ng cÃ¡ch táº­n dá»¥ng MutationObserver API, báº¥t ká»³ lÃºc nÃ o báº¡n cÅ©ng cÃ³ thá»ƒ biáº¿t pháº§n nÃ o Ä‘Ã£ thay Ä‘á»•i vÃ  dá»… dÃ ng undo chÃºng.</li></ul><p><img src="https://cdn-images-1.medium.com/max/1000/1*48tGIboHxgLeKEjMTGkUGg.png" alt=""></p><p>TrÃªn Ä‘Ã¢y chá»‰ lÃ  1 sá»‘ vÃ­ dá»¥ vá» lá»£i Ã­ch cá»§a MutationObserver.</p><h1 id="Cach-su-dung-MutationObserver"><a href="#Cach-su-dung-MutationObserver" class="headerlink" title="CÃ¡ch sá»­ dá»¥ng MutationObserver"></a>CÃ¡ch sá»­ dá»¥ng MutationObserver</h1><p>Triá»ƒn khai MutationObserver khÃ¡ dá»… dÃ ng. Báº¡n cáº§n táº¡o 1 instance MutationObserver báº±ng cÃ¡ch truyá»n cho nÃ³ 1 hÃ m vÃ  hÃ m nÃ y Ä‘Æ°á»£c gá»i má»—i khi 1 sá»± thay Ä‘á»•i xáº£y ra. Äá»‘i sá»‘ Ä‘áº§u tiÃªn cá»§a hÃ m lÃ  1 táº­p há»£p táº¥t cáº£ cÃ¡c sá»± thay Ä‘á»•i xáº£y ra trÃªn 1 khá»‘i duy nháº¥t. Má»—i sá»± thay Ä‘á»•i cung cáº¥p thÃ´ng tin vá» loáº¡i cá»§a nÃ³ cÅ©ng nhÆ° thay Ä‘á»•i nÃ o Ä‘Ã£ xáº£y ra.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mutationObserver = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span>(<span class="params">mutations</span>) </span>&#123;</span><br><span class="line">  mutations.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">mutation</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(mutation);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Object táº¡o ra cÃ³ 3 phÆ°Æ¡ng thá»©c:</p><ul><li><strong>observe</strong>: báº¯t Ä‘áº§u láº¯ng nghe sá»± thay Ä‘á»•i. NÃ³ nháº­n 2 Ä‘á»‘i sá»‘: DOM node mÃ  báº¡n muá»‘n quan sÃ¡t vÃ  má»™t object chÆ°a cÃ¡c thiáº¿t láº­p.</li><li><strong>disconnect</strong>: dá»«ng quÃ¡ trÃ¬nh láº¯ng nghe thay Ä‘á»•i.</li><li><strong>takeRecords</strong>: tráº£ vá» khá»‘i thay Ä‘á»•i cuá»‘i cÃ¹ng trÆ°á»›c khi callback Ä‘Æ°á»£c kÃ­ch hoáº¡t.</li></ul><p>Äoáº¡n code sau thá»ƒ hiá»‡n quÃ¡ trÃ¬nh quan sÃ¡t (observing) diá»…n ra:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Báº¯t Ä‘áº§u láº¯ng nghe thay Ä‘á»•i trong root HTML cá»§a trang.</span></span><br><span class="line">mutationObserver.observe(<span class="built_in">document</span>.documentElement, &#123;</span><br><span class="line">  attributes: <span class="literal">true</span>,</span><br><span class="line">  characterData: <span class="literal">true</span>,</span><br><span class="line">  childList: <span class="literal">true</span>,</span><br><span class="line">  subtree: <span class="literal">true</span>,</span><br><span class="line">  attributeOldValue: <span class="literal">true</span>,</span><br><span class="line">  characterDataOldValue: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Giá» giáº£ sá»­ ta cÃ³ 1 div cá»±c ká»³ Ä‘Æ¡n giáº£n trong DOM:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"sample-div"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"test"</span>&gt; Simple div &lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure><p>Sá»­ dá»¥ng jQuery, báº¡n cÃ³ thá»ƒ xÃ³a thuá»™c tÃ­nh class tá»« div Ä‘Ã³:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#sample-div"</span>).removeAttr(<span class="string">"class"</span>);</span><br></pre></td></tr></table></figure><p>Khi Ä‘Ã£ báº¯t Ä‘áº§u quan sÃ¡t, sau khi gá»i hÃ m mutationObserver.observe(â€¦) ta cÃ³ thá»ƒ xem thÃ´ng tin log Ä‘Æ°á»£c in ra trong console cá»§a <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationRecord" target="_blank" rel="noopener">MutationRecord</a>.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*UxkSstuyCvmKkBTnjbezNw.png" alt=""></p><p>ÄÃ¢y lÃ  sá»± biáº¿n Ä‘á»•i táº¡o ra bá»Ÿi ta Ä‘Ã£ xÃ³a thuá»™c tÃ­nh class.</p><p>Cuá»‘i cÃ¹ng, Ä‘á»ƒ dá»«ng sá»± quan sÃ¡t DOM sau khi Ä‘Ã£ xong viá»‡c, ta lÃ m nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dá»«ng MutationObserver, khÃ´ng láº¯ng nghe thay Ä‘á»•i ná»¯a.</span></span><br><span class="line">mutationObserver.disconnect();</span><br></pre></td></tr></table></figure><p>NgÃ y nay MutationObserver Ä‘Æ°á»£c há»— trá»£ khÃ¡ tá»‘t:</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*nlOmrsfy-Y1XoR8B." alt=""></p><h1 id="Giai-phap-thay-the"><a href="#Giai-phap-thay-the" class="headerlink" title="Giáº£i phÃ¡p thay tháº¿"></a>Giáº£i phÃ¡p thay tháº¿</h1><p>Tuy nhiÃªn, MutationObserver cÅ©ng chá»‰ má»›i xuáº¥t hiá»‡n chÆ°a lÃ¢u. Váº­y thÃ¬ trÆ°á»›c khi cÃ³ nÃ³, cÃ¡c developer dÃ¹ng cÃ¡i gÃ¬?</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  1 vÃ i lá»±a chá»n:</p><ul><li><strong>Polling</strong></li><li><strong>MutationEvents</strong></li><li><strong>CSS animations</strong></li></ul><h2 id="Polling"><a href="#Polling" class="headerlink" title="Polling"></a>Polling</h2><p>Giáº£i phÃ¡p Ä‘Æ¡n giáº£n nháº¥t vÃ  kÃ©m tinh táº¿ nháº¥t lÃ  polling (bá» phiáº¿u bÃ¬nh chá»n). Sá»­ dá»¥ng WebAPI setInterval báº¡n cÃ³ thá»ƒ thiáº¿t láº­p 1 tÃ¡c vá»¥ kiá»ƒm tra sá»± thay Ä‘á»•i theo chu ká»³ nháº¥t Ä‘á»‹nh. DÄ© nhiÃªn thÃ¬ cÃ¡ch nÃ y lÃ m giáº£m hiá»‡u nÄƒng cá»§a webapp 1 cÃ¡ch Ä‘Ã¡ng sá»£.</p><h2 id="MutationEvents"><a href="#MutationEvents" class="headerlink" title="MutationEvents"></a>MutationEvents</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events" target="_blank" rel="noopener">MutationEvents API</a> Ä‘Æ°á»£c giá»›i thiá»‡u vÃ o nÄƒm 2000. Máº·c dÃ¹ nÃ³ cÃ³ Ã­ch, cÃ¡c sá»± kiá»‡n thay Ä‘á»•i (mutation events) Ä‘Æ°á»£c báº¯n ra má»—i khi cÃ³ 1 sá»± thay Ä‘á»•i báº¥t ká»³ trÃªn DOM vÃ  má»™t láº§n ná»¯a lÃ m áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng. NgÃ y nay thÃ¬ MutationEvents API Ä‘Ã£ bá»‹ há»§y bá» vÃ  nhá»¯ng trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i sáº½ sá»›m ngá»«ng há»— trá»£ nÃ³.</p><p>Danh má»¥c trÃ¬nh duyá»‡t há»— trá»£ cho MutationEvents:</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*l-QdpBfjwNfPDTyh." alt=""></p><h2 id="CSS-animations"><a href="#CSS-animations" class="headerlink" title="CSS animations"></a>CSS animations</h2><p>Má»™t giáº£i phÃ¡p thay tháº¿ hÆ¡i ká»³ cá»¥c Ä‘Ã³ lÃ  dá»±a trÃªn <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Animations/Using_CSS_animations" target="_blank" rel="noopener">CSS Animations</a>. Nghe cÃ³ váº» bá»‘i rá»‘i nhá»‰. Vá» cÆ¡ báº£n thÃ¬ Ã½ tÆ°á»Ÿng cá»§a nÃ³ lÃ  táº¡o ra 1 animation cÃ³ thá»ƒ Ä‘Æ°á»£c trigger khi cÃ³ má»™t element Ä‘Æ°á»£c thÃªm vÃ o DOM. Khoáº£nh kháº¯c animation báº¯t Ä‘áº§u, sá»± kiá»‡n animationstart sáº½ Ä‘Æ°á»£c báº¯n ra: náº¿u báº¡n Ä‘Ã£ gáº¯n 1 event handler vÃ o sá»± kiá»‡n Ä‘Ã³ thÃ¬ báº¡n sáº½ biáº¿t 1 cÃ¡ch chÃ­nh xÃ¡c khi nÃ o element Ä‘Æ°á»£c thÃªm vÃ o DOM. Thá»i gian thá»±c hiá»‡n cá»§a animation pháº£i cá»±c nhá» Ä‘á»ƒ cho nÃ³ dÆ°á»ng nhÆ° vÃ´ hÃ¬nh trÆ°á»›c con máº¯t user.</p><p>Äáº§u tiÃªn ta cáº§n má»™t element cha, bÃªn trong nÃ³ ta sáº½ listen sá»± kiá»‡n chÃ¨n node:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=â€container-elementâ€&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>Äá»ƒ cÃ³ thá»ƒ xá»­ lÃ½ khi cÃ³ node chÃ¨n vÃ o, ta cáº§n thiáº¿t láº­p má»™t chuá»—i cÃ¡c <a href="https://www.w3schools.com/cssref/css3_pr_animation-keyframes.asp" target="_blank" rel="noopener">keyframe</a> animation khá»Ÿi Ä‘á»™ng khi node Ä‘Æ°á»£c thÃªm vÃ o:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@keyframes nodeInserted &#123; </span><br><span class="line"> <span class="keyword">from</span> &#123; <span class="attr">opacity</span>: <span class="number">0.99</span>; &#125;</span><br><span class="line"> to &#123; <span class="attr">opacity</span>: <span class="number">1</span>; &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Vá»›i keyframe Ä‘Æ°á»£c táº¡o ra Ä‘Ã³, animation cáº§n pháº£i Ä‘Æ°á»£c Ã¡p dá»¥ng vÃ o cÃ¡c element mÃ  ta muá»‘n láº¯ng nghe. LÆ°u Ã½ lÃ  thá»i gian duration ráº¥t nhá», má»¥c Ä‘Ã­ch lÃ  Ä‘á»ƒ kÃ©o dÃ£n dáº¥u váº¿t cá»§a animation trÃªn trÃ¬nh duyá»‡t:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#container-element * &#123;</span><br><span class="line"> animation-duration: <span class="number">0.001</span>s;</span><br><span class="line"> animation-name: nodeInserted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BÆ°á»›c thiáº¿t láº­p nÃ y sáº½ thÃªm animation vÃ o táº¥t cáº£ cÃ¡c node con cá»§a container-element. Khi animation káº¿t thÃºc (sau 0.001s nhÆ° trÃªn), sá»± kiá»‡n chÃ¨n node sáº½ Ä‘Æ°á»£c báº¯n ra.</p><p>Ta cáº§n má»™t hÃ m event listener Javascript. Trong hÃ m Ä‘Ã³ ta pháº£i gá»i event.animationName Ä‘á»ƒ Ä‘áº£m báº£o Ä‘Ã³ chÃ­nh lÃ  animation mÃ  ta cáº§n.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> insertionListener = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Äáº£m báº£o Ä‘Ã¢y lÃ  animation mÃ  ta cáº§n xá»­ lÃ½.</span></span><br><span class="line">  <span class="keyword">if</span> (event.animationName === <span class="string">"nodeInserted"</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Node has been inserted: "</span> + event.target);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Giá» thÃ¬ thÃªm event listener vÃ o node cha:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(â€œanimationstartâ€, insertionListener, <span class="literal">false</span>); <span class="comment">// standard + firefox</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(â€œMSAnimationStartâ€, insertionListener, <span class="literal">false</span>); <span class="comment">// IE</span></span><br><span class="line"><span class="built_in">document</span>.addEventListener(â€œwebkitAnimationStartâ€, insertionListener, <span class="literal">false</span>); <span class="comment">// Chrome + Safari</span></span><br></pre></td></tr></table></figure><p>TrÃ¬nh duyá»‡t há»— trá»£ CSS animation:</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*W4wHvVAeUmc45vA2." alt=""></p><p>MutationObserver cung cáº¥p má»™t sá»‘ tÃ­nh nÄƒng nÃ¢ng cao hÆ¡n táº¥t cáº£ 3 giáº£i phÃ¡p trÃªn. Vá» báº£n cháº¥t, nÃ³ bao phá»§ toÃ n bá»™ má»—i thay Ä‘á»•i cÃ³ thá»ƒ diá»…n ra trÃªn DOM vÃ  nÃ³ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a khi báº¯n ra cÃ¡c thay Ä‘á»•i trong 1 chuá»—i hÃ ng loáº¡t. TrÃªn háº¿t MutationObserver Ä‘Æ°á»£c há»— trá»£ bá»Ÿi táº¥t cáº£ cÃ¡c trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i Ä‘i kÃ¨m vá»›i 1 sá»‘ polyfills Ä‘á»ƒ dÃ¹ng MutationEvents</p><p>MutationObserver chiáº¿m giá»¯ má»™t vá»‹ trÃ­ trung tÃ¢m trong thÆ° viá»‡n cá»§a <a href="https://www.sessionstack.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_content=mutation-observer-post" target="_blank" rel="noopener">SessionStack</a>.</p><p>Khi báº¡n Ä‘Ã£ tÃ­ch há»£p thÆ° viá»‡n cá»§a SessionStack vÃ o webapp, nÃ³ báº¯t Ä‘áº§u thu tháº­p cÃ¡c thÃ´ng tin cháº³ng háº¡n nhÆ° thay Ä‘á»•i trÃªn DOM, request máº¡ng, biá»‡t lá»‡, thÃ´ng bÃ¡o debug, vÃ¢n vÃ¢n, vÃ  gá»­i chÃºng vá» server. SessionStack dÃ¹ng chÃ­nh nhá»¯ng dá»¯ liá»‡u nÃ y Ä‘á»ƒ tÃ¡i táº¡o láº¡i má»i thá»© Ä‘Ã£ xáº£y ra vá»›i user cá»§a báº¡n vÃ  hiá»ƒn thá»‹ cÃ¡c váº¥n Ä‘á» cá»§a sáº£n pháº©m trong cÃ¹ng 1 tÃ¬nh huá»‘ng mÃ  nÃ³ diá»…n ra vá»›i user. KhÃ¡ nhiá»u ngÆ°á»i nghÄ© ráº±ng SessionStack ghi láº¡i video, nhÆ°ng khÃ´ng pháº£i váº­y. Ghi video ráº¥t tá»‘n kÃ©m, máº·t khÃ¡c lÆ°á»£ng dá»¯ liá»‡u thu tháº­p Ä‘Æ°á»£c láº¡i ráº¥t nháº¹ vÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n UX cÅ©ng nhÆ° hiá»‡u nÄƒng cá»§a webapp cá»§a báº¡n.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 10 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn-images-1.medium.com/max/1000/0*mPXf5zRCdEQ42Hn0.&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Webapp cÃ ng ngÃ y cÃ ng náº·ng hÆ¡n á»Ÿ phÃ­a client bá»Ÿi vÃ¬ nhiá»u lÃ½ do Ä‘áº¡i loáº¡i nhÆ° UI pháº£i â€œphÃ¬ nhiÃªuâ€ Ä‘á»ƒ chá»©a Ä‘á»±ng nhá»¯ng thá»© logic phá»©c táº¡p bÃªn trong bao gá»“m cáº£ tÃ­nh toÃ¡n theo thá»i gian thá»±c (real-time), vÃ  nhiá»u nhiá»u thá»© khÃ¡c ná»¯a.&lt;/p&gt;
&lt;p&gt;Sá»± phá»©c táº¡p gia tÄƒng lÃ m cho chÃºng ta khÃ³ náº¯m báº¯t chÃ­nh xÃ¡c tráº¡ng thÃ¡i cá»§a UI táº¡i má»—i thá»i Ä‘iá»ƒm trong vÃ²ng Ä‘á»i cá»§a webapp.&lt;/p&gt;
&lt;p&gt;Äiá»u nÃ y cÃ ng khÃ³ hÆ¡n ná»¯a náº¿u chÃºng ta xÃ¢y dá»±ng má»™t vÃ i thá»© cháº³ng háº¡n nhÆ° library hay framework mÃ  cáº§n pháº£i pháº£n á»©ng cÅ©ng nhÆ° xá»­ lÃ½ nhá»¯ng hÃ nh Ä‘á»™ng dá»±a trÃªn DOM.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P9: Cáº¥u táº¡o cá»§a Web Push Notifications</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P9-Cau-tao-cua-Web-Push-Notifications.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P9-Cau-tao-cua-Web-Push-Notifications.html</id>
    <published>2018-11-24T15:51:00.000Z</published>
    <updated>2018-11-24T15:53:39.773Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 9 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p>HÃ´m nay chÃºng ta sáº½ chuyá»ƒn hÆ°á»›ng sá»± chÃº Ã½ qua <strong>web push notifications</strong> (táº¡m dá»‹ch: thÃ´ng bÃ¡o Ä‘áº©y trÃªn trang web): chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» thÃ nh pháº§n cá»§a nÃ³, khÃ¡m phÃ¡ cÃ¡c quy trÃ¬nh gá»­i/nháº­n thÃ´ng bÃ¡o phÃ­a sau vÃ  cuá»‘i bÃ i sáº½ cÃ¹ng tÃ¬m hiá»ƒu lÃ m sao SessionStack sá»­ dá»¥ng chÃºng Ä‘á»ƒ xÃ¢y dá»±ng chá»©c nÄƒng cá»§a sáº£n pháº©m.</p><p>Push Notifications ráº¥t phá»• biáº¿n trong tháº¿ giá»›i cá»§a Ä‘iá»‡n thoáº¡i. VÃ¬ lÃ½ do nÃ y hay lÃ½ do khÃ¡c, chÃºng bÆ°á»›c chÃ¢n vÃ o tháº¿ giá»›i web láº¡i khÃ¡ muá»™n máº·c dÃ¹ nÃ³ lÃ  tÃ­nh nÄƒng ráº¥t Ä‘Æ°á»£c cÃ¡c developer Æ°a chuá»™ng vÃ  Ä‘á» xuáº¥t.<br><a id="more"></a></p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>Web Push Notifications cho phÃ©p user tham gia vÃ o cÃ¡c cáº­p nháº­t theo thá»i gian tá»« webapp nháº±m má»¥c Ä‘Ã­ch thu hÃºt ngÆ°á»i dÃ¹ng dá»±a trÃªn ná»™i dung thÃº vá»‹, quan trá»ng vÃ  Ä‘Ãºng lÃºc Ä‘á»‘i vá»›i há».</p><p>Push dá»±a trÃªn Service Workers - chÃ­nh lÃ  chá»§ Ä‘á» mÃ  chÃºng ta Ä‘Ã£ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-8---Service-Workers--vong-doi-va-cac-truong-hop-su-dung" target="_blank" rel="noopener">tháº£o luáº­n á»Ÿ bÃ i trÆ°á»›c</a>.</p><p>LÃ½ do lá»±a chá»n dÃ¹ng Service Workers trong trÆ°á»ng há»£p nÃ y lÃ  vÃ¬ chÃºng hoáº¡t Ä‘á»™ng trong background. Ráº¥t phÃ¹ há»£p cho Push Notifications vÃ¬ nhÆ° váº­y nghÄ©a lÃ  code chá»‰ Ä‘Æ°á»£c thá»±c thi khi user tÆ°Æ¡ng tÃ¡c vá»›i chÃ­nh notification Ä‘Ã³.</p><h1 id="Push-amp-notification"><a href="#Push-amp-notification" class="headerlink" title="Push &amp; notification"></a>Push &amp; notification</h1><p>Push vÃ  notification lÃ  2 API khÃ¡c nhau.</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Push_API" target="_blank" rel="noopener">Push</a>: Ä‘Æ°á»£c gá»i khi server cung cáº¥p thÃ´ng tin cho Server Worker</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Notifications_API" target="_blank" rel="noopener">Notification</a>: hÃ nh Ä‘á»™ng cá»§a Service Worker hoáº·c má»™t Ä‘oáº¡n script trÃªn webapp nháº±m hiá»ƒn thá»‹ thÃ´ng tin Ä‘áº¿n user.</li></ul><h1 id="Push"><a href="#Push" class="headerlink" title="Push"></a>Push</h1><p>CÃ³ 3 bÆ°á»›c cÆ¡ báº£n Ä‘á»ƒ triá»ƒn khai 1 push:</p><ul><li><strong>Giao diá»‡n (UI)</strong>: thÃªm vÃ o nhá»¯ng logic cáº§n thiáº¿t á»Ÿ phÃ­a client Ä‘á»ƒ Ä‘Äƒng kÃ½ user vá»›i push. ÄÃ¢y lÃ  pháº§n logic Javascript mÃ  UI cá»§a webapp cáº§n Ä‘á»ƒ cho phÃ©p user Ä‘Äƒng kÃ½ vÃ o push message.</li><li><strong>Gá»­i push message</strong>: triá»ƒn khai lá»i gá»i API trÃªn server Ä‘á»ƒ trigger má»™t push message tá»›i thiáº¿t bá»‹ cá»§a user.</li><li><strong>Nháº­n push message</strong>: xá»­ lÃ½ push message má»™t khi nÃ³ vá» tá»›i trÃ¬nh duyá»‡t.</li></ul><p>Giá» thÃ¬ chÃºng ta sáº½ tÃ¬m hiá»ƒu toÃ n bá»™ quÃ¡ trÃ¬nh má»™t cÃ¡ch chi tiáº¿t hÆ¡n.</p><h1 id="Xac-nhan-ho-tro-tu-trinh-duyet"><a href="#Xac-nhan-ho-tro-tu-trinh-duyet" class="headerlink" title="XÃ¡c nháº­n há»— trá»£ tá»« trÃ¬nh duyá»‡t"></a>XÃ¡c nháº­n há»— trá»£ tá»« trÃ¬nh duyá»‡t</h1><p>Äáº§u tiÃªn lÃ  cáº§n pháº£i kiá»ƒm tra xem trÃ¬nh duyá»‡t báº¡n Ä‘ang dÃ¹ng cÃ³ há»— trá»£ cho push message hay khÃ´ng. ChÃºng ta cÃ³ 2 bÃ i check Ä‘Æ¡n giáº£n:</p><ul><li>Kiá»ƒm tra serviceWorker trong object navigator</li><li>Kiá»ƒm tra PushManager trong object window</li></ul><p>Code kiá»ƒm tra:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!(<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator)) &#123; </span><br><span class="line">  <span class="comment">// Service Worker khÃ´ng Ä‘Æ°á»£c há»— trá»£, vÃ´ hiá»‡u hÃ³a hoáº·c áº©n UI Ä‘i. </span></span><br><span class="line">  <span class="keyword">return</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!(<span class="string">'PushManager'</span> <span class="keyword">in</span> <span class="built_in">window</span>)) &#123; </span><br><span class="line">  <span class="comment">// Push khÃ´ng Ä‘Æ°á»£c há»— trá»£, vÃ´ hiá»‡u hÃ³a hoáº·c áº©n UI Ä‘i. </span></span><br><span class="line">  <span class="keyword">return</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Dang-ky-mot-Service-Worker"><a href="#Dang-ky-mot-Service-Worker" class="headerlink" title="ÄÄƒng kÃ½ má»™t Service Worker"></a>ÄÄƒng kÃ½ má»™t Service Worker</h1><p>Táº¡i thá»i Ä‘iá»ƒm nÃ y, ta Ä‘Ã£ biáº¿t cÃ¡c chá»©c nÄƒng Ä‘á»u Ä‘Æ°á»£c há»— trá»£. BÆ°á»›c tiáº¿p theo sáº½ lÃ  Ä‘Äƒng kÃ½ Service Worker.</p><p>ÄÄƒng kÃ½ má»™t Service Worker nhÆ° tháº¿ nÃ o thÃ¬ báº¡n cÅ©ng Ä‘Ã£ quen vá»›i nhá»¯ng diá»…n giáº£i tá»« <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-8---Service-Workers--vong-doi-va-cac-truong-hop-su-dung" target="_blank" rel="noopener">bÃ i trÆ°á»›c</a> rá»“i.</p><h1 id="Yeu-cau-duoc-cap-quyen"><a href="#Yeu-cau-duoc-cap-quyen" class="headerlink" title="YÃªu cáº§u Ä‘Æ°á»£c cáº¥p quyá»n"></a>YÃªu cáº§u Ä‘Æ°á»£c cáº¥p quyá»n</h1><p>Xong pháº§n vá»›i Service Worker thÃ¬ ta cÃ³ thá»ƒ Ä‘i tiáº¿p Ä‘áº¿n pháº§n Ä‘Äƒng kÃ½ user. Báº¡n cáº§n pháº£i cÃ³ quyá»n cá»§a user thÃ¬ má»›i gá»­i push message Ä‘áº¿n há» Ä‘Æ°á»£c.</p><p>API dÃ¹ng Ä‘á»ƒ láº¥y quyá»n (permission) cÅ©ng tÆ°Æ¡ng Ä‘á»•i Ä‘Æ¡n giáº£n, tuy nhiÃªn Ä‘iá»ƒm báº¥t lá»£i lÃ  API Ä‘Ã£ thay Ä‘á»•i tá»« viá»‡c dÃ¹ng callback sang tráº£ vá» Promise. NÃ³ sinh ra váº¥n Ä‘á» khÃ¡c: chÃºng ta khÃ´ng thá»ƒ biáº¿t version cá»§a API Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai trÃªn trÃ¬nh duyá»‡t hiá»‡n táº¡i, vÃ¬ tháº¿ chÃºng ta pháº£i xá»­ lÃ½ cáº£ 2 trÆ°á»ng há»£p.</p><p>NÃ³ trÃ´ng nhÆ° tháº¿ nÃ y Ä‘Ã¢y:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestPermission</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> permissionResult = Notification.requestPermission(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Xá»­ lÃ½ phiÃªn báº£n cÅ© vá»›i callback.</span></span><br><span class="line">      resolve(result);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (permissionResult) &#123;</span><br><span class="line">      permissionResult.then(resolve, reject);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">permissionResult</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (permissionResult !== <span class="string">'granted'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Permission not granted.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Lá»i gá»i Ä‘áº¿n Notification.requestPermission() sáº½ hiá»ƒn thá»‹ 1 báº£ng thÃ´ng bÃ¡o nhá»:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*xhB8ceUNM6vb8s0ZQKMHNg.png" alt=""></p><p>Má»™t khi quyá»n Ä‘Ã£ Ä‘Æ°á»£c cáº¥p, Ä‘Æ°á»£c Ä‘Ã³ng hoáº·c block thÃ¬ chÃºng ta cÅ©ng nháº­n Ä‘Æ°á»£c nhá»¯ng káº¿t quáº£ tÆ°Æ¡ng tá»± dÆ°á»›i dáº¡ng string: granted, default, denied.</p><p>Nhá»› ráº±ng náº¿u user click chuá»™t vÃ o nÃºt Block thÃ¬ webapp cá»§a báº¡n sáº½ khÃ´ng thá»ƒ há»i user vá» chuyá»‡n cáº¥p quyá»n má»™t láº§n ná»¯a, cho tá»›i khi user tá»± â€œunblockâ€ app cá»§a báº¡n báº±ng cÃ¡ch thay Ä‘á»•i tráº¡ng thÃ¡i cá»§a quyá»n. TÃ¹y chá»n nÃ y Ä‘Æ°á»£c giáº¥u trong báº£ng cÃ i Ä‘áº·t.</p><h1 id="Dang-ky-mot-user-voi-PushManager"><a href="#Dang-ky-mot-user-voi-PushManager" class="headerlink" title="ÄÄƒng kÃ½ má»™t user vá»›i PushManager"></a>ÄÄƒng kÃ½ má»™t user vá»›i PushManager</h1><p>Khi Service Worker Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½ vÃ  chÃºng ta Ä‘Æ°á»£c user cáº¥p quyá»n, ta cÃ³ thá»ƒ subscribe 1 user báº±ng cÃ¡ch gá»i registration.pushManager.subscribe() khi Ä‘Äƒng kÃ½ Service Worker cá»§a báº¡n.</p><p>ToÃ n bá»™ Ä‘oáº¡n code nhÆ° sau (bao gá»“m cáº£ pháº§n Ä‘Äƒng kÃ½ Service Worker):</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribeUserToPush</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> navigator.serviceWorker.register(<span class="string">'service-worker.js'</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">registration</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> subscribeOptions = &#123;</span><br><span class="line">      userVisibleOnly: <span class="literal">true</span>,</span><br><span class="line">      applicationServerKey: btoa(</span><br><span class="line">        <span class="string">'BEl62iUYgUivxIkv69yViEuiBIa-Ib9-SkvMeAtA3LFgDzkrxZJjSgSnfckjBJuBkr3qBUYIHBQFLXYp5Nksh8U'</span></span><br><span class="line">      )</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> registration.pushManager.subscribe(subscribeOptions);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">pushSubscription</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'PushSubscription: '</span>, <span class="built_in">JSON</span>.stringify(pushSubscription));</span><br><span class="line">    <span class="keyword">return</span> pushSubscription;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>registration.pushManager.subscribe(options) nháº­n má»™t object options gá»“m 1 param báº¯t buá»™c vÃ  1 param tÃ¹y chá»n:</p><ul><li><strong>userVisibleOnly</strong>: má»™t boolean chá»‰ Ä‘á»‹nh push subscription tráº£ vá» sáº½ chá»‰ Ä‘Æ°á»£c dÃ¹ng cho message mÃ  hiá»‡u á»©ng cá»§a message Ä‘Ã³ user cÃ³ thá»ƒ nhÃ¬n tháº¥y Ä‘Æ°á»£c. NÃ³ pháº£i Ä‘Æ°á»£c gÃ¡n báº±ng true náº¿u khÃ´ng thÃ¬ sáº½ lá»—i (CÃ³ cáº£ 1 quÃ¡ khá»© lá»‹ch sá»­ vá» nÃ³).</li><li><strong>applicationServerKey</strong>: má»™t DOMString hoáº·c ArrayBufffer chá»©a public key Ä‘Æ°á»£c mÃ£ hÃ³a thÃ nh Base64 mÃ  server push sáº½ dÃ¹ng Ä‘á»ƒ xÃ¡c thá»±c server cá»§a app.</li></ul><p>Server cá»§a báº¡n cáº§n sinh ra má»™t cáº·p server key cho app, chÃºng cÃ²n Ä‘Æ°á»£c biáº¿t Ä‘áº¿n lÃ  key VAPID duy nháº¥t cho server. ÄÃ¢y lÃ  1 cáº·p public-private key. Private key thÃ¬ Ä‘Æ°á»£c giá»¯ má»™t cÃ¡ch bÃ­ máº­t á»Ÿ phÃ­a báº¡n trong khi public key Ä‘Æ°á»£c trao Ä‘á»•i vá»›i client. Nhá»¯ng key nÃ y cho phÃ©p push service biáº¿t app server nÃ o Ä‘Ã£ Ä‘Äƒng kÃ½ user vÃ  Ä‘áº£m báº£o Ä‘Ã³ chÃ­nh lÃ  server trigger cÃ¡c push message Ä‘áº¿n ngÆ°á»i dÃ¹ng cá»¥ thá»ƒ.</p><p>Báº¡n chá»‰ cáº§n táº¡o ra cáº·p private/public key 1 láº§n duy nháº¥t cho á»©ng dá»¥ng. CÃ³ 1 cÃ¡ch lÃ m nhanh Ä‘Ã³ lÃ  dÃ¹ng trang nÃ y <a href="https://web-push-codelab.glitch.me/" target="_blank" rel="noopener">https://web-push-codelab.glitch.me/</a></p><p>TrÃ¬nh duyá»‡t truyá»n applicationServerKey (public key) lÃªn má»™t push server khi Ä‘Äƒng kÃ½ user, nghÄ©a lÃ  push server cÃ³ thá»ƒ liÃªn káº¿t public key cá»§a app báº¡n vá»›i PushSubscription cá»§a user.</p><p>ÄÃ¢y lÃ  nhá»¯ng gÃ¬ diá»…n ra:</p><ul><li>Webapp cá»§a báº¡n Ä‘Æ°á»£c load xong vÃ  báº¡n gá»i subscribe(), truyá»n server key vÃ o.</li><li>TrÃ¬nh duyá»‡t táº¡o 1 request lÃªn máº¡ng Ä‘áº¿n má»™t push service Ä‘á»ƒ sinh ra má»™t endpoint, sau Ä‘Ã³ liÃªn káº¿t endpoint nÃ y vá»›i key vÃ  tráº£ vá» cho trÃ¬nh duyá»‡t.</li><li>TrÃ¬nh duyá»‡t sáº½ thÃªm endpoint nÃ y vÃ o trong object PushSubscription, chÃ­nh lÃ  object Ä‘Æ°á»£c tráº£ vá» tá»« subscribe() promise.</li></ul><p>Vá» sau, cá»© má»—i khi báº¡n muá»‘n gá»­i 1 push message, báº¡n chá»‰ cáº§n táº¡o má»™t <strong>Authorization header</strong> cÃ³ chÆ°a thÃ´ng tin Ä‘Ã£ kÃ½ (signed) vá»›i private key tá»« server á»©ng dá»¥ng cá»§a báº¡n. Khi push service nháº­n request Ä‘á»ƒ gá»­i má»™t push message, nÃ³ sáº½ xÃ¡c minh header báº±ng cÃ¡ch tÃ¬m public key Ä‘Ã£ liÃªn káº¿t vá»›i endpoint cá»¥ thá»ƒ Ä‘Ã³ (á»Ÿ bÆ°á»›c thá»© 2)</p><h1 id="Object-PushSubscription"><a href="#Object-PushSubscription" class="headerlink" title="Object PushSubscription"></a>Object PushSubscription</h1><p>Má»™t PushSubscription chá»©a nhá»¯ng thÃ´ng tin cáº§n thiáº¿t Ä‘á»ƒ gá»­i push message Ä‘áº¿n thiáº¿t bá»‹ cá»§a user:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"endpoint"</span>: <span class="string">"https://domain.pushservice.com/some-id"</span>,</span><br><span class="line">  <span class="string">"keys"</span>: &#123;</span><br><span class="line">    <span class="string">"p256dh"</span>:</span><br><span class="line"><span class="string">"BIPUL12DLfytvTajnryr3PJdAgXS3HGMlLqndGcJGabyhHheJYlNGCeXl1dn18gSJ1WArAPIxr4gK0_dQds4yiI="</span>,</span><br><span class="line">    <span class="string">"auth"</span>:<span class="string">"FPssMOQPmLmXWmdSTdbKVw=="</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>endpoint á»Ÿ Ä‘Ã¢y lÃ  URL cá»§a push service. Äá»ƒ trigger má»™t push mesage ta cáº§n táº¡o request POST Ä‘áº¿n URL nÃ y.<br>Object keys chá»©a giÃ¡ trá»‹ dÃ¹ng Ä‘á»ƒ mÃ£ hÃ³a dá»¯ liá»‡u thÃ´ng tin Ä‘Æ°á»£c gá»­i Ä‘i vá»›i push message.<br>Má»™t khi user Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½ vÃ  báº¡n cÃ³ PushSubscription thÃ¬ báº¡n cáº§n gá»­i nÃ³ vá» cho server. Táº¡i Ä‘Ã¢y (trÃªn server) báº¡n sáº½ lÆ°u thÃ´ng tin tham gia cá»§a user vÃ o database vÃ  ká»ƒ tá»« bÃ¢y giá» sáº½ dÃ¹ng nÃ³ Ä‘á»ƒ gá»­i push message vá» cho user Ä‘Ã³.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*hTMGxzZrOmxxIfaQU7nKig.png" alt=""></p><h1 id="Gui-push-message"><a href="#Gui-push-message" class="headerlink" title="Gá»­i push message"></a>Gá»­i push message</h1><p>Khi báº¡n cáº§n gá»­i má»™t push message cho nhiá»u user, Ä‘iá»u Ä‘áº§u tiÃªn báº¡n cáº§n lÃ  push service. Báº¡n Ä‘ang chá»‰ báº£o cho push service (thÃ´ng qua API) dá»¯ liá»‡u Ä‘á»ƒ gá»­i, gá»­i Ä‘áº¿n ai vÃ  cÃ¡c tÃ¬nh huá»‘ng vá» viá»‡c lÃ m tháº¿ nÃ o Ä‘á»ƒ gá»­i message. ThÃ´ng thÆ°á»ng, lá»i gá»i API nÃ y sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n trÃªn server.</p><h1 id="Push-Services"><a href="#Push-Services" class="headerlink" title="Push Services"></a>Push Services</h1><p>Push service lÃ  thá»© dÃ¹ng Ä‘á»ƒ nháº­n cÃ¡c request, xÃ¡c nháº­n chÃºng vÃ  chuyá»ƒn giao push message cho trÃ¬nh duyá»‡t phÃ¹ há»£p.</p><p>LÆ°u Ã½ ráº±ng báº¡n khÃ´ng quáº£n lÃ½ push service, nÃ³ lÃ  1 dá»‹ch vá»¥ cá»§a bÃªn thá»© 3. Server cá»§a báº¡n giao tiáº¿p vá»›i push service thÃ´ng qua API. Má»™t vÃ­ dá»¥ vá» push service chÃ­nh lÃ  <a href="https://firebase.google.com/docs/cloud-messaging/" target="_blank" rel="noopener">Googleâ€™s FCM</a></p><p>Push service xá»­ lÃ½ táº¥t cáº£ nhá»¯ng viá»‡c náº·ng nhá»c. VÃ­ dá»¥: Náº¿u nhÆ° trÃ¬nh duyá»‡t Ä‘ang offline, push service sáº½ xáº¿p message vÃ o hÃ ng Ä‘á»£i vÃ  chá» cho Ä‘áº¿n khi trÃ¬nh duyá»‡t online láº¡i trÆ°á»›c khi gá»­i message Ä‘i 1 cÃ¡ch tuáº§n tá»±.</p><p>Má»—i tÃ¬nh duyá»‡t cÃ³ thá»ƒ dÃ¹ng báº¥t ká»³ push service nÃ o vÃ  Ä‘iá»u nÃ y vÆ°á»£t ngoÃ i kháº£ nÄƒng kiá»ƒm soÃ¡t cá»§a developer.</p><p>Tuy nhiÃªn táº¥t cáº£ cÃ¡c push service cÃ³ chung API nÃªn viá»‡c nÃ y khÃ´ng lÃ m cho quÃ¡ trÃ¬nh triá»ƒn khai trá»Ÿ nÃªn khÃ³ khÄƒn.</p><p>Äá»ƒ láº¥y Ä‘Æ°á»£c URL xá»­ lÃ½ cÃ¡c request cho push message, báº¡n cáº§n pháº£i kiá»ƒm tra giÃ¡ trá»‹ cá»§a endpoint trong object PushSubscription.</p><h1 id="Push-Service-API"><a href="#Push-Service-API" class="headerlink" title="Push Service API"></a>Push Service API</h1><p>Push Service API cung cáº¥p 1 cÃ¡ch Ä‘á»ƒ gá»­i message Ä‘áº¿n cho user. API lÃ  1 <a href="https://tools.ietf.org/html/draft-ietf-webpush-protocol-12" target="_blank" rel="noopener">Web Push Protocol</a> theo tiÃªu chuáº©n IETF Ä‘á»‹nh nghÄ©a cÃ¡ch ta gá»i API Ä‘áº¿n má»™t push service</p><p>Dá»¯ liá»‡u báº¡n gá»­i vá»›i push message pháº£i Ä‘Æ°á»£c mÃ£ hÃ³a. Báº±ng cÃ¡ch nÃ y, báº¡n ngÄƒn cháº·n push service Ä‘á»c dá»¯ liá»‡u gá»­i Ä‘i. Äiá»u nÃ y ráº¥t quan trá»ng vÃ¬ trÃ¬nh duyá»‡t chÃ­nh lÃ  ngÆ°á»i quyáº¿t Ä‘á»‹nh nÃªn dÃ¹ng push service nÃ o (cÃ³ thá»ƒ Ä‘Ã³ lÃ  push service khÃ´ng Ä‘Ã¡ng tin cáº­y vÃ  báº£o máº­t kÃ©m)</p><p>Vá»›i má»—i push message, báº¡n cÃ³ thá»ƒ Ä‘Æ°a ra hÆ°á»›ng dáº«n nhÆ° sau:</p><ul><li><strong>TTL</strong>: Ä‘á»‹nh nghÄ©a má»™t message nÃªn chá» bao lÃ¢u trong hÃ ng Ä‘á»£i trÆ°á»›c khi nÃ³ bá»‹ gá»¡ ra vÃ  khÃ´ng Ä‘Æ°á»£c chuyá»ƒn Ä‘i.</li><li><strong>Má»©c Ä‘á»™ Æ°u tiÃªn (priority)</strong>: Ä‘á»‹nh nghÄ©a má»©c Ä‘á»™ Æ°u tiÃªn cá»§a má»—i message, cÃ¡ch nÃ y giÃºp cho push service chá»‰ gá»­i nhá»¯ng thÃ´ng tin cÃ³ má»©c Ä‘á»™ Æ°u tiÃªn cao, vÃ­ dá»¥ trong trÆ°á»ng há»£p pin thiáº¿t bá»‹ cá»§a ngÆ°á»i dÃ¹ng sáº¯p cáº¡n.</li><li><strong>Chá»§ Ä‘á» (topic)</strong>: cung cáº¥p cho push message má»™t tÃªn chá»§ Ä‘á» sáº½ thay tháº¿ message Ä‘ang chá» xá»­ lÃ½ (pending) cÃ³ cÃ¹ng chá»§ Ä‘á» Ä‘á»ƒ khi thiáº¿t bá»‹ Ä‘ang hoáº¡t Ä‘á»™ng, user sáº½ khÃ´ng nháº­n thÃ´ng tin cÅ©, lá»—i thá»i.</li></ul><p><img src="https://cdn-images-1.medium.com/max/1000/1*PgclyCPqxWc1rENfAOesag.png" alt=""></p><h1 id="Su-kien-Push-tren-trinh-duyet"><a href="#Su-kien-Push-tren-trinh-duyet" class="headerlink" title="Sá»± kiá»‡n Push trÃªn trÃ¬nh duyá»‡t"></a>Sá»± kiá»‡n Push trÃªn trÃ¬nh duyá»‡t</h1><p>Má»™t khi báº¡n gá»­i message Ä‘áº¿n push service nhÆ° giáº£i thÃ­ch á»Ÿ trÃªn, message sáº½ chuyá»ƒn sang tráº¡ng thÃ¡i chá» (pending) cho Ä‘áº¿n khi 1 trong sá»‘ nhá»¯ng Ä‘iá»u sau Ä‘Ã¢y xáº£y ra:</p><ul><li>Thiáº¿t bá»‹ online</li><li>Message háº¿t háº¡n trÃªn hÃ ng Ä‘á»£i do TTL.</li></ul><p>Khi push service truyá»n má»™t message, trÃ¬nh duyá»‡t sáº½ nháº­n nÃ³, giáº£i mÃ£ vÃ  Ä‘iá»u phá»‘i má»™t sá»± kiá»‡n push trong Service Worker cá»§a báº¡n.</p><p>Äiá»u tuyá»‡t vá»i lÃ  trÃ¬nh duyá»‡t thá»±c thi code Service Worker cá»§a báº¡n tháº­m chÃ­ cáº£ khi web page chÆ°a má»Ÿ lÃªn:</p><ul><li>Push message Ä‘Æ°á»£c gá»­i tá»›i trÃ¬nh duyá»‡t vÃ  Ä‘Æ°á»£c giáº£i mÃ£.</li><li>TrÃ¬nh duyá»‡t Ä‘Ã¡nh thá»©c Service Worker</li><li>Má»™t sá»± kiá»‡n push Ä‘Æ°á»£c phÃ¢n phá»‘i Ä‘áº¿n Service Worker</li></ul><p>Code Ä‘á»ƒ cÃ i Ä‘áº·t má»™t listener cho push even cÅ©ng khÃ¡ tÆ°Æ¡ng Ä‘á»“ng vá»›i cÃ¡c loáº¡i event listener khÃ¡c trong Javascript:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'push'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event.data) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'This push event has data: '</span>, event.data.text());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'This push event has no data.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Má»™t Ä‘iá»u cáº§n pháº£i hiá»ƒu vá» Service Worker lÃ  báº¡n cÃ³ Ã­t quyá»n kiá»ƒm soÃ¡t vá» thá»i gian cháº¡y cá»§a code Service Worker. TrÃ¬nh duyá»‡t quyáº¿t Ä‘á»‹nh khi nÃ o thÃ¬ Ä‘Ã¡nh thá»©c nÃ³ dáº­y vÃ  khi nÃ o thÃ¬ há»§y nÃ³.</p><p>Trong Service Worker, event.waitUntil(promise) cho trÃ¬nh duyá»‡t biáº¿t cÃ´ng viá»‡c váº«n Ä‘ang thá»±c hiá»‡n cho tá»›i khi promise Ä‘Æ°á»£c giáº£i quyáº¿t xong vÃ  trÃ¬nh duyá»‡t sáº½ khÃ´ng há»§y service worker náº¿u nÃ³ cáº§n quÃ¡ trÃ¬nh Ä‘Ã³ hoÃ n thÃ nh.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  1 vÃ­ dá»¥ vá» xá»­ lÃ½ sá»± kiá»‡n push:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'push'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> promise = self.registration.showNotification(<span class="string">'Push notification!'</span>);</span><br><span class="line"></span><br><span class="line">  event.waitUntil(promise);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Gá»i self.registration.showNotification() hiá»ƒn thá»‹ má»™t thÃ´ng bÃ¡o Ä‘áº¿n user vÃ  nÃ³ tráº£ vá» promise, promise nÃ y Ä‘Æ°á»£c resolve khi thÃ´ng bÃ¡o Ä‘Ã£ Ä‘Æ°á»£c hiá»ƒn thá»‹ lÃªn.</p><p>PhÆ°Æ¡ng thá»©c showNotification(title, options) cÃ³ thá»ƒ Ä‘Æ°á»£c chá»‰nh sá»­a Ä‘á»ƒ phÃ¹ há»£p vá»›i nhu cáº§u. Param title lÃ  1 string, cÃ²n options lÃ  object nhÆ° dÆ°á»›i Ä‘Ã¢y:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"//"</span>: <span class="string">"Visual Options"</span>,</span><br><span class="line">  <span class="string">"body"</span>: <span class="string">"&lt;String&gt;"</span>,</span><br><span class="line">  <span class="string">"icon"</span>: <span class="string">"&lt;URL String&gt;"</span>,</span><br><span class="line">  <span class="string">"image"</span>: <span class="string">"&lt;URL String&gt;"</span>,</span><br><span class="line">  <span class="string">"badge"</span>: <span class="string">"&lt;URL String&gt;"</span>,</span><br><span class="line">  <span class="string">"vibrate"</span>: <span class="string">"&lt;Array of Integers&gt;"</span>,</span><br><span class="line">  <span class="string">"sound"</span>: <span class="string">"&lt;URL String&gt;"</span>,</span><br><span class="line">  <span class="string">"dir"</span>: <span class="string">"&lt;String of 'auto' | 'ltr' | 'rtl'&gt;"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="string">"//"</span>: <span class="string">"Behavioural Options"</span>,</span><br><span class="line">  <span class="string">"tag"</span>: <span class="string">"&lt;String&gt;"</span>,</span><br><span class="line">  <span class="string">"data"</span>: <span class="string">"&lt;Anything&gt;"</span>,</span><br><span class="line">  <span class="string">"requireInteraction"</span>: <span class="string">"&lt;boolean&gt;"</span>,</span><br><span class="line">  <span class="string">"renotify"</span>: <span class="string">"&lt;Boolean&gt;"</span>,</span><br><span class="line">  <span class="string">"silent"</span>: <span class="string">"&lt;Boolean&gt;"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="string">"//"</span>: <span class="string">"Both Visual &amp; Behavioural Options"</span>,</span><br><span class="line">  <span class="string">"actions"</span>: <span class="string">"&lt;Array of Strings&gt;"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="string">"//"</span>: <span class="string">"Information Option. No visual affect."</span>,</span><br><span class="line">  <span class="string">"timestamp"</span>: <span class="string">"&lt;Long&gt;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu chi tiáº¿t vá» má»—i options á»Ÿ Ä‘Ã¢y: <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/showNotification" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/showNotification</a></p><p>Push Notification lÃ  má»™t cÃ¡ch tuyá»‡t vá»i Ä‘á»ƒ thu tháº­p sá»± chÃº Ã½ cá»§a user nhá»¯ng khi cÃ³ thÃ´ng tin gáº¥p, quan trá»ng hoáº·c cáº§n thá»i Ä‘iá»ƒm nháº¡y cáº£m mÃ  báº¡n muá»‘n chia sáº» vá»›i há».</p><p>Team SessionStack thá»±c hiá»‡n push notifications Ä‘á»ƒ bÃ¡o cho user biáº¿t khi cÃ³ crash, váº¥n Ä‘á» hoáº·c Ä‘iá»u gÃ¬ Ä‘Ã³ báº¥t thÆ°á»ng trong sáº£n pháº©m cá»§a há». Viá»‡c nÃ y giÃºp cho user biáº¿t ngay láº­p tá»©c náº¿u cÃ³ gÃ¬ khÃ´ng Ä‘Ãºng Ä‘ang xáº£y ra. Sau Ä‘Ã³ há» cÃ³ thá»ƒ replay láº¡i issue Ä‘Ã³ dÆ°á»›i dáº¡ng video vÃ  xem má»i thá»© diá»…n ra vá»›i ngÆ°á»i dÃ¹ng cuá»‘i cá»§a há» báº±ng cÃ¡ch táº­n dá»¥ng dá»¯ liá»‡u Ä‘Æ°á»£c thu tháº­p vá»›i thÆ° viá»‡n cá»§a SessionStack, cháº³ng háº¡n nhÆ° thay Ä‘á»•i trÃªn DOM, tÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng, request máº¡ng, biá»‡t lá»‡ khÃ´ng Ä‘Æ°á»£c xá»­ lÃ½ vÃ  cÃ¡c thÃ´ng bÃ¡o lá»—i.</p><p>TÃ­nh nÄƒng nÃ y khÃ´ng chá»‰ sáº½ giÃºp user sá»­ dá»¥ng SessionStack hiá»ƒu vÃ  tÃ¡i hiá»‡n láº¡i báº¥t ká»³ váº¥n Ä‘á» nÃ o mÃ  nÃ³ cÃ²n cho phÃ©p há» nháº­n Ä‘Æ°á»£c thÃ´ng bÃ¡o ngay khi nÃ³ xuáº¥t hiá»‡n.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 9 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;HÃ´m nay chÃºng ta sáº½ chuyá»ƒn hÆ°á»›ng sá»± chÃº Ã½ qua &lt;strong&gt;web push notifications&lt;/strong&gt; (táº¡m dá»‹ch: thÃ´ng bÃ¡o Ä‘áº©y trÃªn trang web): chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» thÃ nh pháº§n cá»§a nÃ³, khÃ¡m phÃ¡ cÃ¡c quy trÃ¬nh gá»­i/nháº­n thÃ´ng bÃ¡o phÃ­a sau vÃ  cuá»‘i bÃ i sáº½ cÃ¹ng tÃ¬m hiá»ƒu lÃ m sao SessionStack sá»­ dá»¥ng chÃºng Ä‘á»ƒ xÃ¢y dá»±ng chá»©c nÄƒng cá»§a sáº£n pháº©m.&lt;/p&gt;
&lt;p&gt;Push Notifications ráº¥t phá»• biáº¿n trong tháº¿ giá»›i cá»§a Ä‘iá»‡n thoáº¡i. VÃ¬ lÃ½ do nÃ y hay lÃ½ do khÃ¡c, chÃºng bÆ°á»›c chÃ¢n vÃ o tháº¿ giá»›i web láº¡i khÃ¡ muá»™n máº·c dÃ¹ nÃ³ lÃ  tÃ­nh nÄƒng ráº¥t Ä‘Æ°á»£c cÃ¡c developer Æ°a chuá»™ng vÃ  Ä‘á» xuáº¥t.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P8: Service Workers, vÃ²ng Ä‘á»i vÃ  cÃ¡c trÆ°á»ng há»£p sá»­ dá»¥ng</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P8-Service-Workers-vong-doi-va-cac-truong-hop-su-dung.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P8-Service-Workers-vong-doi-va-cac-truong-hop-su-dung.html</id>
    <published>2018-11-24T15:04:00.000Z</published>
    <updated>2018-11-24T15:16:23.564Z</updated>
    
    <content type="html"><![CDATA[<p>Báº¡n cÃ³ láº½ Ä‘Ã£ biáº¿t ráº±ng <a href="https://developers.google.com/web/progressive-web-apps/" target="_blank" rel="noopener">Progressive Web Apps</a> chá»‰ cÃ³ thá»ƒ phá»• biáº¿n hÆ¡n khi chÃºng hÆ°á»›ng tá»›i tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng (UX) mÆ°á»£t mÃ  hÆ¡n, giá»‘ng nhÆ° lÃ  táº¡o 1 native app hÆ¡n lÃ  má»™t tráº£i nghiá»‡m mang phong cÃ¡ch trÃ¬nh duyá»‡t.</p><p>Má»™t trong sá»‘ nhá»¯ng yÃªu cáº§u khi xÃ¢y dá»±ng PWA lÃ  lÃ m nÃ³ cá»±c ká»³ Ä‘Ã¡ng tin cáº­y á»Ÿ khoáº£n loading: nÃ³ cÃ³ thá»ƒ cháº¡y ká»ƒ cáº£ trong tÃ¬nh tráº¡ng internet khÃ´ng á»•n Ä‘á»‹nh hoáº·c rá»›t máº¡ng.</p><p>Trong bÃ i nÃ y, chÃºng ta sáº½ Ä‘Ã o sÃ¢u vÃ o Service Workers: cÃ¡ch chÃºng hoáº¡t Ä‘á»™ng vÃ  chÃºng ta nÃªn quan tÃ¢m Ä‘áº¿n Ä‘Ã¢u. Cuá»‘i bÃ i, team tÃ¡c giáº£ cÃ³ má»™t sá»‘ lá»£i Ã­ch Ä‘á»™c Ä‘Ã¡o cá»§a Service Workers mÃ  chÃºng ta nÃªn dÃ¹ng Ä‘á»“ng thá»i chia sáº» kinh nghiá»‡m cá»§a há» táº¡i <a href="https://www.sessionstack.com/" target="_blank" rel="noopener">SessionStack</a>.<br><a id="more"></a></p><h1 id="Khai-quat"><a href="#Khai-quat" class="headerlink" title="KhÃ¡i quÃ¡t"></a>KhÃ¡i quÃ¡t</h1><p>Náº¿u báº¡n muá»‘n hiá»ƒu rÃµ má»i thá»© vá» Service Workers, báº¡n cáº§n pháº£i báº¯t Ä‘áº§u vá»›i bÃ i viáº¿t trÆ°á»›c vá» <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-7---Thanh-phan-cua-WebWorker---5-truong-hop-su-dung" target="_blank" rel="noopener">Web Workers</a>.</p><p>Vá» cÆ¡ báº£n, Service Worker chá»‰ lÃ  1 loáº¡i cá»§a Web Worker vÃ  cá»¥ thá»ƒ hÆ¡n lÃ  nÃ³ giá»‘ng nhÆ° 1 <a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker" target="_blank" rel="noopener">Shared Worker</a>:</p><ul><li>Service Worker cháº¡y trong global context cá»§a chÃ­nh nÃ³</li><li>NÃ³ khÃ´ng thá»ƒ gáº¯n káº¿t vá»›i 1 trang cá»¥ thá»ƒ</li><li>KhÃ´ng thá»ƒ truy cáº­p vÃ o DOM</li></ul><p>Má»™t trong nhá»¯ng lÃ½ do táº¡i sao Service Worker API ráº¥t tuyá»‡t vá»i lÃ  chÃºng cho phÃ©p webapp há»— trá»£ tráº£i nghiá»‡m khi offline, cho phÃ©p developer hoÃ n toÃ n Ä‘iá»u khiá»ƒn luá»“ng sá»­ dá»¥ng.</p><h1 id="Vong-doi-cua-Service-Worker"><a href="#Vong-doi-cua-Service-Worker" class="headerlink" title="VÃ²ng Ä‘á»i cá»§a Service Worker"></a>VÃ²ng Ä‘á»i cá»§a Service Worker</h1><p>VÃ²ng Ä‘á»i cá»§a má»™t service worker lÃ  hoÃ n toÃ n tÃ¡ch biá»‡t vá»›i web page. NÃ³ bao gá»“m cÃ¡c giai Ä‘oáº¡n sau:</p><ul><li>Táº£i vá» (Download)</li><li>CÃ i Ä‘áº·t (Installation)</li><li>KÃ­ch hoáº¡t (Activation)</li></ul><h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p>ÄÃ¢y lÃ  khi trÃ¬nh duyá»‡t táº£i file .js chá»©a Service Worker</p><h2 id="Cai-dat"><a href="#Cai-dat" class="headerlink" title="CÃ i Ä‘áº·t"></a>CÃ i Ä‘áº·t</h2><p>Äá»ƒ cÃ i Ä‘áº·t má»™t Service Worker cho webapp cá»§a báº¡n thÃ¬ báº¡n cáº§n pháº£i Ä‘Äƒng kÃ½ nÃ³ trÆ°á»›c trong code Javascript. Khi Service Worker Ä‘Ã£ Ä‘Äƒng kÃ½ xong, nÃ³ sáº½ nháº¯c nhá»Ÿ tÃ¬nh duyá»‡t khá»Ÿi Ä‘á»™ng má»™t bÆ°á»›c cÃ i Ä‘áº·t cháº¡y ná»n Service Worker.</p><p>Báº±ng cÃ¡ch Ä‘Äƒng kÃ½ Service Worker, báº¡n Ä‘Ã£ thÃ´ng bÃ¡o cho trÃ¬nh duyá»‡t file Javascript cá»§a worker náº±m á»Ÿ Ä‘Ã¢u. CÃ¹ng xem vÃ­ dá»¥ bÃªn dÆ°á»›i:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    navigator.serviceWorker.register(<span class="string">'/sw.js'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">registration</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ÄÄƒng kÃ½ thÃ nh cÃ´ng</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'ServiceWorker registration successful'</span>);</span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ÄÄƒng kÃ½ tháº¥t báº¡i</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'ServiceWorker registration failed: '</span>, err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Code sáº½ kiá»ƒm tra náº¿u mÃ´i trÆ°á»ng hiá»‡n táº¡i cÃ³ support Service Worker hay khÃ´ng. Náº¿u nhÆ° cÃ³ thÃ¬ file /sw.js sáº½ Ä‘Æ°á»£c Ä‘Äƒng kÃ½.</p><p>Báº¡n cÃ³ thá»ƒ gá»i phÆ°Æ¡ng thá»©c register() má»—i khi má»™t trang load lÃªn mÃ  khÃ´ng pháº£i lo láº¯ng gÃ¬, trÃ¬nh duyá»‡t sáº½ sáº½ tá»± kiá»ƒm tra náº¿u service worker Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½ hay chÆ°a vÃ  tá»± xá»­ lÃ½ má»™t cÃ¡ch phÃ¹ há»£p.</p><p>Má»™t Ä‘iá»ƒm quan trá»ng á»Ÿ phÆ°Æ¡ng thá»©c register() lÃ  vá»‹ trÃ­ cá»§a file service worker. Trong trÆ°á»ng há»£p nÃ y báº¡n cÃ³ thá»ƒ tháº¥y ráº±ng file service worker Ä‘ang á»Ÿ root cá»§a domain. NghÄ©a lÃ  pháº¡m vi (scope) cá»§a service worker sáº½ bao hÃ m toÃ n bá»™ origin. NÃ³i cÃ¡ch khÃ¡c, service worker nÃ y sáº½ nháº­n cÃ¡c sá»± kiá»‡n fetch (mÃ  chÃºng ta sáº½ tháº£o luáº­n sau) cho má»i thá»© trÃªn domain nÃ y. Náº¿u ta Ä‘Äƒng kÃ½ file service worker á»Ÿ /example/sw.js thÃ¬ service worker chá»‰ cÃ³ thá»ƒ tháº¥y cÃ¡c sá»± kiá»‡n fetch cho trang cÃ³ URL báº¯t Ä‘áº§u vá»›i /example/ (vÃ­ dá»¥: /example/page/1, /example/page/2)</p><p>Trong giai Ä‘oáº¡n cÃ i Ä‘áº·t, tá»‘t nháº¥t ta nÃªn load vÃ  cache nhá»¯ng tÃ i nguyÃªn dáº¡ng tÄ©nh (static asset). Má»™t khi cÃ¡c tÃ i nguyÃªn Ä‘Ã£ Ä‘Æ°á»£c cache thÃ nh cÃ´ng thÃ¬ quÃ¡ trÃ¬nh cÃ i Ä‘áº·t Service Worker cÅ©ng hoÃ n thÃ nh. Náº¿u khÃ´ng (load fail), Service Worker sáº½ thá»­ láº¡i (retry). Má»™t khi Ä‘Ã£ thÃ nh cÃ´ng, báº¡n sáº½ biáº¿t cÃ¡c static asset Ä‘ang náº±m trong cache.</p><p>Báº¡n sáº½ tá»± há»i náº¿u nhÆ° quÃ¡ tÃ¬nh Ä‘Äƒng kÃ½ diá»…n ra sau sá»± kiá»‡n load thÃ¬ Ä‘Æ°á»£c khÃ´ng. Äiá»u nÃ y khÃ´ng báº¯t buá»™c, nhÆ°ng Ä‘Ã³ lÃ  cÃ¡ch tá»‘t nháº¥t vÃ  Ä‘Æ°á»£c Ä‘á» nghá»‹ lÃ m theo.</p><p>Táº¡i sao? Giáº£ sá»­ má»™t user láº§n Ä‘áº§u tiÃªn ghÃ© thÄƒm webapp cá»§a báº¡n. KhÃ´ng cÃ³ service worker nÃ o cáº£ vÃ  trÃ¬nh duyá»‡t khÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ biáº¿t trÆ°á»›c cÃ³ hay khÃ´ng má»™t service worker cáº§n Ä‘Æ°á»£c cÃ i Ä‘áº·t. Náº¿u nhÆ° Service Worker Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t, trÃ¬nh duyá»‡t sáº½ dÃ nh ra 1 lÆ°á»£ng CPU vÃ  bá»™ nhá»› cho tiáº¿n trÃ¬nh Ä‘Ã³, ngÆ°á»£c láº¡i thÃ¬ trÃ¬nh duyá»‡t sáº½ dÃ nh toÃ n bá»™ cho quÃ¡ trÃ¬nh render web page.</p><p>Äiá»ƒm máº¥u chá»‘t lÃ  náº¿u báº¡n chá»‰ cÃ i Ä‘áº·t Service Worker trÃªn trang cá»§a báº¡n thÃ¬ báº¡n Ä‘ang máº¡o hiá»ƒm vá» Ä‘á»™ delay cá»§a quÃ¡ trÃ¬nh loading &amp; render chá»© khÃ´ng pháº£i Ä‘ang lÃ m cho trang cÃ³ thá»ƒ sáºµn sÃ ng cho ngÆ°á»i dÃ¹ng má»™t cÃ¡ch nhanh nháº¥t cÃ³ thá»ƒ.</p><p>LÆ°u Ã½ ráº±ng Ä‘iá»u nÃ y chá»‰ quan trá»ng cho láº§n Ä‘áº§u tiÃªn ghÃ© thÄƒm trang. Nhá»¯ng láº§n ghÃ© thÄƒm sau thÃ¬ khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng vá»›i quÃ¡ trÃ¬nh cÃ i Ä‘áº·t Service Worker. Má»™t khi Service Worker Ä‘Ã£ Ä‘Æ°á»£c kÃ­ch hoáº¡t trong láº§n Ä‘áº§u ghÃ© thÄƒm trang, nÃ³ cÃ³ thá»ƒ xá»­ lÃ½ cÃ¡c sá»± kiá»‡n loading/caching cho nhá»¯ng láº§n ghÃ© thÄƒm káº¿ tiáº¿p. Äiá»u nÃ y ráº¥t cÃ³ Ã½ nghÄ©a bá»Ÿi vÃ¬ nÃ³ cáº§n pháº£i sáºµn sÃ ng Ä‘á»ƒ xá»­ lÃ½ trÆ°á»ng há»£p káº¿t ná»‘i máº¡ng bá»‹ háº¡n cháº¿.</p><h2 id="Kich-hoat"><a href="#Kich-hoat" class="headerlink" title="KÃ­ch hoáº¡t"></a>KÃ­ch hoáº¡t</h2><p>Sau khi Service Worker cÃ i Ä‘áº·t, bÆ°á»›c tiáº¿p theo lÃ  kÃ­ch hoáº¡t nÃ³. BÆ°á»›c nÃ y lÃ  cÆ¡ há»™i tuyá»‡t vá»i Ä‘á»ƒ quáº£n lÃ½ cache trÆ°á»›c Ä‘Ã³.</p><p>Má»™t khi Ä‘Ã£ kÃ­ch hoáº¡t, Service Worker sáº½ báº¯t Ä‘áº§u kiá»ƒm soÃ¡t toÃ n trang náº±m trong pháº¡m vi cá»§a nÃ³. Má»™t sá»± tháº­t ráº¥t thÃº vá»‹: page nÃ o Ä‘Äƒng kÃ½ Service Worker láº§n Ä‘áº§u tiÃªn sáº½ khÃ´ng bá»‹ Ä‘iá»u khiá»ƒn cho Ä‘áº¿n khi nÃ³ load láº¡i. Má»™t khi Service Worker kiá»ƒm soÃ¡t, nÃ³ sáº½ cÃ³ nhá»¯ng tráº¡ng thÃ¡i sau:</p><ul><li>NÃ³ sáº½ xá»­ lÃ½ cÃ¡c sá»± kiá»‡n fetch &amp; message diá»…n ra khi má»™t request máº¡ng hoáº·c message Ä‘Æ°á»£c táº¡o ra tá»« page.</li><li>NÃ³ sáº½ bá»‹ há»§y bá» Ä‘á»ƒ giáº£i phÃ³ng bá»™ nhá»›.</li></ul><p>DÆ°á»›i Ä‘Ã¢y lÃ  vÃ²ng Ä‘á»i cá»§a nÃ³:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*mVOrpKC9pFTMg4EXPozoog.png" alt=""></p><h1 id="Xu-ly-qua-trinh-cai-dat-ben-trong-Service-Worker"><a href="#Xu-ly-qua-trinh-cai-dat-ben-trong-Service-Worker" class="headerlink" title="Xá»­ lÃ½ quÃ¡ trÃ¬nh cÃ i Ä‘áº·t bÃªn trong Service Worker"></a>Xá»­ lÃ½ quÃ¡ trÃ¬nh cÃ i Ä‘áº·t bÃªn trong Service Worker</h1><p>Sau khi page xoay vÃ²ng quÃ¡ trÃ¬nh Ä‘Äƒng kÃ½, ta cÃ¹ng tÃ¬m hiá»ƒu Ä‘iá»u gÃ¬ diá»…n ra bÃªn trong script cá»§a Service Worker, code nÃ y xá»­ lÃ½ sá»± kiá»‡n cÃ i Ä‘áº·t báº±ng cÃ¡ch thÃªm má»™t event listener vÃ o instance cá»§a Service Worker.</p><p>ÄÃ¢y lÃ  nhá»¯ng bÆ°á»›c cáº§n thiáº¿t khi xá»­ lÃ½ sá»± kiá»‡n cÃ i Ä‘áº·t</p><ul><li>Má»Ÿ cache</li><li>Cache cÃ¡c file</li><li>XÃ¡c nháº­n táº¥t cáº£ cÃ¡c asset cáº§n thiáº¿t Ä‘á»u Ä‘Ã£ Ä‘Æ°á»£c cache.</li></ul><p>DÆ°á»›i Ä‘Ã¢y lÃ  quÃ¡ trÃ¬nh cÃ i Ä‘áº·t Ä‘Æ¡n giáº£n bÃªn trong Service Worker:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CACHE_NAME = <span class="string">'my-web-app-cache'</span>;</span><br><span class="line"><span class="keyword">var</span> urlsToCache = [</span><br><span class="line">  <span class="string">'/'</span>,</span><br><span class="line">  <span class="string">'/styles/main.css'</span>,</span><br><span class="line">  <span class="string">'/scripts/app.js'</span>,</span><br><span class="line">  <span class="string">'/scripts/lib.js'</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">self.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// event.waitUntil nháº­n má»™t promise Ä‘á»ƒ biáº¿t quÃ¡ trÃ¬nh</span></span><br><span class="line">  <span class="comment">// cÃ i Ä‘áº·t máº¥t bao lÃ¢u vÃ  cÃ³ thÃ nh cÃ´ng hay khÃ´ng.</span></span><br><span class="line">  event.waitUntil(</span><br><span class="line">    caches.open(CACHE_NAME)</span><br><span class="line">      .then(<span class="function"><span class="keyword">function</span>(<span class="params">cache</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Opened cache'</span>);</span><br><span class="line">        <span class="keyword">return</span> cache.addAll(urlsToCache);</span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Náº¿u táº¥t cáº£ cÃ¡c file Ä‘á»u Ä‘Ã£ Ä‘Æ°á»£c lÆ°u cache thÃ nh cÃ´ng thÃ¬ service worker sáº½ Ä‘Æ°á»£c cÃ i Ä‘áº·t. Náº¿u má»™t file nÃ o Ä‘Ã³ khÃ´ng download Ä‘Æ°á»£c thÃ¬ bÆ°á»›c cÃ i Ä‘áº·t sáº½ bá»‹ fail. VÃ¬ tháº¿ hÃ£y cáº©n tháº­n vá»›i nhá»¯ng file báº¡n truyá»n vÃ o.</p><p>Xá»­ lÃ½ sá»± kiá»‡n cÃ i Ä‘áº·t hoÃ n toÃ n khÃ´ng báº¯t buá»™c vÃ  báº¡n cÃ³ thá»ƒ bá» qua, trong trÆ°á»ng há»£p Ä‘Ã³ báº¡n khÃ´ng cáº§n pháº£i thá»±c hiá»‡n thÃªm bÆ°á»›c nÃ o ná»¯a.</p><h1 id="Cache-request-trong-qua-trinh-thuc-thi-runtime"><a href="#Cache-request-trong-qua-trinh-thuc-thi-runtime" class="headerlink" title="Cache request trong quÃ¡ trÃ¬nh thá»±c thi (runtime)"></a>Cache request trong quÃ¡ trÃ¬nh thá»±c thi (runtime)</h1><p>Pháº§n nÃ y thá»±c sá»± thÃº vá»‹ má»™t cÃ¡ch xuáº¥t sáº¯c. ÄÃ¢y lÃ  nÆ¡i báº¡n sáº½ biáº¿t lÃ m tháº¿ nÃ o Ä‘á»ƒ can thiá»‡p request vÃ  tráº£ vá» cache Ä‘Ã£ Ä‘Æ°á»£c táº¡o (vÃ  táº¡o má»›i).</p><p>Sau khi Service Worker cÃ i Ä‘áº·t xong vÃ  user Ä‘iá»u hÆ°á»›ng Ä‘áº¿n page khÃ¡c hoáº·c refresh láº¡i page hiá»‡n táº¡i, Service Worker sáº½ nháº­n Ä‘Æ°á»£c sá»± kiá»‡n fetch. ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ thá»ƒ hiá»‡n lÃ m tháº¿ nÃ o Ä‘á»ƒ tráº£ vá» nhá»¯ng asset Ä‘Ã£ cache hoáº·c thá»±c hiá»‡n má»™t request má»›i vÃ  cache káº¿t quáº£:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  event.respondWith(</span><br><span class="line">    <span class="comment">// PhÆ°Æ¡ng thá»©c nÃ y xem xÃ©t request vÃ  tÃ¬m xem cÃ³</span></span><br><span class="line">    <span class="comment">// káº¿t quáº£ nÃ o Ä‘Ã£ Ä‘Æ°á»£c cache tá»« táº¥t cáº£ cÃ¡c cache</span></span><br><span class="line">    <span class="comment">// mÃ  Service Worker Ä‘Ã£ táº¡o.</span></span><br><span class="line">    caches.match(event.request)</span><br><span class="line">      .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Náº¿u tÃ¬m tháº¥y cache thÃ¬ tráº£ vá» response.</span></span><br><span class="line">        <span class="keyword">if</span> (response) &#123;</span><br><span class="line">          <span class="keyword">return</span> response;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// NhÃ¢n báº£n request. Má»™t request lÃ  1 stream vÃ  chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng 1 láº§n. </span></span><br><span class="line">        <span class="comment">// Bá»Ÿi vÃ¬ chÃºng ta Ä‘ang xÃ i 1 cÃ¡i cho cache vÃ  1 cÃ¡i cho trÃ¬nh duyá»‡t Ä‘á»ƒ fetch,</span></span><br><span class="line">        <span class="comment">// náº¿n ta cáº§n pháº£i nhÃ¢n báº£n request.</span></span><br><span class="line">        <span class="keyword">var</span> fetchRequest = event.request.clone();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Cache khÃ´ng tÃ¬m tháº¥y nÃªn ta cáº§n thá»±c hiá»‡n fetch</span></span><br><span class="line">        <span class="comment">// Ä‘á»ƒ táº¡o request tá»›i máº¡ng vÃ  tráº£ vá» dá»¯ liá»‡u náº¿u tÃ¬m tháº¥y</span></span><br><span class="line">        <span class="comment">// thá»© gÃ¬ Ä‘Ã³.</span></span><br><span class="line">        <span class="keyword">return</span> fetch(fetchRequest).then(</span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// Kiá»ƒm tra náº¿u ta nháº­n Ä‘Æ°á»£c response há»£p lá»‡.</span></span><br><span class="line">            <span class="keyword">if</span>(!response || response.status !== <span class="number">200</span> || response.type !== <span class="string">'basic'</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> response;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// NhÃ¢n báº£n response bá»Ÿi vÃ¬ nÃ³ cÅ©ng khÃ´ng pháº£i lÃ  1 stream.</span></span><br><span class="line">            <span class="comment">// Bá»Ÿi vÃ¬ chÃºng ta muá»‘n trÃ¬nh duyá»‡t sá»­ dá»¥ng response cÅ©ng nhÆ°</span></span><br><span class="line">            <span class="comment">// cache sá»­ dá»¥ng response, ta cáº§n nhÃ¢n báº£n nÃ³ thÃ nh 2 stream.</span></span><br><span class="line">            <span class="keyword">var</span> responseToCache = response.clone();</span><br><span class="line"></span><br><span class="line">            caches.open(CACHE_NAME)</span><br><span class="line">              .then(<span class="function"><span class="keyword">function</span>(<span class="params">cache</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// ThÃªm request vÃ o cache phá»¥c vá»¥ sau nÃ y</span></span><br><span class="line">                cache.put(event.request, responseToCache);</span><br><span class="line">              &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>TÃ³m gá»n láº¡i thÃ¬ Ä‘Ã¢y lÃ  nhá»¯ng Ä‘iá»u Ä‘Ã£ diá»…n ra:</p><ul><li>event.respondWith() sáº½ xÃ¡c Ä‘á»‹nh lÃ m tháº¿ nÃ o chÃºng ta pháº£n há»“i vá»›i sá»± kiá»‡n fetch. Ta truyá»n má»™t promise tá»« caches.match(), hÃ m Ä‘ang kiá»ƒm tra request vÃ  tÃ¬m kiáº¿m náº¿u cÃ³ báº¥t ká»³ káº¿t quáº£ Ä‘Ã£ Ä‘Æ°á»£c cache sáºµn nÃ o tá»« nhá»¯ng cache Ä‘Ã£ Ä‘Æ°á»£c táº¡o trÆ°á»›c Ä‘Ã³.</li><li>Náº¿u cÃ³ cache, response Ä‘Æ°á»£c láº¥y ra.</li><li>NgÆ°á»£c láº¡i, fetch Ä‘Æ°á»£c thá»±c thi.</li><li>Kiá»ƒm tra náº¿u tráº¡ng thÃ¡i lÃ  200. ChÃºng ta sáº½ kiá»ƒm tra kiá»ƒu response lÃ  cÆ¡ báº£n, nghÄ©a lÃ  nÃ³ sáº½ chá»‰ ra request tá»« origin cá»§a chÃºng ta. Request Ä‘áº¿n cÃ¡c asset cá»§a bÃªn thá»© 3 khÃ´ng thá»ƒ cache Ä‘Æ°á»£c trong trÆ°á»ng há»£p nÃ y.</li><li>Response Ä‘Æ°á»£c thÃªm vÃ o cache.</li></ul><p>Request vÃ  response pháº£i Ä‘Æ°á»£c nhÃ¢n báº£n (clone) vÃ¬ chÃºng lÃ  <a href="https://streams.spec.whatwg.org/" target="_blank" rel="noopener">stream</a>. ThÃ¢n (body) cá»§a má»™t stream chá»‰ cÃ³ thá»ƒ sá»­ dá»¥ng 1 láº§n. VÃ  khi ta cáº§n dÃ¹ng nÃ³, ta pháº£i nhÃ¢n báº£n nÃ³ bá»Ÿi vÃ¬ trÃ¬nh duyá»‡t cÅ©ng cáº§n sá»­ dá»¥ng nÃ³ ná»¯a.</p><h1 id="Cap-nhat-Service-Worker"><a href="#Cap-nhat-Service-Worker" class="headerlink" title="Cáº­p nháº­t Service Worker"></a>Cáº­p nháº­t Service Worker</h1><p>Khi má»™t user ghÃ© thÄƒm webapp cá»§a báº¡n, trÃ¬nh duyá»‡t sáº½ thá»­ download láº¡i file .js chá»©a code Service Worker. TÃ¡c vá»¥ nÃ y sáº½ Ä‘Æ°á»£c cháº¡y ná»n.</p><p>Náº¿u cÃ³ má»™t chÃºt khÃ¡c biá»‡t dÃ¹ chá»‰ má»™t byte giá»¯a file Service Worker má»›i download vá» vÃ  file cÅ© thÃ¬ trÃ¬nh duyá»‡t cÅ©ng sáº½ giáº£ Ä‘á»‹nh ráº±ng cÃ³ sá»± thay Ä‘á»•i vÃ  Service Worker má»›i pháº£i khá»Ÿi táº¡o láº¡i.</p><p>Service Worker má»›i sáº½ báº¯t Ä‘áº§u khá»Ÿi táº¡o vÃ  cÃ i Ä‘áº·t. Tuy nhiÃªn vÃ o thá»i Ä‘iá»ƒm nÃ y, Service Worker cÅ© váº«n Ä‘ang kiá»ƒm soÃ¡t page trÃªn webapp cá»§a báº¡n, nghÄ©a lÃ  Service Worker má»›i sáº½ náº±m trong tráº¡ng thÃ¡i chá» Ä‘á»£i.</p><p>Má»™t khi trang Ä‘ang má»Ÿ Ä‘Æ°á»£c Ä‘Ã³ng láº¡i, Service Worker cÅ© sáº½ bá»‹ há»§y bá»Ÿi trÃ¬nh duyá»‡t vÃ  Service Worker má»›i cÃ i Ä‘áº·t sáº½ chiáº¿m quyá»n kiá»ƒm soÃ¡t toÃ n bá»™. ÄÃ¢y lÃ  khi sá»± kiá»‡n kÃ­ch hoáº¡t cá»§a nÃ³ Ä‘Æ°á»£c kÃ­ch hoáº¡t.</p><p>Táº¡i sao láº¡i cáº§n pháº£i lÃ m táº¥t cáº£ Ä‘iá»u nÃ y? LÃ  Ä‘á»ƒ trÃ¡nh váº¥n Ä‘á» khi cÃ³ 2 phiÃªn báº£n webapp cháº¡y Ä‘á»“ng thá»i trong cÃ¡c tab khÃ¡c nhau. Viá»‡c nÃ y diá»…n ra má»™t cÃ¡ch ráº¥t phá»• biáº¿n vÃ  cÃ³ thá»ƒ táº¡o ra nhá»¯ng lá»—i tá»“i tá»‡ (vÃ­ dá»¥: báº¡n cÃ³ schema khÃ¡c nhau trong khi lÆ°u trá»¯ dá»¯ liá»‡u local trÃªn trÃ¬nh duyá»‡t).</p><h1 id="Xoa-du-lieu-trong-cache"><a href="#Xoa-du-lieu-trong-cache" class="headerlink" title="XÃ³a dá»¯ liá»‡u trong cache"></a>XÃ³a dá»¯ liá»‡u trong cache</h1><p>BÆ°á»›c phá»• biáº¿n nháº¥t trong callback kÃ­ch hoáº¡t lÃ  quáº£n lÃ½ cache. Báº¡n sáº½ cáº§n pháº£i lÃ m Ä‘iá»u nÃ y ngay bá»Ÿi vÃ¬ náº¿u báº¡n dá»n dáº¹p cache cÅ© trong bÆ°á»›c cÃ i Ä‘áº·t, Service Worker cÅ© sáº½ dá»«ng láº¡i má»™t cÃ¡ch Ä‘á»™t ngá»™t vÃ  khÃ´ng thá»ƒ phÃ¢n phá»‘i cÃ¡c file tá»« cache Ä‘Ã³ ná»¯a.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ cÃ¡ch báº¡n cÃ³ thá»ƒ xÃ³a vÃ i file khÃ´ng náº±m trong danh sÃ¡ch an toÃ n trong cache (trong trÆ°Æ¡ng há»£p nÃ y lÃ  cÃ³ chá»¯ page-1 vÃ  page-2 trong tÃªn cá»§a nÃ³)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'activate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cacheWhitelist = [<span class="string">'page-1'</span>, <span class="string">'page-2'</span>];</span><br><span class="line"></span><br><span class="line">  event.waitUntil(</span><br><span class="line">    <span class="comment">// Láº¥y táº¥t cáº£ key tá»« cache.</span></span><br><span class="line">    caches.keys().then(<span class="function"><span class="keyword">function</span>(<span class="params">cacheNames</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.all(</span><br><span class="line">        <span class="comment">// Láº·p qua máº£ng cÃ¡c file.</span></span><br><span class="line">        cacheNames.map(<span class="function"><span class="keyword">function</span>(<span class="params">cacheName</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// Náº¿u file trong cache khÃ´ng náº±m trong danh sÃ¡ch an toÃ n</span></span><br><span class="line">          <span class="comment">// thÃ¬ nÃ³ sáº½ bá»‹ xÃ³a.</span></span><br><span class="line">          <span class="keyword">if</span> (cacheWhitelist.indexOf(cacheName) === <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> caches.delete(cacheName);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Yeu-cau-HTTPS"><a href="#Yeu-cau-HTTPS" class="headerlink" title="YÃªu cáº§u HTTPS"></a>YÃªu cáº§u HTTPS</h1><p>Khi xÃ¢y dá»±ng webapp, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng Service Worker qua localhost nhÆ°ng má»™t khi Ä‘Ã£ deploy nÃ³ lÃªn production, báº¡n cáº§n chuáº©n bá»‹ HTTPS (vÃ  Ä‘Ã³ cÅ©ng lÃ  lÃ½ do cuá»‘i cÃ¹ng báº¡n cáº§n Ä‘áº¿n HTTPS).</p><p>Sá»­ dá»¥ng Service Worker, báº¡n cÃ³ thá»ƒ chiáº¿m quyá»n káº¿t ná»‘i vÃ  ngá»¥y táº¡o response. Náº¿u khÃ´ng dÃ¹ng HTTPS, webapp cá»§a báº¡n trá»Ÿ thÃ nh Ä‘á»‘i tÆ°á»£ng cá»§a cÃ¡ch táº¥n cÃ´ng <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener">káº»-trung-gian</a> (man-in-the-middle).</p><p>Äá»ƒ an toÃ n hÆ¡n, báº¡n cáº§n pháº£i Ä‘Äƒng kÃ½ Service Worker vá»›i page Ä‘Æ°á»£c phÃ¢n phá»‘i qua HTTPS Ä‘á»ƒ báº¡n biáº¿t Ä‘Æ°á»£c Service Worker nÃ o trÃ¬nh duyá»‡t nháº­n vá» mÃ  khÃ´ng bá»‹ thay Ä‘á»•i khi lÆ°u thÃ´ng qua máº¡ng.</p><h1 id="Cac-trinh-duyet-ho-tro"><a href="#Cac-trinh-duyet-ho-tro" class="headerlink" title="CÃ¡c trÃ¬nh duyá»‡t há»— trá»£"></a>CÃ¡c trÃ¬nh duyá»‡t há»— trá»£</h1><p>Sá»± há»— trá»£ cho Service Worker ngÃ y cÃ ng Ä‘Æ°á»£c cáº£i thiá»‡n:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*6o2TRDmrJlS97vh1wEjLYw.png" alt=""></p><p>Báº¡n cÃ³ thá»ƒ theo dÃµi tiáº¿n Ä‘á»™ cho táº¥t cáº£ cÃ¡c trÃ¬nh duyá»‡t táº¡i Ä‘Ã¢y: <a href="https://jakearchibald.github.io/isserviceworkerready/" target="_blank" rel="noopener">https://jakearchibald.github.io/isserviceworkerready/</a></p><h1 id="Service-Workers-mo-ra-chan-troi-moi"><a href="#Service-Workers-mo-ra-chan-troi-moi" class="headerlink" title="Service Workers má»Ÿ ra chÃ¢n trá»i má»›i"></a>Service Workers má»Ÿ ra chÃ¢n trá»i má»›i</h1><p>Má»™t sá»‘ tÃ­nh nÄƒng Ä‘á»™c Ä‘Ã¡o mÃ  Service Worker cung cáº¥p:</p><ul><li><strong>Push notificationsâ€Š</strong>: cho phÃ©p user tham gia vÃ o láº¯ng nghe cáº­p nháº­t theo thá»i gian</li><li><strong>Äá»“ng bá»™ dÆ°á»›i ná»n (background sync)</strong>: cho phÃ©p báº¡n táº¡m hoÃ£n cÃ¡c hÃ nh Ä‘á»™ng cho tá»›i khi user cÃ³ káº¿t ná»‘i á»•n Ä‘á»‹nh. Báº±ng cÃ¡ch nÃ y báº¡n cÃ³ thá»ƒ Ä‘áº£m báº£o ráº±ng báº¥t ká»³ thá»© gÃ¬ mÃ  user cáº§n gá»­i thÃ¬ cháº¯c cháº¯n nÃ³ sáº½ Ä‘Æ°á»£c gá»­i Ä‘i.</li><li><strong>Äá»“ng bá»™ Ä‘á»‹nh ká»³ (periodic sync - tÆ°Æ¡ng lai)</strong>: API cung cáº¥p kháº£ nÄƒng quáº£n lÃ½ Ä‘á»“ng bá»™ dÆ°á»›i ná»n theo chu ká»³.</li><li><strong>Ranh giá»›i áº£o (Geofencing - tÆ°Æ¡ng lai)</strong>: báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a params, cÃ²n gá»i lÃ  nhá»¯ng geofence bao quanh má»™t khu vá»±c. Webapp sáº½ nháº­n thÃ´ng bÃ¡o khi cÃ³ má»™t thiáº¿t bá»‹ vÆ°á»£t qua geofence, Ä‘iá»u nÃ y cho phÃ©p báº¡n cung cáº¥p tráº£ nghiá»‡m cÃ³ Ã­ch dá»±a trÃªn vá»‹ trÃ­ Ä‘á»‹a lÃ½ cá»§a user.</li></ul><p>Má»—i má»¥c nÃ y sáº½ Ä‘Æ°á»£c tháº£o luáº­n chi tiáº¿t hÆ¡n trong cÃ¡c bÃ i viáº¿t khÃ¡c.</p><p>Team tÃ¡c giáº£ Ä‘ang ná»— lá»±c khÃ´ng ngá»«ng Ä‘á»ƒ mang láº¡i tráº£i nghiá»‡m UX mÆ°á»£t mÃ  nháº¥t cÃ³ thá»ƒ cho SessionStack, tá»‘i Æ°u hÃ³a thá»i gian táº£i trang vÃ  thá»i gian pháº£n há»“i.</p><p>Khi báº¡n replay láº¡i 1 session cá»§a user trÃªn <a href="https://www.sessionstack.com/" target="_blank" rel="noopener">SessionStack</a> (hoáº·c xem nÃ³ trong thá»i gian thá»±c), pháº§n SessionStack front-end sáº½ khÃ´ng ngá»«ng láº¥y dá»¯ liá»‡u tá»« server vá» Ä‘á»ƒ táº¡o ra má»™t tráº£i nghiá»‡m liá»n máº¡ch nhÆ° lÆ°u trong buffer. Má»™t khi báº¡n Ä‘Ã£ tÃ­ch há»£p thÆ° viá»‡n cá»§a SessionStack vÃ o trong webapp, nÃ³ sáº½ báº¯t Ä‘áº§u thu tháº­p dá»¯ liá»‡u liÃªn tá»¥c vá» thay Ä‘á»•i trÃªn DOM, tÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng, request máº¡ng, biá»‡t lá»‡ khÃ´ng Ä‘Æ°á»£c xá»­ lÃ½ vÃ  thÃ´ng bÃ¡o lá»—i.</p><p>Khi má»™t phiÃªn lÃ m viá»‡c Ä‘Æ°á»£c replay hoáº·c stream theo thá»i gian thá»±c thÃ¬ SessionStack phá»¥c vá»¥ táº¥t cáº£ dá»¯ liá»‡u cho phÃ©p báº¡n tháº¥y má»i thá»© vá» tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng á»Ÿ gÃ³c Ä‘á»™ trÃ¬nh duyá»‡t cá»§a user (cáº£ vá» máº·t ká»¹ thuáº­t láº«n hÃ¬nh áº£nh). Nhá»¯ng cÃ´ng viá»‡c nÃ y cáº§n pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n cá»±c nhanh Ä‘á»ƒ khÃ´ng lÃ m cho user pháº£i chá» Ä‘á»£i.</p><p>Bá»Ÿi vÃ¬ dá»¯ liá»‡u Ä‘Æ°á»£c front-end kÃ©o vá» nÃªn Ä‘Ã¢y lÃ  má»™t sÃ n diá»…n tuyá»‡t vá»i cho Service Worker cÃ³ thá»ƒ â€œtá»a sÃ¡ngâ€ mÃ  xá»­ lÃ½ nhá»¯ng trÆ°á»ng há»£p nhÆ° reload player vÃ  stream má»i thá»© thÃªm vÃ i láº§n ná»¯a. Xá»­ lÃ½ káº¿t ná»‘i máº¡ng bá»‹ cháº­m cÅ©ng cá»±c ká»³ quan trá»ng.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Báº¡n cÃ³ láº½ Ä‘Ã£ biáº¿t ráº±ng &lt;a href=&quot;https://developers.google.com/web/progressive-web-apps/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Progressive Web Apps&lt;/a&gt; chá»‰ cÃ³ thá»ƒ phá»• biáº¿n hÆ¡n khi chÃºng hÆ°á»›ng tá»›i tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng (UX) mÆ°á»£t mÃ  hÆ¡n, giá»‘ng nhÆ° lÃ  táº¡o 1 native app hÆ¡n lÃ  má»™t tráº£i nghiá»‡m mang phong cÃ¡ch trÃ¬nh duyá»‡t.&lt;/p&gt;
&lt;p&gt;Má»™t trong sá»‘ nhá»¯ng yÃªu cáº§u khi xÃ¢y dá»±ng PWA lÃ  lÃ m nÃ³ cá»±c ká»³ Ä‘Ã¡ng tin cáº­y á»Ÿ khoáº£n loading: nÃ³ cÃ³ thá»ƒ cháº¡y ká»ƒ cáº£ trong tÃ¬nh tráº¡ng internet khÃ´ng á»•n Ä‘á»‹nh hoáº·c rá»›t máº¡ng.&lt;/p&gt;
&lt;p&gt;Trong bÃ i nÃ y, chÃºng ta sáº½ Ä‘Ã o sÃ¢u vÃ o Service Workers: cÃ¡ch chÃºng hoáº¡t Ä‘á»™ng vÃ  chÃºng ta nÃªn quan tÃ¢m Ä‘áº¿n Ä‘Ã¢u. Cuá»‘i bÃ i, team tÃ¡c giáº£ cÃ³ má»™t sá»‘ lá»£i Ã­ch Ä‘á»™c Ä‘Ã¡o cá»§a Service Workers mÃ  chÃºng ta nÃªn dÃ¹ng Ä‘á»“ng thá»i chia sáº» kinh nghiá»‡m cá»§a há» táº¡i &lt;a href=&quot;https://www.sessionstack.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SessionStack&lt;/a&gt;.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P7: ThÃ nh pháº§n cá»§a WebWorker + 5 trÆ°á»ng há»£p sá»­ dá»¥ng</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P7-Thanh-phan-cua-WebWorker-5-truong-hop-su-dung.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P7-Thanh-phan-cua-WebWorker-5-truong-hop-su-dung.html</id>
    <published>2018-11-16T00:27:00.000Z</published>
    <updated>2018-11-16T00:30:02.825Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 7 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p>Trong bÃ i nÃ y chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» Web Workers: má»™t cÃ¡i nhÃ¬n tá»•ng quan, tháº£o luáº­n vá» cÃ¡c loáº¡i worker khÃ¡ch nhau, cÃ¡c thÃ nh pháº§n cá»§a nÃ³ hoáº¡t Ä‘á»™ng vá»›i nhau nhÆ° tháº¿ nÃ o vÃ  nhá»¯ng Ä‘iá»ƒm máº¡nh cÅ©ng nhÆ° Ä‘iá»ƒm yáº¿u cá»§a nÃ³ trong cÃ¡c ngá»¯ cáº£nh khÃ¡c nhau. Cuá»‘i cÃ¹ng, team tÃ¡c giáº£ sáº½ cung cáº¥p 5 trÆ°á»ng há»£p mÃ  trong Ä‘Ã³ Web Worker lÃ  sá»± lá»±a chá»n Ä‘Ãºng Ä‘áº¯n.</p><p>Báº¡n Ä‘Ã£ quen vá»›i sá»± tháº­t ráº±ng Javascript cháº¡y Ä‘Æ¡n luá»“ng nhÆ° chÃºng ta Ä‘Ã£ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-1---Khai-quat-ve-engine--runtime-va-callstack" target="_blank" rel="noopener">tháº£o luáº­n chi tiáº¿t á»Ÿ bÃ i trÆ°á»›c</a>. JS cÅ©ng giÃºp cÃ¡c developer viáº¿t code báº¥t Ä‘á»“ng bá»™.<br><a id="more"></a></p><h1 id="Nhung-han-che-cua-lap-trinh-bat-dong-bo"><a href="#Nhung-han-che-cua-lap-trinh-bat-dong-bo" class="headerlink" title="Nhá»¯ng háº¡n cháº¿ cá»§a láº­p trÃ¬nh báº¥t Ä‘á»“ng bá»™"></a>Nhá»¯ng háº¡n cháº¿ cá»§a láº­p trÃ¬nh báº¥t Ä‘á»“ng bá»™</h1><p>ChÃºng ta Ä‘Ã£ tháº£o luáº­n á»Ÿ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-4---Event-loop--lap-trinh-bat-dong-bo---5-meo-cai-thien-Async-Await" target="_blank" rel="noopener">bÃ i trÆ°á»›c</a> vá» láº­p trÃ¬nh báº¥t Ä‘á»“ng bá»™ vÃ  khi nÃ o thÃ¬ nÃªn dÃ¹ng.</p><p>Láº­p trÃ¬nh báº¥t Ä‘á»“ng bá»™ cho phÃ©p UI cá»§a app trá»Ÿ nÃªn mÆ°á»£t mÃ , báº±ng cÃ¡ch â€œlÃªn lá»‹châ€ cho tá»«ng pháº§n cá»§a code Ä‘Æ°á»£c thá»±c thi á»Ÿ thá»i gian phÃ¹ há»£p trong event loop, do Ä‘Ã³ nÃ³ cho phÃ©p render UI Ä‘Æ°á»£c thá»±c hiá»‡n trÆ°á»›c.</p><p>Má»™t trÆ°á»ng há»£p tá»‘t Ä‘á»ƒ dÃ¹ng láº­p trÃ¬nh báº¥t Ä‘á»“ng bá»™ lÃ  khi ta gá»i Ajax request. Bá»Ÿi vÃ¬ request cÃ³ thá»ƒ tá»‘n nhiá»u thá»i gian nÃªn cÃ³ thá»ƒ Ä‘á»ƒ cho nÃ³ cháº¡y báº¥t Ä‘á»“ng bá»™ vÃ  trong khi client chá» káº¿t quáº£ tráº£ vá», nhá»¯ng code khÃ¡c váº«n Ä‘Æ°á»£c thá»±c thi.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Giáº£ sá»­ báº¡n dÃ¹ng jQuery</span></span><br><span class="line">jQuery.ajax(&#123;</span><br><span class="line">    url: <span class="string">'https://api.example.com/endpoint'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// code Ä‘Æ°á»£c thá»±c thi khi response tráº£ vá»</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>NhÆ°ng Ä‘iá»u nÃ y láº¡i gÃ¢y ra váº¥n Ä‘á» khÃ¡c: request Ä‘Æ°á»£c xá»­ lÃ½ bá»Ÿi Web API cá»§a trÃ¬nh duyá»‡t, nhÆ°ng lÃ m tháº¿ nÃ o mÃ  code khÃ¡c cÃ³ thá»ƒ cháº¡y báº¥t Ä‘á»“ng bá»™? VÃ­ dá»¥ náº¿u nhÆ° code bÃªn trong má»™t success callback láº¡i cháº¡y ngá»‘n ráº¥t nhiá»u CPU:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = performCPUIntensiveCalculation();</span><br></pre></td></tr></table></figure><p>Náº¿u nhÆ° performCPUIntensiveCalculation khÃ´ng pháº£i lÃ  má»™t request HTTP nhÆ°ng láº¡i block code xá»­ lÃ½ (vÃ­ dá»¥: 1 vÃ²ng láº·p ráº¥t lá»›n), khÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ giáº£i phÃ³ng event loop vÃ  unblock cho UI trÃ¬nh duyá»‡t, nÃ³ sáº½ Ä‘Ã³ng bÄƒng vÃ  khÃ´ng pháº£n há»“i láº¡i vá»›i user.</p><p>NghÄ©a lÃ  trong Javascript, nhá»¯ng hÃ m báº¥t Ä‘á»“ng bá»™ chá»‰ giáº£i quyáº¿t váº¥n Ä‘á» nhá» cá»§a háº¡n cháº¿ á»Ÿ Ä‘Æ¡n luá»“ng.</p><p>Trong nhá»¯ng trÆ°á»ng há»£p Ä‘Ã³, báº¡n cÃ³ thá»ƒ lÃ m cho unblock UI khá»i quÃ¡ trÃ¬nh tÃ­nh toÃ¡n quÃ¡ lÃ¢u báº±ng cÃ¡ch sá»­ dá»¥ng setTimeout. VÃ­ dá»¥, tÃ¡ch má»™t chuá»—i xá»­ lÃ½ tÃ­nh toÃ¡n phá»©c táº¡p vÃ o trong nhiá»u lá»i gá»i setTimeout, báº±ng cÃ¡ch Ä‘Ã³ báº¡n cÃ³ thá»ƒ Ä‘áº·t chÃºng vÃ o nhá»¯ng â€œvá»‹ trÃ­â€ khÃ¡c nhau trong event loop vÃ  cÃ¡ch nÃ y cÃ³ thá»ƒ giÃºp cho render UI Ä‘Æ°á»£c tá»‘t hÆ¡n.</p><p>CÃ¹ng xem má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n vá» tÃ­nh toÃ¡n sá»‘ trung bÃ¬nh cá»§a 1 máº£ng sá»‘ nguyÃªn:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">average</span>(<span class="params">numbers</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = numbers.length,</span><br><span class="line">        sum = <span class="number">0</span>,</span><br><span class="line">        i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        sum += numbers[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum / len;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch ta viáº¿t láº¡i code trÃªn vÃ  â€œgiáº£ láº­pâ€ trÆ°á»ng há»£p báº¥t Ä‘á»“ng bá»™:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">averageAsync</span>(<span class="params">numbers, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> len = numbers.length,</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">calculateSumAsync</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; len) &#123;</span><br><span class="line">            <span class="comment">// ÄÆ°a hÃ m tiáº¿p theo vÃ o event loop</span></span><br><span class="line">            setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                sum += numbers[i];</span><br><span class="line">                calculateSumAsync(i + <span class="number">1</span>);</span><br><span class="line">            &#125;, <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// háº¿t máº£ng, gá»i callback</span></span><br><span class="line">            callback(sum / len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    calculateSumAsync(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CÃ¡ch nÃ y sáº½ dÃ¹ng setTimeout Ä‘á»ƒ thÃªm má»—i bÆ°á»›c thá»±c hiá»‡n tÃ­nh toÃ¡n vÃ o trong event loop. Giá»¯a má»—i láº§n tÃ­nh toÃ¡n sáº½ cÃ³ Ä‘á»§ thá»i gian cho cÃ¡c tÃ­nh toÃ¡n Ä‘Æ°á»£c thÃªm vÃ o vÃ  giáº£i phÃ³ng trÃ¬nh duyá»‡t khá»i bá»‹ Ä‘Ã³ng bÄƒng.</p><h1 id="Web-Workers-den-giai-cuu"><a href="#Web-Workers-den-giai-cuu" class="headerlink" title="Web Workers Ä‘áº¿n giáº£i cá»©u"></a>Web Workers Ä‘áº¿n giáº£i cá»©u</h1><p>HTML5 mang Ä‘áº¿n cho chÃºng ta ráº¥t nhiá»u thá»© tuyá»‡t vá»i:</p><ul><li>SSE (Ä‘Ã£ tháº£o luáº­n vÃ  so sÃ¡nh vá»›i WebSocket á»Ÿ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-5---Dao-sau-WebSocket---HTTP-2-voi-SSE---Hay-chon-gia-dung" target="_blank" rel="noopener">bÃ i trÆ°á»›c</a>)</li><li>Geolocation</li><li>Application cache</li><li>Local Storage</li><li>Drag and Drop</li><li><strong>Web Workers</strong></li></ul><p>Web Workers lÃ  tiáº¿n trÃ¬nh trong trÃ¬nh duyá»‡t nhÆ°ng cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ thá»±c thi Javascript code mÃ  khÃ´ng cáº£n trá»Ÿ event loop</p><p>Äiá»u nÃ y thá»±c sá»± ká»³ diá»‡u. ToÃ n bá»™ mÃ´ hÃ¬nh cá»§a Javascript dá»±a trÃªn Ã½ tÆ°á»Ÿng vá» mÃ´i trÆ°á»ng Ä‘Æ¡n luá»“ng nhÆ°ng giá» Ä‘Ã¢y lÃ  cÃ³ Web Workers vÃ  nÃ³ gá»¡ bá» (1 pháº§n nÃ o) sá»± háº¡n cháº¿ Ä‘Ã³.</p><p>Web Workers cho phÃ©p developer Ä‘áº·t nhá»¯ng cÃ´ng viá»‡c cÃ³ thá»i gian cháº¡y dÃ i vÃ  nhá»¯ng cÃ´ng viá»‡c náº·ng vá» xá»­ lÃ½ tÃ­nh toÃ¡n trong background mÃ  khÃ´ng gÃ¢y trá»Ÿ ngáº¡i Ä‘áº¿n UI, lÃ m app cá»§a báº¡n mÆ°á»£t mÃ  hÆ¡n. NgoÃ i ra, khÃ´ng cáº§n pháº£i xÃ i trick vá»›i setTimeout Ä‘á»ƒ Ä‘Ã¡nh lá»«a event loop ná»¯a.</p><p><a href="http://afshinm.github.io/50k/" target="_blank" rel="noopener">á» Ä‘Ã¢y</a> cÃ³ má»™t demo máº«u thá»ƒ hiá»‡n sá»± khÃ¡c nhau khi thá»±c hiá»‡n sáº¯p xáº¿p máº£ng dÃ¹ng vÃ  khÃ´ng dÃ¹ng Web Workers.</p><h1 id="Khai-quat-ve-Web-Workers"><a href="#Khai-quat-ve-Web-Workers" class="headerlink" title="KhÃ¡i quÃ¡t vá» Web Workers"></a>KhÃ¡i quÃ¡t vá» Web Workers</h1><p>Web Workers cho phÃ©p báº¡n lÃ m nhá»¯ng viá»‡c nhÆ° thá»±c thi cÃ¡c Ä‘oáº¡n code xá»­ lÃ½ tá»‘n thá»i gian Ä‘á»ƒ tÃ­nh toÃ¡n cÃ¡c phÃ©p tÃ­nh hao tá»•n nheiefu CPU nhÆ°ng khÃ´ng lÃ m cáº£n trá»Ÿ UI. Thá»±c ra, nÃ³ sáº½ cháº¡y song song. Web Workers lÃ  Ä‘a luá»“ng.</p><p>Báº¡n sáº½ tháº¯c máº¯c: â€œChá»© khÃ´ng pháº£i Javascript lÃ  ngÃ´n ngá»¯ Ä‘Æ¡n luá»“ng Ã ?â€</p><p>ÄÃ¢y lÃ  lÃºc mÃ  báº¡n sáº½ thá»‘t lÃªn <em>aha</em> ngáº¡c nhiÃªn khi nháº­n ra Javascript lÃ  má»™t ngÃ´n ngá»¯ khÃ´ng Ä‘á»‹nh nghÄ©a mÃ´ hÃ¬nh tiáº¿n trÃ¬nh. <strong>Web Workers khÃ´ng pháº£i lÃ  má»™t pháº§n cá»§a Javascript, nÃ³ lÃ  tÃ­nh nÄƒng cá»§a trÃ¬nh duyá»‡t mÃ  cÃ³ thá»ƒ truy xuáº¥t thÃ´ng qua Javascript</strong>. Äa sá»‘ cÃ¡c trÃ¬nh duyá»‡t cÃ³ lá»‹ch sá»­ vá» Ä‘Æ¡n tiáº¿n trÃ¬nh (giá» thÃ¬ thay Ä‘á»•i rá»“i), vÃ  Ä‘a sá»‘ cÃ¡c triá»ƒn khai cá»§a Javascript Ä‘á»u diá»…n ra trÃªn trÃ¬nh duyá»‡t. Web Workers khÃ´ng Ä‘Æ°á»£c triá»ƒn khai trÃªn Node.js, nÃ³ cÃ³ khÃ¡i niá»‡m hÆ¡i khÃ¡c má»™t chÃºt vá» cluster hay child_process.</p><p>CÃ³ 3 loáº¡i Web Workers Ä‘Æ°á»£c Ä‘á» cáº­p Ä‘áº¿n trong <a href="http://www.whatwg.org/specs/web-workers/current-work/" target="_blank" rel="noopener">thÃ´ng sá»‘ ká»¹ thuáº­t</a>:</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener">Dedicated Workers</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker" target="_blank" rel="noopener">Shared Workers</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API" target="_blank" rel="noopener">Service workers</a></li></ul><h1 id="Dedicated-Workers-Worker-chuyen-dung"><a href="#Dedicated-Workers-Worker-chuyen-dung" class="headerlink" title="Dedicated Workers (Worker chuyÃªn dá»¥ng)"></a>Dedicated Workers (Worker chuyÃªn dá»¥ng)</h1><p>Dedicated Web Workers Ä‘Æ°á»£c khá»Ÿi táº¡o bá»Ÿi tiáº¿n trÃ¬nh chÃ­nh vÃ  chá»‰ cÃ³ thá»ƒ giao tiáº¿p vá»›i tiáº¿n trÃ¬nh Ä‘Ã³.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*ya4zMDfbNUflXhzKz9EBIw.png" alt=""></p><h1 id="Shared-Workers-Worker-chia-se"><a href="#Shared-Workers-Worker-chia-se" class="headerlink" title="Shared Workers (Worker chia sáº»)"></a>Shared Workers (Worker chia sáº»)</h1><p>Shared Workers cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p bá»Ÿi táº¥t cáº£ cÃ¡c tiáº¿n trÃ¬nh cháº¡y trÃªn cÃ¹ng origin (khÃ¡c tab trÃ¬nh duyá»‡t, iframe hoáº·c lÃ  cÃ¡c shared worker khÃ¡c)</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*lzOIevUBVy5eWyf2kHf--w.png" alt=""></p><p>Náº¿u báº¡n muá»‘n dÃ¹ng thá»­ SessionStack Ä‘á»ƒ hiá»ƒu vÃ  khÃ¡m phÃ¡ láº¡i nhá»¯ng váº¥n Ä‘á» ká»¹ thuáº­t cÅ©ng nhÆ° UX trÃªn webapp cá»§a báº¡n, team SessionStack Ä‘ang cÃ³ báº£n dÃ¹ng thá»­ miá»…n phÃ­, <a href="https://www.sessionstack.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_content=Post-5-websockets-getStarted" target="_blank" rel="noopener">á»Ÿ Ä‘Ã¢y nhÃ©</a>.</p><h1 id="Service-Workers-Worker-dich-vu"><a href="#Service-Workers-Worker-dich-vu" class="headerlink" title="Service Workers (Worker dá»‹ch vá»¥)"></a>Service Workers (Worker dá»‹ch vá»¥)</h1><p>Má»™t Service Worker lÃ  worker hÆ°á»›ng sá»± kiá»‡n (event-driven) Ä‘Æ°á»£c Ä‘Äƒng kÃ½ vá»›i origin vÃ  path. NÃ³ cÃ³ thá»ƒ Ä‘iá»u khiá»ƒn web page/site mÃ  nÃ³ liÃªn káº¿t, can thiá»‡p vÃ  chá»‰nh sá»­a sá»± Ä‘iá»u hÆ°á»›ng vÃ  cÃ¡c yÃªu cáº§u tÃ i nguyÃªn, lÆ°u Ä‘á»‡m tÃ i nguyÃªn vá»›i phong cÃ¡ch ráº¥t chi tiáº¿t Ä‘á»ƒ cho phÃ©p báº¡n cÃ³ toÃ n quyá»n Ä‘iá»u khiá»ƒn vá» viá»‡c app cá»§a báº¡n xá»­ lÃ½ nhÆ° tháº¿ nÃ o trong tá»«ng trÆ°á»ng há»£p cá»¥ thá»ƒ (vÃ­ dá»¥ nhÆ° khi rá»›t máº¡ng)</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*6o2TRDmrJlS97vh1wEjLYw.png" alt=""></p><p>Trong bÃ i nÃ y chÃºng ta sáº½ táº­p trung vÃ o <strong>Dedicated Worker</strong> vÃ  chá»‰ gá»i nÃ³ dÆ°á»›i cÃ¡i tÃªn <strong>Web Workers</strong> hoáº·c <strong>Worker</strong></p><h1 id="Web-Workers-hoat-dong-nhu-the-nao"><a href="#Web-Workers-hoat-dong-nhu-the-nao" class="headerlink" title="Web Workers hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?"></a>Web Workers hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?</h1><p>Web Workers Ä‘Æ°á»£c triá»ƒn khai dÆ°á»›i dáº¡ng Ä‘uÃ´i .js vÃ  Ä‘Æ°á»£c Ä‘Ã­nh kÃ¨m theo request HTTP báº¥t Ä‘á»“ng bá»™ trong web cá»§a báº¡n. Nhá»¯ng request nÃ y Ä‘Æ°á»£c áº©n hoÃ n toÃ n bá»Ÿi <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API" target="_blank" rel="noopener">Web Worker API</a></p><p>Workers sá»­ dá»¥ng message kiá»ƒu tiáº¿n trÃ¬nh Ä‘á»ƒ thá»±c hiá»‡n quÃ¡ trÃ¬nh hoáº¡t Ä‘á»™ng song song. ChÃºng cÃ³ thá»ƒ giá»¯ cho UI Ä‘Æ°á»£c cáº­p nháº­t má»›i nháº¥t, cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c vÃ  mÆ°á»£t mÃ  vá»›i ngÆ°á»i dÃ¹ng má»™t cÃ¡ch hoÃ n háº£o.</p><p>Web Workers cháº¡y trong má»™t tiáº¿n trÃ¬nh cÃ´ láº­p trong trÃ¬nh duyá»‡t. <strong>Do Ä‘Ã³ lÃ  code chÃºng thá»±c thi cáº§n pháº£i Ä‘áº·t trong 1 file riÃªng biá»‡t</strong>. Äiá»u nÃ y ráº¥t quan trá»ng nhÃ©.</p><p>CÃ¡ch táº¡o worker cÆ¡ báº£n</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">'task.js'</span>);</span><br></pre></td></tr></table></figure><p>Náº¿u task.js tá»“n táº¡i vÃ  cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c, trÃ¬nh duyá»‡t sáº½ thiáº¿t láº­p má»™t tiáº¿n trÃ¬nh má»›i Ä‘á»ƒ táº£i file báº¥t Ä‘á»“ng bá»™. Sau khi quÃ¡ trÃ¬nh táº£i file hoÃ n táº¥t, nÃ³ sáº½ thá»±c thi code trong Ä‘Ã³ vÃ  worker báº¯t Ä‘áº§u lÃ m viá»‡c.</p><p>Trong trÆ°á»ng há»£p file lá»—i khÃ´ng load Ä‘Æ°á»£c thÃ¬ tráº£ vá» 404 vÃ  worker sáº½ dá»«ng láº¡i má»™t cÃ¡ch yÃªn láº·ng nhÆ° chÆ°a cÃ³ gÃ¬ xáº£y ra.</p><p>Äá»ƒ báº¯t Ä‘áº§u táº¡o worker, báº¡n cáº§n gá»i phÆ°Æ¡ng thá»©c postMessage:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worker.postMessage();</span><br></pre></td></tr></table></figure><h1 id="Giao-tiep-cua-Web-Worker"><a href="#Giao-tiep-cua-Web-Worker" class="headerlink" title="Giao tiáº¿p cá»§a Web Worker"></a>Giao tiáº¿p cá»§a Web Worker</h1><p>Äá»ƒ giao tiáº¿p giá»¯a má»™t Web Worker vÃ  trang cá»§a báº¡n thÃ¬ báº¡n cáº§n pháº£i sá»­ dá»¥ng phÆ°Æ¡ng thá»©c postMessage hoáº·c <a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel" target="_blank" rel="noopener">kÃªnh phÃ¡t sÃ³ng</a> (Broadcast channel).</p><h1 id="Phuong-thuc-postMessage"><a href="#Phuong-thuc-postMessage" class="headerlink" title="PhÆ°Æ¡ng thá»©c postMessage"></a>PhÆ°Æ¡ng thá»©c postMessage</h1><p>CÃ¡c trÃ¬nh duyá»‡t má»›i há»— trá»£ object JSON nhÆ° lÃ  param Ä‘áº§u tiÃªn cá»§a phÆ°Æ¡ng thá»©c trong khi cÃ¡c trÃ¬nh duyá»‡t cÅ© hÆ¡n thÃ¬ chá»n string</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ vá» má»™t page cÃ³ worker cÃ³ thá»ƒ giao tiáº¿p qua láº¡i vá»›i nÃ³ nhÆ° tháº¿ nÃ o báº±ng cÃ¡ch truyá»n má»™t object JSON. Truyá»n string cÅ©ng tÆ°Æ¡ng tá»±:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onclick=<span class="string">"startComputation()"</span>&gt;Start computation&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  function startComputation() &#123;</span></span><br><span class="line"><span class="regexp">    worker.postMessage(&#123;'cmd': 'average', 'data': [1, 2, 3, 4]&#125;);</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  var worker = new Worker('doWork.js');</span></span><br><span class="line"><span class="regexp">  worker.addEventListener('message', function(e) &#123;</span></span><br><span class="line"><span class="regexp">    console.log(e.data);</span></span><br><span class="line"><span class="regexp">  &#125;, false);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><p>VÃ  Ä‘oáº¡n code cá»§a worker:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = e.data;</span><br><span class="line">  <span class="keyword">switch</span> (data.cmd) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'average'</span>:</span><br><span class="line">      <span class="keyword">var</span> result = calculateAverage(data); <span class="comment">// TÃ­nh trung bÃ¬nh cá»™ng tá»« má»™t array</span></span><br><span class="line">      self.postMessage(result);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      self.postMessage(<span class="string">'Unknown command'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>Khi click vÃ o button, trang chÃ­nh sáº½ gá»i tá»›i postMessage. DÃ²ng worker.postMessage truyá»n má»™t object JSON vÃ o worker, object chá»©a thÃ´ng tin lÃ  cmd vÃ  data. Worker sáº½ xá»­ lÃ½ message thÃ´ng qua má»™t message handler Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a.</p><p>Khi message Ä‘áº¿n, cÃ¡c thao tÃ¡c tÃ­nh toÃ¡n thá»±c sá»± sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n trong worker mÃ  khÃ´ng cáº£n trá»Ÿ event loop. Worker kiá»ƒm tra event e Ä‘Æ°á»£c truyá»n vÃ o vÃ  thá»±c thi giá»‘ng nhÆ° má»™t hÃ m Javascript bÃ¬nh thÆ°á»ng. Khi xong viá»‡c káº¿t quáº£ sáº½ Ä‘Æ°á»£c tráº£ ngÆ°á»£c láº¡i cho trang chÃ­nh.</p><p>Trong ngá»¯ cáº£nh cá»§a worker, cáº£ self vÃ  this Ä‘á»u Ä‘ang tham chiáº¿u Ä‘áº¿n global scope.</p><blockquote><p>CÃ³ 2 cÃ¡ch Ä‘á»ƒ dá»«ng worker: gá»i hÃ m worker.terminate() tá»« ngoÃ i trang chÃ­nh hoáº·c gá»i self.close() bÃªn trong worker.</p></blockquote><h1 id="Kenh-phat-song-Broadcast-Channel"><a href="#Kenh-phat-song-Broadcast-Channel" class="headerlink" title="KÃªnh phÃ¡t sÃ³ng (Broadcast Channel)"></a>KÃªnh phÃ¡t sÃ³ng (Broadcast Channel)</h1><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel" target="_blank" rel="noopener">Broadcast Channel</a> giá»‘ng nhÆ° má»™t API giao tiáº¿p tá»•ng quÃ¡t. NÃ³ cho phÃ©p chÃºng ta broadcast message tá»›i táº¥t cáº£ cÃ¡c ngá»¯ cáº£nh cÃ¹ng chia sáº» chung origin. Táº¥t cáº£ cÃ¡c tab trÃ¬nh duyá»‡t, iframe hoáº·c worker phá»¥c vá»¥ chung origin cÃ³ thá»ƒ phÃ¡t vÃ  nháº­n message.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Káº¿t ná»‘i Ä‘áº¿n má»™t broadcast channel</span></span><br><span class="line"><span class="keyword">var</span> bc = <span class="keyword">new</span> BroadcastChannel(<span class="string">'test_channel'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// VÃ­ dá»¥ gá»­i má»™t message Ä‘Æ¡n giáº£n</span></span><br><span class="line">bc.postMessage(<span class="string">'This is a test message.'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// VÃ­ dá»¥ vá» má»™t event handler cÃ³ chá»©c</span></span><br><span class="line"><span class="comment">// nÄƒng in message ra console</span></span><br><span class="line">bc.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; </span><br><span class="line">  <span class="built_in">console</span>.log(e.data); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ngáº¯t káº¿t ná»‘i</span></span><br><span class="line">bc.close()</span><br></pre></td></tr></table></figure><p>Xem hÃ¬nh minh há»a thÃ¬ báº¡n sáº½ hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a Broadcast Channel rÃµ rÃ ng hÆ¡n:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*NVT6WbNrH_mQL64--b-l1Q.png" alt=""></p><p>Broadcast Channel bá»‹ háº¡n cháº¿ há»— trá»£ tá»« cÃ¡c trÃ¬nh duyá»‡t:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*81mCsOzyJj-HfQ1lP_033w.png" alt=""></p><h1 id="Kich-thuoc-message"><a href="#Kich-thuoc-message" class="headerlink" title="KÃ­ch thÆ°á»›c message"></a>KÃ­ch thÆ°á»›c message</h1><p>CÃ³ 2 cÃ¡ch Ä‘á»ƒ gá»­i message trong Web Workers:</p><ul><li><p><strong>Sao chÃ©p message</strong>: message Ä‘Æ°á»£c serialized, sao chÃ©p, gá»­i Ä‘i vÃ  Ä‘Æ°á»£c de-serialized á»Ÿ Ä‘áº§u kia. Trang web vÃ  worker khÃ´ng dÃ¹ng chung instance, vÃ¬ tháº¿ cuá»‘i cÃ¹ng lÃ  káº¿t quáº£ sáº½ bá»‹ trÃ¹ng láº·p á»Ÿ cáº£ 2 phÃ­a. Äa sá»‘ cÃ¡c trÃ¬nh duyá»‡t triá»ƒn khai tÃ­nh nÄƒng nÃ y báº±ng cÃ¡ch encoding/decoding giÃ¡ trá»‹ á»Ÿ cáº£ 2 phÃ­a thÃ nh JSON má»™t cÃ¡ch tá»± Ä‘á»™ng. ÄÃºng nhÆ° dá»± Ä‘oÃ¡n thÃ¬ cÃ¡c hoáº¡t Ä‘á»™ng dá»¯ liá»‡u nhÆ° tháº¿ nÃ y bá»• sung thÃªm chi phÃ­ Ä‘Ã¡ng ká»ƒ vÃ o viá»‡c truyá»n táº£i message. Message cÃ ng lá»›n thÃ¬ thá»i gian gá»­i cÃ ng lÃ¢u.</p></li><li><p><strong>Truyá»n táº£i message</strong>: Ä‘iá»u nÃ y nghÄ©a lÃ  bÃªn gá»­i sáº½ khÃ´ng thá»ƒ sá»­ dá»¥ng nÃ³ má»™t khi Ä‘Ã£ gá»­i Ä‘i. Truyá»n táº£i dá»¯ liá»‡u gáº§n nhÆ° tá»©c thá»i. Háº¡n cháº¿ lÃ  chá»‰ duy nháº¥t <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener">ArrayBuffer</a> lÃ  cÃ³ thá»ƒ gá»­i Ä‘Æ°á»£c.</p></li></ul><h1 id="Tinh-nang-co-san-cua-Web-Workers"><a href="#Tinh-nang-co-san-cua-Web-Workers" class="headerlink" title="TÃ­nh nÄƒng cÃ³ sáºµn cá»§a Web Workers"></a>TÃ­nh nÄƒng cÃ³ sáºµn cá»§a Web Workers</h1><p>Web Workder chá»‰ cÃ³ truy xuáº¥t tá»›i má»™t táº­p há»£p nhá» cÃ¡c tÃ­nh nÄƒng cá»§a Javascript bá»Ÿi vÃ¬ báº£n cháº¥t Ä‘a luá»“ng cá»§a nÃ³, dÆ°á»›i Ä‘Ã¢y lÃ  danh sÃ¡ch cÃ¡c tÃ­nh nÄƒng:</p><ul><li>Object navigator</li><li>Object location (chá»‰ Ä‘á»c - read only)</li><li>XMLHttpRequest</li><li>setTimeout()/clearTimeout() vÃ  setInterval()/clearInterval()</li><li>Bá»™ Ä‘á»‡m á»©ng dá»¥ng (<a href="https://www.html5rocks.com/tutorials/appcache/beginner/" target="_blank" rel="noopener">Application Cache</a>)</li><li>Import script bÃªn ngoÃ i thÃ´ng qua importScripts()</li><li><a href="https://www.html5rocks.com/en/tutorials/workers/basics/#toc-enviornment-subworkers" target="_blank" rel="noopener">Táº¡o cÃ¡c web worker khÃ¡c</a></li></ul><h1 id="Han-che-cua-Web-Workers"><a href="#Han-che-cua-Web-Workers" class="headerlink" title="Háº¡n cháº¿ cá»§a Web Workers"></a>Háº¡n cháº¿ cá»§a Web Workers</h1><p>HÆ¡i buá»“n lÃ  Web Worker khÃ´ng cÃ³ quyá»n truy cáº­p Ä‘áº¿n má»™t sá»‘ tÃ­nh nÄƒng quan trá»ng cá»§a Javascript:</p><ul><li>DOM (not thread-safe)</li><li>Object window</li><li>Object document</li><li>Object parent</li></ul><p>Äiá»u nÃ y nghÄ©a lÃ  Web Worker khÃ´ng thá»ƒ thay Ä‘á»•i DOM (vÃ  UI). NÃ³ cÃ³ thá»ƒ hÆ¡i khÃ³ khÄƒn, nhÆ°ng náº¿u báº¡n Ä‘Ã£ quen vá»›i viÃªc sá»­ dá»¥ng Web Worker Ä‘Ãºng cÃ¡ch thÃ¬ báº¡n sáº½ báº¯t Ä‘áº§u sá»­ dá»¥ng kháº£ nÄƒng â€œtÃ­nh toÃ¡n Ä‘á»™c láº­pâ€ cá»§a nÃ³ trong khi cÃ¡c code thay Ä‘á»•i UI Ä‘ang Ä‘Æ°á»£c xá»­ lÃ½ vÃ  hoáº¡t Ä‘á»™ng. Worker sáº½ chÄƒm sÃ³c táº¥t cáº£ nhá»¯ng pháº§n náº·ng nhá»c cho báº¡n vÃ  khi Ä‘Ã£ xong viÃªc thÃ¬ báº¡n chá»‰ cáº§n gá»­i káº¿t quáº£ ra mÃ n hÃ¬nh Ä‘á»ƒ cáº­p nháº­t UI cho phÃ¹ há»£p.</p><h1 id="Xu-ly-loi"><a href="#Xu-ly-loi" class="headerlink" title="Xá»­ lÃ½ lá»—i"></a>Xá»­ lÃ½ lá»—i</h1><p>Giá»‘ng nhÆ° code Javascript khÃ¡c, báº¡n sáº½ cáº§n xá»­ lÃ½ lá»—i khi Web Worker báº¯n ra. Náº¿u cÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh worker thá»±c thi, ErrorEvent sáº½ Ä‘Æ°á»£c báº¯n. Interface nÃ y sáº½ bao gá»“m 3 thuá»™c tÃ­nh há»¯u Ã­ch cho viá»‡c tÃ¬m ra báº¡n Ä‘ang sai chá»— nÃ o:</p><ul><li><strong>filename</strong>: tÃªn cá»§a worker script gÃ¢y ra lá»—i</li><li><strong>lineno</strong>: sá»‘ cá»§a dÃ²ng gÃ¢y ra lá»—i</li><li><strong>message</strong>: mÃ´ táº£ lá»—i</li></ul><p>VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Line: '</span> + e.lineno);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'In: '</span> + e.filename);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Message: '</span> + e.message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">'workerWithError.js'</span>);</span><br><span class="line">worker.addEventListener(<span class="string">'error'</span>, onError, <span class="literal">false</span>);</span><br><span class="line">worker.postMessage(); <span class="comment">// Khá»Ÿi táº¡o worker mÃ  khÃ´ng truyá»n messageself.addEventListener('message', function(e) &#123;</span></span><br><span class="line">  postMessage(x * <span class="number">2</span>); <span class="comment">// Intentional error. 'x' is not defined.</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>á» Ä‘Ã¢y báº¡n tháº¥y ráº±ng chÃºng ta táº¡o worker vÃ  báº¯t Ä‘áº§u listen sá»± kiá»‡n error.</p><p>BÃªn trong worker (file workerWithError.js) chÃºng ta cá»‘ tÃ¬nh táº¡o má»™t exception báº±ng cÃ¡ch nhÃ¢n x vá»›i 2 trong khi x khÃ´ng há» tá»“n táº¡i trong scope Ä‘Ã³. Exception Ä‘Æ°á»£c báº¯n ra khi khá»Ÿi táº¡o script vÃ  hÃ m onError Ä‘Æ°á»£c gá»i vá»›i thÃ´ng tin vá» lá»—i.</p><h1 id="Truong-hop-nen-su-dung-Web-Workers"><a href="#Truong-hop-nen-su-dung-Web-Workers" class="headerlink" title="TrÆ°á»ng há»£p nÃªn sá»­ dá»¥ng Web Workers"></a>TrÆ°á»ng há»£p nÃªn sá»­ dá»¥ng Web Workers</h1><p>Cho Ä‘áº¿n bÃ¢y giá» thÃ¬ chÃºng ta Ä‘Ã£ nghiÃªn cá»©u vá» Ä‘iá»ƒm máº¡nh vÃ  háº¡n cháº¿ cá»§a Web Workers. CÃ¹ng xem nhá»¯ng trÆ°á»ng hÆ¡p nÃ o thÃ¬ dÃ¹ng chÃºng lÃ  tá»‘t nháº¥t:</p><ul><li><strong>DÃ² tia (Ray tracing)</strong>: ray tracing lÃ  má»™t ká»¹ thuáº­t <a href="https://en.wikipedia.org/wiki/Rendering_%28computer_graphics%29" target="_blank" rel="noopener">render</a> Ä‘á»ƒ sinh ra nhá»¯ng hÃ¬nh áº£nh báº±ng cÃ¡ch dÃ² theo váº¿t Ä‘Æ°á»ng Ä‘i cá»§a Ã¡nh sÃ¡ng theo dáº¡ng pixel. Ray traycing sá»­ dá»¥ng ráº¥t nhiá»u phÃ©p tÃ­nh toÃ¡n há»c cÃ³ áº£nh hÆ°á»›ng lá»›n Ä‘áº¿n CPU Ä‘á»ƒ giáº£ láº­p Ä‘Æ°á»ng Ä‘i cá»§a Ã¡nh sÃ¡ng. Ã tÆ°á»Ÿng vá» giáº£ láº­p nhá»¯ng hiá»‡u á»©ng nhÆ° pháº£n chiáº¿u (reflection), khÃºc xáº¡ (refraction), váº­t liá»‡u, vÃ¢n vÃ¢n. Táº¥t cáº£ cÃ¡c logic tÃ­nh toÃ¡n nhÆ° váº­y Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°a vÃ o Web Worker Ä‘á»ƒ trÃ¡nh gÃ¢y trá»Ÿ ngáº¡i vá»›i UI thread. Tháº­m chÃ­ cÃ³ thá»ƒ tá»‘t hÆ¡n náº¿u báº¡n cÃ³ thá»ƒ chia nhá» quÃ¡ trÃ¬nh render hÃ¬nh áº£nh ra nhiá»u worker (vÃ  chia ra nhiá»u CPU). ÄÃ¢y lÃ  1 minh há»a Ä‘Æ¡n giáº£n cá»§a ray tracing sá»­ dá»¥ng Web Workers: â€Š<a href="https://nerget.com/rayjs-mt/rayjs.html" target="_blank" rel="noopener">https://nerget.com/rayjs-mt/rayjs.html</a></li><li><strong>MÃ£ hÃ³a (Encryption)</strong>: MÃ£ hÃ³a end-to-end (E2EE) cÃ ng ngÃ y cÃ ng phá»• biáº¿n do sá»± gia tÄƒng kháº¯t khe vá» cÃ¡c quy Ä‘á»‹nh cá»§a dá»¯ liá»‡u nháº¡y cáº£m &amp; cÃ¡ nhÃ¢n. MÃ£ hÃ³a cÃ³ thá»ƒ khÃ¡ tá»‘n thá»i gian, Ä‘áº·c biá»‡t náº¿u cÃ³ ráº¥t nhiá»u dá»¯ liá»‡u cáº§n Ä‘Æ°á»£c mÃ£ hÃ³a thÆ°á»ng xuyÃªn (trÆ°á»›c khi gá»­i vá» server cháº³ng háº¡n). ÄÃ¢y lÃ  má»™t trÆ°á»ng há»£p trong Ä‘Ã³ Web Worker lÃ  lá»±a chá»n ráº¥t tá»‘t vÃ¬ nÃ³ khÃ´ng yÃªu cáº§u truy xuáº¥t Ä‘áº¿n DOM hay cÃ¡c thá»© khÃ¡c, chá»‰ thuáº§n tÃºy lÃ  thuáº­t toÃ¡n mÃ£ hÃ³a. Má»™t khi Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº©y vÃ o worker xá»­ lÃ½, nÃ³ sáº½ hoáº¡t Ä‘á»™ng ráº¥t trÆ¡n tru vÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n tráº£i nghiá»‡m cá»§a ngÆ°á»i dÃ¹ng.</li><li><strong>Táº£i trÆ°á»›c dá»¯ liá»‡u</strong>: Äá»ƒ tá»‘i Æ°u website hoáº·c webapp vÃ  cáº£i thiá»‡n thá»i gian loading, báº¡n cÃ³ thá»ƒ nhá» váº£ Web Workers Ä‘á»ƒ load vÃ  lÆ°u dá»¯ liá»‡u trÆ°á»›c vÃ  sá»­ dá»¥ng chÃºng vá» sau khi cáº§n Ä‘áº¿n. Web Workers ráº¥t tá»‘t trong trÆ°á»ng há»£p nÃ y vÃ¬ nÃ³ khÃ´ng áº£nh hÆ°á»›ng Ä‘áº¿n UI, khÃ´ng giá»‘ng nhÆ° khi ta dÃ¹ng mÃ  khÃ´ng cÃ³ workers.</li><li><strong>Progressive Web Apps</strong>: ChÃºng cáº§n Ä‘Æ°á»£c load tháº­t nhanh ká»ƒ cáº£ khi káº¿t ná»‘i máº¡ng khÃ´ng á»•n Ä‘á»‹nh. NghÄ©a lÃ  dá»¯ liá»‡u cáº§n pháº£i Ä‘Æ°á»£c lÆ°u trÃªn trÃ¬nh duyá»‡t. IndexDB hoáº·c nhá»¯ng API tÆ°Æ¡ng tá»± há»— trá»£ tá»‘t khoáº£n nÃ y. Vá» cÆ¡ báº£n thÃ¬ lÆ°u trá»¯ á»Ÿ phÃ­a client lÃ  cáº§n thiáº¿t. Äá»ƒ cÃ³ thá»ƒ sá»­ dá»¥ng mÃ  khÃ´ng gÃ¢y cáº£n trá»Ÿ Ä‘áº¿n UI, cÃ´ng viá»‡c cáº§n pháº£i Ä‘Æ°á»£c hoÃ n thÃ nh trong Web Workers. Trong trÆ°á»ng há»£p cá»§a IndexDB, cÃ³ má»™t API báº¥t Ä‘á»“ng bá»™ cho phÃ©p báº¡n lÃ m viá»‡c nÃ y mÃ  khÃ´ng dÃ¹ng workers, tuy nhiÃªn cÅ©ng cÃ³ má»™t API Ä‘á»“ng bá»™ trÆ°á»›c Ä‘Ã¢y (cÃ³ thá»ƒ sáº½ Ä‘Æ°á»£c giá»›i thiá»‡u láº¡i) chá»‰ Ä‘Æ°á»£c phÃ©p cháº¡y bÃªn trong workers.</li><li><strong>Kiá»ƒm tra chÃ­nh táº£ (Spell checking)</strong>: má»™t bá»™ spell checker cÆ¡ báº£n hoáº¡t Ä‘á»™ng nhÆ° sau: chÆ°Æ¡ng trÃ¬nh sáº½ Ä‘á»c má»™t file tá»« Ä‘iá»ƒn vá»›i danh sÃ¡ch cÃ¡c tá»« Ä‘Ãºng chÃ­nh táº£. Tá»« Ä‘iá»ƒn sáº½ Ä‘Æ°á»£c parse thÃ nh cÃ¢y tÃ¬m kiáº¿m (search tree) Ä‘á»ƒ cÃ³ thá»ƒ tÃ¬m kiáº¿m vÄƒn báº£n hiá»‡u quáº£. Khi má»™t tá»« Ä‘Æ°á»£c Ä‘Æ°a vÃ o checker, chÆ°Æ¡ng trÃ¬nh sáº½ kiá»ƒm tra náº¿u nÃ³ tá»“n táº¡i trong cÃ¢y tÃ¬m kiáº¿m. Náº¿u tá»« Ä‘Ã³ khÃ´ng tá»“n táº¡i, chÆ°Æ¡ng trÃ¬nh sáº½ cung cáº¥p tá»« thay tháº¿ báº±ng cÃ¡ch thay Ä‘á»•i kÃ½ tá»± thay tháº¿ vÃ  kiá»ƒm tra náº¿u Ä‘Ã³ lÃ  1 tá»« há»£p lá»‡ náº¿u nÃ³ lÃ  tá»« mÃ  user muá»‘n viáº¿t ra. Táº¥t cáº£ quÃ¡ trÃ¬nh nÃ y cÃ³ thá»ƒ dá»… dÃ ng giáº£m táº£i cho há»‡ thá»‘ng báº±ng Web Workers vÃ  user cÃ³ thá»ƒ gÃµ chá»¯, viáº¿t cÃ¢u mÃ  khÃ´ng gÃ¢y cáº£n trá»Ÿ vá»›i UI trong khi worker thá»±c thi táº¥t cáº£ cÃ¡c pháº§n tÃ¬m kiáº¿m vÃ  Ä‘Æ°a ra Ä‘á» xuáº¥t.</li></ul><p>Hiá»‡u nÄƒng vÃ  Ä‘á»™ tin cáº­y lÃ  ráº¥t quan trá»ng Ä‘á»‘i vá»›i team SessionStack. LÃ½ do lÃ  vÃ¬ má»™t khi Ä‘Ã£ tÃ­ch há»£p SessionStack vÃ o web app cá»§a báº¡n, chÆ°Æ¡ng trÃ¬nh sáº½ báº¯t Ä‘áº§u ghi láº¡i má»i thá»© tá»« thay Ä‘á»•i trÃªn DOM vÃ  tÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng Ä‘áº¿n cÃ¡c request máº¡ng, exception khÃ´ng Ä‘Æ°á»£c xá»­ lÃ½ vÃ  cÃ¡c thÃ´ng bÃ¡o lá»—i. Táº¥t cáº£ dá»¯ liá»‡u Ä‘Æ°á»£c truyá»n vá» cho server cá»§a chÆ°Æ¡ng trÃ¬nh trong <strong>thá»i gian thá»±c</strong> Ä‘á»ƒ cÃ³ thá»ƒ cho phÃ©p báº¡n cháº¡y láº¡i nhá»¯ng issue tá»« webapp dÆ°á»›i dáº¡ng video vÃ  xem thá»­ Ä‘iá»u gÃ¬ Ä‘ang diá»…n ra vá»›i user. Táº¥t cáº£ Ä‘iá»u nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n vá»›i Ä‘á»™ trá»… tá»‘i thiá»ƒu vÃ  khÃ´ng cÃ³ áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng cá»§a app cá»§a báº¡n.</p><p>ÄÃ¢y lÃ  lÃ½ do mÃ  team tÃ¡c giáº£ Ä‘Ã£ Ä‘Æ°a toÃ n bá»™ logic (pháº§n nÃ o cÃ³ thá»ƒ) tá»« cáº£ thÆ° viá»‡n Ä‘iá»u hÃ nh &amp; pháº§n player vÃ o Web Worker Ä‘á»ƒ xá»­ lÃ½ cÃ¡c cÃ´ng viÃªc náº·ng táº£i vá»›i CPU nhÆ° bÄƒm Ä‘á»ƒ xÃ¡c nháº­n tÃ­nh toÃ n váº¹n dá»¯ liá»‡u, render, vÃ¢n vÃ¢n.</p><p>CÃ´ng nghá»‡ web liÃªn tá»¥c thay Ä‘á»•i vÃ  phÃ¡t triá»ƒn vÃ¬ tháº¿ team tÃ¡c giáº£ Ä‘Ã£ Ä‘i thÃªm 1 cháº·ng Ä‘Æ°á»ng dÃ i Ä‘á»ƒ Ä‘áº£m báº£o SessionStack tháº­t nháº¹ vÃ  khÃ´ng gÃ¢y áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng cá»§a ngÆ°á»i dÃ¹ng.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 7 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;Trong bÃ i nÃ y chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» Web Workers: má»™t cÃ¡i nhÃ¬n tá»•ng quan, tháº£o luáº­n vá» cÃ¡c loáº¡i worker khÃ¡ch nhau, cÃ¡c thÃ nh pháº§n cá»§a nÃ³ hoáº¡t Ä‘á»™ng vá»›i nhau nhÆ° tháº¿ nÃ o vÃ  nhá»¯ng Ä‘iá»ƒm máº¡nh cÅ©ng nhÆ° Ä‘iá»ƒm yáº¿u cá»§a nÃ³ trong cÃ¡c ngá»¯ cáº£nh khÃ¡c nhau. Cuá»‘i cÃ¹ng, team tÃ¡c giáº£ sáº½ cung cáº¥p 5 trÆ°á»ng há»£p mÃ  trong Ä‘Ã³ Web Worker lÃ  sá»± lá»±a chá»n Ä‘Ãºng Ä‘áº¯n.&lt;/p&gt;
&lt;p&gt;Báº¡n Ä‘Ã£ quen vá»›i sá»± tháº­t ráº±ng Javascript cháº¡y Ä‘Æ¡n luá»“ng nhÆ° chÃºng ta Ä‘Ã£ &lt;a href=&quot;https://kipalog.com/posts/Duc-khoet-Javascript--Phan-1---Khai-quat-ve-engine--runtime-va-callstack&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;tháº£o luáº­n chi tiáº¿t á»Ÿ bÃ i trÆ°á»›c&lt;/a&gt;. JS cÅ©ng giÃºp cÃ¡c developer viáº¿t code báº¥t Ä‘á»“ng bá»™.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P6: So sÃ¡nh vá»›i WebAssembly + Má»™t sá»‘ trÆ°á»ng há»£p tá»‘t hÆ¡n nÃªn sá»­ dá»¥ng</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P6-So-sanh-voi-WebAssembly-Mot-so-truong-hop-tot-hon-nen-su-dung.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P6-So-sanh-voi-WebAssembly-Mot-so-truong-hop-tot-hon-nen-su-dung.html</id>
    <published>2018-11-16T00:19:00.000Z</published>
    <updated>2018-11-16T00:21:12.978Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 6 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p>Láº§n nÃ y chÃºng ta sáº½ khÃ¡m phÃ¡ vá» WebAssembly vÃ  phÃ¢n tÃ­ch cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a nÃ³, quan trá»ng hÆ¡n lÃ  nhá»¯ng Ä‘iá»ƒm vÆ°á»£t trá»™i hÆ¡n so vá»›i Javascript vá» máº·t hiá»‡u nÄƒng: thá»i gian táº£i, tá»‘c Ä‘á»™ thá»±c thi, dá»n rÃ¡c (GC), sá»­ dá»¥ng bá»™ nhá»›, truy cáº­p API, debugging, Ä‘a luá»“ng vÃ  tÃ­nh di Ä‘á»™ng (portability).</p><p>CÃ¡ch chÃºng ta xÃ¢y dá»±ng web app trÃªn bá» vá»±c cÃ¡ch máº¡ng - váº«n Ä‘ang trong nhá»¯ng ngÃ y Ä‘áº§u nhÆ°ng cÃ¡ch chÃºng ta suy nghÄ© vá» web app Ä‘ang dáº§n thay Ä‘á»•i.<br><a id="more"></a></p><h1 id="Cung-xem-WebAssembly-co-the-lam-gi"><a href="#Cung-xem-WebAssembly-co-the-lam-gi" class="headerlink" title="CÃ¹ng xem WebAssembly cÃ³ thá»ƒ lÃ m gÃ¬"></a>CÃ¹ng xem WebAssembly cÃ³ thá»ƒ lÃ m gÃ¬</h1><p>WebAssembly (gá»i táº¯t <strong>wasm</strong>) lÃ  má»™t loáº¡i bytecode cáº¥p Ä‘á»™ tháº¥p vÃ  hiá»‡u quáº£ cho web.</p><p>WASM cho phÃ©p báº¡n sá»­ dá»¥ng ngÃ´n ngá»¯ khÃ¡c Javascript (nhÆ° C, C++, Rustâ€¦), viáº¿t chÆ°Æ¡ng trÃ¬nh vá»›i nhá»¯ng ngÃ´n ngá»¯ Ä‘Ã³, vÃ  biÃªn dá»‹ch trÆ°á»›c (ahead of time) sang WebAssembly.</p><p>Káº¿t quáº£ lÃ  webapp sáº½ load vÃ  thá»±c thi ráº¥t nhanh.</p><h1 id="Thoi-gian-tai-loading-time"><a href="#Thoi-gian-tai-loading-time" class="headerlink" title="Thá»i gian táº£i (loading time)"></a>Thá»i gian táº£i (loading time)</h1><p>Äá»ƒ load Javascript, trÃ¬nh duyá»‡t pháº£i load táº¥t cáº£ file .js Ä‘Ãºng nguyÃªn vÄƒn báº£n.</p><p>WebAssembly load nhanh hÆ¡n trong trÃ¬nh duyá»‡t bá»Ÿi vÃ¬ chá»‰ cÃ³ nhá»¯ng file wasm <strong>Ä‘Ã£ Ä‘Æ°á»£c biÃªn dá»‹ch</strong> lÃ  Ä‘Æ°á»£c truyá»n táº£i qua internet. VÃ  bá»Ÿi vÃ¬ wasm lÃ  ngÃ´n ngá»¯ báº­c tháº¥p gáº§n giá»‘ng assembly cÃ³ format nhá»‹ phÃ¢n ráº¥t nhá» gá»n.</p><h1 id="Thuc-thi-execution"><a href="#Thuc-thi-execution" class="headerlink" title="Thá»±c thi (execution)"></a>Thá»±c thi (execution)</h1><p>Wasm cháº¡y cháº­m hÆ¡n 20% <strong>so vá»›i native code</strong>. DÃ¹ gÃ¬ Ä‘i ná»¯a thÃ¬ Ä‘Ã¢y lÃ  má»™t káº¿t quáº£ Ä‘Ã¡ng kinh ngáº¡c. NÃ³ lÃ  má»™t Ä‘á»‹nh dáº¡ng Ä‘Æ°á»£c biÃªn dá»‹ch sang mÃ´i trÆ°á»ng sandbox vÃ  cháº¡y cÃ¹ng ráº¥t nhiá»u rÃ ng buá»™c Ä‘á»ƒ Ä‘áº£m báº£o nÃ³ khÃ´ng cÃ³ nhá»¯ng Ä‘iá»ƒm yáº¿u báº£o máº­t hoáº·c ráº¥t khÃ³ Ä‘á»ƒ chá»‘ng láº¡i. Tá»‘c Ä‘á»™ cháº­m lÃ  khÃ´ng Ä‘Ã¡ng ká»ƒ khi so vá»›i native code. HÆ¡n ná»¯a, nÃ³ sáº½ Ä‘Æ°á»£c cáº£i thiá»‡n cháº¡y nhanh hÆ¡n trong tÆ°Æ¡ng lai.</p><p>NgoÃ i ra, kháº£ nÄƒng tÆ°Æ¡ng thÃ­ch ráº¥t tá»‘t vá»›i trÃ¬nh duyá»‡t lÃ  Ä‘iá»ƒm máº¡nh, táº¥t cáº£ nhá»¯ng engine lá»›n Ä‘á»u cÃ³ há»— trá»£ WebAssembly vÃ  Ä‘á»u Ä‘Æ°a ra thá»i gian thá»±c thi tÆ°Æ¡ng Ä‘Æ°Æ¡ng nhau.</p><p>Äá»ƒ hiá»ƒu WebAssembly thá»±c thi nhanh nhÆ° tháº¿ nÃ o so vá»›i Javascript, báº¡n nÃªn <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-2---Ben-trong-engine-V8---5-meo-de-toi-uu-hoa-code" target="_blank" rel="noopener">Ä‘á»c bÃ i trÆ°á»›c trong series Äá»¥c khoÃ©t Javascript</a></p><p>CÃ¹ng xem Ä‘iá»u gÃ¬ xáº£y ra trong V8:<br><img src="https://cdn-images-1.medium.com/max/1000/0*bN9YVBLw_tT1Xvte." alt=""></p><p>CÃ¡ch tiáº¿p cáº­n cá»§a V8: biÃªn dá»‹ch cháº­m</p><p>á» bÃªn trÃ¡i, chÃºng ta cÃ³ Javascript source, bao gá»“m cÃ¡c hÃ m. Äáº§u tiÃªn thÃ¬ nÃ³ cáº§n pháº£i Ä‘Æ°á»£c parse (phÃ¢n tÃ­ch cÃº phÃ¡p) Ä‘á»ƒ chuyá»ƒn táº¥t cáº£ string sang token vÃ  sinh ra <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank" rel="noopener">Abstract Syntax Tree</a> (AST - CÃ¢y cÃº phÃ¡p trá»«u tÆ°á»£ng, chÃºng ta sáº½ cÃ³ má»™t bÃ i viáº¿t vá» nÃ³ sau). CÃ¢y AST lÃ  Ä‘áº¡i diá»‡n biá»ƒu thá»‹ logic cá»§a chÆ°Æ¡ng trÃ¬nh JS trong bá»™ nhá»›. Má»™t khi nÃ³ Ä‘Æ°á»£c sinh ra, V8 sáº½ Ä‘i tháº³ng Ä‘áº¿n mÃ£ mÃ¡y. Vá» cÆ¡ báº£n thÃ¬ báº¡n sáº½ duyá»‡t qua cÃ¢y Ä‘Ã³, táº¡o ra mÃ£ mÃ¡y vÃ  hÃ m cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c biÃªn dá»‹ch. KhÃ´ng cÃ³ tiáº¿n trÃ¬nh nÃ o cá»‘ gáº¯ng tÄƒng tá»‘c nÃ³.</p><p>Giá» thÃ¬ lÆ°á»›t qua xem V8 pipeline lÃ m gÃ¬ tiáº¿p theo:</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*wzuQ9LYv7CAUICOC." alt=""></p><p>ChÃºng ta cÃ³ <a href="https://github.com/v8/v8/wiki/TurboFan" target="_blank" rel="noopener">TurboFan</a>, 1 trong nhá»¯ng trÃ¬nh biÃªn dá»‹ch tá»‘i Æ°u hÃ³a cá»§a V8. Trong khi app Javascript Ä‘ang cháº¡y thÃ¬ cÃ²n cÃ³ ráº¥t nhiá»u code khÃ¡c cháº¡y trong V8. TurboFan thá»±c hiá»‡n Ä‘iá»u hÃ nh, náº¿u cÃ³ gÃ¬ cháº¡y cháº­m báº¥t ká»ƒ lÃ  Ä‘ang ngháº½n cá»• chai (bottleneck) hay nhá»¯ng Ä‘iá»ƒm nÃ³ng (hot spots), thÃ¬ sáº½ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a. NÃ³ Ä‘áº©y pháº§n code Ä‘ang ngá»‘n tÃ i nguyÃªn CPU Ä‘Ã³ qua má»™t bá»™ <a href="https://en.wikipedia.org/wiki/Just-in-time_compilation" target="_blank" rel="noopener">JIT</a> tá»‘i Æ°u Ä‘á»ƒ táº¡o ra code nhanh hÆ¡n nhiá»u.</p><p>NÃ³ giáº£i quyáº¿t váº¥n Ä‘á», nhÆ°ng bÃªn cáº¡nh Ä‘Ã³ quÃ¡ trÃ¬nh phÃ¢n tÃ­ch code vÃ  quyáº¿t Ä‘á»‹nh nÃªn tá»‘i Æ°u nhÆ° tháº¿ nÃ o cÅ©ng lÃ m tá»‘n tÃ i nguyÃªn CPU. Äiá»u nÃ y, lÃ m hao tá»•n thá»i lÆ°á»£ng pin nhiá»u hÆ¡n, Ä‘áº·c biá»‡t lÃ  trÃªn cÃ¡c thiáº¿t bá»‹ di Ä‘á»™ng.</p><p>ChÃ , wasm thÃ¬ khÃ´ng cáº§n. NÃ³ Ä‘i tháº³ng vÃ o quÃ¡ trÃ¬nh lÃ m viá»‡c nhÆ° dÆ°á»›i Ä‘Ã¢y:</p><p><img src="https://cdn-images-1.medium.com/max/1000/0*GDU4GguTzk8cSAYk." alt=""></p><p>Wasm Ä‘Ã£ duyá»‡t qua quÃ¡ trÃ¬nh tá»‘i Æ°u hÃ³a ngay trong giai Ä‘oáº¡n biÃªn dá»‹ch. TrÃªn háº¿t thÃ¬ parsing Ä‘Ã£ khÃ´ng cÃ²n cáº§n thiáº¿t ná»¯a. Báº¡n cÃ³ mÃ£ nhá»‹ phÃ¢n tá»‘i Æ°u cÃ³ thá»ƒ gáº¯n trá»±c tiáº¿p vÃ o bá»™ pháº­n backend Ä‘á»ƒ sinh ra mÃ£ mÃ¡y. Táº¥t cáº£ cÃ¡c sá»± tá»‘i Æ°u hÃ³a Ä‘Ã£ Ä‘Æ°á»£c hoÃ n thÃ nh bá»Ÿi trÃ¬nh biÃªn dá»‹ch á»Ÿ frontend.</p><p>Äiá»u nÃ y lÃ m cho quÃ¡ trÃ¬nh thá»±c thi wasm trá»Ÿ nÃªn hiá»‡u quáº£ hÆ¡n ráº¥t nhiá»u bá»Ÿi vÃ¬ ta cÃ³ thá»ƒ bá» qua 1 sá»‘ bÆ°á»›c trong khi xá»­ lÃ½.</p><h1 id="Mo-hinh-bo-nho"><a href="#Mo-hinh-bo-nho" class="headerlink" title="MÃ´ hÃ¬nh bá»™ nhá»›"></a>MÃ´ hÃ¬nh bá»™ nhá»›</h1><p><img src="https://cdn-images-1.medium.com/max/1000/0*QphcOVaiVC2YL7Jd." alt=""></p><p>Bá»™ nhá»› cá»§a 1 chÆ°Æ¡ng trÃ¬nh C++ lÃ  chuá»—i liá»n ká» cÃ¡c block nhá»› khÃ´ng cÃ³ â€œlá»—â€. Má»™t trong sá»‘ cÃ¡c tÃ­nh nÄƒng cá»§a wasm giÃºp Ä‘áº©y máº¡nh sá»± báº£o máº­t lÃ  Ã½ tÆ°á»Ÿng vá» stack thá»±c thi Ä‘áº·t riÃªng biá»‡t vá»›i bá»™ nhá»› tháº³ng hÃ ng (linear). Trong C++ ta cÃ³ heap, cáº¥p phÃ¡t tá»« Ä‘Ã¡y cá»§a heap vÃ  phÃ¡t triá»ƒn stack á»Ÿ Ä‘á»‰nh heap. Ta cÃ³ thá»ƒ láº¥y con trá» vÃ  tÃ¬m kiáº¿m trong bá»™ nhá»› stack Ä‘á»ƒ chÆ¡i Ä‘Ã¹a vá»›i nhá»¯ng biáº¿n mÃ  chÃºng ta cÃ²n khÃ´ng Ä‘á»¥ng tá»›i.</p><p>ÄÃ¢y lÃ  má»™t Ä‘iá»ƒm cáº¡m báº«y mÃ  ráº¥t nhiá»u malware khai thÃ¡c.</p><p>WebAssembly sá»­ dá»¥ng má»™t mÃ´ hÃ¬nh hoÃ n toÃ n khÃ¡c. Stack thá»±c thi tÃ¡ch biá»‡t vá»›i chÆ°Æ¡ng trÃ¬nh chÃ­nh WebAssembly nÃªn khÃ´ng cÃ³ cÃ¡ch nÃ o báº¡n cÃ³ thá»ƒ chá»‰nh sá»­a vÃ  thay Ä‘á»•i nhá»¯ng biáº¿n bÃªn trong nÃ³. ThÃªm ná»¯a lÃ  cÃ¡c hÃ m cÃ³ offset lÃ  sá»‘ nguyÃªn chá»© ko dÃ¹ng contror. HÃ m trá» vÃ o má»™t báº£ng chá»©c nÄƒng vÃ´ hÆ°á»›ng. Sau Ä‘Ã³, cÃ¡c con sá»‘ Ä‘Æ°á»£c tÃ­nh toÃ¡n trá»±c tiáº¿p nÃ y Ä‘Æ°á»£c Ä‘Æ°a vÃ o bÃªn trong module. NÃ³ Ä‘Æ°á»£c xÃ¢y dá»±ng theo cÃ¡ch nÃ y Ä‘á»ƒ cÃ³ thá»ƒ load nhiá»u wasm cÃ¹ng láº§n, Ä‘Ã¡nh offset táº¥t cáº£ cÃ¡c index vÃ  nÃ³ sáº½ cháº¡y tá»‘t.</p><p>Äá»ƒ tÃ¬m hiá»ƒu sÃ¢u hÆ¡n vá» mÃ´ hÃ¬nh bá»™ nhá»› vÃ  cÃ¡c cÃ¡ch quáº£n lÃ½ trong Javascript, báº¡n cÃ³ thá»ƒ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-3---Quan-ly-bo-nho---4-truong-hop-ro-ri-pho-bien" target="_blank" rel="noopener">xem láº¡i bÃ i trÆ°á»›c</a>.</p><h1 id="Don-rac-GC"><a href="#Don-rac-GC" class="headerlink" title="Dá»n rÃ¡c (GC)"></a>Dá»n rÃ¡c (GC)</h1><p>ChÃºng ta Ä‘Ã£ biáº¿t quáº£n lÃ½ bá»™ nhá»› cá»§a Javascript cÃ³ bao gá»“m cáº£ xá»­ lÃ½ dá»n rÃ¡c Garbage Collector.</p><p>Äá»‘i vá»›i WebAssembly thÃ¬ hÆ¡i khÃ¡c má»™t chÃºt. NÃ³ há»— trá»£ nhá»¯ng ngÃ´n ngá»¯ quáº£n lÃ½ bá»™ nhá»› thá»§ cÃ´ng. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng GC cá»§a chÃ­nh báº¡n vá»›i cÃ¡c wasm module, nhÆ°ng cÃ´ng viá»‡c Ä‘Ã³ hÆ¡i phá»©c táº¡p.</p><p>Hiá»‡n táº¡i, WebAssembly Ä‘Æ°á»£c thiáº¿t káº¿ xoay quanh cÃ¡c trÆ°á»ng há»£p sá»­ dá»¥ng cá»§a C++ vÃ  RUST. Bá»Ÿi vÃ¬ wasm lÃ  ngÃ´n ngá»¯ tháº¥p nÃªn sáº½ dá»… hiá»ƒu hÆ¡n náº¿u sá»­ dá»¥ng nhá»¯ng ngÃ´n ngá»¯ láº­p trÃ¬nh gáº§n gÅ©i &amp; dá»… biÃªn dá»‹ch ra ngÃ´n ngá»¯ assembly. C cÃ³ thá»ƒ sá»­ dá»¥ng malloc thÆ°á»ng, C++ cÃ³ thá»ƒ dÃ¹ng con trá» thÃ´ng minh. Rust dÃ¹ng má»™t mÃ´ hÃ¬nh khÃ¡c hoÃ n toÃ n (nhÆ°ng lÃ  1 chá»§ Ä‘á» khÃ¡c nhÃ©). Nhá»¯ng ngÃ´n ngá»¯ nÃ y khÃ´ng dÃ¹ng GC, do Ä‘Ã³ chÃºng khÃ´ng cáº§n cÃ¡c tÃ¡c vá»¥ runtime Ä‘á»ƒ theo dÃµi bá»™ nhá»›. WebAssembly phÃ¹ há»£p vá»›i chÃºng.</p><p>ThÃªm ná»¯a, nhá»¯ng ngÃ´n ngá»¯ nÃ y khÃ´ng pháº£i Ä‘Æ°á»£c thiáº¿t káº¿ 100% cho viá»‡c truy váº¥n nhá»¯ng thá»© phá»©c táº¡p thuá»™c vá» Javascript, vÃ­ dá»¥ nhÆ° thay Ä‘á»•i DOM. NÃ³ khÃ¡ vÃ´ nghÄ©a khi pháº£i viáº¿t toÃ n bá»™ app HTML trÃªn ná»n C++ bá»Ÿi vÃ¬ C++ khÃ´ng Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i má»¥c Ä‘Ã­ch lÃ m webapp. Äa sá»‘ cÃ¡c trÆ°á»ng há»£p cÃ¡c ká»¹ sÆ° dÃ¹ng C++ hoáº·c Rust, há» hÆ°á»›ng tá»›i WebGL hoáº·c nhá»¯ng thÆ° viá»‡n cÃ³ tÃ­nh tá»‘i Æ°u hÃ³a cao. (VÃ­ dá»¥: phÃ©p tÃ­nh toÃ¡n há»c khÃ³ vÃ  phá»©c táº¡p)</p><p>Tuy nhiÃªn, trong tÆ°Æ¡ng lai WebAssembly sáº½ há»— trá»£ nhá»¯ng ngÃ´n ngá»¯ cÃ³ sáºµn GC.</p><h1 id="Truy-xuat-Platform-API"><a href="#Truy-xuat-Platform-API" class="headerlink" title="Truy xuáº¥t Platform API"></a>Truy xuáº¥t Platform API</h1><p>TÃ¹y thuá»™c vÃ o mÃ´i trÆ°á»ng runtime thá»±c thi Javascript, quyá»n truy xuáº¥t vÃ o nhá»¯ng API Ä‘ang tá»“n táº¡i Ä‘áº·c trÆ°ng cho platform cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p trá»±c tiáº¿p thÃ´ng qua app JS cá»§a báº¡n. VÃ­ dá»¥: báº¡n cháº¡y JS code trÃªn trÃ¬nh duyá»‡t, báº¡n cÃ³ 1 cá»¥c cÃ¡c Web API mÃ  webapp cÃ³ thá»ƒ gá»i vÃ  Ä‘iá»u khiá»ƒn trÃ¬nh duyá»‡t hoáº·c chá»©c nÄƒng thiáº¿t bá»‹ vÃ  cÃ³ quyá»n truy xuáº¥t vÃ o DOM, CSSOM, WebGL, IndexedDB, Web Audio API, vÃ¢n vÃ¢n.</p><p>WebAssembly module khÃ´ng cÃ³ quyá»n truy cáº­p vÃ o platform API. Má»i thá»© Ä‘á»u trung gian qua Javascript. Náº¿u báº¡n muá»‘n truy xuáº¥t vÃ o má»™t sá»‘ API Ä‘áº·c trÆ°ng cho platform bÃªn trong module WebAssembly thÃ¬ báº¡n pháº£i gá»i nÃ³ thÃ´ng qua Javascript.</p><p>VÃ­ dá»¥, náº¿u muá»‘n dÃ¹ng console.log, báº¡n gá»i nÃ³ thÃ´ng qua JS thay vÃ¬ C++. VÃ  dÄ© nhiÃªn lÃ  sáº½ cÃ³ nhá»¯ng háº¡n cháº¿ vá» JS mÃ  ta pháº£i cháº¥p nháº­n.</p><p>NhÆ°ng trÆ°á»ng há»£p nÃ y sáº½ sá»›m Ä‘Æ°á»£c kháº¯c phá»¥c khi mÃ  Ä‘áº·c Ä‘iá»ƒm ká»¹ thuáº­t sáº½ cung cáº¥p cÃ¡c platform API cho wasm trong tÆ°Æ¡ng lai, báº¡n sáº½ cÃ³ thá»ƒ sá»›m phÃ¡t triá»ƒn app mÃ  khÃ´ng cáº§n Javascript.</p><h1 id="Anh-xa-ma-nguon-Source-map"><a href="#Anh-xa-ma-nguon-Source-map" class="headerlink" title="Ãnh xáº¡ mÃ£ nguá»“n (Source map)"></a>Ãnh xáº¡ mÃ£ nguá»“n (Source map)</h1><p>Khi báº¡n lÃ m tá»‘i giáº£n code JS, báº¡n cáº§n Ä‘áº£m báº£o cÃ³ thá»ƒ debug nÃ³. ÄÃ³ lÃ  khi mÃ  ta cáº§n Ä‘áº¿n <a href="https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/" target="_blank" rel="noopener">Source Map</a>.</p><p>Vá» cÆ¡ báº£n, Source Map lÃ  1 cÃ¡ch Ä‘á»ƒ map má»™t file tá»‘i giáº£n vá» vá»›i tráº¡ng thÃ¡i ban Ä‘áº§u cá»§a nÃ³. Khi báº¡n build sáº£n pháº©m cho mÃ´i trÆ°á»ng production, cÃ¹ng vá»›i file JS Ä‘Ã£ káº¿t há»£p &amp; tá»‘i gian, báº¡n sáº½ sinh ra 1 file source map chá»©a thÃ´ng tin vá» file JS gá»‘c. Khi báº¡n query má»™t dÃ²ng cá»¥ thá»ƒ vá»›i sá»‘ cá»™t nÃ o Ä‘Ã³ file JS, báº¡n cÃ³ thá»ƒ tra cá»©u trong source map Ä‘á»ƒ tÃ¬m ra vá»‹ trÃ­ gá»‘c ban Ä‘áº§u cá»§a nÃ³.</p><p>WebAssembly khÃ´ng há»— trá»£ source map vÃ¬ nÃ³ chÆ°a cÃ³ mÃ´ táº£ ká»¹ thuáº­t cho pháº§n nÃ y nhÆ°ng hi vá»ng lÃ  tÆ°Æ¡ng lai gáº§n sáº½ há»— trá»£.</p><p>Khi báº¡n Ä‘áº·t breakpoint trong code C++, báº¡n sáº½ tháº¥y code C++ thay vÃ¬ WebAssembly, Ã­t nháº¥t lÃ  váº«n cÃ²n cÃ³ Ã­ch.</p><h1 id="Da-luong-Multithreading"><a href="#Da-luong-Multithreading" class="headerlink" title="Äa luá»“ng (Multithreading)"></a>Äa luá»“ng (Multithreading)</h1><p>Ai cÅ©ng biáº¿t Javascript lÃ  Ä‘Æ¡n luá»“ng. CÃ³ nhiá»u cÃ¡ch Ä‘á»ƒ cáº£i thiá»‡n Event Loop vÃ  nÃ¢ng cáº¥p pháº§n láº­p trÃ¬nh báº¥t Ä‘á»“ng bá»™ mÃ  chÃºng tÃ´i Ä‘Ã£ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-4---Event-loop--lap-trinh-bat-dong-bo---5-meo-cai-thien-Async-Await" target="_blank" rel="noopener">giá»›i thiá»‡u trong bÃ i trÆ°á»›c</a>.</p><p>Javascript cÃ³ thá»ƒ dÃ¹ng Web Workers nhÆ°ng nÃ³ ráº¥t háº¡n cháº¿ trÆ°á»ng há»£p. Vá» cÆ¡ báº£n, báº¥t ká»³ tÃ­nh toÃ¡n nÃ o áº£nh hÆ°á»Ÿng náº·ng Ä‘áº¿n CPU vÃ  block luá»“ng xá»­ UI Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘áº©y ra load riÃªng vá»›i WebWorker. Tuy nhiÃªn, WebWorker láº¡i khÃ´ng truy xuáº¥t Ä‘Æ°á»£c vÃ o DOM.</p><p>WebAssembly hiá»‡n táº¡i khÃ´ng há»— trá»£ Ä‘a luá»“ng. Tuy nhiÃªn, Ä‘iá»u nÃ y cháº¯c cháº¯n sáº½ Ä‘Æ°á»£c thay Ä‘á»•i. Wasm Ä‘ang tiáº¿n gáº§n tá»›i nhá»¯ng tiáº¿n trÃ¬nh native (vÃ­ dá»¥: luá»“ng kiá»ƒu C++). CÃ³ nhá»¯ng luá»“ng â€œthá»±câ€ sáº½ táº¡o ra ráº¥t nhiá»u cÆ¡ há»™i má»›i trÃªn trÃ¬nh duyá»‡t. VÃ  láº½ dÄ© nhiÃªn, nÃ³ cÅ©ng sáº½ bá»‹ láº¡m dá»¥ng nhiá»u hÆ¡n.</p><h1 id="Tinh-di-dong-Portability"><a href="#Tinh-di-dong-Portability" class="headerlink" title="TÃ­nh di Ä‘á»™ng (Portability)"></a>TÃ­nh di Ä‘á»™ng (Portability)</h1><p>NgÃ y nay Javascript cÃ³ thá»ƒ cháº¡y á»Ÿ báº¥t ká»³ Ä‘Ã¢u, tá»« trÃ¬nh duyá»‡t Ä‘áº¿n server, ká»ƒ cáº£ trong cÃ¡c há»‡ thá»‘ng nhÃºng.</p><p>WebAssembly Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ an toÃ n vÃ  linh Ä‘á»™ng. NhÆ° Javascript, nÃ³ cháº¡y trÃªn nhiá»u mÃ´i trÆ°á»ng há»— trá»£ wasm (vÃ­ dá»¥: má»i trÃ¬nh duyá»‡t)</p><p>WebAssembly cÃ³ cÃ¹ng má»¥c tiÃªu di Ä‘á»™ng nhÆ° cÃ¡ch mÃ  Java Ä‘ang cá»‘ thá»±c hiá»‡n trong nhá»¯ng ngÃ y Ä‘áº§u vá»›i Applets.</p><h1 id="Khi-nao-thi-dung-WebAssembly-tot-hon-JavaScript"><a href="#Khi-nao-thi-dung-WebAssembly-tot-hon-JavaScript" class="headerlink" title="Khi nÃ o thÃ¬ dÃ¹ng WebAssembly tá»‘t hÆ¡n JavaScript?"></a>Khi nÃ o thÃ¬ dÃ¹ng WebAssembly tá»‘t hÆ¡n JavaScript?</h1><p>Trong cÃ¡c phiÃªn báº£n Ä‘áº§u cá»§a WebAssembly, chá»©c nÄƒng chÃ­nh chá»‰ táº­p trung vÃ o cÃ¡c phÃ©p tÃ­nh náº·ng táº£i trÃªn CPU (cÃ¡c bÃ i toÃ¡n phá»©c táº¡p cháº³ng háº¡n). á»¨ng dá»¥ng chá»§ yáº¿u nháº¥t khi nghÄ© Ä‘áº¿n lÃ  games - cÃ³ cáº£ hÃ ng táº¥n pixel cáº§n thao tÃ¡c xá»­ lÃ½ trÃªn mÃ n hÃ¬nh. Báº¡n cÃ³ thá»ƒ viáº¿t app báº±ng ngÃ´n ngá»¯ mÃ  báº¡n quen thuá»™c nhÆ° C++/Rust báº±ng OpenGL sao Ä‘Ã³ biÃªn dá»‹ch sang wasm vÃ  nÃ³ sáº½ cháº¡y trÃªn trÃ¬nh duyá»‡t.</p><p>Báº¡n cÃ³ thá»ƒ xem vÃ­ dá»¥ sau (tá»‘t nháº¥t lÃ  dÃ¹ng Firefox): <a href="http://s3.amazonaws.com/mozilla-games/tmp/2017-02-21-SunTemple/SunTemple.html" target="_blank" rel="noopener">http://s3.amazonaws.com/mozilla-games/tmp/2017-02-21-SunTemple/SunTemple.html</a>. NÃ³ cháº¡y trÃªn ná»n <a href="https://www.unrealengine.com/en-US/what-is-unreal-engine-4" target="_blank" rel="noopener">Unreal engine</a>.</p><p>Má»™t trÆ°á»ng há»£p khÃ¡c tiÃªu biá»ƒu cho viÃªc sá»­ dá»¥ng WebAssembly (vá» máº·t hiá»‡u nÄƒng) lÃ  triá»ƒn khai má»™t sá»‘ thÆ° viá»‡n cháº¡y cÃ¡c tÃ¡c vá»¥ náº·ng vá»›i CPU, vÃ­ dá»¥ nhÆ° xá»­ lÃ½ áº£nh.</p><p>NhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÆ°á»›c, wasm cÃ³ thá»ƒ giáº£m khÃ¡ nhiá»u lÆ°á»£ng tiÃªu thá»¥ pin trÃªn cÃ¡c thiáº¿t bá»‹ di Ä‘á»™ng (phá»¥ thuá»™c vÃ o engine), bá»Ÿi vÃ¬ Ä‘a sá»‘ cÃ¡c bÆ°á»›c xá»­ lÃ½ Ä‘á»u Ä‘Ã£ Ä‘Æ°á»£c hoÃ n thÃ nh trÆ°á»›c trong khi biÃªn dá»‹ch.</p><p>Trong tÆ°Æ¡ng lai, báº¡n sáº½ cÃ³ thá»ƒ sá»­ dá»¥ng code WASM nhá»‹ phÃ¢n ká»ƒ cáº£ khi báº¡n khÃ´ng thá»±c sá»± viáº¿t code cÃ³ thá»ƒ biÃªn dá»‹ch ra nÃ³. Báº¡n cÃ³ thá»ƒ tÃ¬m vÃ i projects trÃªn NPM Ä‘ang báº¯t Ä‘áº§u triá»ƒn khai theo hÆ°á»›ng nÃ y.</p><p>Vá»›i trÆ°á»ng há»£p thay Ä‘á»•i DOM vÃ  sá»­ dá»¥ng nhiá»u platform API thÃ¬ tá»‘t nháº¥t váº«n lÃ  dÃ¹ng Javascript, bá»Ÿi vÃ¬ rÃµ rÃ ng nÃ³ há»— trá»£ tá»‘t vá»›i cÃ¡c API Ä‘Ã³.</p><p>á» <a href="https://www.sessionstack.com/?utm_source=medium&amp;utm_medium=blog&amp;utm_content=Post-6-webassembly-outro" target="_blank" rel="noopener">SessionStack</a>, tÃ¡c giáº£ liÃªn tá»¥c má»Ÿ rá»™ng biÃªn giá»›i hiá»‡u nÄƒng cá»§a Javascript nháº±m viáº¿t Ä‘Æ°á»£c nhiá»u code tá»‘i Æ°u vÃ  hiá»‡u quáº£ cao. Giáº£i phÃ¡p cá»§a há» cáº§n cung cáº¥p hiá»‡u nÄƒng nhanh chÃ³ng máº·t vÃ¬ khÃ´ng thá»ƒ gÃ¢y áº£nh hÆ°á»Ÿng lÃªn hiá»‡u nÄƒng cá»§a app cá»§a khÃ¡ch hÃ ng.</p><p>Má»™t khi báº¡n Ä‘Ã£ tÃ­ch há»£p SessionStack vÃ o web app cá»§a báº¡n, nÃ³ sáº½ ghi láº¡i má»i thá»© diá»…n ra trÃªn app/website: nhá»¯ng thay Ä‘á»•i trÃªn DOM, tÆ°Æ¡ng tÃ¡c cá»§a ngÆ°á»i dÃ¹ng, JS exception, stack trace, nhá»¯ng request bá»‹ fail vÃ  cáº£ thÃ´ng bÃ¡o debug, cho phÃ©p báº¡n cháº¡y láº¡i (replay) nhá»¯ng issue Ä‘Ã£ xáº£y ra dÆ°á»›i dáº¡ng video vÃ  xem chÃºng diá»…n ra nhÆ° tháº¿ nÃ o vá»›i ngÆ°á»i dÃ¹ng. Táº¥t cáº£ Ä‘á»u hoáº¡t Ä‘á»™ng theo thá»i gian thá»±c (real-time) vÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng cá»§a webapp. SessionStack pháº£i tá»‘i Æ°u hÃ³a code má»™t cÃ¡ch tá»‘i Ä‘a vÃ  lÃ m cho quÃ¡ trÃ¬nh nÃ y báº¥t Ä‘á»“ng bá»™ nháº¥t cÃ³ thá»ƒ.</p><p>KhÃ´ng chá»‰ lÃ  má»™t thÆ° viá»‡n! Khi báº¡n cháº¡y láº¡i má»™t session cá»§a ngÆ°á»i dÃ¹ng trong SessionStack thÃ¬ nÃ³ pháº£i render láº¡i toÃ n bá»™ nhá»¯ng gÃ¬ mÃ  trÃ¬nh duyá»‡t cá»§a user thá»±c hiá»‡n táº¡i thá»i Ä‘iá»ƒm váº¥n Ä‘á» xáº£y ra vÃ  team tÃ¡c giáº£ pháº£i xÃ¢y dá»±ng láº¡i toÃ n bá»™ tráº¡ng thÃ¡i, cho phÃ©p báº¡n cÃ³ thá»ƒ nháº£y tá»›i nháº£y lui trong timeline session. Äá»ƒ Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³, team tÃ¡c giáº£ Ä‘Ã£ táº­n dá»¥ng tá»‘i Ä‘a kháº£ nÄƒng báº¥t Ä‘á»“ng bá»™ mÃ  Javascript cung cáº¥p trong khi thiáº¿u sÃ³t nhá»¯ng giáº£i phÃ¡p tá»‘t hÆ¡n.</p><p>Vá»›i WebAssembly, team tÃ¡c giáº£ cÃ³ thá»ƒ Ä‘áº©y nhá»¯ng tiáº¿n trÃ¬nh xá»­ lÃ½ vÃ  render náº·ng nháº¥t vÃ o má»™t ngÃ´n ngá»¯ phÃ¹ há»£p hÆ¡n vá»›i cÃ´ng viá»‡c nÃ y vÃ  Ä‘á»ƒ pháº§n thu tháº­p dá»¯ liá»‡u, thay Ä‘á»•i DOM cho Javascript lÃ m.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 6 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;Láº§n nÃ y chÃºng ta sáº½ khÃ¡m phÃ¡ vá» WebAssembly vÃ  phÃ¢n tÃ­ch cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a nÃ³, quan trá»ng hÆ¡n lÃ  nhá»¯ng Ä‘iá»ƒm vÆ°á»£t trá»™i hÆ¡n so vá»›i Javascript vá» máº·t hiá»‡u nÄƒng: thá»i gian táº£i, tá»‘c Ä‘á»™ thá»±c thi, dá»n rÃ¡c (GC), sá»­ dá»¥ng bá»™ nhá»›, truy cáº­p API, debugging, Ä‘a luá»“ng vÃ  tÃ­nh di Ä‘á»™ng (portability).&lt;/p&gt;
&lt;p&gt;CÃ¡ch chÃºng ta xÃ¢y dá»±ng web app trÃªn bá» vá»±c cÃ¡ch máº¡ng - váº«n Ä‘ang trong nhá»¯ng ngÃ y Ä‘áº§u nhÆ°ng cÃ¡ch chÃºng ta suy nghÄ© vá» web app Ä‘ang dáº§n thay Ä‘á»•i.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P5: Hiá»ƒu sÃ¢u vá» WebSocket &amp; HTTP/2 vá»›i SSE</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P5-Hieu-sau-ve-WebSocket-HTTP-2-voi-SSE.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P5-Hieu-sau-ve-WebSocket-HTTP-2-voi-SSE.html</id>
    <published>2018-11-16T00:04:00.000Z</published>
    <updated>2018-11-16T00:16:38.066Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 5 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p>Trong pháº§n nÃ y chÃºng ta sáº½ Ä‘Ã o sÃ¢u vá»›i tháº¿ giá»›i cá»§a nhá»¯ng giao thá»©c giao tiáº¿p, Ã¡nh xáº¡ (mapping) vÃ  tháº£o luáº­n vá» nhá»¯ng thuá»™c tÃ­nh cÅ©ng nhÆ° thÃ nh pháº§n cá»§a chÃºng. ChÃºng ta sáº½ Ä‘Æ°a ra 1 so sÃ¡nh nhá» giá»¯a WebSockets vÃ  HTTP/s. Cuá»‘i cÃ¹ng, team SessionStack sáº½ chia sáº» má»™t vÃ i Ã½ tÆ°á»Ÿng vá» viá»‡c lá»±a chá»n phÆ°Æ¡ng thá»©c nÃ o cho phÃ¹ há»£p vá»›i giao thá»©c máº¡ng.<br><a id="more"></a></p><h1 id="Gioi-thieu"><a href="#Gioi-thieu" class="headerlink" title="Giá»›i thiá»‡u"></a>Giá»›i thiá»‡u</h1><p>NgÃ y nay nhá»¯ng webapp phá»©c táº¡p cÃ³ nhiá»u tÃ­nh nÄƒng, UI Ä‘á»™ng xuáº¥t hiá»‡n nhÆ° trÄƒm hoa Ä‘ua ná»Ÿ. CÅ©ng khÃ´ng pháº£i báº¥t ngá», internet cÅ©ng Ä‘Ã£ phÃ¡t triá»ƒn Ä‘Æ°á»£c má»™t quÃ£ng Ä‘Æ°á»ng khÃ¡ dÃ i ká»ƒ tá»« khi báº¯t Ä‘áº§u.</p><p>Ban Ä‘áº§u, internet khÃ´ng Ä‘Æ°á»£c xÃ¢y dá»±ng Ä‘á»ƒ dÃ nh cho nhá»¯ng app Ä‘á»™ng vÃ  phá»©c táº¡p. NÃ³ Ä‘Æ°á»£c hÃ¬nh thÃ nh nhÆ° lÃ  má»™t táº­p há»£p cá»§a cÃ¡c trang HTML, káº¿t ná»‘i vá»›i nhau Ä‘á»ƒ cáº¥u thÃ nh nÃªn khÃ¡i niá»‡m vá» â€œWebâ€ chá»©a thÃ´ng tin. Pháº§n lá»›n má»i thá»© Ä‘Æ°á»£c xÃ¢y dá»±ng xung quanh mÃ´ hÃ¬nh request/response ná»•i tiáº¿ng cá»§a HTTP. Má»™t client táº£i trang vÃ  khÃ´ng cÃ³ gÃ¬ xáº£y ra cho Ä‘áº¿n khi user báº¯t Ä‘áº§u click vÃ  di chuyá»ƒn Ä‘áº¿n trang tiáº¿p theo.</p><p>Khoáº£ng nÄƒm 2005, AJAX Ä‘Æ°á»£c giá»›i thiá»‡u vÃ  ráº¥t nhiá»u ngÆ°á»i Ä‘Ã£ khÃ¡m phÃ¡ kháº£ nÄƒng táº¡o káº¿t ná»‘i giá»¯a client vÃ  server theo 2 chiá»u (<strong>bidirectional</strong>). VÃ  váº«n nhÆ° tháº¿, táº¥t cáº£ giao tiáº¿p HTTP Ä‘Æ°á»£c chá»‰ Ä‘áº¡o bá»Ÿi client yÃªu cáº§u user tÆ°Æ¡ng tÃ¡c hoáº·c thá»±c hiá»‡n theo chu ká»³ Ä‘á»ƒ láº¥y dá»¯ liá»‡u má»›i tá»« server.</p><h1 id="Tao-mot-HTTP-â€œ2-chieuâ€"><a href="#Tao-mot-HTTP-â€œ2-chieuâ€" class="headerlink" title="Táº¡o má»™t HTTP â€œ2 chiá»uâ€"></a>Táº¡o má»™t HTTP â€œ2 chiá»uâ€</h1><p>CÃ´ng nghá»‡ cho phÃ©p server gá»­i dá»¯ liá»‡u vá» client má»™t cÃ¡ch â€œchá»§ Ä‘á»™ngâ€ Ä‘Ã£ phÃ¡t triá»ƒn Ä‘Æ°á»£c 1 thá»i gian. Push vÃ  Comet lÃ  vÃ­ dá»¥.</p><p>Má»™t trong sá»‘ máº¹o ná»•i tiáº¿ng Ä‘á»ƒ táº¡o ra áº£o giÃ¡c ráº±ng server Ä‘ang gá»­i dá»¯ liá»‡u vá» client Ä‘Æ°á»£c gá»i lÃ  long polling. Vá»›i long polling, client má»Ÿ káº¿t ná»‘i HTTP Ä‘áº¿n server vÃ  giá»¯ nÃ³ tiáº¿p tá»¥c má»Ÿ cho Ä‘áº¿n khi cÃ³ response tráº£ vá». Má»—i khi server cÃ³ dá»¯ liá»‡u má»›i cáº§n Ä‘Æ°á»£c gá»­i, nÃ³ chuyá»ƒn giao thÃ´ng tin dÆ°á»›i dáº¡ng má»™t response.</p><p>CÃ¹ng xem má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n vá» long polling:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">poll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      $.ajax(&#123; </span><br><span class="line">        url: <span class="string">'https://api.example.com/endpoint'</span>, </span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// LÃ m gÃ¬ Ä‘Ã³ vá»›i `data`</span></span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// CÃ i Ä‘áº·t poll má»›i theo Ä‘á»‡ quy</span></span><br><span class="line">          poll();</span><br><span class="line">        &#125;, </span><br><span class="line">        dataType: <span class="string">'json'</span></span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;, <span class="number">10000</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>ÄÃ¢y lÃ  má»™t hÃ m tá»± thá»±c thi cÆ¡ báº£n cháº¡y má»™t cÃ¡ch tá»± Ä‘á»™ng láº§n Ä‘áº§u tiÃªn. NÃ³ sáº½ cÃ i Ä‘áº·t má»™t khoáº£ng thá»i gian 10 giÃ¢y vÃ  sau má»—i lá»i gá»i Ajax báº¥t Ä‘á»“ng bá»™ Ä‘áº¿n server, callback láº¡i gá»i ajax láº§n ná»¯a.</p><p>VÃ i ká»¹ thuáº­t khÃ¡c cÃ³ thá»ƒ ká»ƒ Ä‘áº¿n nhÆ° <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/Socket.html" target="_blank" rel="noopener">Flash</a>, request nhiá»u thÃ nh pháº§n XHR vÃ  <a href="http://cometdaily.com/2007/12/27/a-standards-based-approach-to-comet-communication-with-rest/" target="_blank" rel="noopener">htmlfiles</a> ná»•i tiáº¿ng.</p><p>Táº¥t cáº£ nhá»¯ng phÆ°Æ¡ng phÃ¡p nÃ y Ä‘á»u cÃ³ chung má»™t váº¥n Ä‘á»: ChÃºng qua máº·t HTTP, lÃ m cho chÃºng khÃ´ng phÃ¹ há»£p vá»›i nhá»¯ng app cÃ³ Ä‘á»™ trá»… tháº¥p. Giáº£ sá»­ nhÆ° game báº¯n sÃºng nhiá»u ngÆ°á»i chÆ¡i trÃªn trÃ¬nh duyá»‡t hoáº·c báº¥t ká»³ game onlinen nÃ o cÃ³ Ä‘á»‘i thá»§ thá»±c.</p><h1 id="Gioi-thieu-WebSockets"><a href="#Gioi-thieu-WebSockets" class="headerlink" title="Giá»›i thiá»‡u WebSockets"></a>Giá»›i thiá»‡u WebSockets</h1><p>ThÃ´ng sá»‘ ká»¹ thuáº­t cá»§a WebSocket Ä‘á»‹nh nghÄ©a má»™t káº¿t ná»‘i API dáº¡ng â€œsocketâ€ (á»• cáº¯m Ä‘iá»‡n!) giá»¯a trÃ¬nh duyá»‡t vÃ  server. Theo nghÄ©a Ä‘en thÃ¬ cÃ³ 1 káº¿t ná»‘i cá»‘ Ä‘á»‹nh giá»¯a client vÃ  server vÃ  cáº£ 2 bÃªn cÃ³ thá»ƒ gá»­i dá»¯ liá»‡u báº¥t ká»³ lÃºc nÃ o.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*a4lA5FYDkjA9mv53NPKtOg.png" alt=""></p><p>Client thiáº¿t láº­p má»™t káº¿t ná»‘i WebSocket thÃ´ng qua má»™t tiáº¿n trÃ¬nh Ä‘Æ°á»£c gá»i lÃ  WebSocket handshake (báº¯t tay WebSocket). Tiáº¿n trÃ¬nh nÃ y báº¯t Ä‘áº§u vá»›i client gá»­i má»™t request HTTP thÃ´ng thÆ°á»ng Ä‘áº¿n server. NÃ³ kÃ¨m theo header Upgrade Ä‘á»ƒ thÃ´ng bÃ¡o cho server ráº±ng client muá»‘n táº¡o má»™t káº¿t ná»‘i WebSocket.</p><p>CÃ¹ng xem thá»­ quÃ¡ trÃ¬nh má»Ÿ káº¿t ná»‘i WebSocket nhÆ° tháº¿ nÃ o á»Ÿ phÃ­a client:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new WebSocket with an encrypted connection.</span></span><br><span class="line"><span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://websocket.example.com'</span>);</span><br></pre></td></tr></table></figure><blockquote><p>WebSocket URL sá»­ dá»¥ng ws scheme. ChÃºng ta cÃ²n cÃ³ cáº£ wss cho nhá»¯ng káº¿t ná»‘i WebSocket báº£o máº­t hÆ¡n, tÆ°Æ¡ng tá»± nhÆ° HTTPS.</p></blockquote><p>Scheme nÃ y báº¯t Ä‘áº§u má»™t tiáº¿n trÃ¬nh má»Ÿ káº¿t ná»‘i WebSocket Ä‘áº¿n websocket.example.com.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  1 vÃ­ dá»¥ Ä‘Æ¡n giáº£n cá»§a header cá»§a request khá»Ÿi táº¡o.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET ws:<span class="comment">//websocket.example.com/ HTTP/1.1</span></span><br><span class="line">Origin: http:<span class="comment">//example.com</span></span><br><span class="line">Connection: Upgrade</span><br><span class="line">Host: websocket.example.com</span><br><span class="line">Upgrade: websocket</span><br></pre></td></tr></table></figure><p>Náº¿u server há»— trá»£ giao thá»©c WebSocket, nÃ³ sáº½ Ä‘á»“ng Ã½ Ä‘á»ƒ nÃ¢ng cáº¥p vÃ  giao tiáº¿p thÃ´ng qua header Upgrade trong response.</p><p>CÃ¹ng xem pháº§n thiáº¿t láº­p cá»§a nÃ³ trong Node.js nhÆ° tháº¿ nÃ o:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ChÃºng ta sáº½ dÃ¹ng https://github.com/theturtle32/WebSocket-Node</span></span><br><span class="line"><span class="comment">// Triá»ƒn khai WebSocket</span></span><br><span class="line"><span class="keyword">var</span> WebSocketServer = <span class="built_in">require</span>(<span class="string">'websocket'</span>).server;</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// xá»­ lÃ½ HTTP request. </span></span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">1337</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// táº¡o server</span></span><br><span class="line">wsServer = <span class="keyword">new</span> WebSocketServer(&#123;</span><br><span class="line">  httpServer: server</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// WebSocket server</span></span><br><span class="line">wsServer.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> connection = request.accept(<span class="literal">null</span>, request.origin);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ÄÃ¢y lÃ  callback quan trá»ng nháº¥t,chÃºng ta sáº½ </span></span><br><span class="line">  <span class="comment">// xá»­ lÃ½ thÃ´ng tin cá»§a client á»Ÿ Ä‘Ã¢y.</span></span><br><span class="line">  connection.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// Xá»­ lÃ½ thÃ´ng tin WebSocket</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  connection.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">connection</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ÄÃ³ng káº¿t ná»‘i</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Sau khi thÃ nh láº­p káº¿t ná»‘i, server tráº£ vá»:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">101</span> Switching Protocols</span><br><span class="line"><span class="built_in">Date</span>: Wed, <span class="number">25</span> Oct <span class="number">2017</span> <span class="number">10</span>:<span class="number">07</span>:<span class="number">34</span> GMT</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Upgrade: WebSocket</span><br></pre></td></tr></table></figure><p>Khi káº¿t ná»‘i Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p, sá»± kiá»‡n open sáº½ Ä‘Æ°á»£c báº¯n ra cho instance WebSocket á»Ÿ phÃ­a client:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://websocket.example.com'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hiá»‡n thÃ´ng bÃ¡o khi káº¿t ná»‘i WebSocket thÃ nh cÃ´ng.</span></span><br><span class="line">socket.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'WebSocket is connected.'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Giá» thÃ¬ quÃ¡ trÃ¬nh â€œbáº¯t tayâ€ Ä‘Ã£ hoÃ n táº¥t, káº¿t ná»‘i khá»Ÿi táº¡o HTTP Ä‘Æ°á»£c thay tháº¿ báº±ng WebSocket vÃ  sá»­ dá»¥ng cÃ¹ng loáº¡i ná»n táº£ng káº¿t ná»‘i TCP/IP. Táº¡i thá»i Ä‘iá»ƒm nÃ y, cáº£ 2 bÃªn Ä‘á»u cÃ³ thá»ƒ gá»­i dá»¯ liá»‡u.</p><p>Vá»›i WebSocket, báº¡n cÃ³ thá»ƒ truyá»n bao nhiÃªu thÃ´ng tin tÃ¹y thÃ­ch mÃ  khÃ´ng cáº§n pháº£i gÃ¡nh chá»‹u nhá»¯ng chi phÃ­ khÃ´ng Ä‘Ã¡ng cÃ³ liÃªn quan Ä‘áº¿n request HTTP truyá»n thá»‘ng. Dá»¯ liá»‡u Ä‘Æ°á»£c truyá»n Ä‘i thÃ´ng qua WebSocket dÆ°á»›i dáº¡ng tin nháº¯n (message), má»—i tin nháº¯n bao gá»“m má»™t hoáº·c nhiá»u <em>frame</em> chá»©a dá»¯ liá»‡u báº¡n gá»­i Ä‘i (gá»i lÃ  <em>kiá»‡n hÃ ng</em> - <em>payload</em>). Äá»ƒ Ä‘áº£m báº£o message cÃ³ thá»ƒ tÃ¡i cáº¥u trÃºc má»™t cÃ¡ch chÃ­nh xÃ¡c khi nÃ³ Ä‘áº¿n vá»›i client, má»—i frame Ä‘Æ°á»£c gÃ¡n cá»©ng tá»« 4-12 byte thÃ´ng tin vá» payload. Sá»­ dá»¥ng há»‡ thá»‘ng thÃ´ng tin dá»±a trÃªn frame nhÆ° tháº¿ nÃ y giÃºp giáº£m táº£i khá»‘i lÆ°á»£ng dá»¯ liá»‡u dÆ° thá»«a (non-payload data) pháº£i truyá»n Ä‘i, cÃ³ thá»ƒ lÃ m cho Ä‘á»™ trá»… giáº£m Ä‘i Ä‘Ã¡ng ká»ƒ.</p><p><strong>LÆ°u Ã½</strong>: <em>Äáº·c biá»‡t chÃº Ã½ lÃ  client chá»‰ Ä‘Æ°á»£c thÃ´ng bÃ¡o vá» message má»›i má»™t khi táº¥t cáº£ frame Ä‘á»u Ä‘Æ°á»£c nháº­n vÃ  payload message gá»‘c Ä‘Æ°á»£c tÃ¡i cáº¥u trÃºc Ä‘áº§y Ä‘á»§</em></p><h1 id="WebSocket-URLs"><a href="#WebSocket-URLs" class="headerlink" title="WebSocket URLs"></a>WebSocket URLs</h1><p>ChÃºng ta cÃ³ Ä‘á» cáº­p sÆ¡ qua vá» WebSocket URL scheme á»Ÿ trÃªn. Trong thá»±c tháº¿, chÃºng giá»›i thiá»‡u cÃ³ 2 scheme má»›i lÃ  ws:// vÃ  wss://</p><p>URL cÃ³ cáº¥u trÃºc ngá»¯ phÃ¡p cá»¥ thá»ƒ vá» scheme. WebSocket URL Ä‘áº·c biá»‡t vÃ¬ nÃ³ khÃ´ng há»— trá»£ nhÃ³m kÃ½ tá»± anchor (cÃ³ dáº¥u thÄƒng á»Ÿ trÆ°á»›c, vÃ­ dá»¥: #Ä‘Ã¢y_lÃ _anchor).</p><p>CÃ³ nhá»¯ng luáº­t chung Ä‘Æ°á»£c Ã¡p dá»¥ng cho cáº£ style cá»§a WebSocket URL vÃ  HTTP URL. ws khÃ´ng Ä‘Æ°á»£c mÃ£ hÃ³a, nÃ³ cÃ³ cá»•ng máº·c Ä‘á»‹nh lÃ  80 trong khi Ä‘Ã³ wss yÃªu cáº§u mÃ£ hÃ³a TLS vÃ  dÃ¹ng cá»•ng 443 máº·c Ä‘á»‹nh.</p><h1 id="Framing-protocol-Giao-thuc-framing"><a href="#Framing-protocol-Giao-thuc-framing" class="headerlink" title="Framing protocol (Giao thá»©c framing)"></a>Framing protocol (Giao thá»©c framing)</h1><p>CÃ¹ng Ä‘Ã o sÃ¢u má»™t chÃºt vá» framing protocol vá»›i nhá»¯ng gÃ¬ <a href="https://tools.ietf.org/html/rfc6455" target="_blank" rel="noopener">RFC</a> cung cáº¥p:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>                   <span class="number">1</span>                   <span class="number">2</span>                     <span class="number">3</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">+-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line">|F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line">|I|S|S|S|  (<span class="number">4</span>)  |A|     (<span class="number">7</span>)     |             (<span class="number">16</span>/<span class="number">64</span>)           |</span><br><span class="line">|N|V|V|V|       |S|             |   (<span class="keyword">if</span> payload len==<span class="number">126</span>/<span class="number">127</span>)   |</span><br><span class="line">| |<span class="number">1</span>|<span class="number">2</span>|<span class="number">3</span>|       |K|             |                               |</span><br><span class="line">+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line">|     Extended payload length continued, <span class="keyword">if</span> payload len == <span class="number">127</span>  |</span><br><span class="line">+ - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line">|                               |Masking-key, <span class="keyword">if</span> MASK set to <span class="number">1</span>  |</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">| Masking-key (continued)       |          Payload Data         |</span><br><span class="line">+-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line">:                     Payload Data continued ...                :</span><br><span class="line">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line">|                     Payload Data continued ...                |</span><br><span class="line">+---------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>Theo nhÆ° RFC Ä‘á»‹nh nghÄ© vá» WebSocket thÃ¬ nÃ³ chá»‰ cÃ³ duy nháº¥t má»™t header trÆ°á»›c má»—i gÃ³i tin, vÃ  nÃ³ khÃ¡ phá»©c táº¡p. ChÃºng ta cÃ¹ng tÃ¬m hiá»ƒu:</p><ul><li>fin (1 bit): biá»ƒu thá»‹ náº¿u frame Ä‘Ã³ lÃ  frame cuá»‘i cÃ¹ng táº¡o nÃªn message. Háº§u háº¿t message Ä‘á»u cÃ³ thá»ƒ chá»©a trong má»™t frame duy nháº¥t vÃ  bit nÃ y luÃ´n cÃ³ giÃ¡ trá»‹. Thá»±c nghiá»‡m cho tháº¥y Firefox táº¡o 1 frame thá»© 2 sau má»—i 32K.</li><li>rsv1, rsv2, rsv3 (Má»—i thá»© 1 bit): pháº£i báº±ng 0 trá»« khi cÃ³ má»™t <a href="https://tools.ietf.org/html/rfc6066" target="_blank" rel="noopener">extension</a> (Ä‘áº¡i khÃ¡i nhÆ° tiá»‡n Ã­ch má»Ÿ rá»™ng) Ä‘Æ°á»£c trao Ä‘á»•i vÃ  nÃ³ Ä‘á»‹nh nghÄ©a Ã½ nghÄ©a cho giÃ¡ trá»‹ khÃ¡c 0. Náº¿u nháº­n vá» má»™t giÃ¡ trá»‹ khÃ¡c 0 vÃ  khÃ´ng cÃ³ extension nÃ o xÃ¡c Ä‘á»‹nh Ã½ nghÄ©a cá»§a giÃ¡ trá»‹ khÃ¡c 0 Ä‘Ã³ Ä‘Æ°á»£c trao Ä‘á»•i thÃ¬ ngÆ°á»i nháº­n cuá»‘i sáº½ bá»‹ máº¥t káº¿t ná»‘i.</li><li>opcode (4 bit): nÃ³ cho biáº¿t nhá»¯ng gÃ¬ frame Ä‘áº¡i diá»‡n. CÃ³ nhá»¯ng giÃ¡ trá»‹ sau Ä‘Ã¢y Ä‘Æ°á»£c dÃ¹ng:<ul><li>0x00: frame nÃ y tiáº¿p tá»¥c payload tá»« frame trÆ°á»›c Ä‘Ã³.</li><li>0x01: frame nÃ y chá»©a dá»¯ liá»‡u chá»¯ (text).</li><li>0x02: frame nÃ y chá»©a dá»¯ liá»‡u nhá»‹ phÃ¢n (binary).</li><li>0x08: frame nÃ y há»§y káº¿t ná»‘i.</li><li>0x09: frame nÃ y lÃ  ping.</li><li>0x0a: frame nÃ y lÃ  pong.</li></ul></li></ul><p>(Báº¡n cÃ³ thá»ƒ tháº¥y ráº±ng cÃ³ nhiá»u giÃ¡ trá»‹ khÃ´ng sá»­ dá»¥ng, chÃºng Ä‘Æ°á»£c dá»± trá»¯ cho tÆ°Æ¡ng lai khi cáº§n)</p><ul><li>mask (1 bit): biá»ƒu thá»‹ náº¿u káº¿t ná»‘i Ä‘Ã£ Ä‘Æ°á»£c che Ä‘áº­y (mask). RÃµ rÃ ng lÃ  má»—i message tá»« client Ä‘áº¿n server <em>pháº£i Ä‘Æ°á»£c che Ä‘áº­y</em> vÃ  vá» máº·t ká»¹ thuáº­t thÃ¬ nÃ³ sáº½ há»§y káº¿t ná»‘i náº¿u khÃ´ng Ä‘Æ°á»£c che Ä‘áº­y.</li><li>payload_len (7 bit): Ä‘á»™ dÃ i cá»§a payload. WebSocket frame cÃ³ nhá»¯ng Ä‘á»™ dÃ i theo cÃ¡c khoáº£ng tÃ­nh theo byte nhÆ° sau:<ul><li>0-125 biá»ƒu thá»‹ Ä‘á»™ dÃ i cá»§a payload</li><li>Náº¿u lÃ  126 byte thÃ¬ 2 byte tiáº¿p theo biá»ƒu thá»‹ Ä‘á»™ dÃ i payload dÆ°á»›i dáº¡ng sá»‘ nguyÃªn 16bit khÃ´ng dáº¥u</li><li>Náº¿u lÃ  127 byte thÃ¬ 8 byte tiáº¿p theo biá»ƒu thá»‹ Ä‘á»™ dÃ i payload dÆ°á»›i dáº¡ng sá»‘ nguyÃªn 64bit khÃ´ng dáº¥u</li><li>Váº­y lÃ  Ä‘á»™ dÃ i payload sáº½ vÃ o khoáº£ng ~7bit, 16bit hoáº·c 64bit.</li></ul></li><li>masking-key (32 bit): táº¥t cáº£ frame Ä‘Æ°á»£c gá»­i tá»« client Ä‘áº¿n server sáº½ Ä‘Æ°á»£c che Ä‘áº­y (mask) báº±ng má»™t giÃ¡ trá»‹ 32bit Ä‘Ã­nh kÃ¨m trong frame.</li><li>payload: Dá»¯ liá»‡u tháº­t sá»± cáº§n Ä‘Æ°á»£c che Ä‘áº­y. Äá»™ dÃ i cá»§a nÃ³ chÃ­nh lÃ  payload_len</li></ul><p>Táº¡i sao WebSocket láº¡i dá»±a trÃªn frame (frame-based) mÃ  khÃ´ng dá»±a trÃªn dÃ²ng cháº£y (stream-based)? CÃ³ trá»i má»›i biáº¿t, tÃ¡c giáº£ cÅ©ng khÃ´ng biáº¿t vÃ¬ sao nÃªn náº¿u báº¡n cÃ³ thÃ´ng tin gÃ¬ vá» Ä‘iá»u nÃ y thÃ¬ cÃ³ thá»ƒ nháº¯n tin Ä‘áº¿n tÃ¡c giáº£. NgoÃ i ra thÃ¬ cÃ³ <a href="https://news.ycombinator.com/item?id=3377406" target="_blank" rel="noopener">má»™t topic tháº£o luáº­n ráº¥t tá»‘t vá» váº¥n Ä‘á» nÃ y trÃªn HackerNews</a>, báº¡n cÃ³ thá»ƒ tham kháº£o.</p><h1 id="Du-lieu-tren-frame"><a href="#Du-lieu-tren-frame" class="headerlink" title="Dá»¯ liá»‡u trÃªn frame"></a>Dá»¯ liá»‡u trÃªn frame</h1><p>NhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn, dá»¯ liá»‡u cÃ³ thá»ƒ phÃ¢n máº£nh thÃ nh nhiá»u frame. Frame Ä‘áº§u tiÃªn chuyá»ƒn giao dá»¯ liá»‡u cÃ³ má»™t opcode biá»ƒu thá»‹ kiá»ƒu dá»¯ liá»‡u Ä‘ang Ä‘Æ°á»£c truyá»n. Äiá»u nÃ y cáº§n thiáº¿t bá»Ÿi vÃ¬ Javascript háº§u nhÆ° khÃ´ng cÃ³ há»— trá»£ cho kiá»ƒu dá»¯ liá»‡u nhá»‹ phÃ¢n (binary) khi nÃ³ Ä‘Æ°á»£c xÃ¢y dá»±ng. 0x01 biá»ƒu thá»‹ kiá»ƒu encode vÄƒn báº£n UTF-8, 0x02 lÃ  dá»¯ liá»‡u nhá»‹ phÃ¢n. Äa sá»‘ má»i ngÆ°á»i sáº½ chuyá»ƒn giao JSON trong trÆ°á»ng há»£p báº¡n muá»‘n chá»n opcode vÄƒn báº£n. Khi báº¡n phÃ¡t tÃ­n hiá»‡u (emit) dá»¯ liá»‡u nhá»‹ phÃ¢n nÃ³ sáº½ Ä‘Æ°á»£c thá»ƒ hiá»‡n trÃªn trÃ¬nh duyá»‡t dÆ°á»›i dáº¡ng cá»¥ thá»ƒ lÃ  <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" target="_blank" rel="noopener">Blob</a>.</p><p>API Ä‘á»ƒ gá»­i dá»¯ liá»‡u thÃ´ng qua WebSocket khÃ¡ Ä‘Æ¡n giáº£n:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://websocket.example.com'</span>);</span><br><span class="line">socket.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  socket.send(<span class="string">'Some message'</span>); <span class="comment">// Gá»­i dá»¯ liá»‡u Ä‘áº¿n server.</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Khi WebSocket nháº­n dá»¯ liá»‡u (á»Ÿ phÃ­a client), má»™t sá»± kiá»‡n message Ä‘Æ°á»£c báº¯n ra. Sá»± kiá»‡n nÃ y bao gá»“m má»™t thuá»™c tÃ­nh gá»i lÃ  data cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ truy cáº­p ná»™i dung cá»§a message.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Xá»­ lÃ½ message gá»­i Ä‘i tá»« server.</span></span><br><span class="line">socket.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> message = event.data;</span><br><span class="line">  <span class="built_in">console</span>.log(message);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Báº¡n cÃ³ thá»ƒ khÃ¡m phÃ¡ dá»¯ liá»‡u má»™t cÃ¡ch dá»… dÃ ng trong má»—i frame trong káº¿t ná»‘i WebSocket sá»­ dá»¥ng tab Network trong Chrome DevTools:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*Sz4wI2ukt91vRrgf8UonWw.png" alt=""></p><h1 id="Su-phan-manh"><a href="#Su-phan-manh" class="headerlink" title="Sá»± phÃ¢n máº£nh"></a>Sá»± phÃ¢n máº£nh</h1><p>Dá»¯ liá»‡u payload cÃ³ thá»ƒ Ä‘Æ°á»£c chia thÃ nh nhiá»u frame riÃªng. NÆ¡i nháº­n cÃ³ nhiá»‡m vá»¥ lÆ°u Ä‘á»‡m chÃºng cho Ä‘áº¿n khi bit fin Ä‘Æ°á»£c set. Tháº¿ nÃªn báº¡n cÃ³ thá»ƒ chuyá»ƒn 1 chuá»—i â€œHello Worldâ€ trong 11 gÃ³i tin cá»§a 6 (Ä‘á»™ dÃ i header) + 1 byte cho má»—i gÃ³i. Sá»± phÃ¢n máº£nh khÃ´ng Ä‘Æ°á»£c cháº¥p nháº­n cho gÃ³i tin Ä‘iá»u khiá»ƒn (control packages). Tuy nhiÃªn, Ä‘áº·c Ä‘iá»ƒm ká»¹ thuáº­t muá»‘n báº¡n cÃ³ thá»ƒ xá»­ lÃ½ nhá»¯ng frame Ä‘iá»u khiá»ƒn xen káº½ nhau. ÄÃ³ lÃ  trÆ°á»ng há»£p gÃ³i tin TCP nháº­n Ä‘Æ°á»£c cÃ³ thá»© tá»± lá»™n xá»™n.</p><p>Logic Ä‘á»ƒ káº¿t ná»‘i frame Ä‘Æ°á»£c mÃ´ táº£ sÆ¡ lÆ°á»£c nhÆ° sau:</p><ul><li>Nháº­n frame Ä‘áº§u tiÃªn</li><li>Ghi nhá»› opcode</li><li>Ná»‘i cÃ¡c frame payload láº¡i vá»›i nhau cho Ä‘áº¿n khi bit fin Ä‘Æ°á»£c set.</li><li>Giáº£ Ä‘á»‹nh ráº±ng opcode cho má»—i gÃ³i tin lÃ  0</li></ul><p>Má»¥c Ä‘Ã­ch chÃ­nh cá»§a sá»± phÃ¢n máº£nh lÃ  cho phÃ©p gá»­i message khi khÃ´ng biáº¿t rÃµ kÃ­ch thÆ°á»›c ban Ä‘áº§u cá»§a message. Vá»›i sá»± phÃ¢n máº£nh, server cÃ³ thá»ƒ chá»n má»™t kÃ­ch thÆ°á»›c buffer (bá»™ Ä‘á»‡m) phÃ¹ há»£p vÃ  khi buffer Ä‘áº§y thÃ¬ ghi máº£nh (fragment) Ä‘Ã³ vÃ o network. TrÆ°á»ng há»£p sá»­ dá»¥ng phá»¥ cá»§a sá»± phÃ¢n máº£nh lÃ  truyá»n tin Ä‘a luá»“ng (multiplexing), vá»‘n dÄ© khÃ´ng cáº§n má»™t message lá»›n trÃªn má»™t kÃªnh logic Ä‘á»ƒ tiáº¿p nháº­n toÃ n bá»™ kÃªnh Ä‘áº§u ra, vÃ¬ tháº¿ multiplexing cáº§n pháº£i giáº£i phÃ³ng Ä‘á»ƒ cáº¯t message ra thÃ nh nhiá»u máº£nh Ä‘á»ƒ cÃ³ thá»ƒ chia sáº» Ä‘áº¿n kÃªnh Ä‘áº§u ra tá»‘t hÆ¡n.</p><h1 id="Heartbeating-nhip-tim-la-gi"><a href="#Heartbeating-nhip-tim-la-gi" class="headerlink" title="Heartbeating (nhá»‹p tim) lÃ  gÃ¬ ?"></a>Heartbeating (nhá»‹p tim) lÃ  gÃ¬ ?</h1><p>Táº¡i má»™t thá»i Ä‘iá»ƒm sau khi â€œbáº¯t tayâ€ (handshake), cáº£ client vÃ  server cÃ³ thá»ƒ lá»±a chá»n Ä‘á»ƒ gá»­i Ä‘i má»™t ping Ä‘áº¿n phÃ­a kia. Khi ping Ä‘Æ°á»£c nháº­n, ngÆ°á»i nháº­n pháº£i gá»­i ngÆ°á»£c láº¡i má»™t pong ngay khi cÃ³ thá»ƒ. ÄÃ³ gá»i lÃ  heartbeat (nhá»‹p tim Ä‘áº­p). Báº¡n cÃ³ thá»ƒ dÃ¹ng nÃ³ Ä‘á»ƒ Ä‘áº£m báº£o client váº«n Ä‘ang Ä‘Æ°á»£c káº¿t ná»‘i.</p><p>Má»™t ping hay pong chá»‰ lÃ  frame bÃ¬nh thÆ°á»ng, khÃ´ng pháº£i frame Ä‘iá»u khiá»ƒn. Ping cÃ³ opcode lÃ  0x9 vÃ  opcode cá»§a pong lÃ  0xA. Khi báº¡n nháº­n Ä‘Æ°á»£c ping, gá»­i ngÆ°á»£c láº¡i pong vá»›i chÃ­nh xÃ¡c cÃ¹ng dá»¯ liá»‡u Payload nhÆ° ping (vá»›i ping vÃ  pong thÃ¬ Ä‘á»™ dÃ i payload tá»‘i Ä‘a lÃ  125). Báº¡n cÅ©ng cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c pong mÃ  chÆ°a tá»«ng gá»­i ping. Náº¿u nÃ³ xáº£y ra thÃ¬ bá» qua, quÃªn nÃ³ Ä‘i.</p><p>Heartbeat cÃ³ thá»ƒ ráº¥t cÃ³ Ã­ch. CÃ³ nhiá»u dá»‹ch vá»¥ (cháº³ng háº¡n nhÆ° bá»™ cÃ¢n báº±ng táº£i - load balancer) sáº½ há»§y nhá»¯ng káº¿t ná»‘i Ä‘á»©ng yÃªn (idle). ThÃªm ná»¯a, bÃªn nháº­n khÃ´ng thá»ƒ biáº¿t náº¿u bÃªn kia (bÃªn gá»­i) Ä‘Ã£ bá»‹ káº¿t thÃºc hay chÆ°a. Chá»‰ cÃ³ Ä‘áº¿n láº§n gá»­i thÃ´ng tin tiáº¿p theo ta má»›i nháº­n ra cÃ³ gÃ¬ Ä‘Ã³ khÃ´ng á»•n.</p><h1 id="Xu-ly-loi"><a href="#Xu-ly-loi" class="headerlink" title="Xá»­ lÃ½ lá»—i"></a>Xá»­ lÃ½ lá»—i</h1><p>Báº¡n cÃ³ thá»ƒ xá»­ lÃ½ bao nhiÃªu lá»—i xáº£y ra cÅ©ng Ä‘Æ°á»£c báº±ng cÃ¡ch listen Ä‘áº¿n sá»± kiá»‡n error.<br>VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://websocket.example.com'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Xá»­ lÃ½ lá»—i xáº£y ra.</span></span><br><span class="line">socket.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'WebSocket Error: '</span> + error);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="Dong-ket-noi"><a href="#Dong-ket-noi" class="headerlink" title="ÄÃ³ng káº¿t ná»‘i"></a>ÄÃ³ng káº¿t ná»‘i</h1><p>Äá»ƒ Ä‘Ã³ng káº¿t ná»•i thÃ¬ client hoáº·c server pháº£i gá»­i má»™t frame Ä‘iá»u khiá»ƒn vá»›i dá»¯ liá»‡u chá»©a opcode 0x8. Ngay khi nháº­n Ä‘Æ°á»£c frame Ä‘Ã³ thÃ¬ bÃªn nháº­n sáº½ gá»­i tráº£ má»™t frame Ä‘Ã³ng (close). BÃªn gá»­i sáº½ Ä‘Ã³ng káº¿t ná»‘i. Báº¥t ká»³ thÃ´ng tin nÃ o nháº­n Ä‘Æ°á»£c sau khi Ä‘Ã³ng káº¿t ná»‘i Ä‘á»u bá»‹ vá»©t bá».</p><p>ÄÃ¢y lÃ  cÃ¡ch báº¡n khá»Ÿi táº¡o quÃ¡ trÃ¬nh Ä‘Ã³ng káº¿t ná»‘i WebSocket tá»« client:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ÄÃ³ng náº¿u káº¿t ná»‘i Ä‘ang Ä‘Æ°á»£c má»Ÿ.</span></span><br><span class="line"><span class="keyword">if</span> (socket.readyState === WebSocket.OPEN) &#123;</span><br><span class="line">    socket.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Äá»ƒ thá»±c hiá»‡n dá»n dáº¹p sau khi Ä‘Ã³ng káº¿t ná»‘i thÃ nh cÃ´ng, báº¡n cÃ³ thá»ƒ thÃªm má»™t event listener vÃ o sá»± kiá»‡n close:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dá»n dáº¹p nhá»¯ng thá»© cáº§n thiáº¿t.</span></span><br><span class="line">socket.onclose = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Disconnected from WebSocket.'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Server láº¯ng nghe sá»± kiá»‡n close Ä‘á»ƒ xá»­ lÃ½ náº¿u cáº§n:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">connection.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">reasonCode, description</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Káº¿t ná»‘i Ä‘ang bá»‹ Ä‘Ã³ng.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="So-sanh-WebSockets-va-HTTP-2"><a href="#So-sanh-WebSockets-va-HTTP-2" class="headerlink" title="So sÃ¡nh WebSockets vÃ  HTTP/2"></a>So sÃ¡nh WebSockets vÃ  HTTP/2</h1><p>Trong khi HTTP/2 cung cáº¥p nhiá»u thá»©, nÃ³ láº¡i khÃ´ng hoÃ n toÃ n thay tháº¿ sá»± cáº§n thiáº¿t cho cÃ¡c cÃ´ng nghá»‡ push/streaming hiá»‡n cÃ³.</p><p>Äiá»u quan trá»ng Ä‘áº§u tiÃªn vá» HTTP/2 mÃ  ta cáº§n chÃº Ã½ lÃ  nÃ³ khÃ´ng pháº£i lÃ  má»™t thay tháº¿ cho táº¥t cáº£ HTTP. Nhá»¯ng Ä‘á»™ng tá»«, mÃ£ status vÃ  Ä‘a sá»‘ cÃ¡c loáº¡i header sáº½ váº«n nhÆ° cÅ©. HTTP/2 hÆ°á»›ng Ä‘áº¿n cáº£i thiá»‡n sá»± hiá»‡u quáº£ trong cÃ¡ch mÃ  dá»¯ liá»‡u truyá»n trÃªn Ä‘Æ°á»ng dÃ¢y.</p><p>Giá» náº¿u so sÃ¡nh HTTP/2 vá»›i WebSocket thÃ¬ ta cÃ³ nhiá»u thá»© tÆ°Æ¡ng Ä‘á»“ng:</p><table><thead><tr><th></th><th>HTTP/2</th><th>WebSocket</th></tr></thead><tbody><tr><td>Headers</td><td>ÄÆ°á»£c nÃ©n (HPACK)</td><td>KhÃ´ng nÃ©n</td></tr><tr><td>Binary</td><td>CÃ³</td><td>Nhá»‹ PhÃ¢n hoáº·c VÄƒn Báº£n</td></tr><tr><td>Multiplexing</td><td>CÃ³</td><td>CÃ³</td></tr><tr><td>Sá»± Æ°u tiÃªn</td><td>CÃ³</td><td>KhÃ´ng</td></tr><tr><td>NÃ©n</td><td>CÃ³</td><td>CÃ³</td></tr><tr><td>Äinh hÆ°á»›ng</td><td>Client/Server hoáº·c lÃ  Server Push</td><td>2 chiá»u</td></tr><tr><td>Full-duplex</td><td>CÃ³</td><td>CÃ³</td></tr></tbody></table><p>NhÆ° Ä‘Ã£ tháº¥y á»Ÿ trÃªn, HTTP/2 giá»›i thiá»‡u tÃ­nh nÄƒng <a href="https://en.wikipedia.org/wiki/Push_technology?oldformat=true" target="_blank" rel="noopener">Server Push</a> Ä‘á»ƒ cho phÃ©p server gá»­i tÃ i nguyÃªn má»™t cÃ¡ch chá»§ Ä‘á»™ng Ä‘áº¿n bá»™ Ä‘á»‡m phÃ­a client. Tuy nhiÃªn, nÃ³ khÃ´ng cho phÃ©p tá»± Ã½ push dá»¯ liá»‡u xuá»‘ng client. Server push chá»‰ Ä‘Æ°á»£c xá»­ lÃ½ báº±ng browser vÃ  khÃ´ng Ä‘Æ°á»£c báº­t trong code cá»§a á»©ng dá»¥ng, nghÄ©a lÃ  khÃ´ng cÃ³ API cho app Ä‘á»ƒ get thÃ´ng bÃ¡o tá»« nhá»¯ng sá»± kiá»‡n nhÆ° tháº¿ nÃ y.</p><p>ÄÃ¢y lÃ  nÆ¡i Sá»± kiá»‡n server gá»­i thÃ´ng tin (Server-Sent Events - SSE) trá»Ÿ nÃªn ráº¥t cÃ³ Ã­ch. SSE lÃ  1 cÆ¡ cháº¿ cho phÃ©p server push dá»¯ liá»‡u báº¥t Ä‘á»“ng bá»™ vá» client má»™t khi káº¿t ná»‘i client-server Ä‘Æ°á»£c thiáº¿t láº­p. Server cÃ³ thá»ƒ lá»±a chá»n Ä‘á»ƒ gá»­i dá»¯ liá»‡u khi nÃ o má»™t â€œcá»¥câ€ dá»¯ liá»‡u má»›i Ä‘Ã£ sáºµn sÃ ng. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c cÃ¢n nháº¯c nhÆ° lÃ  mÃ´ hÃ¬nh Ä‘Äƒng kÃ½-xuáº¥t báº£n (<a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" target="_blank" rel="noopener">publish-subscribe</a>) 1 chiá»u. NÃ³ cÅ©ng cung cáº¥p má»™t chuáº©n Javascript client API tÃªn lÃ  EventSource Ä‘Æ°á»£c triá»ƒn khai trong Ä‘a sá»‘ cÃ¡c trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i nhÆ° lÃ  1 pháº§n cá»§a tiÃªu chuáº©n HTML5 bá»Ÿi <a href="https://www.w3.org/TR/eventsource/" target="_blank" rel="noopener">W3C</a>. ChÃº Ã½ ráº±ng trÃ¬nh duyá»‡t khÃ´ng há»— trá»£ <a href="http://caniuse.com/#feat=eventsource" target="_blank" rel="noopener">EventSource API</a> cÅ©ng cÃ³ thá»ƒ dá»… dÃ ng polyfill.</p><p>Bá»Ÿi vÃ¬ SSE dá»±a trÃªn HTTP, nÃ³ cÃ³ thá»ƒ phÃ¹ há»£p vá»›i HTTP/2 vÃ  cÃ³ thá»ƒ káº¿t há»£p Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c sá»± tá»‘t nháº¥t cá»§a cáº£ 2 bÃªn: HTTP/2 xá»­ lÃ½ táº§ng giao váº­n (transport layer) hiá»‡u quáº£ dá»±a trÃªn cÃ¡c luá»“ng multiplex vÃ  SSE cung cáº¥p API cho app Ä‘á»ƒ thá»±c hiá»‡n push.</p><p>Äá»ƒ hiá»ƒu hoÃ n toÃ n vá» Stream vÃ  Multiplexing, Ä‘áº§u tiÃªn ta cáº§n biáº¿t sÆ¡ lÆ°á»£c vá» Ä‘á»‹nh nghÄ©a táº¡i IETF: <em>má»™t â€œstreamâ€ lÃ  chuá»—i tuáº§n tá»± 2 chiá»u vÃ  Ä‘á»™c láº­p cá»§a nhiá»u frame Ä‘Æ°á»£c trao Ä‘á»•i giá»¯a client vÃ  server trong má»™t káº¿t ná»‘i HTTP/2. Má»™ trong sá»‘ nhá»¯ng Ä‘áº·c tÃ­nh chÃ­nh cá»§a nÃ³ lÃ  má»™t káº¿t ná»‘i HTTP/2 cÃ³ thá»ƒ chá»©a Ä‘á»“ng thá»i nhiá»u stream Ä‘ang má»Ÿ vá»›i frame endpoint xen káº½ tá»« nhiá»u stream.</em></p><p><img src="https://cdn-images-1.medium.com/max/1000/1*pSh7IORJoUXbwCjyJ7fM9A.png" alt=""></p><p>Pháº£i nhá»› ráº±ng SSE lÃ  dá»±a trÃªn HTTP. NghÄ©a lÃ  vá»›i HTTP/2, khÃ´ng chá»‰ nhiá»u stream SSE Ä‘Æ°á»£c xen káº½ trÃªn má»™t káº¿t ná»‘i TCP mÃ  cÅ©ng cÆ¡ cháº¿ Ä‘Ã³ cÃ³ thá»ƒ thá»±c hiá»‡n vá»›i sá»± káº¿t há»£p cá»§a nhiá»u stream SSE (push tá»« server Ä‘áº¿n client) vÃ  nhiá»u client request (client Ä‘áº¿n server). Nhá» Æ¡n HTTP/2 vÃ  SSE mÃ  giá» Ä‘Ã¢y chÃºng ta Ä‘Ã£ cÃ³ má»™t káº¿t ná»‘i HTTP 2 chiá»u thuáº§n tÃºy vá»›i API Ä‘Æ¡n giáº£n Ä‘á»ƒ code á»©ng dá»¥ng cÃ³ thá»ƒ Ä‘Äƒng kÃ½ cho server push. Thiáº¿u Ä‘i kháº£ nÄƒng giao tiáº¿p 2 chiá»u thÆ°á»ng Ä‘Æ°á»£c xem nhÆ° lÃ  má»™t bÆ°á»›c cáº£i lÃ¹i khi so sÃ¡nh SSE vá»›i WebSocket. Cáº£m Æ¡n HTTP/2, nhá» nÃ³ mÃ  Ä‘iá»u nÃ y khÃ´ng cÃ²n lÃ  váº§n Ä‘á» ná»¯a. ThÃªm ná»¯a lÃ  nÃ³ má»Ÿ ra cÆ¡ há»™i Ä‘á»ƒ bá» qua WebSocket vÃ  táº­p trung vÃ o nhá»¯ng cÃ´ng nghá»‡ thay tháº¿ dá»±a trÃªn HTTP.</p><h1 id="Lam-the-nao-de-chon-giua-WebSocket-amp-HTTP-2"><a href="#Lam-the-nao-de-chon-giua-WebSocket-amp-HTTP-2" class="headerlink" title="LÃ m tháº¿ nÃ o Ä‘á»ƒ chá»n giá»¯a WebSocket &amp; HTTP/2?"></a>LÃ m tháº¿ nÃ o Ä‘á»ƒ chá»n giá»¯a WebSocket &amp; HTTP/2?</h1><p>WebSocket cháº¯c cháº¯n sáº½ tá»“n táº¡i trong sá»± thá»‘ng trá»‹ cá»§a HTTP/2 + SSE, chá»§ yáº¿u bá»Ÿi vÃ¬ nÃ³ lÃ  cÃ´ng nghá»‡ Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã³n nháº­n vÃ  trong nhiá»u trÆ°á»ng há»£p cá»¥ thá»ƒ nÃ³ cÃ³ sá»± vÆ°á»£t trá»™i so vá»›i HTTP/2 nhÆ° cÃ¡ch nÃ³ Ä‘Æ°á»£c xÃ¢y dá»±ng cho kháº£ nÄƒng giao tiáº¿p 2 chiá»u vá»›i Ã­t chi phÃ­ tá»‘n kÃ©m (vÃ­ dá»¥: headers).</p><p>Giáº£ sá»­ báº¡n muá»‘n xÃ¢y dá»±ng game MMO (Massive Multiplayer Online: Game nhiá»u ngÆ°á»i chÆ¡i trá»±c tuyáº¿n) cáº§n má»™t lÆ°á»£ng khá»•ng lá»“ message tá»« cáº£ 2 Ä‘áº§u káº¿t ná»‘i. Trong nhá»¯ng trÆ°á»ng há»£p nhÆ° tháº¿ thÃ¬ WebSocket thá»ƒ hiá»‡n ráº¥t ráº¥t tá»‘t.</p><p>Tá»•ng quÃ¡t thÃ¬ sá»­ dá»¥ng WebSocket khi nÃ o báº¡n cáº§n má»™t káº¿t ná»‘i vá»›i Ä‘á»™ trá»… ráº¥t tháº¥p, gáº§n nhÆ° lÃ  realtime giá»¯a client &amp; server. Nhá»› ká»¹ ráº±ng viá»‡c nÃ y cÃ³ thá»ƒ yÃªu cáº§u báº¡n cÃ¢n nháº¯c láº¡i cÃ¡ch xÃ¢y dá»±ng á»©ng dá»¥ng server-side cá»§a báº¡n, cÅ©ng nhÆ° chuyá»ƒn sang táº­p trung vÃ o nhá»¯ng cÃ´ng nghá»‡ nhÆ° event queue.</p><p>Náº¿u trÆ°á»ng há»£p cá»§a báº¡n cáº§n hiá»ƒn thá»‹ tin tá»©c thá»‹ trÆ°á»ng, dá»¯ liá»‡u thá»‹ trÆ°á»ng, á»©ng dá»¥ng chatâ€¦ theo thá»i gian thá»±c, sá»­ dá»¥ng HTTP/2 + SSE sáº½ cung cáº¥p cho báº¡n kÃªnh giao tiáº¿p 2 chiá»u hiá»‡u quáº£ trong khi gáº·t hÃ¡i nhiá»u lá»£i Ã­ch khi hoáº¡t Ä‘á»™ng trong tháº¿ giá»›i cá»§a HTTP:</p><ul><li>WebSocket thÆ°á»ng gÃ¢y ra khÃ³ khÄƒn khi cÃ¢n nháº¯c sá»± tÆ°Æ¡ng thÃ­ch vá»›i háº¡ táº§ng web hiá»‡n táº¡i cÅ©ng nhÆ° nÃ³ nÃ¢ng cáº¥p káº¿t ná»‘i HTTP Ä‘áº¿n má»™t giao thá»©c hoÃ n toÃ n khÃ¡c mÃ  khÃ´ng cÃ³ gÃ¬ dÃ­nh dÃ¡ng tá»›i HTTP.</li><li>Má»Ÿ rá»™ng vÃ  báº£o máº­t: nhá»¯ng thÃ nh pháº§n cá»§a web (firewall, phÃ¡t hiá»‡n xÃ¢m nháº­p, cÃ¢n báº±ng táº£i) Ä‘Æ°á»£c xÃ¢y dá»±ng, báº£o trÃ¬ vÃ  thiáº¿t Ä‘áº·t vá»›i tÆ° tÆ°á»Ÿng cá»§a HTTP, má»™t mÃ´i trÆ°á»ng cho á»©ng dá»¥ng lá»›n vÃ  nghiÃªm ngáº·t sáº½ Æ°u tiÃªn kháº£ nÄƒng phá»¥c há»“i, báº£o váº­t vÃ  kháº£ nÄƒng má»Ÿ rá»™ng.</li></ul><p>Báº¡n cÅ©ng cáº§n pháº£i cÃ¢n nháº¯c vá» váº¥n Ä‘á» há»— trá»£ cá»§a trÃ¬nh duyá»‡t:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*YFr59cEF2qxzjjleebvbcQ.png" alt=""></p><p>KhÃ¡ tá»‘t pháº£i khÃ´ng nÃ o?</p><p>NhÆ°ng vá»›i HTTP/2 thÃ¬ khÃ´ng háº³n:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*C1VWSKOx89vqdiSiflDRJw.png" alt=""></p><ul><li>Chá»‰ cÃ³ TLS (CÅ©ng khÃ´ng tá»‡ láº¯m)</li><li>Há»— trá»£ má»™t pháº§n cho IE11 nhÆ°ng chá»‰ trÃªn Windows 10</li><li>Chá»‰ há»— trá»£ OSX 10.11 trá»Ÿ lÃªn trÃªn Safari</li><li>Chá»‰ há»— trá»£ HTTP/2 náº¿u báº¡n cÃ³ thá»ƒ Ä‘iá»u hÆ°á»›ng nÃ³ qua APLN (server cá»§a báº¡n cÅ©ng cáº§n pháº£i há»— trá»£ nÃ³ rÃµ rÃ ng)</li></ul><p>Há»— trá»£ SSE thÃ¬ tá»‘t hÆ¡n má»™t chÃºt:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*9ryMUEZhtbTg7lECHVz0fw.png" alt=""></p><p>Chá»‰ cÃ³ IE/Edge lÃ  khÃ´ng há»— trá»£ (Opera Mini cÅ©ng tháº¿). Váº«n cÃ³ nhá»¯ng polyfill khÃ¡ tá»‘t Ä‘á»ƒ giÃºp chÃºng ta lÃ m viÃªc vá»›i SSE trÃªn IE/Edge.</p><h1 id="SessionStack-lua-chon-nhu-the-nao"><a href="#SessionStack-lua-chon-nhu-the-nao" class="headerlink" title="SessionStack lá»±a chá»n nhÆ° tháº¿ nÃ o?"></a>SessionStack lá»±a chá»n nhÆ° tháº¿ nÃ o?</h1><p>Team SessionStack sá»­ dá»¥ng cáº£ 2 WebSocket vÃ  HTTP, tÃ¹y thuá»™c vÃ o tá»«ng trÆ°á»ng há»£p. Má»™t khi báº¡n Ä‘Ã£ tÃ­ch há»£p SessionStack vÃ o web app cá»§a báº¡n, nÃ³ sáº½ ghi láº¡i má»i thá»© diá»…n ra trÃªn app/website: nhá»¯ng thay Ä‘á»•i trÃªn DOM, tÆ°Æ¡ng tÃ¡c cá»§a ngÆ°á»i dÃ¹ng, JS exception, stack trace, nhá»¯ng request bá»‹ fail vÃ  cáº£ thÃ´ng bÃ¡o debug, cho phÃ©p báº¡n cháº¡y láº¡i (replay) nhá»¯ng issue Ä‘Ã£ xáº£y ra dÆ°á»›i dáº¡ng video vÃ  xem chÃºng diá»…n ra nhÆ° tháº¿ nÃ o vá»›i ngÆ°á»i dÃ¹ng. Táº¥t cáº£ Ä‘á»u hoáº¡t Ä‘á»™ng theo thá»i gian thá»±c (real-time) vÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u nÄƒng cá»§a webapp.</p><p>Äiá»u Ä‘Ã³ nghÄ©a lÃ  báº¡n cÃ³ thá»ƒ tham gia vÃ o má»™t phiÃªn lÃ m viá»‡c cá»§a user, trong khi user Ä‘ang hoáº¡t Ä‘á»™ng trÃªn trÃ¬nh duyá»‡t. Trong trÆ°á»ng há»£p nÃ y, team tÃ¡c giáº£ chá»n sá»­ dá»¥ng HTTP bá»Ÿi vÃ¬ khÃ´ng cáº§n giao tiáº¿p 2 chiá»u (server chá»‰ cáº§n stream dá»¯ liá»‡u Ä‘áº¿n trÃ¬nh duyá»‡t). Náº¿u dÃ¹ng WebSocket á»Ÿ Ä‘Ã¢y thÃ¬ sáº½ ráº¥t tá»‡, cÃ ng khÃ³ Ä‘á»ƒ báº£o trÃ¬ vÃ  má»Ÿ rá»™ng.</p><p>Tuy nhiÃªn, thÆ° viá»‡n SessionStack tÃ­ch há»£p vÃ o trong webapp cá»§a báº¡n sá»­ dá»¥ng WebSocket (náº¿u cÃ³ thá»ƒ, cÃ²n khÃ´ng thÃ¬ HTTP). NÃ³ sáº¯p xáº¿p vÃ  gá»­i dá»¯ liá»‡u vá» server vÃ  cÅ©ng lÃ  giao tiáº¿p 1 chiá»u. Team tÃ¡c giáº£ chá»n WebSocket vÃ¬ trong trÆ°á»ng há»£p nÃ y vÃ i tÃ­nh nÄƒng cáº§n thiáº¿t sá»­ dá»¥ng giao tiáº¿p 2 chiá»u.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 5 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;Trong pháº§n nÃ y chÃºng ta sáº½ Ä‘Ã o sÃ¢u vá»›i tháº¿ giá»›i cá»§a nhá»¯ng giao thá»©c giao tiáº¿p, Ã¡nh xáº¡ (mapping) vÃ  tháº£o luáº­n vá» nhá»¯ng thuá»™c tÃ­nh cÅ©ng nhÆ° thÃ nh pháº§n cá»§a chÃºng. ChÃºng ta sáº½ Ä‘Æ°a ra 1 so sÃ¡nh nhá» giá»¯a WebSockets vÃ  HTTP/s. Cuá»‘i cÃ¹ng, team SessionStack sáº½ chia sáº» má»™t vÃ i Ã½ tÆ°á»Ÿng vá» viá»‡c lá»±a chá»n phÆ°Æ¡ng thá»©c nÃ o cho phÃ¹ há»£p vá»›i giao thá»©c máº¡ng.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P4: Event loop, láº­p trÃ¬nh báº¥t Ä‘á»“ng bá»™ &amp; 5 máº¹o cáº£i thiá»‡n Async/Await</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P4-Event-loop-lap-trinh-bat-dong-bo-5-meo-cai-thien-Async-Await.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P4-Event-loop-lap-trinh-bat-dong-bo-5-meo-cai-thien-Async-Await.html</id>
    <published>2018-11-13T16:34:00.000Z</published>
    <updated>2018-11-13T16:39:26.827Z</updated>
    
    <content type="html"><![CDATA[<p>ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 4 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.</p><p>Láº§n nÃ y chÃºng ta sáº½ má»Ÿ rá»™ng nhá»¯ng gÃ¬ cÃ³ trong bÃ i Ä‘áº§u tiÃªn báº±ng cÃ¡ch Ä‘Ã¡nh giÃ¡ nhá»¯ng nhÆ°á»£c Ä‘iá»ƒm cá»§a mÃ´i trÆ°á»ng Ä‘Æ¡n luá»“ng (single thread) vÃ  lÃ m tháº¿ nÃ o Ä‘á»ƒ vÆ°á»£t qua chÃºng nháº±m xÃ¢y dá»±ng nhá»¯ng Javascript UI áº¥n tÆ°á»£ng. VÃ  váº«n nhÆ° cÅ©, cuá»‘i bÃ i viáº¿t tÃ¡c giáº£ sáº½ chia sáº» 5 máº¹o nhá» Ä‘á»ƒ viáº¿t code tá»‘t hÆ¡n vá»›i async/await.<br><a id="more"></a></p><h1 id="Tai-sao-don-luong-lai-la-gioi-han"><a href="#Tai-sao-don-luong-lai-la-gioi-han" class="headerlink" title="Táº¡i sao Ä‘Æ¡n luá»“ng láº¡i lÃ  giá»›i háº¡n."></a>Táº¡i sao Ä‘Æ¡n luá»“ng láº¡i lÃ  giá»›i háº¡n.</h1><p>Trong bÃ i Ä‘áº§u tiÃªn cá»§a series, chÃºng ta suy ngáº«m vá» cÃ¢u há»i Ä‘iá»u gÃ¬ xáº£y ra khi chÃºng ta cÃ³ 1 hÃ m trong callstack vÃ  hÃ m Ä‘Ã³ láº¡i ngá»‘n quÃ¡ nhiá»u thá»i gian Ä‘á»ƒ thá»±c thi.</p><p>HÃ£y tÆ°á»Ÿng tÆ°á»£ng, ta thá»±c hiá»‡n má»™t thuáº­t toÃ¡n chuyá»ƒn Ä‘á»•i hÃ¬nh áº£nh phá»©c táº¡p cháº¡y trÃªn browser.</p><p>Trong khi callstack Ä‘ang thá»±c thi cÃ¡c hÃ m, trÃ¬nh duyá»‡t láº¡i khÃ´ng thá»ƒ lÃ m gÃ¬ cáº£, nÃ³ bá»‹ káº¹t. NghÄ©a lÃ  trÃ¬nh duyá»‡t khÃ´ng thá»ƒ váº½, render, nÃ³ khÃ´ng thá»ƒ cháº¡y code khÃ¡c, chá»‰ Ä‘Æ¡n giáº£n lÃ  káº¹t. VÃ  váº¥n Ä‘á» lÃ  á»Ÿ Ä‘Ã¢y, giao diá»‡n (UI) cá»§a app báº¡n sáº½ hoáº¡t Ä‘á»™ng khÃ´ng hiá»‡u quáº£.</p><p>App cá»§a báº¡n bá»‹ káº¹t.</p><p>Trong má»™t vÃ i trÆ°á»ng há»£p thÃ¬ Ä‘Ã¢y khÃ´ng pháº£i váº¥n Ä‘á» nghiÃªm trá»ng. Tuy nhiÃªn, cÃ³ váº¥n Ä‘á» cÃ²n lá»›n hÆ¡n ná»¯a. Má»™t khi trÃ¬nh duyá»‡t cá»§a báº¡n xá»­ lÃ½ quÃ¡ nhiá»u thá»© trong callstack, nÃ³ sáº½ bá»‹ â€œÄ‘á»¡â€ trong 1 khoáº£ng thá»i gian dÃ i. Táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³, Ä‘a sá»‘ cÃ¡c browser sáº½ chá»n giáº£i phÃ¡p hiá»‡n lá»—i, há»i ngÆ°á»i dÃ¹ng cÃ³ muá»‘n há»§y trang hiá»‡n táº¡i khÃ´ng.</p><p>Äiá»u nÃ y tháº­t lÃ  xáº¥u xÃ­ vÃ  áº£nh hÆ°á»Ÿng nghiÃªm trá»ng Ä‘áº¿n tráº£i nghiá»‡m (UX):</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*MCt4ZC0dMVhJsgo1u6lpYw.jpeg" alt=""></p><h1 id="Nhung-thanh-phan-xay-dung-nen-1-chuong-trinh-JS"><a href="#Nhung-thanh-phan-xay-dung-nen-1-chuong-trinh-JS" class="headerlink" title="Nhá»¯ng thÃ nh pháº§n xÃ¢y dá»±ng nÃªn 1 chÆ°Æ¡ng trÃ¬nh JS"></a>Nhá»¯ng thÃ nh pháº§n xÃ¢y dá»±ng nÃªn 1 chÆ°Æ¡ng trÃ¬nh JS</h1><p>Báº¡n cÃ³ thá»ƒ viáº¿t toÃ n bá»™ code JS trong 1 file .js duy nháº¥t nhÆ°ng chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n cháº¯c cháº¯n chá»©a nhiá»u thÃ nh pháº§n nhá» (gá»i lÃ  nhá»¯ng block), chá»‰ cÃ³ má»™t sá»‘ block sáº½ Ä‘Æ°á»£c <strong>thá»±c thi ngay</strong> (gá»i lÃ  nhÃ³m A) vÃ  pháº§n cÃ²n láº¡i thÃ¬ <strong>cháº¡y sau</strong> (nhÃ³m B). ÄÆ¡n vá»‹ block phá»• biáº¿n nháº¥t lÃ  function (hÃ m).</p><p>Váº¥n Ä‘á» mÃ  Ä‘a sá»‘ cÃ¡c developer JS má»›i gáº·p pháº£i lÃ  há» nghÄ© ráº±ng nhÃ³m B khÃ´ng cáº§n pháº£i Ä‘Æ°á»£c thá»±c thi má»™t cÃ¡ch nghiÃªm ngáº·t ngay sau khi thá»±c thi nhÃ³m A. NÃ³i cÃ¡ch khÃ¡c, nhá»¯ng nhiá»‡m vá»¥ khÃ´ng Ä‘Æ°á»£c hoÃ n thÃ nh ngay bÃ¢y giá» thÃ¬ theo lá»¹ thuyáº¿t nÃ³ sáº½ Ä‘Æ°á»£c hoÃ n thÃ nh má»™t cÃ¡ch báº¥t Ä‘á»“ng bá»™, nghÄ©a lÃ  báº¡n sáº½ khÃ´ng pháº£i gáº·p tÃ¬nh huá»‘ng blocking (bá»‹ cháº·n) nhÆ° Ä‘á» cáº­p á»Ÿ trÃªn</p><p>VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Giáº£ sá»­ ajax(..) lÃ  má»™t hÃ m Ajax thuá»™c thÆ° viá»‡n nÃ o Ä‘Ã³</span></span><br><span class="line"><span class="keyword">var</span> response = ajax(<span class="string">'https://example.com/api'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(response);</span><br><span class="line"><span class="comment">// `response` sáº½ khÃ´ng chá»©a dá»¯ liá»‡u tráº£ vá»</span></span><br></pre></td></tr></table></figure><p>Cháº¯c báº¡n cÅ©ng nháº­n tháº¥y ráº±ng nhá»¯ng request Ajax nhÆ° tháº¿ nÃ y khÃ´ng cháº¡y Ä‘á»“ng bá»™ vá»›i nhau, nghÄ©a lÃ  táº¡i thá»i Ä‘iá»ƒm code thá»±c thi, hÃ m ajax(â€¦) chÆ°a cÃ³ dá»¯ liá»‡u tráº£ vá» Ä‘á»ƒ gÃ¡n vÃ o biáº¿n response</p><p>Má»™t cÃ¡ch Ä‘Æ¡n giáº£n cho thÆ°á»ng gáº·p Ä‘á»ƒ â€œchá»â€ má»™t hÃ m xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™ tráº£ káº¿t quáº£ vá» Ä‘Ã³ lÃ  sá»­ dá»¥ng callback:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ajax(<span class="string">'https://example.com/api'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response); <span class="comment">// "response" giá» Ä‘Ã£ cÃ³ dá»¯ liá»‡u</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ChÃº Ã½: Báº¡n cÃ³ thá»ƒ viáº¿t nhá»¯ng Ajax request Ä‘á»“ng bá»™, tuy nhiÃªn Ä‘á»«ng bao giá» lÃ m tháº¿. Náº¿u báº¡n viáº¿t Ajax nhÆ° váº­y thÃ¬ UI sáº½ bá»‹ block cá»©ng Ä‘Æ¡ vÃ  ngÆ°á»i dÃ¹ng sáº½ khÃ´ng thá»ƒ thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng nhÆ° click, nháº­p dá»¯ liá»‡u, Ä‘iá»u hÆ°á»›ng, lÄƒn chuá»™tâ€¦ Má»™t tráº£i nghiá»‡m kinh khá»§ng.</p><p>ÄÃ¢y lÃ  cÃ¡ch mÃ  Ajax Ä‘Æ°á»£c viáº¿t Ä‘á»“ng bá»™, nhÆ°ng lÃ m Æ¡n, Ä‘á»«ng bao giá» sá»­ dá»¥ng nÃ³ trong app cá»§a báº¡n:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Giáº£ sá»­ báº¡n Ä‘ang dÃ¹ng jQuery</span></span><br><span class="line">jQuery.ajax(&#123;</span><br><span class="line">    url: <span class="string">'https://api.example.com/endpoint'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// callback á»Ÿ Ä‘Ã¢y.</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span>: <span class="literal">false</span> <span class="comment">// Má»™t Ã½ tÆ°á»Ÿng cá»±c ká»³ tá»“i tá»‡</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ChÃºng ta Ä‘Ã£ sá»­ dá»¥ng Ajax request Ä‘á»ƒ vÃ­ dá»¥. NgoÃ i ra báº¡n cÃ³ thá»ƒ dÃ¹ng báº¥t ká»³ Ä‘oáº¡n code nÃ o Ä‘á»ƒ thá»±c hiá»‡n báº¥t Ä‘á»“ng bá»™.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ khÃ¡c vá»›i hÃ m setTimeout(callback, milliseconds). CÃ¡ch thá»©c mÃ  hÃ m setTimeout hoáº¡t Ä‘á»™ng lÃ  nÃ³ sáº½ Ä‘áº·t 1 sá»± kiá»‡n (á»Ÿ Ä‘Ã¢y lÃ  sá»± kiá»‡n timeout) vÃ  Ä‘á»ƒ nÃ³ thá»±c hiá»‡n sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">first</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'first'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">second</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'second'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">third</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'third'</span>);</span><br><span class="line">&#125;</span><br><span class="line">first();</span><br><span class="line">setTimeout(second, <span class="number">1000</span>); <span class="comment">// gá»i hÃ m `second` sau 1000ms</span></span><br><span class="line">third();</span><br></pre></td></tr></table></figure><p>VÃ  Ä‘Ã¢y lÃ  káº¿t quáº£ cá»§a Ä‘oáº¡n code trÃªn:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">first</span><br><span class="line">third</span><br><span class="line">second</span><br></pre></td></tr></table></figure><h1 id="Mo-xe-Event-Loop-vong-lap-su-kien"><a href="#Mo-xe-Event-Loop-vong-lap-su-kien" class="headerlink" title="Má»• xáº» Event Loop (vÃ²ng láº·p sá»± kiá»‡n)"></a>Má»• xáº» Event Loop (vÃ²ng láº·p sá»± kiá»‡n)</h1><p>ChÃºng ta sáº½ báº¯t Ä‘áº§u vá»›i má»™t chÃºt â€œká»³ quáº·câ€ - máº·c dÃ¹ JS cháº¥p nháº­n code cháº¡y báº¥t Ä‘á»“ng bá»™ (nhÆ° trÆ°á»ng há»£p cá»§a setTimeout) thÃ¬ cho Ä‘áº¿n khi giá»›i thiá»‡u ES6, JS cÅ©ng khÃ´ng thá»±c sá»± cÃ³ má»™t khÃ¡i niá»‡m trá»±c tiáº¿p nÃ o vá» báº¥t Ä‘á»“ng bá»™. Bá»™ engine JS chÆ°a bao giá» lÃ m gÃ¬ vÆ°á»£t ra khá»i viá»‡c thá»±c thi <strong>má»™t</strong> khá»‘i lá»‡nh trong chÆ°Æ¡ng trÃ¬nh cá»§a báº¡n táº¡i 1 thá»i Ä‘iá»ƒm cá»‘ Ä‘á»‹nh.</p><p>Báº¡n cÃ³ thá»ƒ xem chi tiáº¿t hÆ¡n vá» cÃ¡ch engine JS (cá»¥ thá»ƒ lÃ  Google V8) hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o á»Ÿ <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-2---Ben-trong-engine-V8---5-meo-de-toi-uu-hoa-code" target="_blank" rel="noopener">bÃ i viáº¿t trÆ°á»›c</a>.</p><p>Váº­y thÃ¬ ai lÃ  ngÆ°á»i ra lá»‡nh cho engine JS pháº£i thá»±c thi nhá»¯ng khá»‘i lá»‡nh trong chÆ°Æ¡ng trÃ¬nh? TrÃªn thá»±c táº¿, engine JS khÃ´ng cháº¡y cÃ´ láº­p, nÃ³ hoáº¡t Ä‘á»™ng bÃªn trong má»™t mÃ´i trÆ°á»ng chá»§ (hosting environment), mÃ´i trÆ°á»ng nÃ y Ä‘á»‘i vá»›i Ä‘a sá»‘ cÃ¡c developer chÃ­nh lÃ  trÃ¬nh duyá»‡t web hoáº·c Node.js. Thá»±c ra, ngÃ y nay, JS Ä‘Ã£ vÃ  Ä‘ang Ä‘Æ°á»£c nhÃºng vÃ o ráº¥t nhiá»u loáº¡i thiáº¿t bá»‹ khÃ¡c nhau, tá»« robot cho tá»›i bÃ³ng Ä‘Ã¨n. Má»—i má»™t thiáº¿t bá»‹ cÃ³ thá»ƒ xem nhÆ° lÃ  1 loáº¡i khÃ¡c nhau cá»§a mÃ´i trÆ°á»ng chá»§ cho engine JS.</p><p>Máº«u sá»‘ chung cá»§a táº¥t cáº£ cÃ¡c mÃ´i trÆ°á»ng Ä‘Ã³ lÃ  má»™t cÆ¡ cháº¿ tÃ­ch há»£p sáºµn Ä‘Æ°á»£c gá»i lÃ  <strong>event-loop</strong> (vÃ²ng láº·p sá»± kiá»‡n), nÃ³ xá»­ lÃ½ quÃ¡ trÃ¬nh thá»±c thi cá»§a nhiá»u khá»‘i lá»‡nh trong chÆ°Æ¡ng trÃ¬nh theo thá»i gian, má»—i láº§n Ä‘á»u gá»i engine JS.</p><p>Äiá»u nÃ y nghÄ©a lÃ  engine JS chá»‰ lÃ  1 mÃ´i trÆ°á»ng thá»±c thi theo yÃªu cáº§u cho báº¥t ká»³ Ä‘oáº¡n code JS tÃ¹y Ã½ nÃ o. NÃ³ chá»‰ lÃ  mÃ´i trÆ°á»ng bao quanh cÃ³ lá»‹ch trÃ¬nh cho cÃ¡c sá»± kiá»‡n (quÃ¡ trÃ¬nh thá»±c thi code JS).</p><p>VÃ­ dá»¥, khi code JS cá»§a báº¡n gá»i Ajax request Ä‘á»ƒ láº¥y dá»¯ liá»‡u tá»« server, báº¡n cÃ i Ä‘áº·t má»™t Ä‘oáº¡n code <em>response</em> trong má»™t hÃ m (gá»i lÃ  callback), vÃ  engine JS sáº½ truyá»n Ä‘áº¡t láº¡i vá»›i mÃ´i trÆ°á»ng chá»§: <em>NÃ y, tao chuáº©n bá»‹ táº¡m ngÆ°ng quÃ¡ trÃ¬nh thá»±c thi ngay bÃ¢y giá», nhÆ°ng mÃ  khi nÃ o mÃ y xong viá»‡c vá»›i request Ä‘Ã³ vÃ  cÃ³ má»™t vÃ i cá»¥c dá»¯ liá»‡u thÃ¬ nhá»› gá»i láº¡i hÃ m nÃ y nhÃ©.</em></p><p>TrÃ¬nh duyá»‡t sau Ä‘Ã³ sáº½ láº¯ng nghe vá» response tá»« máº¡ng, vÃ  khi nÃ³ cÃ³ gÃ¬ Ä‘Ã³ tráº£ vá» cho báº¡n, nÃ³ sáº½ lÃªn lá»‹ch cho hÃ m callback Ä‘Æ°á»£c thá»±c thi báº±ng cÃ¡ch chÃ¨n nÃ³ vÃ o trong event loop</p><p>CÃ¹ng xem sÆ¡ Ä‘á»“ nÃ y nÃ o:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*FA9NGxNB6-v1oI2qGEtlRQ.png" alt=""></p><p>Báº¡n cÃ³ thá»ƒ xem láº¡i pháº§n bÃ i viáº¿t vá» Memory Heap &amp; Call Stack trong <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-1---Khai-quat-ve-engine--runtime-va-callstack" target="_blank" rel="noopener">bÃ i viáº¿t trÆ°á»›c Ä‘Ã¢y</a></p><p>Váº­y thÃ¬ nhá»¯ng Web APIs nÃ y lÃ  gÃ¬? Vá» báº£n cháº¥t, chÃºng lÃ  nhá»¯ng tiáº¿n trÃ¬nh mÃ  báº¡n khÃ´ng thá»ƒ truy xuáº¥t (access), báº¡n chá»‰ cÃ³ thá»ƒ gá»i nÃ³. ChÃºng lÃ  nhá»¯ng thÃ nh pháº§n cá»§a trÃ¬nh duyá»‡t mÃ  trong Ä‘Ã³ cÃ¡ch xá»­ lÃ½ Ä‘á»“ng bá»™ Ä‘Æ°á»£c báº¯t Ä‘áº§u. Náº¿u báº¡n lÃ  má»™t Node.js developer thÃ¬ chÃºng lÃ  nhá»¯ng C++ APIs.</p><p><strong>Váº­y cuá»‘i cÃ¹ng thÃ¬ event loop lÃ  cÃ¡i Ã©o gÃ¬ ?</strong></p><p><img src="https://cdn-images-1.medium.com/max/1000/1*KGBiAxjeD9JT2j6KDo0zUg.png" alt=""></p><p><strong>Event Loop</strong> cÃ³ má»™t cÃ´ng viá»‡c Ä‘Æ¡n giáº£n: theo dÃµi Call Stack vÃ  Callback Queue (hÃ ng Ä‘á»£i cÃ¡c hÃ m callback). Náº¿u Call Stack Ä‘ang trá»‘ng, nÃ³ sáº½ láº¥y event Ä‘áº§u tiÃªn tá»« trong hÃ ng Ä‘á»£i ra vÃ  Ä‘áº©y nÃ³ váº£o trong Call Stack - tá»©c lÃ  thá»±c thi nÃ³.</p><p>Má»—i vÃ²ng láº·p nhÆ° tháº¿ Ä‘Æ°á»£c gá»i lÃ  1 <strong>tick</strong> trong Event Loop. Má»—i sá»± kiá»‡n chá»‰ lÃ  1 hÃ m callback.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'Hi'</span>);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">cb1</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'cb1'</span>);</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Bye'</span>);</span><br></pre></td></tr></table></figure><p>CÃ¹ng <em>thá»±c thi</em> Ä‘oáº¡n code trÃªn vÃ  xem Ä‘iá»u gÃ¬ xáº£y ra nÃ o:</p><ol><li>Tráº¡ng thÃ¡i Ä‘ang trá»‘ng, console cá»§a trÃ¬nh duyá»‡t Ä‘ang trá»‘ng, Call Stack Ä‘ang trá»‘ng. <img src="https://cdn-images-1.medium.com/max/1000/1*9fbOuFXJHwhqa6ToCc_v2A.png" alt=""></li><li>console.log(â€˜Hiâ€™) Ä‘Æ°á»£c thÃªm vÃ o Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*dvrghQCVQIZOfNC27Jrtlw.png" alt=""></li><li>console.log(â€˜Hiâ€™) Ä‘Æ°á»£c thá»±c thi. <img src="https://cdn-images-1.medium.com/max/1000/1*yn9Y4PXNP8XTz6mtCAzDZQ.png" alt=""></li><li>console.log(â€˜Hiâ€™) bá»‹ xÃ³a khá»i Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*iBedryNbqtixYTKviPC1tA.png" alt=""></li><li>setTimeout(function cb1() { â€¦ }) Ä‘Æ°á»£c thÃªm vÃ o Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*HIn-BxIP38X6mF_65snMKg.png" alt=""></li><li>setTimeout(function cb1() { â€¦ }) Ä‘Æ°á»£c thá»±c thi. TrÃ¬nh duyá»‡t táº¡o má»™t timer - vá»‘n lÃ  má»™t pháº§n cá»§a Web APIs. NÃ³ sáº½ thá»±c hiá»‡n pháº§n Ä‘áº¿m ngÆ°á»£c cho báº¡n. <img src="https://cdn-images-1.medium.com/max/1000/1*vd3X2O_qRfqaEpW4AfZM4w.png" alt=""></li><li>The setTimeout(function cb1() { â€¦ }) Ä‘Æ°á»£c thá»±c hiá»‡n xong vÃ  bá»‹ xÃ³a khá»i Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*_nYLhoZPKD_HPhpJtQeErA.png" alt=""></li><li>console.log(â€˜Byeâ€™) Ä‘Æ°á»£c thÃªm vÃ o Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*1NAeDnEv6DWFewX_C-L8mg.png" alt=""></li><li>console.log(â€˜Byeâ€™) Ä‘Æ°á»£c thá»±c thi. <img src="https://cdn-images-1.medium.com/max/1000/1*UwtM7DmK1BmlBOUUYEopGQ.png" alt=""></li><li>console.log(â€˜Byeâ€™) bá»‹ xÃ³a khá»i Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*-vHNuJsJVXvqq5dLHPt7cQ.png" alt=""></li><li>Sau Ã­t nháº¥t 5000ms, timer hoÃ n thÃ nh cÃ´ng viá»‡c cá»§a nÃ³ vÃ  Ä‘áº©y cb1 callback vÃ o trong Callback Queue. <img src="https://cdn-images-1.medium.com/max/1000/1*eOj6NVwGI2N78onh6CuCbA.png" alt=""></li><li>Event Loop láº¥y cb1 tá»« trong Callback Queue vÃ  Ä‘Æ°a nÃ³ vÃ o trong Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*jQMQ9BEKPycs2wFC233aNg.png" alt=""></li><li>cb1 Ä‘Æ°á»£c thá»±c thi vÃ  nÃ³ thÃªm console.log(â€˜cb1â€™) vÃ o trong Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*hpyVeL1zsaeHaqS7mU4Qfw.png" alt=""></li><li>console.log(â€˜cb1â€™) Ä‘Æ°á»£c thá»±c thi. <img src="https://cdn-images-1.medium.com/max/1000/1*lvOtCg75ObmUTOxIS6anEQ.png" alt=""></li><li>console.log(â€˜cb1â€™) bá»‹ xÃ³a khá»i Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*Jyyot22aRkKMF3LN1bgE-w.png" alt=""></li><li>cb1 bá»‹ xÃ³a khá»i Call Stack. <img src="https://cdn-images-1.medium.com/max/1000/1*t2Btfb_tBbBxTvyVgKX0Qg.png" alt=""></li></ol><p>áº¢nh gif tá»•ng há»£p láº¡i quÃ¡ trÃ¬nh 16 bÆ°á»›c á»Ÿ trÃªn:<br><img src="https://cdn-images-1.medium.com/max/1000/1*TozSrkk92l8ho6d8JxqF_w.gif" alt=""></p><p>Tháº­t thÃº vá»‹ khi biáº¿t ráº±ng ES6 cÃ³ mÃ´ táº£ event loop hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o, nghÄ©a lÃ  vá» máº·t ká»¹ thuáº­t, nÃ³ náº±m trong pháº¡m vi trÃ¡ch nghiá»‡m cá»§a má»™t JS engine, tá»©c lÃ  khÃ´ng cÃ²n chá»‰ Ä‘Ã³ng vai trÃ² mÃ´i trÆ°á»ng chá»§. Má»™t lÃ½ do chÃ­nh Ä‘Ã¡ng cho sá»± thay Ä‘á»•i nÃ y chÃ­nh lÃ  viá»‡c giá»›i thiá»‡u Promise trong ES6 bá»Ÿi vÃ¬ promise má»›i cáº§n truy xuáº¥t trá»±c tiáº¿p, kiá»ƒm soÃ¡t tá»‘i Ä‘a lá»‹ch trÃ¬nh Ä‘iá»u hÃ nh Ä‘á»‘i vá»›i event loop queue (Sau nÃ y chÃºng ta sáº½ tháº£o luáº­n chi tiáº¿t hÆ¡n)</p><h1 id="setTimeout-â€¦-hoat-dong-nhu-the-nao"><a href="#setTimeout-â€¦-hoat-dong-nhu-the-nao" class="headerlink" title="setTimeout(â€¦) hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?"></a>setTimeout(â€¦) hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?</h1><p>Äiá»u quan trá»ng cáº§n pháº£i biáº¿t lÃ  setTimeout(â€¦) khÃ´ng tá»± Ä‘á»™ng Ä‘áº·t callback vÃ o trong event loop queue. NÃ³ thiáº¿t láº­p má»™t bá»™ Ä‘áº¿m. Khi bá»™ Ä‘áº¿m káº¿t thÃºc, mÃ´i trÆ°á»ng Ä‘áº·t callback vÃ o trong event loop, vÃ¬ tháº¿ nhá»¯ng <strong>tick</strong> tiáº¿p theo cÃ³ thá»ƒ láº¥y nÃ³ ra vÃ  thá»±c thi:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(myCallback, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>NÃ³ khÃ´ng cÃ³ nghÄ©a lÃ  myCallback sáº½ Ä‘Æ°á»£c thá»±c thi sau 1000ms, mÃ  Ä‘Ãºng hÆ¡n lÃ , trong 1000ms, myCallback sáº½ Ä‘Æ°á»£c thÃªm vÃ o trong queue. Tuy nhiÃªn queue nÃ y cÃ³ thá»ƒ Ä‘ang cÃ³ event khÃ¡c Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o trÆ°á»›c Ä‘Ã³, vÃ  vÃ¬ tháº¿ callback cá»§a báº¡n sáº½ pháº£i chá».</p><p>CÃ³ má»™t vÃ i bÃ i biáº¿t hoáº·c bÃ i hÆ°á»›ng dáº«n dÃ nh cho ngÆ°á»i má»›i báº¯t Ä‘áº§u vá»›i báº¥t Ä‘á»“ng bá»™ trong JS hÆ°á»›ng dáº«n ráº±ng ta nÃªn setTimeout(callback, 0). BÃ¢y giá» báº¡n Ä‘Ã£ biáº¿t cÃ¡ch event loop lÃ m viá»‡c vÃ  cÃ¡ch setTimeout hoáº¡t Ä‘á»™ng rá»“i: gá»i setTimeout vá»›i thá»i gian lÃ  <strong>0</strong> chá»‰ vÃ¬ má»¥c Ä‘Ã­ch hoÃ£n callback láº¡i cho tá»›i khi Call Stack rá»—ng hoÃ n toÃ n.</p><p>HÃ£y xem vÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'Hi'</span>);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'callback'</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Bye'</span>);</span><br></pre></td></tr></table></figure><p>Máº·c dÃ¹ thá»i gian chá» cá»§a callback lÃ  <em>0ms</em> nhÆ°ng káº¿t quáº£ in ra láº¡i nhÆ° tháº¿ nÃ y:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hi</span><br><span class="line">Bye</span><br><span class="line">callback</span><br></pre></td></tr></table></figure><h1 id="Jobs-cong-viec-trong-ES6-la-gi"><a href="#Jobs-cong-viec-trong-ES6-la-gi" class="headerlink" title="Jobs (cÃ´ng viá»‡c) trong ES6 lÃ  gÃ¬?"></a>Jobs (cÃ´ng viá»‡c) trong ES6 lÃ  gÃ¬?</h1><p>Má»™t khÃ¡i niá»‡m má»›i gá»i lÃ  <strong>Job Queue</strong> (HÃ ng Ä‘á»£i cÃ´ng viá»‡c) Ä‘Æ°á»£c giá»›i thiá»‡u trong ES6. NÃ³ lÃ  lá»›p trÃªn cÃ¹ng cá»§a event loop queue. Nhiá»u kháº£ nÄƒng báº¡n sáº½ gáº·p pháº£i nÃ³ khi xá»­ lÃ½ váº¥n Ä‘á» liÃªn quan Ä‘áº¿n báº¥t Ä‘á»“ng bá»™ cá»§a Promise (ChÃºng ta sáº½ nÃ³i vá» nÃ³ sau).</p><p>BÃ¢y giá» thÃ¬ chÃºng ta chá»‰ tÃ¬m hiá»ƒu vá» máº·t Ã½ tÆ°á»Ÿng cÆ¡ báº£n Ä‘á»ƒ sau nÃ y khi tháº£o luáº­n vá» báº¥t Ä‘á»“ng bá»™ vá»›i Promise, báº¡n cÃ³ thá»ƒ hiá»ƒu vá» nhá»¯ng hÃ nh Ä‘á»™ng Ä‘Ã£ Ä‘Æ°á»£c lÃªn lá»‹ch vÃ  xá»­ lÃ½.</p><p>TÆ°á»Ÿng tÆ°á»£ng nÃ³ nhÆ° tháº¿ nÃ y: Job queue lÃ  1 queue Ä‘Æ°á»£c gáº¯n vÃ o cuá»‘i má»—i tick trong event loop queue. Má»—i hÃ nh Ä‘á»™ng báº¥t Ä‘á»“ng bá»™ nháº¥t Ä‘á»‹nh khi xáº£y ra trong 1 tick sáº½ khÃ´ng lÃ m cho toÃ n bá»™ event Ä‘Æ°á»£c thÃªm vÃ o event loop queue nhÆ°ng thay vÃ¬ tháº¿ sáº½ thÃªm 1 item (tá»©c lÃ  job) vÃ o cuá»‘i job queue cá»§a tick hiá»‡n táº¡i.</p><p>Äiá»u nÃ y nghÄ©a lÃ  báº¡n cÃ³ thá»ƒ thÃªm nhá»¯ng tÃ­nh nÄƒng khÃ¡c Ä‘á»ƒ cÃ³ thá»ƒ thá»±c thi sau vÃ  báº¡n cÃ³ thá»ƒ cháº¯c cháº¯n ráº±ng nÃ³ sáº½ Ä‘Æ°á»£c thá»±c thi ngay sau Ä‘Ã³, trÆ°á»›c báº¥t ká»³ Ä‘oáº¡n code nÃ o khÃ¡c.</p><p>Má»™t job cÃ³ thá»ƒ thÃªm nhiá»u job khÃ¡c vÃ o Ä‘oáº¡n cuá»‘i cá»§a cÃ¹ng 1 queue. TrÃªn lÃ½ thuyáº¿t, job cÃ³ thá»ƒ láº·p (loop) vÃ´ thá»i háº¡n (má»™t job thá»±c hiá»‡n thÃªm nhiá»u job khÃ¡c, v..vâ€¦), do Ä‘Ã³ nÃ³ sáº½ lÃ m cho chÆ°Æ¡ng trÃ¬nh bá»‹ quÃ¡ táº£i tÃ i nguyÃªn cáº§n thiáº¿t Ä‘á»ƒ tiáº¿p tá»¥c cháº¡y. Vá» máº·t khÃ¡i niá»‡m thÃ¬ Ä‘iá»u nÃ y tÆ°Æ¡ng tá»± nhÆ° má»™t cÃ´ng viá»‡c cÃ³ thá»i gian thá»±c thi dÃ i hoáº·c lÃ  má»™t vÃ²ng láº·p vÃ´ háº¡n (vÃ­ dá»¥: while(true)).</p><p>Job cÅ©ng giá»‘ng nhÆ° trick setTimeout(callback, 0) (set thá»i gian báº±ng _0_) nhÆ°ng Ä‘Æ°á»£c triá»ƒn khai theo cÃ¡ch cÃ³ váº» nhÆ° â€œchÃ­nh thá»‘ngâ€ hÆ¡n vÃ  cÃ³ sá»± Ä‘áº£m báº£o vá» thá»© tá»±: thá»±c hiá»‡n sau, nhÆ°ng pháº£i lÃ m ngay khi cÃ³ thá»ƒ.</p><h1 id="Callbacks"><a href="#Callbacks" class="headerlink" title="Callbacks"></a>Callbacks</h1><p>NhÆ° báº¡n Ä‘Ã£ biáº¿t, callback lÃ  cÃ¡ch phá»• biáº¿n nháº¥t Ä‘á»ƒ thá»ƒ hiá»‡n &amp; quáº£n lÃ½ sá»± báº¥t Ä‘á»“ng bá»™ trong JS. RÃµ rÃ ng, callback lÃ  mÃ´ hÃ¬nh báº¥t Ä‘á»“ng bá»™ cÆ¡ báº£n nháº¥t trong JS. VÃ´ sá»‘ chÆ°Æ¡ng trÃ¬nh JS, ká»ƒ cáº£ nhá»¯ng app tinh vi vÃ  phá»©c táº¡p nháº¥t thÃ¬ cÅ©ng pháº£i dÃ¹ng tá»›i callback.</p><p>Ngoáº¡i trá»« viá»‡c callback khÃ´ng xuáº¥t hiá»‡n mÃ  khÃ´ng cÃ³ thiáº¿u sÃ³t. Nhiá»u developer Ä‘ang cá»‘ gáº¯ng tÃ¬m kiáº¿m nhá»¯ng mÃ´ hÃ¬nh báº¥t Ä‘á»“ng bá»™ tá»‘t hÆ¡n. Tuy nhiÃªn, chÃºng ta khÃ´ng thá»ƒ sá»­ dá»¥ng báº¥t ká»³ phÆ°Æ¡ng phÃ¡p thay tháº¿ nÃ o khÃ¡c náº¿u nhÆ° báº¡n chÆ°a thá»±c sá»± hiá»ƒu rÃµ vá» callback.</p><p>á» chÆ°Æ¡ng tiáº¿p theo, chÃºng ta sáº½ khÃ¡m phÃ¡ sÃ¢u hÆ¡n vá» váº¥n Ä‘á» nÃ y Ä‘á»ƒ tÃ¬m hiá»ƒu táº¡i sao nhá»¯ng mÃ´ hÃ¬nh báº¥t Ä‘á»“ng bá»™ tinh vi khÃ¡c (sáº½ nÃ³i á»Ÿ nhá»¯ng bÃ i sau) lÃ  cáº§n thiáº¿t vÃ  Ä‘Æ°á»£c Ä‘á» nghá»‹ nÃªn sá»­ dá»¥ng.</p><h1 id="Callback-long-nhau-nested-callback"><a href="#Callback-long-nhau-nested-callback" class="headerlink" title="Callback lá»“ng nhau (nested callback)"></a>Callback lá»“ng nhau (nested callback)</h1><p>Xem Ä‘oáº¡n code dÆ°á»›i Ä‘Ã¢y:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">listen(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        ajax(<span class="string">'https://api.example.com/endpoint'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">text</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (text == <span class="string">"hello"</span>) &#123;</span><br><span class="line">            doSomething();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (text == <span class="string">"world"</span>) &#123;</span><br><span class="line">            doSomethingElse();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ChÃºng ta cÃ³ 3 hÃ m lá»“ng nhau, má»—i hÃ m thá»ƒ hiá»‡n 1 bÆ°á»›c trong chuá»—i báº¥t Ä‘á»“ng bá»™.</p><p>Kiá»ƒu code nhÆ° tháº¿ nÃ y thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  <strong>callback hell</strong>. NhÆ°ng <em>callback hell</em> thá»±c sá»± khÃ´ng pháº£i váº¥n Ä‘á» vá» lá»“ng nhau hay cÃ¡ch dÃ²ng, thá»¥t lá». CÃ¢u chuyá»‡n thá»±c sá»± sÃ¢u xa hÆ¡n tháº¿ nhiá»u.</p><p>Äáº§u tiÃªn, chÃºng ta listen má»™t event <em>click</em>, sau Ä‘Ã³ thÃ¬ chá» timer hoáº¡t Ä‘á»™ng, rá»“i cuá»‘i cÃ¹ng lÃ  chá» cho Ajax tráº£ káº¿t quáº£ vá» vÃ  quÃ¡ trÃ¬nh nÃ y cÃ³ thá»ƒ láº·p láº¡i nhiá»u láº§n má»—i khi chÃºng ta click.</p><p>Thoáº¡t nhÃ¬n Ä‘oáº¡n code nÃ y thá»ƒ hiá»‡n sá»± Ä‘á»“ng bá»™ má»™t cÃ¡ch tá»± nhiÃªn theo thá»© tá»± cÃ¡c bÆ°á»›c nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">listen(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>â€¦rá»“i sau Ä‘Ã³:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;, <span class="number">500</span>);</span><br></pre></td></tr></table></figure><p>â€¦tiáº¿p theo lÃ :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ajax(<span class="string">'https://api.example.com/endpoint'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">text</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>â€¦vÃ  cuá»‘i cÃ¹ng:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (text == <span class="string">"hello"</span>) &#123;</span><br><span class="line">    doSomething();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (text == <span class="string">"world"</span>) &#123;</span><br><span class="line">    doSomethingElse();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ChÃ , Ä‘Ãºng lÃ  má»™t cÃ¡ch thá»ƒ hiá»‡n code báº¥t Ä‘á»“ng bá»™ má»™t cÃ¡ch ráº¥t tá»± nhiÃªn, pháº£i khÃ´ng nÃ o? <em>cÆ°á»i</em></p><h1 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h1><p>CÃ¹ng xem Ä‘oáº¡n code sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> y = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(x + y);</span><br></pre></td></tr></table></figure><p>Ráº¥t rÃµ rÃ ng ráº±ng nÃ³ tÃ­nh tá»•ng cá»§a x vÃ  y rá»“i in káº¿t quáº£ ra console. Tuy nhiÃªn, náº¿u nhÆ° giÃ¡ trá»‹ cá»§a x vÃ  y chÆ°a tá»“n táº¡i vÃ  váº«n cÃ²n Ä‘ang chá» Ä‘á»ƒ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh thÃ¬ sao? Giáº£ sá»­ chÃºng ta cáº§n láº¥y giÃ¡ trá»‹ cá»§a x vÃ  y tá»« server trÆ°á»›c khi chÃºng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ tÃ­nh tá»•ng.<br>TÆ°á»Ÿng tÆ°á»£ng ráº±ng chÃºng ta cÃ³ má»™t hÃ m loadX vÃ  loadY Ä‘á»ƒ thá»±c hiá»‡n load dá»¯ liá»‡u cho x vÃ  y tá»« server vÃ  má»™t hÃ m Ä‘á»ƒ tÃ­nh tá»•ng 2 sá»‘ sau khi chÃºng Ä‘Æ°á»£c load xong.<br>Äoáº¡n code sáº½ giá»‘ng nhÆ° tháº¿ nÃ y (xáº¥u xÃ­ vÃ  phá»©c táº¡p, pháº£i khÃ´ng nÃ o?):</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">getX, getY, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x, y;</span><br><span class="line">    getX(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">        x = result;</span><br><span class="line">        <span class="keyword">if</span> (y !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            callback(x + y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    getY(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">        y = result;</span><br><span class="line">        <span class="keyword">if</span> (x !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            callback(x + y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Má»™t hÃ m Ä‘á»“ng bá»™ hoáº·c báº¥t Ä‘á»“ng bá»™ Ä‘á»ƒ get giÃ¡ trá»‹ cá»§a "x"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchX</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Má»™t hÃ m Ä‘á»“ng bá»™ hoáº·c báº¥t Ä‘á»“ng bá»™ Ä‘á»ƒ get giÃ¡ trá»‹ cá»§a "y"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchY</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;</span><br><span class="line">sum(fetchX, fetchY, <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>CÃ³ má»™t Ä‘iá»u quan trá»ng cáº§n pháº£i nÃªu lÃªn á»Ÿ Ä‘Ã¢y: trong Ä‘oáº¡n code trÃªn, chÃºng ta xem x vÃ  y nhÆ° nhá»¯ng giÃ¡ trá»‹ tÆ°Æ¡ng lai vÃ  hÃ m sum() khÃ´ng quan tÃ¢m vá» viá»‡c x hay y hay cáº£ 2 biáº¿n cÃ³ hay khÃ´ng cÃ³ tá»“n táº¡i giÃ¡ trá»‹.</p><p>DÄ© nhiÃªn lÃ  cÃ¡ch tiáº¿p cáº­n thÃ´ dá»±a trÃªn callback nÃ y cho ta nhiá»u thá»© Ä‘Ã¡ng mong Ä‘á»£i. ÄÃ¢y chá»‰ lÃ  1 bÆ°á»›c tiáº¿n nhá» Ä‘á»ƒ hiá»ƒu vá» Ã­ch lá»£i cá»§a <em>giÃ¡ trá»‹ tÆ°Æ¡ng lai</em> mÃ  khÃ´ng cáº§n lo láº¯ng vá» khÃ­a cáº¡nh thá»i gian khi chÃºng sáºµn cÃ³.</p><h1 id="Gia-tri-cua-Promise"><a href="#Gia-tri-cua-Promise" class="headerlink" title="GiÃ¡ trá»‹ cá»§a Promise"></a>GiÃ¡ trá»‹ cá»§a Promise</h1><p>CÃ¹ng xem vÃ­ dá»¥ vá» x + y Ä‘Æ°á»£c thá»±c hiá»‡n vá»›i Promise:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">xPromise, yPromise</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// `Promise.all([ .. ])` nháº­n vÃ o 1 máº£ng cÃ¡c promise,</span></span><br><span class="line">    <span class="comment">// vÃ  tráº£ vá» 1 promise chá» Ä‘á»£i táº¥t cáº£ chÃºng hoÃ n thÃ nh</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all([xPromise, yPromise])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// khi má»™t promise Ä‘Æ°á»£c phÃ¢n giáº£i (resolve),</span></span><br><span class="line">    <span class="comment">// ta láº¥y giÃ¡ trá»‹ x, y tráº£ vá» vÃ  cá»™ng chÃºng láº¡i.</span></span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">values</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// `values` lÃ  máº£ng chá»©a giÃ¡ trá»‹ cá»§a cÃ¡c object</span></span><br><span class="line">        <span class="comment">// tá»« nhá»¯ng promise Ä‘Ã£ Ä‘Æ°á»£c resolve</span></span><br><span class="line">        <span class="keyword">return</span> values[<span class="number">0</span>] + values[<span class="number">1</span>];</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `fetchX()` vÃ  `fetchY()` tráº£ vá» promise </span></span><br><span class="line"><span class="comment">// chá»©a káº¿t quáº£ tÆ°Æ¡ng á»©ng, cÃ³ thá»ƒ cÃ³ </span></span><br><span class="line"><span class="comment">// luÃ´n hoáº·c chá» sau má»›i cÃ³ dá»¯ liá»‡u</span></span><br><span class="line">sum(fetchX(), fetchY())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ta cÃ³ 1 promise cho tá»•ng cá»§a 2 sá»‘.</span></span><br><span class="line"><span class="comment">// Giá» thÃ¬ gá»i máº¯t xÃ­ch (chain-call) hÃ m `.then(...)` Ä‘á»ƒ chá» </span></span><br><span class="line"><span class="comment">// káº¿t quáº£ cá»§a promise tráº£ vá».</span></span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">sum</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(sum);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>CÃ³ 2 lá»›p Promise trong Ä‘oáº¡n code nÃ y.</p><p>fetchX() vÃ  fetchY() Ä‘Æ°á»£c gá»i trá»±c tiáº¿p vÃ  giÃ¡ trá»‹ tráº£ vá» cá»§a chÃºng (<strong>promise!</strong>) Ä‘Æ°á»£c Ä‘áº©y vÃ o hÃ m sum(â€¦). GiÃ¡ trá»‹ mÃ  nhá»¯ng promise nÃ y thá»ƒ hiá»‡n cÃ³ thá»ƒ sáºµn sÃ ng Ä‘á»ƒ dÃ¹ng ngay lÃºc gá»i hÃ m hoáº·c lÃ  sau Ä‘Ã³ 1 chÃºt nhÆ°ng báº¥t ká»ƒ sá»›m hay muá»™n thÃ¬ má»—i promise Ä‘á»u chuáº©n hÃ³a hÃ nh vi cá»§a nÃ³ cho giá»‘ng nhau. ChÃºng ta suy Ä‘oÃ¡n vá» giÃ¡ trá»‹ cá»§a x vÃ  y theo hÆ°á»›ng Ä‘á»™c láº­p thá»i gian. Theo chu ká»³, chÃºng lÃ  nhá»¯ng <em>giÃ¡ trá»‹ tÆ°Æ¡ng lai</em>.</p><p>Lá»›p thá»© 2 lÃ  promise do hÃ m sum(â€¦) táº¡o ra (thÃ´ng qua Promise.all([ â€¦ ])) vÃ  tráº£ vá», vÃ  cÅ©ng chá» nÃ³ get giÃ¡ trá»‹ khi gá»i .then(â€¦). Khi hÃ m sum(â€¦) hoÃ n táº¥t, tá»•ng <em>giÃ¡ trá»‹ tÆ°Æ¡ng lai</em> Ä‘Ã£ sáºµn sÃ ng vÃ  cÃ³ thá»ƒ in nÃ³ ra. ChÃºng ta áº©n pháº§n logic chá» <em>giÃ¡ trá»‹ tÆ°Æ¡ng lai</em> cá»§a x vÃ  y trong hÃ m `sum(â€¦).</p><p><strong>LÆ°u Ã½</strong>: <em>BÃªn trong sum(â€¦), lá»i gá»i Ä‘áº¿n Promise.all([ â€¦ ]) táº¡o má»™t promise (cÃ¡i nÃ y sáº½ gá»i Ä‘áº¿n xPromise vÃ  yPromise rá»“i phÃ¢n giáº£i chÃºng). Chain-call Ä‘áº¿n .then() sáº½ táº¡o ra 1 promise khÃ¡c vÃ  promise nÃ y sáº½ tráº£ vá» values[0] + values[1] ngay khi resolve (vá»›i giÃ¡ trá»‹ káº¿t quáº£ cá»§a phÃ©p cá»™ng). Do Ä‘Ã³ lá»i gá»i .then(â€¦) ta Ä‘áº·t á»Ÿ cuá»‘i hÃ m .sum(â€¦), tá»©c lÃ  cuá»‘i Ä‘oáº¡n code, thá»±c ra lÃ  xá»­ lÃ½ trÃªn giÃ¡ trá»‹ tráº£ vá» cá»§a promise thá»© 2 hÆ¡n lÃ  promise thá»© nháº¥t Ä‘Æ°á»£c táº¡o ra bá»Ÿi Promise.all([ â€¦ ]). Máº·c dÃ¹ váº­y thÃ¬ chÃºng ta khÃ´ng chain-call vÃ o cuá»‘i hÃ m .then(â€¦) sau vÃ¬ lÃ m váº­y sáº½ táº¡o thÃªm 1 promise vÃ  ta láº¡i pháº£i xá»­ lÃ½ nÃ³. Pháº§n Promise chain-call nÃ y sáº½ Ä‘Æ°á»£c giáº£i thÃ­ch ká»¹ hÆ¡n á»Ÿ cÃ¡c pháº§n sau trong chÆ°Æ¡ng nÃ y.</em></p><p>Vá»›i Promise, lá»i gá»i .then(â€¦) cÃ³ thá»ƒ nháº­n 2 hÃ m param, hÃ m thá»© nháº¥t lÃ  Ä‘á»ƒ thá»±c hiá»‡n thao tÃ¡c vá»›i response hoÃ n thÃ nh (nhÆ° trÃªn), hÃ m thá»© 2 lÃ  vá»›i trÆ°á»ng há»£p bá»‹ lá»—i vÃ  bÃ¡c bá» (rejection).</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sum(fetchX(), fetchY())</span><br><span class="line">.then(</span><br><span class="line">    <span class="comment">// HÃ m xá»­ lÃ½ hoÃ n thÃ nh</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">sum</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log( sum );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// HÃ m xá»­ lÃ½ bÃ¡c bá»</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.error( err ); <span class="comment">// bummer!</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>Náº¿u cÃ³ gÃ¬ Ä‘Ã³ khÃ´ng Ä‘Ãºng trong quÃ¡ trÃ¬nh get x vÃ  y hoáº·c lÃ  cÃ³ sai sÃ³t khÃ¡c thÃ¬ promise mÃ  .sum(â€¦) tráº£ vá» sáº½ bá»‹ reject, hÃ m callback thá»© 2 xá»­ lÃ½ lá»—i Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº©y vÃ o .then(â€¦) sáº½ nháº­n giÃ¡ trá»‹ reject tá»« promise.</p><p>Bá»Ÿi vÃ¬ promise Ä‘Ã³ng gÃ³i tráº¡ng thÃ¡i Ä‘á»™c láº­p thá»i gian tá»« bÃªn ngoÃ i - chá» cho giÃ¡ trá»‹ Ä‘Æ°á»£c xá»­ lÃ½ hoÃ n thÃ nh/reject, vÃ  báº£n thÃ¢n promise Ä‘Ã£ lÃ  Ä‘á»™c láº­p thá»i gian, do Ä‘Ã³ nhiá»u promise cÃ³ thá»ƒ Ä‘Æ°á»£c káº¿t há»£p vá»›i nhau theo nhá»¯ng cÃ¡ch cÃ³ thá»ƒ Ä‘oÃ¡n trÆ°á»›c Ä‘Æ°á»£c báº¥t ká»ƒ lÃ  thá»i gian hay káº¿t quáº£.</p><p>HÆ¡n ná»¯a, má»™t khi promise Ä‘Æ°á»£c resolve thÃ¬ nÃ³ sáº½ tá»“n táº¡i vÄ©nh viá»…n: nÃ³ trá»Ÿ thÃ nh má»™t giÃ¡ trá»‹ <strong>báº¥t biáº¿n</strong> táº¡i thá»i Ä‘iá»ƒm Ä‘Ã³, vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c láº¥y ra sá»­ dá»¥ng bao nhiÃªu láº§n cÅ©ng Ä‘Æ°á»£c</p><p>Thá»±c sá»± lÃ  ráº¥t há»¯u Ã­ch khi ta ná»‘i promise thanhf 1 chuá»—i:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delay</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">        setTimeout(resolve, time);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">delay(<span class="number">1000</span>)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"after 1000ms"</span>);</span><br><span class="line">    <span class="keyword">return</span> delay(<span class="number">2000</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"after another 2000ms"</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"step 4 (next Job)"</span>);</span><br><span class="line">    <span class="keyword">return</span> delay(<span class="number">5000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>Gá»i hÃ m delay(2000) sáº½ táº¡o ra 1 promise mÃ  nÃ³ Ä‘Æ°á»£c hoÃ n thÃ nh trong 2000ms, sau Ä‘Ã³ tráº£ nÃ³ vá» tá»« hÃ m hoÃ n thÃ nh trong .then() Ä‘áº§u tiÃªn, Ä‘iá»u nÃ y lÃ m cho hÃ m .then(â€¦) thá»© hai sáº½ chá» 2000ms</p><p><strong>LÆ°u Ã½</strong>: <em>Bá»Ÿi vÃ¬ giÃ¡ promise lÃ  báº¥t biáº¿n sau khi Ä‘Ã£ Ä‘Æ°á»£c resolve, chÃºng ta cÃ³ thá»ƒ truyá»n nÃ³ Ä‘i kháº¯p nÆ¡i mÃ  khÃ´ng cáº§n lo láº¯ng vá» viá»‡c nÃ³ báº¥t ngá» bá»‹ thay Ä‘á»•i. Äiá»u nÃ y Ä‘áº·c biá»‡t cÃ³ Ã­ch khi cÃ³ nhiá»u Ä‘oáº¡n code cÃ¹ng sá»­ dá»¥ng káº¿t quáº£ cá»§a 1 promise. TÃ­nh báº¥t biáº¿n nghe cÃ³ váº» nhÆ° lÃ  má»™t chá»§ Ä‘á» liÃªn quan Ä‘áº¿n há»c thuáº­t, nhÆ°ng tháº­t ra nÃ³ lÃ  1 pháº§n ráº¥t cÆ¡ báº£n vÃ  cÃ³ khÃ­a cáº¡nh quan trá»ng trong thiáº¿t káº¿ promise mÃ  ta khÃ´ng nÃªn bá» qua.</em></p><h1 id="Promise-hay-khong-Promise"><a href="#Promise-hay-khong-Promise" class="headerlink" title="Promise hay khÃ´ng Promise ?"></a>Promise hay khÃ´ng Promise ?</h1><p>Má»™t chi tiáº¿t quan trá»ng vá» promise lÃ  pháº£i biáº¿t má»™t giÃ¡ trá»‹ thá»±c sá»± lÃ  promise hay khÃ´ng pháº£i. NÃ³i cÃ¡ch khÃ¡c, Ä‘Ã³ cÃ³ pháº£i lÃ  1 giÃ¡ trá»‹ sáº½ hÃ nh xá»­ nhÆ° 1 promise?</p><p>ChÃºng ta biáº¿t ráº±ng promise Ä‘Æ°á»£c xÃ¢y dá»±ng báº±ng lá»‡nh new Promise(â€¦), vÃ  báº¡n cho ráº±ng p instanceof Promise lÃ  Ä‘á»§ Ä‘á»ƒ kiá»ƒm tra? Thá»±c ra thÃ¬ khÃ´ng háº³n.</p><p>Chá»§ yáº¿u bá»Ÿi vÃ¬ báº¡n cÃ³ thá»ƒ nháº­n giÃ¡ trá»‹ promise tá»« má»™t cá»­a sá»• trÃ¬nh duyá»‡t khÃ¡c (vÃ­ dá»¥: iframe), nÃ³ sáº½ cÃ³ promise riÃªng cá»§a nÃ³, khÃ¡c vá»›i promise trong cá»­a sá»•/frame hiá»‡n táº¡i cá»§a báº¡n, vÃ  cÃ¢u lá»‡nh check á»Ÿ trÃªn sáº½ fail khi xÃ¡c Ä‘á»‹nh instance cá»§a promise.</p><p>HÆ¡n ná»¯a, má»™t thÆ° viá»‡n hay framework cÃ³ thá»ƒ sá»­ dá»¥ng promise cá»§a riÃªng nÃ³ mÃ  khÃ´ng dÃ¹ng promise máº·c Ä‘á»‹nh cá»§a ES6. Tháº­t ra, báº¡n cÃ³ thá»ƒ dÃ¹ng promise cá»§a thÆ° viá»‡n trÃªn nhá»¯ng trÃ¬nh duyá»‡t cÅ© khÃ´ng há»— trá»£ promise.</p><h1 id="Nuot-chung-ngoai-le-exception"><a href="#Nuot-chung-ngoai-le-exception" class="headerlink" title="Nuá»‘t chá»­ng ngoáº¡i lá»‡ (exception)"></a>Nuá»‘t chá»­ng ngoáº¡i lá»‡ (exception)</h1><p>Náº¿u trong quÃ¡ trÃ¬nh táº¡o promise hoáº·c lÃ  khi tiáº¿p nháº­n káº¿t quáº£ tá»« nÃ³, má»™t lá»—i biá»‡t lá»‡ JS xáº£y ra, vÃ­ dá»¥ nhÆ° TypeError hoáº·c ReferenceError, exception sáº½ Ä‘Æ°á»£c báº¯t, khi Ä‘Ã³ nÃ³ sáº½ Ã©p (force) cho promise Ä‘ang cháº¡y bá»‹ reject.</p><p>VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    foo.bar();    <span class="comment">// `foo` chÆ°a Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a, lá»—i!</span></span><br><span class="line">    resolve(<span class="number">374</span>); <span class="comment">// Code sáº½ khÃ´ng Ä‘áº¿n Ä‘Æ°á»£c Ä‘Ã¢y :(</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fulfilled</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// khÃ´ng Ä‘áº¿n Ä‘Ã¢y luÃ´n :(</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">rejected</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// `err` sáº½ lÃ  má»™t object cá»§a exception`TypeError`</span></span><br><span class="line">    <span class="comment">// tá»« dÃ²ng `foo.bar()`.</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>NhÆ°ng náº¿u nhÆ° má»™t promise Ä‘Æ°á»£c hoÃ n thÃ nh nhÆ°ng cÃ³ lá»—i exception JS trong quÃ¡ trÃ¬nh tiáº¿p nháº­n (vÃ­ dá»¥ nhÆ° trong callback cá»§a .then(â€¦) )? Ká»ƒ cáº£ nhÆ° tháº¿ thÃ¬ nÃ³ cÅ©ng khÃ´ng bá»‹ máº¥t, báº¡n sáº½ tháº¥y má»™t chÃºt ngáº¡c nhiÃªn khi biáº¿t cÃ¡ch mÃ  chÃºng Ä‘Æ°á»£c xá»­ lÃ½. ÄÃ o sÃ¢u thÃªm 1 tÃ­ nÃ o:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">    resolve(<span class="number">374</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="keyword">function</span> <span class="title">fulfilled</span>(<span class="params">message</span>)</span>&#123;</span><br><span class="line">    foo.bar();</span><br><span class="line">    <span class="built_in">console</span>.log(message);   <span class="comment">// khÃ´ng Ä‘áº¿n Ä‘Æ°á»£c Ä‘Ã¢y nÃ¨.</span></span><br><span class="line">&#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">rejected</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// khÃ´ng Ä‘áº¿n Ä‘Æ°á»£c Ä‘Ã¢y nÃ¨.</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>CÃ³ váº» nhÆ° exception tá»« foo.bar() thá»±c sá»± Ä‘Ã£ bá»‹ nuá»‘t trÃ´i (swallow). ÄÃºng lÃ  nhÆ° tháº¿. CÃ³ gÃ¬ Ä‘Ã³ sÃ¢u hÆ¡n bÃªn trong Ä‘Ã£ hoáº¡t Ä‘á»™ng sai tuy nhiÃªn chÃºng ta láº¡i khÃ´ng biáº¿t. Lá»i gá»i p.then(â€¦) cho chÃ­nh nÃ³ tráº£ vá» 1 promise khÃ¡c vÃ  nÃ³ sáº½ bá»‹ reject vá»›i ReferenceError exception.</p><h1 id="Xu-ly-nhung-biet-le-khong-bi-bat-Uncaught-exception"><a href="#Xu-ly-nhung-biet-le-khong-bi-bat-Uncaught-exception" class="headerlink" title="Xá»­ lÃ½ nhá»¯ng biá»‡t lá»‡ khÃ´ng bá»‹ báº¯t (Uncaught exception)"></a>Xá»­ lÃ½ nhá»¯ng biá»‡t lá»‡ khÃ´ng bá»‹ báº¯t (Uncaught exception)</h1><p>CÃ³ nhiá»u cÃ¡ch tiáº¿p cáº­n khÃ¡c mÃ  nhiá»u ngÆ°á»i cho ráº±ng sáº½ tá»‘t hÆ¡n.</p><p>Má»™t Ä‘á» nghá»‹ phá»• biáº¿n Ä‘Ã³ lÃ  promise nÃªn cÃ³ thÃªm má»™t phÆ°Æ¡ng thá»©c done(â€¦), nÃ³ sáº½ Ä‘Ã¡nh dáº¥u chuá»—i promise lÃ  Ä‘Ã£ xong (done). .done(â€¦)khÃ´ng táº¡o ra vÃ  tráº£ vá» má»™t promise vÃ¬ tháº¿ callback truyá»n qua .done(â€¦) rÃµ rÃ ng lÃ  khÃ´ng liÃªn quan Ä‘áº¿n viá»‡c bÃ¡o cÃ¡o cÃ¡c váº¥n Ä‘á» xáº£y ra vá»›i má»™t chuá»—i promise khÃ´ng tá»“n táº¡i.</p><p>NÃ³ hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° báº¡n Ä‘Ã£ biáº¿t trong cÃ¡c Ä‘iá»u kiá»‡n uncaught error: cÃ¡c exception bÃªn trong má»™t hÃ m reject trong .done(â€¦) sáº½ bá»‹ báº¯n ra ngoÃ i developer console dÆ°á»›i dáº¡ng global uncaught error.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="built_in">Promise</span>.resolve(<span class="number">374</span>);</span><br><span class="line"></span><br><span class="line">p.then(<span class="function"><span class="keyword">function</span> <span class="title">fulfilled</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// Sá»‘ number khÃ´ng cÃ³ hÃ m cá»§a string,</span></span><br><span class="line">    <span class="comment">// nÃªn sáº½ báº¯n ra lá»—i</span></span><br><span class="line">    <span class="built_in">console</span>.log(msg.toLowerCase());</span><br><span class="line">&#125;)</span><br><span class="line">.done(<span class="literal">null</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Náº¿u cÃ³ uncaught exception á»Ÿ Ä‘Ã¢y thÃ¬ nÃ³ sáº½ bá»‹ báº¯n ra nhÆ° lÃ  má»™t global exception</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Dieu-gi-xay-ra-trong-ES8-va-Async-await"><a href="#Dieu-gi-xay-ra-trong-ES8-va-Async-await" class="headerlink" title="Äiá»u gÃ¬ xáº£y ra trong ES8 vÃ  Async/await"></a>Äiá»u gÃ¬ xáº£y ra trong ES8 vÃ  Async/await</h1><p>Javascript ES8 giá»›i thiá»‡u async/await Ä‘á»ƒ giÃºp cho cÃ´ng viá»‡c xá»­ lÃ½ promise dá»… dÃ ng hÆ¡n. ChÃºng ta sáº½ lÆ°á»›t sÆ¡ qua nhá»¯ng kháº£ nÄƒng mÃ  async/await cung cáº¥p vÃ  xem thá»­ lÃ m tháº¿ nÃ o Ä‘á»ƒ dÃ¹ng chÃºng Ä‘á»ƒ viáº¿t code báº¥t Ä‘á»“ng bá»™ má»™t cÃ¡ch phÃ¹ há»£p.</p><p>Váº­y thÃ¬ Ä‘áº§u tiÃªn lÃ  xem thá»­ hoáº¡t Ä‘á»™ng cá»§a async/await.</p><p>Báº¡n Ä‘á»‹nh nghÄ©a má»™t hÃ m báº¥t Ä‘á»“ng bá»™ sá»­ dá»¥ng Ä‘á»‹nh nghÄ©a hÃ m async. Nhá»¯ng hÃ m nhÆ° váº­y sáº½ tráº£ vá» object <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncFunction" target="_blank" rel="noopener">AsyncFunction</a>. Object AsyncFunction biá»ƒu diá»…n hÃ m báº¥t Ä‘á»“ng bá»™ trong Ä‘Ã³ nÃ³ thá»±c thi code bÃªn trong nÃ³.</p><p>Khi má»™t hÃ m async Ä‘Æ°á»£c gá»i, nÃ³ sáº½ tráº£ vá» Promise. Khi hÃ m async tráº£ vá» giÃ¡ trá»‹, nÃ³ láº¡i khÃ´ng pháº£i promise, má»™t promise sáº½ Ä‘Æ°á»£c táº¡o ra tá»± Ä‘á»™ng vÃ  Ä‘Æ°á»£c phÃ¢n giáº£i (resolve) vá»›i giÃ¡ trá»‹ tráº£ vá» tá»« hÃ m. Khi hÃ m async báº¯n ra exception, promise sáº½ reject vá»›i giÃ¡ trá»‹ báº¯n ra.</p><p>Má»™t hÃ m async cÃ³ thá»ƒ chá»©a thá»ƒ hiá»‡n await, nÃ³ sáº½ dá»«ng quÃ¡ trÃ¬nh thá»±c thi cá»§a hÃ m vÃ  Ä‘á»£i cho promise giáº£i quyáº¿t xong rá»“i quay láº¡i thá»±c thi tiáº¿p vÃ  tráº£ vá» giÃ¡ trá»‹ Ä‘Ã£ Ä‘Æ°á»£c resolve.</p><p>Báº¡n cÃ³ thá»ƒ xem nhÆ° promise trong JS tÆ°Æ¡ng tá»± vá»›i Java Future hay C# Task.</p><blockquote><p>Má»¥c Ä‘Ã­ch cá»§a async/await lÃ  lÃ m Ä‘Æ¡n giáº£n hÃ³a quÃ¡ trÃ¬nh sá»­ dá»¥ng promise.</p></blockquote><p>Xem vÃ­ dá»¥ sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HÃ m JS bÃ¬nh thÆ°á»ng</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNumber1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">'374'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Giá»‘ng nhÆ° hÃ m trÃªn</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getNumber2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">374</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TÆ°Æ¡ng tá»±, nhá»¯ng hÃ m báº¯n ra exception tÆ°Æ¡ng tá»± vá»›i nhá»¯ng hÃ m tráº£ vá» promise bá»‹ reject:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">'Some error'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">'Some error'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tá»« khÃ³a await chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng bÃªn trong hÃ m async vÃ  cho phÃ©p báº¡n chá» promise má»™t cÃ¡ch Ä‘á»“ng bá»™. Náº¿u chÃºng ta sá»­ dá»¥ng promise bÃªn ngoÃ i má»™t hÃ m async thÃ¬ pháº£i dÃ¹ng tá»›i callback:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// `rp` lÃ  má»™t hÃ m gá»i promise.</span></span><br><span class="line">    <span class="keyword">var</span> promise1 = rp(<span class="string">'https://api.example.com/endpoint1'</span>);</span><br><span class="line">    <span class="keyword">var</span> promise2 = rp(<span class="string">'https://api.example.com/endpoint2'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hiá»‡n táº¡i cáº£ 2 request Ä‘á»u Ä‘Æ°á»£c gá»i Ä‘á»“ng thá»i vÃ </span></span><br><span class="line">    <span class="comment">// ta pháº£i Ä‘á»£i cho nÃ³ hoÃ n thÃ nh.</span></span><br><span class="line">    <span class="keyword">var</span> response1 = <span class="keyword">await</span> promise1;</span><br><span class="line">    <span class="keyword">var</span> response2 = <span class="keyword">await</span> promise2;</span><br><span class="line">    <span class="keyword">return</span> response1 + <span class="string">' '</span> + response2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Bá»Ÿi vÃ¬ ta khÃ´ng á»Ÿ trong hÃ m `async` </span></span><br><span class="line"><span class="comment">// nÃªn chÃºng ta pháº£i dÃ¹ng `then()`.</span></span><br><span class="line">loadData().then(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'Done'</span>));</span><br></pre></td></tr></table></figure><p>Báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a hÃ m async báº±ng cÃ¡ch sá»­ dá»¥ng async function expression (AFE - Thá»ƒ hiá»‡n hÃ m async). Má»™t AFE tÆ°Æ¡ng tá»± vÃ  gáº§n giá»‘ng nhÆ° má»™t async function statement (AFS). Äiá»ƒm khÃ¡c biá»‡t chÃ­nh giá»¯a AFE vÃ  AFS lÃ  tÃªn cá»§a hÃ m, trong AFE ta cÃ³ thá»ƒ bá» qua tÃªn Ä‘á»ƒ táº¡o hÃ m vÃ´ danh (anonymous function). Má»™t AFE cÃ³ thá»ƒ sá»­ dá»¥ng nhÆ° má»™t IIFE (<a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE" target="_blank" rel="noopener">Immediately Invoked Function Expression</a>), loáº¡i hÃ m Ä‘Æ°á»£c thá»±c thi ngay sau khi nÃ³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a.</p><p>NÃ³ trÃ´ng nhÆ° tháº¿ nÃ y:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loadData = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// `rp` lÃ  má»™t hÃ m gá»i promise.</span></span><br><span class="line">    <span class="keyword">var</span> promise1 = rp(<span class="string">'https://api.example.com/endpoint1'</span>);</span><br><span class="line">    <span class="keyword">var</span> promise2 = rp(<span class="string">'https://api.example.com/endpoint2'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hiá»‡n táº¡i cáº£ 2 request Ä‘á»u Ä‘Æ°á»£c gá»i Ä‘á»“ng thá»i vÃ </span></span><br><span class="line">    <span class="comment">// ta pháº£i Ä‘á»£i cho nÃ³ hoÃ n thÃ nh.</span></span><br><span class="line">    <span class="keyword">var</span> response1 = <span class="keyword">await</span> promise1;</span><br><span class="line">    <span class="keyword">var</span> response2 = <span class="keyword">await</span> promise2;</span><br><span class="line">    <span class="keyword">return</span> response1 + <span class="string">' '</span> + response2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Quan trá»ng lÃ  async/await Ä‘Æ°á»£c há»— trá»£ vÃ  cÃ³ thá»ƒ cháº¡y trÃªn Ä‘a sá»‘ cÃ¡c trÃ¬nh duyá»‡t:</p><p> <a href="https://cdn-images-1.medium.com/max/1000/0*z-A-JIe5OWFtgyd2." target="_blank" rel="noopener"><img src="https://cdn-images-1.medium.com/max/1000/0*z-A-JIe5OWFtgyd2." alt=""></a> <a></a></p><p>Náº¿u nhÆ° trÃ¬nh duyá»‡t nÃ o khÃ´ng há»— trá»£ thÃ¬ ta váº«n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c JS transpiler nhÆ° <a href="https://babeljs.io/docs/plugins/transform-async-to-generator/" target="_blank" rel="noopener">Babel</a> hay <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-3.html" target="_blank" rel="noopener">TypeScript</a></p><p>Cuá»‘i cÃ¹ng thÃ¬ Ä‘iá»u quan trá»ng nháº¥t lÃ  khÃ´ng nÃªn chá»n lá»±a má»™t cÃ¡ch mÃ¹ quÃ¡ng nhá»¯ng cÃ¡ch tiáº¿p cáº­n â€œmá»›i nháº¥tâ€ Ä‘á»ƒ viáº¿t code báº¥t Ä‘á»“ng bá»™. Tá»‘t hÆ¡n lÃ  báº¡n hiá»ƒu vá» cáº¥u trÃºc báº¥t Ä‘á»“ng bá»™ cá»§a JS, nghiÃªn cá»©u táº¡i sao nÃ³ láº¡i lÃ  má»™t váº¥n Ä‘á» nghiÃªm tÃºc vÃ  hiá»ƒu má»™t cÃ¡ch sÃ¢u sáº¯c vá» cÃ¡c thÃ nh pháº§n bÃªn trong cá»§a giáº£i phÃ¡p mÃ  báº¡n lá»±a chá»n. Má»—i cÃ¡ch tiáº¿p cáº­n khÃ¡c nhau Ä‘á»u cÃ³ nhá»¯ng Ä‘iá»ƒm máº¡nh vÃ  Ä‘iá»ƒm yáº¿u, hÃ£y cÃ¢n nháº¯c.</p><h1 id="5-meo-de-viet-code-bat-dong-bo-vua-chac-chan-vua-de-bao-tri"><a href="#5-meo-de-viet-code-bat-dong-bo-vua-chac-chan-vua-de-bao-tri" class="headerlink" title="5 máº¹o Ä‘á»ƒ viáº¿t code báº¥t Ä‘á»“ng bá»™ vá»«a cháº¯c cháº¯n vá»«a dá»… báº£o trÃ¬"></a>5 máº¹o Ä‘á»ƒ viáº¿t code báº¥t Ä‘á»“ng bá»™ vá»«a cháº¯c cháº¯n vá»«a dá»… báº£o trÃ¬</h1><h3 id="1-Clean-code-code-sach"><a href="#1-Clean-code-code-sach" class="headerlink" title="1. Clean code (code sáº¡ch):"></a>1. <strong>Clean code (code sáº¡ch)</strong>:</h3><p>Sá»­ dá»¥ng async/await cho phÃ©p báº¡n viáº¿t code Ã­t hÆ¡n nhiá»u. Má»—i láº§n sá»­ dá»¥ng async/await báº¡n cÃ³ thá»ƒ bá» qua má»™t sá»‘ bÆ°á»›c khÃ´ng cáº§n thiáº¿t, vÃ­ dá»¥: .then(), viáº¿t hÃ m anonymous Ä‘á»ƒ xá»­ lÃ½ responsive, Ä‘áº·t tÃªn response tá»« callbackâ€¦</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `rp` lÃ  má»™t hÃ m gá»i promise</span></span><br><span class="line">rp(â€˜https:<span class="comment">//api.example.com/endpoint1').then(function(data) &#123;</span></span><br><span class="line"> <span class="comment">// â€¦</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>â€¦so vá»›i</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `rp` lÃ  má»™t hÃ m gá»i promise</span></span><br><span class="line"><span class="keyword">var</span> response = <span class="keyword">await</span> rp(â€˜https:<span class="comment">//api.example.com/endpoint1');</span></span><br></pre></td></tr></table></figure><h3 id="2-Xu-ly-loi"><a href="#2-Xu-ly-loi" class="headerlink" title="2. Xá»­ lÃ½ lá»—i:"></a>2. <strong>Xá»­ lÃ½ lá»—i</strong>:</h3><p>Async/await giÃºp chÃºng ta cÃ³ thá»ƒ xá»­ lÃ½ cáº£ lá»—i Ä‘á»“ng bá»™ vÃ  báº¥t Ä‘á»“ng bá»™ vá»›i cÃ¹ng má»™t cáº¥u trÃºc code: chÃ­nh lÃ  try/catch ná»•i tiáº¿ng. VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; <span class="comment">// Catches synchronous errors.</span></span><br><span class="line">        getJSON().then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> parsed = <span class="built_in">JSON</span>.parse(response);</span><br><span class="line">            <span class="built_in">console</span>.log(parsed);</span><br><span class="line">        &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; <span class="comment">// Catches asynchronous errors</span></span><br><span class="line">            <span class="built_in">console</span>.log(e); </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€¦so vá»›i</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(<span class="keyword">await</span> getJSON());</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Dieu-kien"><a href="#3-Dieu-kien" class="headerlink" title="3. Äiá»u kiá»‡n:"></a>3. <strong>Äiá»u kiá»‡n</strong>:</h3><p>Viáº¿t code Ä‘iá»u kiá»‡n vá»›i async/await rÃµ rÃ ng hÆ¡n ráº¥t nhiá»u:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getJSON()</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (response.needsAnotherRequest) &#123;</span><br><span class="line">        <span class="keyword">return</span> makeAnotherRequest(response)</span><br><span class="line">          .then(<span class="function"><span class="keyword">function</span>(<span class="params">anotherResponse</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(anotherResponse)</span><br><span class="line">            <span class="keyword">return</span> anotherResponse</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€¦so vá»›i</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> response = <span class="keyword">await</span> getJSON();</span><br><span class="line">  <span class="keyword">if</span> (response.needsAnotherRequest) &#123;</span><br><span class="line">    <span class="keyword">var</span> anotherResponse = <span class="keyword">await</span> makeAnotherRequest(response);</span><br><span class="line">    <span class="built_in">console</span>.log(anotherResponse)</span><br><span class="line">    <span class="keyword">return</span> anotherResponse</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">    <span class="keyword">return</span> response;    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Stack-Frames"><a href="#4-Stack-Frames" class="headerlink" title="4. Stack Frames:"></a>4. <strong>Stack Frames</strong>:</h3><p>KhÃ´ng giá»‘ng nhÆ° async/await, stack lá»—i tráº£ vá» tá»« má»™t chuá»—i promise lÃ m chÃºng ta khÃ´ng biáº¿t lá»—i xuáº¥t phÃ¡t tá»« Ä‘Ã¢u mÃ  láº§n:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> callAPromise()</span><br><span class="line">    .then(callback1)</span><br><span class="line">    .then(callback2)</span><br><span class="line">    .then(callback3)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"boom"</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">loadData()</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line"><span class="comment">// Error: boom at callAPromise.then.then.then.then (index.js:8:13)</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>â€¦so vá»›i</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> callAPromise1()</span><br><span class="line">  <span class="keyword">await</span> callAPromise2()</span><br><span class="line">  <span class="keyword">await</span> callAPromise3()</span><br><span class="line">  <span class="keyword">await</span> callAPromise4()</span><br><span class="line">  <span class="keyword">await</span> callAPromise5()</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"boom"</span>);</span><br><span class="line">&#125;</span><br><span class="line">loadData()</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="comment">// Error: boom at loadData (index.js:7:9)</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="5-Qua-trinh-Debug"><a href="#5-Qua-trinh-Debug" class="headerlink" title="5. QuÃ¡ trÃ¬nh Debug:"></a>5. <strong>QuÃ¡ trÃ¬nh Debug</strong>:</h3><p>Náº¿u báº¡n Ä‘Ã£ tá»«ng sá»­ dá»¥ng promise, báº¡n sáº½ biáº¿t ráº±ng debug vá»›i chÃºng thá»±c sá»± lÃ  Ã¡c má»™ng. Giáº£ sá»­ báº¡n Ä‘áº·t breakpoint bÃªn trong .then() vÃ  dÃ¹ng nhá»¯ng lá»‡nh debug nhÆ° stop-over, debugger sáº½ khÃ´ng Ä‘i Ä‘áº¿n .then() tiáº¿p theo bá»Ÿi vÃ¬ nÃ³ â€œlá»¡ chÃ¢nâ€ bÆ°á»›c vÃ o code báº¥t Ä‘á»“ng bá»™.<br>Vá»›i async/await báº¡n cÃ³ thá»ƒ duyá»‡t qua nhá»¯ng lá»i gá»i await chÃ­nh xÃ¡c nhÆ° nhá»¯ng hÃ m Ä‘á»“ng bá»™ thÃ´ng thÆ°á»ng.</p><p><strong>Viáº¿t code Javascript báº¥t Ä‘á»“ng bá»™ lÃ  ráº¥t quan trá»ng khÃ´ng chá»‰ cho app mÃ  cáº£ cho nhá»¯ng thÆ° viá»‡n ná»¯a</strong>.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ChÃ o cÃ¡c báº¡n Ä‘áº¿n vá»›i bÃ i thá»© 4 trong series Ä‘á»¥c khoÃ©t vÃ  khÃ¡m phÃ¡ Javascript cÅ©ng nhÆ° cÃ¡c thÃ nh pháº§n cá»§a nÃ³. Trong quÃ¡ trÃ¬nh xÃ¡c Ä‘á»‹nh vÃ  tÃ¬m hiá»ƒu cÃ¡c thÃ nh pháº§n cá»‘t lÃµi, tÃ¡c giáº£ cÅ©ng chia sáº» má»™t sá»‘ nguyÃªn táº¯c mÃ  há» Ä‘ang dÃ¹ng Ä‘á»ƒ xÃ¢y dá»±ng SessionStack, má»™t á»©ng dá»¥ng Javascript hÆ°á»›ng Ä‘áº¿n sá»± máº¡nh máº½, hiá»‡u nÄƒng cao vÃ  á»•n Ä‘á»‹nh.&lt;/p&gt;
&lt;p&gt;Láº§n nÃ y chÃºng ta sáº½ má»Ÿ rá»™ng nhá»¯ng gÃ¬ cÃ³ trong bÃ i Ä‘áº§u tiÃªn báº±ng cÃ¡ch Ä‘Ã¡nh giÃ¡ nhá»¯ng nhÆ°á»£c Ä‘iá»ƒm cá»§a mÃ´i trÆ°á»ng Ä‘Æ¡n luá»“ng (single thread) vÃ  lÃ m tháº¿ nÃ o Ä‘á»ƒ vÆ°á»£t qua chÃºng nháº±m xÃ¢y dá»±ng nhá»¯ng Javascript UI áº¥n tÆ°á»£ng. VÃ  váº«n nhÆ° cÅ©, cuá»‘i bÃ i viáº¿t tÃ¡c giáº£ sáº½ chia sáº» 5 máº¹o nhá» Ä‘á»ƒ viáº¿t code tá»‘t hÆ¡n vá»›i async/await.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>CÃ¡ch Javascript hoáº¡t Ä‘á»™ng P3: Quáº£n lÃ½ bá»™ nhá»› &amp; 4 trÆ°á»ng há»£p memory leaks phá»• biáº¿n</title>
    <link href="http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P3-Quan-ly-bo-nho-4-truong-hop-memory-leaks-pho-bien.html"/>
    <id>http://nthung2112.github.io/2018/11/Cach-Javascript-hoat-dong-P3-Quan-ly-bo-nho-4-truong-hop-memory-leaks-pho-bien.html</id>
    <published>2018-11-13T16:03:00.000Z</published>
    <updated>2018-11-13T16:05:48.137Z</updated>
    
    <content type="html"><![CDATA[<p>Máº¥y hÃ´m trÆ°á»›c chÃºng ta Ä‘Ã£ báº¯t Ä‘áº§u series bÃ i viáº¿t Ä‘á»¥c khoÃ©t vá» Javascript vÃ  cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o, báº±ng cÃ¡ch hiá»ƒu vá» nhá»¯ng thÃ nh pháº§n cÆ¡ báº£n vÃ  cÃ¡ch chÃºng tÆ°Æ¡ng tÃ¡c vá»›i nhau thÃ¬ chÃºng ta cÃ³ thá»ƒ viáº¿t code tá»‘t hÆ¡n vÃ  <em>ngon</em> hÆ¡n.</p><p>BÃ i Ä‘áº§u tiÃªn lÃ  tá»•ng quan vá» series, cung cáº¥p cÃ¡i nhÃ¬n toÃ n cáº£nh vá» engine, runtime &amp; callstack. BÃ i thá»© 2 lÃ  má»™t cÃ¡i nhÃ¬n cá»¥ thá»ƒ hÆ¡n vá» nhá»¯ng thÃ nh pháº§n bÃªn trong cá»§a bá»™ engine V8 cá»§a Google vÃ  má»™t sá»‘ máº¹o váº·t Ä‘á»ƒ tá»‘i Æ°u Javascript code.</p><p>á» bÃ i thá»© 3 nÃ y, chÃºng ta sáº½ tháº£o luáº­n vá» má»™t váº¥n Ä‘á» khÃ´ng kÃ©m pháº§n quan trá»ng nhÆ°ng láº¡i thÆ°á»ng bá»‹ cÃ¡c dev bá» qua do sá»± phá»©c táº¡p ngÃ y cÃ ng gia tÄƒng cá»§a cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh thÆ°á»ng dÃ¹ng: quáº£n lÃ½ bá»™ nhá»›. ChÃºng ta cÅ©ng sáº½ tÃ¬m hiá»ƒu má»™t sá»‘ máº¹o Ä‘á»ƒ cÃ³ thá»ƒ xá»­ lÃ½ nhá»¯ng trÆ°á»ng há»£p rÃ² rÃ¬ bá»™ nhá»› cá»§a Javascript mÃ  team SesstionStack Ä‘Ã£ Ã¡p dá»¥ng Ä‘á»ƒ trÃ¡nh bá»‹ rÃ² rá»‰ vÃ  khÃ´ng lÃ m tá»‘n bá»™ nhá»› cá»§a webapp.<br><a id="more"></a></p><h1 id="Tong-quan"><a href="#Tong-quan" class="headerlink" title="Tá»•ng quan"></a>Tá»•ng quan</h1><p>Nhá»¯ng ngÃ´n ngá»¯ nhÆ° C cÃ³ bá»™ quáº£n lÃ½ bá»™ nhá»› level tháº¥p khÃ¡ cÆ¡ báº£n lÃ  malloc() vÃ  free(). Nhá»¯ng phÆ°Æ¡ng thá»©c nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cáº¥p phÃ¡t má»™t cÃ¡ch tÆ°á»ng minh vÃ  giáº£i phÃ³ng bá»™ nhá»› trÃªn há»‡ Ä‘iá»u hÃ nh.</p><p>Má»™t cÃ¡ch tÆ°Æ¡ng tá»±, Javascript cáº¥p phÃ¡t bá»™ nhá»› khi object, string, â€¦ Ä‘Æ°á»£c táº¡o ra vÃ  <em>tá»± Ä‘á»™ng</em> giáº£i phÃ³ng nÃ³ má»—i khi khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng ná»¯a bá»Ÿi má»™t tiáº¿n trÃ¬nh dá»n rÃ¡c (garbage collection). QuÃ¡ trÃ¬nh giáº£i phÃ³ng tÃ i nguyÃªn má»™t cÃ¡ch <em>tá»± Ä‘á»™ng hÃ³a</em> nhÆ° tháº¿ nÃ y gÃ¢y ra sá»± nháº§m láº«n vÃ  lÃ m cho Javascript (vÃ  nhá»¯ng ngÃ´n ngá»¯ báº­c cao khÃ¡c) developer cáº£m tháº¥y â€œáº¥n tÆ°á»£ngâ€ nÃªn há» thÆ°á»ng bá» qua váº¥n Ä‘á» quáº£n lÃ½ bá»™ nhá»›. <strong>ÄÃ¢y lÃ  má»™t sai láº§m lá»›n.</strong></p><p>Ká»ƒ cáº£ khi lÃ m viá»‡c vá»›i ngÃ´n ngá»¯ báº­c cao, developer cÅ©ng nÃªn hiá»ƒu vá» váº¥n Ä‘á» quáº£n lÃ½ bá»™ nhá»› (Ã­t nháº¥t lÃ  nhá»¯ng thá»© cÆ¡ báº£n). Thá»‰nh thoáº£ng cÃ³ nhá»¯ng váº¥n Ä‘á» xáº£y ra vá»›i quáº£n lÃ½ bá»™ nhá»› tá»± Ä‘á»™ng (bug hay sá»± giá»›i háº¡n thá»±c hiá»‡n trong GCâ€¦) mÃ  developer cáº§n pháº§n hiá»ƒu Ä‘á»ƒ cÃ³ thá»ƒ xá»­ lÃ½ má»™t cÃ¡ch Ä‘Ãºng Ä‘áº¯n (hoáº·c tÃ¬m cÃ¡ch â€œÄ‘i Ä‘Æ°á»ng vÃ²ngâ€ vÆ°á»£t qua nÃ³ vá»›i Ã­t thiá»‡t háº¡i nháº¥t).</p><h1 id="Vong-doi-cua-bo-nho"><a href="#Vong-doi-cua-bo-nho" class="headerlink" title="VÃ²ng Ä‘á»i cá»§a bá»™ nhá»›"></a>VÃ²ng Ä‘á»i cá»§a bá»™ nhá»›</h1><p>DÃ¹ cho báº¡n Ä‘ang dÃ¹ng ngÃ´n ngá»¯ láº­p trÃ¬nh nÃ o Ä‘i ná»¯a thÃ¬ vÃ²ng Ä‘á»i bá»™ nhá»› háº§u nhÆ° Ä‘á»u giá»‘ng nhau:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*slxXgq_TO38TgtoKpWa_jQ.png" alt=""></p><p>ÄÃ¢y lÃ  nhá»¯ng gÃ¬ xáº£y ra á»Ÿ má»—i bÆ°á»›c trong vÃ²ng Ä‘á»i:</p><ul><li><p><strong>Cáº¥p phÃ¡t bá»™ nhá»›</strong>: bá»™ nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t bá»Ÿi há»‡ Ä‘iá»u hÃ nh vÃ  cho phÃ©p chÆ°Æ¡ng trÃ¬nh sá»­ dá»¥ng nÃ³. á» ngÃ´n ngá»¯ báº­c tháº¥p (nhÆ° C), Ä‘Ã¢y lÃ  má»™t quÃ¡ trÃ¬nh tÆ°á»ng minh, rÃµ rÃ ng mÃ  developer pháº£i xá»­ lÃ½. Trong cÃ¡c ngÃ´n ngá»¯ báº­c cao thÃ¬ pháº§n nÃ y ngÃ´n ngá»¯ sáº½ lÃ m giÃºp báº¡n.</p></li><li><p><strong>Sá»­ dá»¥ng bá»™ nhá»›</strong>: ÄÃ¢y lÃ  thá»i Ä‘iá»ƒm khi chÆ°Æ¡ng tÃ¬nh cá»§a báº¡n sá»­ dá»¥ng nhá»¯ng vÃ¹ng nhá»› Ä‘Ã£ Ä‘Æ°á»£c cáº¥p phÃ¡t trÆ°á»›c Ä‘Ã³. CÃ¡c thao tÃ¡c Äá»c vÃ  Ghi Ä‘Æ°á»£c thá»±c hiá»‡n khi chÃºng ta thá»±c thi nhá»¯ng biáº¿n Ä‘Ã£ Ä‘Æ°á»£c khai bÃ¡o trong code.</p></li><li><p><strong>Giáº£i phÃ³ng bá»™ nhá»›</strong>: Giá» lÃ  lÃºc giáº£i phÃ³ng toÃ n bá»™ nhá»¯ng vÃ¹ng nhá»› mÃ  báº¡n khÃ´ng cÃ²n dÃ¹ng Ä‘áº¿n ná»¯a Ä‘á»ƒ sá»­ dá»¥ng láº¡i vá» sau. Giá»‘ng nhÆ° pháº§n cáº¥p phÃ¡t, bÆ°á»›c nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n má»™t cÃ¡ch tÆ°á»ng minh trong cÃ¡c ngÃ´n ngá»¯ báº­c tháº¥p.</p></li></ul><p>Äá»ƒ hiá»ƒu thÃªm vá» cÃ¡c khÃ¡i niá»‡m cá»§a callstack vÃ  heap thÃ¬ má»i báº¡n xem láº¡i <a href="https://kipalog.com/posts/Duc-khoet-Javascript--Phan-1---Khai-quat-ve-engine--runtime-va-callstack" target="_blank" rel="noopener">Pháº§n 1</a> cá»§a series.</p><h1 id="Bo-nho-la-gi"><a href="#Bo-nho-la-gi" class="headerlink" title="Bá»™ nhá»› lÃ  gÃ¬?"></a>Bá»™ nhá»› lÃ  gÃ¬?</h1><p>TrÆ°á»›c khi Ä‘i sÃ¢u vÃ o bá»™ nhá»› cá»§a Javascript, chÃºng ta sáº½ duyá»‡t sÆ¡ qua bá»™ nhá»› cÆ¡ báº£n vÃ  cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a nÃ³.</p><p>á» pháº§n cá»©ng, bá»™ nhá»› mÃ¡y tÃ­nh bao gá»“m má»™t cÆ¡ sá»‘ cÃ¡c <a href="https://vi.wikipedia.org/wiki/Flip-flop" target="_blank" rel="noopener">flip flops</a> (Ä‘áº¡i khÃ¡i lÃ  1 tráº¡ng thÃ¡i Ä‘Ã³ng-má»Ÿ). Má»—i flip-flop chá»©a má»™t vÃ i transistor vÃ  cÃ³ thá»ƒ lÆ°u trá»¯ 1 bit thÃ´ng tin. Má»™t flip-flop Ä‘á»™c láº­p cÃ³ thá»ƒ Ä‘Æ°á»£c truy xuáº¥t báº±ng sá»‘ Ä‘á»‹nh danh duy nháº¥t (<strong>unique identifier</strong>), do Ä‘Ã³ chÃºng ta cÃ³ thá»ƒ Ä‘á»c vÃ  ghi lÃªn chÃºng. VÃ  láº½ dÄ© nhiÃªn, vá» máº·t Ã½ tÆ°á»Ÿng chÃºng ta cÃ³ thá»ƒ cÃ´ng nháº­n ráº±ng toÃ n bá»™ bá»™ nhá»› mÃ¡y tÃ­nh lÃ  1 máº£ng khá»•ng lá»“ cÃ¡c bit cÃ³ thá»ƒ Ä‘á»c &amp; ghi.</p><p>Vá» pháº§n con ngÆ°á»i thÃ¬ há» khÃ´ng giá»i lÃ m viá»‡c vá»›i bit nÃªn tá»• chá»©c chÃºng vÃ o nhá»¯ng nhÃ³m lá»›n hÆ¡n, 8 bit thÃ nh 1 byte. NgoÃ i byte cÃ²n cÃ³ word (16 hoáº·c 32 bit)</p><p>CÃ³ ráº¥t nhiá»u thá»© Ä‘Æ°á»£c lÆ°u trá»¯ trong bá»™ nhá»›:</p><ol><li>Táº¥t cáº£ cÃ¡c biáº¿n vÃ  dá»¯ liá»‡u Ä‘Æ°á»£c sá»­ dá»¥ng trong cÃ¡c chÆ°Æ¡ng trÃ¬nh.</li><li>Code cá»§a chÆ°Æ¡ng trÃ¬nh cháº¡y, ká»ƒ cáº£ code cá»§a há»‡ Ä‘iá»u hÃ nh.</li></ol><p>TrÃ¬nh biÃªn dá»‹ch vÃ  há»‡ Ä‘iá»u hÃ nh lÃ m viá»‡c vá»›i nhau Ä‘á»ƒ xá»­ lÃ½ háº§u nhÆ° toÃ n bá»™ pháº§n quáº£n lÃ½ bá»™ nhá»› nhÆ°ng chÃºng tÃ´i khuyáº¿n cÃ¡o báº¡n nÃªn cÃ³ cÃ¡i nhÃ¬n sÆ¡ lÆ°á»£c vá» nhá»¯ng gÃ¬ xáº£y ra á»Ÿ ná»™i bá»™ bÃªn trong.</p><p>Khi biÃªn dá»‹ch code, trÃ¬nh biÃªn dá»‹ch sáº½ xem xÃ©t cÃ¡c kiá»ƒu dá»¯ liá»‡u nguyÃªn thá»§y (string, number, booleanâ€¦) vÃ  tÃ­nh toÃ¡n trÆ°á»›c bao nhiÃªu bá»™ nhá»› mÃ  chÃºng cáº§n sá»­ dá»¥ng. LÆ°á»£ng bá»™ nhá»› cáº§n thiáº¿t sau Ä‘Ã³ sáº½ Ä‘Æ°á»£c cáº¥p phÃ¡t cho chÆ°Æ¡ng tÃ¬nh trong khÃ´ng gian callstack. VÃ¹ng khÃ´ng gian Ä‘Æ°á»£c cáº¥p phÃ¡t Ä‘Æ°á»£c gá»i lÃ  stack space bá»Ÿi vÃ¬ khi gá»i hÃ m, bá»™ nhá»› cá»§a nÃ³ Ä‘Æ°á»£c thÃªm vÃ o vá»‹ trÃ­ trÃªn cÃ¹ng cá»§a bá»™ nhá»› hiá»‡n táº¡i. VÃ  khi há»§y bá», chÃºng bá»‹ gá»¡ bá» theo quy táº¯c LIFO (last-in-first-out, vÃ o sau ra trÆ°á»›c). VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int n; <span class="comment">// 4 bytes</span></span><br><span class="line">int x[<span class="number">4</span>]; <span class="comment">// máº£ng 4 pháº§n tá»­, má»—i pháº§n tá»­ 4 bytes</span></span><br><span class="line">double m; <span class="comment">// 8 bytes</span></span><br></pre></td></tr></table></figure><p>TrÃ¬nh biÃªn dá»‹ch sáº½ tÃ­nh toÃ¡n ngay láº­p tá»©c Ä‘oáº¡n code nÃ y cáº§n 4 + 4 * 4 + 8 = 28 bytes</p><blockquote><p>ÄÃ³ lÃ  cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a kÃ­ch thÆ°á»›c vÃ¹ng nhá»› cho kiá»ƒu sá»‘ integer vÃ  double. Khoáº£ng 20 nÄƒm trÆ°á»›c, integer lÃ  2 byte vÃ  double lÃ  4 byte. Code cá»§a báº¡n khÃ´ng pháº£i phá»¥ thuá»™c vÃ o kÃ­ch thÆ°á»›c cá»§a cÃ¡c kiá»ƒu dá»¯ liá»‡u cÆ¡ báº£n.</p></blockquote><p>TrÃ¬nh biÃªn dá»‹ch sáº½ chÃ¨n code tÆ°Æ¡ng tÃ¡c vá»›i há»‡ Ä‘iá»u hÃ nh Ä‘á»ƒ yÃªu cáº§u sá»‘ lÆ°á»£ng byte cáº§n thiáº¿t Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c biáº¿n.</p><p>Trong vÃ­ dá»¥ trÃªn, trÃ¬nh biÃªn dá»‹ch biáº¿t chÃ­nh xÃ¡c bao nhiÃªu bá»™ nhá»› cáº§n thiáº¿t cho má»—i biáº¿n. Thá»±c táº¿ thÃ¬ má»—i khi ghi dá»¯ liá»‡u vÃ o biáº¿n n, nÃ³ sáº½ Ä‘Æ°á»£c dá»‹ch ná»™i bá»™ thÃ nh má»™ thá»© Ä‘áº¡i loáº¡i nhÆ° â€œÄ‘á»‹a chá»‰ vÃ¹ng nhá»› 4127963â€</p><p>Äá»ƒ Ã½ ráº±ng náº¿u ta thá»­ truy xuáº¥t x[4] thÃ¬ ta sáº½ truy xuáº¥t nháº§m sang dá»¯ liá»‡u Ä‘ang liÃªn káº¿t vá»›i m. Bá»Ÿi vÃ¬ chÃºng ta Ä‘ang cá»‘ truy xuáº¥t vÃ o má»™t pháº§n tá»­ khÃ´ng tá»“n táº¡i trong máº£ng: 4 byte nÃ y náº±m ngoÃ i vÃ¹ng x[3] vá»‘n lÃ  vÃ¹ng nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t cuá»‘i cÃ¹ng cá»§a máº£ng (index Ä‘Ã¡nh tá»« 0 :v), vÃ  váº­y lÃ  cÃ³ thá»ƒ ta Ä‘á»c/ghi nháº§m sang cÃ¡c bit cá»§a biáº¿n m. Äiá»u nÃ y cÃ³ thá»ƒ gÃ¢y ra nhiá»u háº­u quáº£ khÃ´ng mong muá»‘n cho toÃ n bá»™ chÆ°Æ¡ng trÃ¬nh. Xem hÃ¬nh cho rÃµ hÆ¡n nhÃ©:</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*5aBou4onl1B8xlgwoGTDOg.png" alt=""></p><p>Khi má»™t hÃ m gá»i má»™t hÃ m khÃ¡c thÃ¬ má»—i hÃ m sáº½ chiáº¿m má»™t pháº§n cá»§a stack. Pháº§n Ä‘Ã³ sáº½ lÆ°u giá»¯ táº¥t cáº£ nhá»¯ng biáº¿n cá»¥c bá»™ cÅ©ng nhÆ° má»™t bá»™ Ä‘áº¿m Ä‘á»ƒ ghi nhá»› vá»‹ trÃ­ mÃ  quÃ¡ trÃ¬nh thá»±c thi cá»§a hÃ m dá»«ng láº¡i. Khi hÃ m káº¿t thÃºc thÃ¬ vÃ¹ng bá»™ nhá»› láº¡i Ä‘Æ°á»£c giáº£i phÃ³ng cho tháº±ng khÃ¡c dÃ¹ng.</p><h1 id="Cap-phat-dong"><a href="#Cap-phat-dong" class="headerlink" title="Cáº¥p phÃ¡t Ä‘á»™ng"></a>Cáº¥p phÃ¡t Ä‘á»™ng</h1><p>Tháº­t khÃ´ng may lÃ  má»i thá»© dÆ°á»ng nhÆ° khÃ´ng dá»… nhÆ° ta tÆ°á»Ÿng khi mÃ  ta khÃ´ng biáº¿t bao nhiÃªu bá»™ nhá»› 1 biáº¿n cÃ³ thá»ƒ cáº§n táº¡i thá»i Ä‘iá»ƒm thá»±c thi. Giáº£ sá»­ chÃºng ta muá»‘n lÃ m nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int n = readInput(); <span class="comment">// Ä‘á»c input tá»« ngÆ°á»i dÃ¹ng</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// táº¡o 1 máº£ng vá»›i "n" pháº§n tá»­</span></span><br></pre></td></tr></table></figure><p>Táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch, trÃ¬nh biÃªn dá»‹ch khÃ´ng biáº¿t máº£ng sáº½ cáº§n bao nhiÃªu bá»™ nhá»› bá»Ÿi vÃ¬ nÃ³ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi dá»¯ liá»‡u nháº­p vÃ o tá»« phÃ­a ngÆ°á»i dÃ¹ng.</p><p>VÃ¬ tháº¿ nÃ³ khÃ´ng thá»ƒ cáº¥p phÃ¡t vÃ¹ng nhá»› cho biáº¿n trÃªn stack. Thay vÃ¬ tháº¿, chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta cáº§n há»i há»‡ Ä‘iá»u hÃ nh vá» kÃ­ch thÆ°á»›c bá»™ nhá»› phÃ¹ há»£p trong khi thá»±c thi (run-time). VÃ¹ng nhá»› nÃ y Ä‘Æ°á»£c gÃ¡n tá»« khÃ´ng gian <em>heap</em>. Sá»± khÃ¡c biá»‡t giá»¯a cáº¥p phÃ¡t bá»™ nhá»› Ä‘á»™ng vÃ  tÄ©nh Ä‘Æ°á»£c tá»•ng káº¿t trong báº£ng sau:</p><table><thead><tr><th>Cáº¥p phÃ¡t tÄ©nh</th><th>Cáº¥p phÃ¡t Ä‘á»™ng</th></tr></thead><tbody><tr><td>Biáº¿t kÃ­ch thÆ°á»›c táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch.</td><td>KhÃ´ng biáº¿t kÃ­ch thá»©c lÃºc biÃªn dá»‹ch</td></tr><tr><td>Thá»±c hiá»‡n lÃºc biÃªn dá»‹ch</td><td>Thá»±c hiá»‡n lÃºc thá»±c thi (runtime)</td></tr><tr><td>GÃ¡n vÃ o stack</td><td>GÃ¡n vÃ o heap</td></tr><tr><td>GÃ¡n theo thá»© tá»± FILO (first-in-last-out)</td><td>GÃ¡n khÃ´ng theo thá»© tá»± cá»¥ thá»ƒ nÃ o cáº£</td></tr></tbody></table><p>Äá»ƒ cÃ³ thá»ƒ cÃ³ cÃ¡i nhÃ¬n sÃ¢u sáº¯c vá» cáº¥p phÃ¡t bá»™ nhá»› Ä‘á»™ng, cÃ³ thá»ƒ chÃºng ta cáº§n dÃ nh thÃªm thá»i gian tÃ¬m hiá»ƒu vá» <strong>con trá»</strong>, nhÆ°ng nhÆ° váº­y thÃ¬ hÆ¡i bá»‹ láº¡c Ä‘á». Náº¿u báº¡n tháº¥y cÃ³ há»©ng thÃº vá»›i chá»§ Ä‘á» nÃ y thÃ¬ xin lá»—i pháº£i háº¹n báº¡n trong 1 bÃ i viáº¿t khÃ¡c rá»“i.</p><h1 id="Cap-phat-trong-Javascript"><a href="#Cap-phat-trong-Javascript" class="headerlink" title="Cáº¥p phÃ¡t trong Javascript"></a>Cáº¥p phÃ¡t trong Javascript</h1><p>Javascript giÃºp developer giáº£m bá»›t trÃ¡ch nhiá»‡m trong viá»‡c cáº¥p phÃ¡t bá»™ nhá»›. JS tá»± lÃ m háº¿t má»i thá»©.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">374</span>; <span class="comment">// cáº¥p phÃ¡t bá»™ nhá»› cho sá»‘</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="string">'sessionstack'</span>; <span class="comment">// cáº¥p phÃ¡t cho string </span></span><br><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="literal">null</span></span><br><span class="line">&#125;; <span class="comment">// cáº¥p phÃ¡t cho object vÃ  cÃ¡c thuá»™c tÃ­nh cá»§a nÃ³</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="literal">null</span>, <span class="string">'str'</span>];  <span class="comment">// (giá»‘ng nhÆ° object) cáº¥p phÃ¡t cho</span></span><br><span class="line">                           <span class="comment">// máº£ng vÃ  cÃ¡c giÃ¡ tá»‹ cá»§a nÃ³</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + <span class="number">3</span>;</span><br><span class="line">&#125; <span class="comment">// cáº¥p phÃ¡t cho hÃ m (lÃ  1 object cÃ³ thá»ƒ thá»±c thi)</span></span><br><span class="line"><span class="comment">// function expressions cÅ©ng cáº¥p phÃ¡t object</span></span><br><span class="line">someElement.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  someElement.style.backgroundColor = <span class="string">'blue'</span>;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>Má»™t vÃ i lá»i gá»i hÃ m cÅ©ng tráº£ vá» dáº¡ng cáº¥p phÃ¡t object:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// cáº¥p phÃ¡t Date object</span></span><br><span class="line"><span class="keyword">var</span> e = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>); <span class="comment">// cáº¥p phÃ¡t 1 pháº§n tá»­ DOM</span></span><br></pre></td></tr></table></figure><p>PhÆ°Æ¡ng thá»©c cÃ³ thá»ƒ cáº¥p phÃ¡t giÃ¡ trá»‹ hoáº·c object:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">'sessionstack'</span>;</span><br><span class="line"><span class="keyword">var</span> s2 = s1.substr(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">// s2 lÃ  1 string má»›i</span></span><br><span class="line"><span class="comment">// Bá»Ÿi vÃ¬ string lÃ  báº¥t biáº¿n, </span></span><br><span class="line"><span class="comment">// JavaScript cÃ³ thá»ƒ chá»n khÃ´ng cáº¥p phÃ¡t bá»™ nhá»›</span></span><br><span class="line"><span class="comment">// mÃ  lÆ°u trá»¯ pháº¡m vi [0, 3]</span></span><br><span class="line"><span class="keyword">var</span> a1 = [<span class="string">'str1'</span>, <span class="string">'str2'</span>];</span><br><span class="line"><span class="keyword">var</span> a2 = [<span class="string">'str3'</span>, <span class="string">'str4'</span>];</span><br><span class="line"><span class="keyword">var</span> a3 = a1.concat(a2); </span><br><span class="line"><span class="comment">// máº£ng má»›i gá»“m 4 pháº§n tá»­ lÃ </span></span><br><span class="line"><span class="comment">// sá»± káº¿t há»£p cá»§a máº£ng a1 vÃ  a2</span></span><br></pre></td></tr></table></figure><h1 id="Su-dung-bo-nho-trong-Javascript"><a href="#Su-dung-bo-nho-trong-Javascript" class="headerlink" title="Sá»­ dá»¥ng bá»™ nhá»› trong Javascript"></a>Sá»­ dá»¥ng bá»™ nhá»› trong Javascript</h1><p>Sá»­ dá»¥ng bá»™ nhá»› Ä‘Ã£ Ä‘Æ°á»£c cáº¥p phÃ¡t trong Javascript cÃ³ thá»ƒ gÃ³i gá»n má»™t cÃ¡ch Ä‘Æ¡n giáº£n trong 2 chá»¯ <strong>Ä‘á»c/ghi</strong></p><p>Viá»‡c nÃ y cÃ³ thá»ƒ thá»±c hiá»‡n báº±ng cÃ¡ch Ä‘á»c/ghi giÃ¡ trá»‹ cá»§a biáº¿n hoáº·c thuá»™c tÃ­nh cá»§a object hoáº·c truyá»n Ä‘á»‘i sá»‘ (argument) vÃ o 1 hÃ m.</p><h1 id="Giai-phong-khi-khong-dung-bo-nho-nua"><a href="#Giai-phong-khi-khong-dung-bo-nho-nua" class="headerlink" title="Giáº£i phÃ³ng khi khÃ´ng dÃ¹ng bá»™ nhá»› ná»¯a"></a>Giáº£i phÃ³ng khi khÃ´ng dÃ¹ng bá»™ nhá»› ná»¯a</h1><p>Äa sá»‘ cÃ¡c pháº§n Ä‘á» vá» quáº£n lÃ½ bá»™ nhá»› xáº£y ra á»Ÿ giai Ä‘oáº¡n nÃ y.</p><p>CÃ´ng viá»‡c khÃ³ nháº¥t á»Ÿ Ä‘Ã¢y lÃ  tÃ¬m hiá»ƒu khi nÃ o bá»™ nhá»› Ä‘Ã£ Ä‘Æ°á»£c cáº¥p phÃ¡t cÃ³ cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng hay khÃ´ng. ThÆ°á»ng thÃ¬ nÃ³ yÃªu cáº§u developer xÃ¡c Ä‘á»‹nh vÃ¹ng nhá»› nÃ o trong chÆ°Æ¡ng trÃ¬nh khÃ´ng dÃ¹ng ná»¯a vÃ  giáº£i phÃ³ng nÃ³.</p><p>NgÃ´n ngá»¯ báº­c cao thÃªm vÃ o 1 chÆ°Æ¡ng tÃ¬nh gá»i lÃ  bá»™ dá»n rÃ¡c (garbage collector - GC) thá»±c hiá»‡n cÃ´ng viá»‡c Ä‘i tÃ¬m nhá»¯ng vÃ¹ng nhá»› Ä‘Ã£ Ä‘Æ°á»£c cáº¥p phÃ¡t vÃ  tÃ¬m hiá»ƒu xem nÃ³ cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng hay khÃ´ng, náº¿u khÃ´ng dÃ¹ng ná»¯a thÃ¬ sáº½ tá»± Ä‘á»™ng giáº£i phÃ³ng nÃ³.</p><p>Äiá»u hÆ¡i chuá»‘i lÃ  tiáº¿n trÃ¬nh nÃ y chá»‰ tÆ°Æ¡ng Ä‘á»‘i Ä‘Ãºng, bá»Ÿi vÃ¬ váº¥n Ä‘á» tá»•ng quÃ¡t vá» viá»‡c xÃ¡c Ä‘á»‹nh má»™t vÃ¹ng nhá»› cÃ³ cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng hay khÃ´ng lÃ  báº¥t kháº£ thi (khÃ´ng thá»ƒ thá»±c hiá»‡n báº±ng thuáº­t toÃ¡n).</p><p>Äa sá»‘ GC hoáº¡t Ä‘á»™ng báº±ng cÃ¡ch thu tháº­p nhá»¯ng vÃ¹ng nhá»› khÃ´ng cÃ²n bá»‹ truy xuáº¥t Ä‘áº¿n, vÃ­ dá»¥: táº¥t cáº£ biáº¿n Ä‘ang trá» Ä‘áº¿n nÃ³ Ä‘á»u Ä‘i ra khá»i pháº¡m vi thá»±c thi. Tuy nhiÃªn, Ä‘iá»u nÃ y cÅ©ng láº¡i khÃ´ng háº³n lÃ  chÃ­nh xÃ¡c vÃ¬ táº¡i báº¥t ká»³ thá»i Ä‘iá»ƒm nÃ o má»™t Ä‘á»‹a chá»‰ vÃ¹ng nhá»› Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°á»£c trá» tá»›i bá»Ÿi 1 biáº¿n, nhÆ°ng biáº¿n Ä‘Ã³ láº¡i khÃ´ng bao giá» Ä‘Æ°á»£c sá»­ dá»¥ng ná»¯a.</p><h1 id="Qua-trinh-don-rac"><a href="#Qua-trinh-don-rac" class="headerlink" title="QuÃ¡ trÃ¬nh dá»n rÃ¡c"></a>QuÃ¡ trÃ¬nh dá»n rÃ¡c</h1><p>RÃµ rÃ ng cÃ¡ch thá»©c Ä‘á»ƒ tÃ¬m Ä‘Æ°á»£c vÃ¹ng nhá»› â€œkhÃ´ng cÃ²n dÃ¹ng ná»¯aâ€ lÃ  báº¥t kháº£ thi cho nÃªn GC thá»±c hiá»‡n má»™t giáº£i phÃ¡p háº¡n cháº¿ cho váº¥n Ä‘á» chung. Pháº§n nÃ y sáº½ giáº£i thÃ­ch nhá»¯ng khÃ¡i niá»‡m cáº§n thiáº¿t Ä‘á»ƒ báº¡n cÃ³ thá»ƒ hiá»ƒu Ä‘Æ°á»£c nhá»¯ng thuáº­t toÃ¡n GC vÃ  cÃ¡c giá»›i háº¡n cá»§a chÃºng.</p><h2 id="Tham-chieu-bo-nho"><a href="#Tham-chieu-bo-nho" class="headerlink" title="Tham chiáº¿u bá»™ nhá»›"></a>Tham chiáº¿u bá»™ nhá»›</h2><p>Ã tÆ°á»Ÿng chÃ­nh cá»§a nhá»¯ng thuáº­t toÃ¡n GC dá»±a trÃªn <strong>tham chiáº¿u</strong></p><p>Trong ngá»¯ cáº£nh quáº£n lÃ½ bá»™ nhá»›, má»™t object A tham chiáº¿u Ä‘áº¿n object B khÃ¡c náº¿u nhÆ° A cÃ³ truy xuáº¥t Ä‘áº¿n B (cÃ³ thá»ƒ tÆ°á»ng minh hoáº·c khÃ´ng tÆ°á»ng minh). VÃ­ dá»¥: má»™t Javascript object cÃ³ tham chiáº¿u Ä‘áº¿n prototype cá»§a chÃ­nh nÃ³ (<strong>khÃ´ng tÆ°á»ng minh</strong>) vÃ  tham chiáº¿u Ä‘áº¿n giÃ¡ trá»‹ cá»§a thuá»™c tÃ­nh cá»§a nÃ³ (<strong>tÆ°á»ng minh</strong>).</p><p>Trong trÆ°á»ng há»£p nÃ y, khÃ¡i niá»‡m cá»§a 1 â€œobjectâ€ Ä‘Æ°á»£c má»Ÿ rá»™ng thÃ nh má»™t thá»© gÃ¬ Ä‘Ã³ hÆ¡n lÃ  JS object thÃ´ng thÆ°á»ng vÃ  bao trÃ¹m cáº£ function scope (hoáº·c lÃ  lexical scope toÃ n cá»¥c).</p><blockquote><p>Lexical scoping Ä‘á»‹nh nghÄ©a cÃ¡ch mÃ  nhá»¯ng tÃªn biáº¿n Ä‘Æ°á»£c phÃ¢n giáº£i trong cÃ¡c hÃ m lá»“ng nhau: nhá»¯ng hÃ m con chÆ°a scope cá»§a hÃ m cha ká»ƒ cáº£ khi hÃ m cha Ä‘Ã£ Ä‘Æ°á»£c return.</p></blockquote><h2 id="Bo-dem-tham-chieu"><a href="#Bo-dem-tham-chieu" class="headerlink" title="Bá»™ Ä‘áº¿m tham chiáº¿u"></a>Bá»™ Ä‘áº¿m tham chiáº¿u</h2><p>ÄÃ¢y lÃ  thuáº­t toÃ¡n dá»n rÃ¡c Ä‘Æ¡n giáº£n nháº¥t. Má»™t object Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ lÃ  â€œrÃ¡c cÃ³ thá»ƒ dá»nâ€ náº¿u nhÆ° khÃ´ng cÃ³ tham chiáº¿u nÃ o trá» Ä‘áº¿n nÃ³.</p><p>VÃ­ dá»¥:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o1 = &#123;</span><br><span class="line">  o2: &#123;</span><br><span class="line">    x: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Táº¡o 2 object</span></span><br><span class="line"><span class="comment">// 'o1' tham chiáº¿u Ä‘áº¿n 'o2' vÃ¬ nÃ³ lÃ  1 thuá»™c tÃ­nh cá»§a 'o1'</span></span><br><span class="line"><span class="comment">// Hiá»‡n táº¡i khÃ´ng cÃ³ rÃ¡c Ä‘á»ƒ dá»n.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o3 = o1; <span class="comment">// biáº¿n 'o3' Ä‘ang tham chiáº¿u tá»›i cÃ¹ng 1 object vá»›i 'o1'</span></span><br><span class="line"></span><br><span class="line">o1 = <span class="number">1</span>;      <span class="comment">// giá» thÃ¬ object Ä‘Æ°á»£c tham chiáº¿u trÆ°á»›c Ä‘Ã³ bá»Ÿi 'o1'         </span></span><br><span class="line">            <span class="comment">// chá»‰ cÃ²n láº¡i 1 tham chiáº¿u duy nháº¥t lÃ  'o3'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o4 = o3.o2; <span class="comment">// tham chiáº¿u Ä‘áº¿n thuá»™c tÃ­nh 'o2'</span></span><br><span class="line">                <span class="comment">// object nÃ y giá» cÃ³ 2 tham chiáº¿u: </span></span><br><span class="line">                <span class="comment">// má»™t lÃ  thuá»™c tÃ­nh cá»§a 'o3': o3.o2</span></span><br><span class="line">                <span class="comment">// hai lÃ  biáº¿n 'o4'</span></span><br><span class="line"></span><br><span class="line">o3 = <span class="string">'374'</span>; <span class="comment">// Giá» thÃ¬ object trÆ°á»›c Ä‘Ã¢y lÃ  cá»§a o1 khÃ´ng cÃ²n tham chiáº¿u ná»¯a.</span></span><br><span class="line">            <span class="comment">// NÃ³ cÃ³ thá»ƒ bá»‹ dá»n dáº¹p bá»Ÿi GC </span></span><br><span class="line">            <span class="comment">// Tuy nhiÃªn thuá»™c tÃ­nh 'o2' cá»§a nÃ³ thÃ¬ váº«n cÃ²n</span></span><br><span class="line">            <span class="comment">// Ä‘Æ°á»£c tham chiáº¿u bá»Ÿi biáº¿n 'o4' nÃªn chÆ°a bá»‹ dá»n</span></span><br><span class="line"></span><br><span class="line">o4 = <span class="literal">null</span>; <span class="comment">// thuá»™c tÃ­nh 'o2' trÆ°á»›c Ä‘Ã¢y trong 'o1' giá»</span></span><br><span class="line">           <span class="comment">// Ä‘Ã£ khÃ´ng cÃ²n gÃ¬ tham chiáº¿u Ä‘áº¿n nÃ³</span></span><br><span class="line">           <span class="comment">// láº§n nÃ y thÃ¬ GC cÃ³ thá»ƒ dá»n nÃ³ Ä‘Æ°á»£c rá»“i.</span></span><br></pre></td></tr></table></figure><h2 id="Van-de-tu-tham-chieu-vong-tron"><a href="#Van-de-tu-tham-chieu-vong-tron" class="headerlink" title="Váº¥n Ä‘á» tá»« tham chiáº¿u vÃ²ng trÃ²n"></a>Váº¥n Ä‘á» tá»« tham chiáº¿u vÃ²ng trÃ²n</h2><p>CÃ³ má»™t sá»‘ giá»›i háº¡n liÃªn quan Ä‘áº¿n tham chiáº¿u vÃ²ng trÃ²n. Trong vÃ­ dá»¥ sau, 2 object Ä‘Æ°á»£c táº¡o ra vÃ  Ä‘Æ°á»£c tham chiáº¿u láº«n nhau, táº¡o thÃ nh 1 vÃ²ng trÃ²n. ChÃºng sáº½ Ä‘Æ°á»£c Ä‘áº©y ra ngoÃ i scope sau khi hÃ m káº¿t thÃºc nÃªn vá» máº·t lÃ½ thuyáº¿t thÃ¬ chÃºng vÃ´ dá»¥ng vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c giáº£i phÃ³ng. Tuy nhiÃªn, thuáº­t toÃ¡n Ä‘áº¿m tham chiáº¿u xem xÃ©t ráº±ng má»—i object Ä‘á»u Ä‘ang cÃ³ Ã­t nháº¥t 1 tham chiáº¿u Ä‘áº¿n object Ä‘Ã³ nÃªn thuáº­t toÃ¡n sáº½ bá» qua mÃ  khÃ´ng dá»n dáº¹p.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o1 = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> o2 = &#123;&#125;;</span><br><span class="line">  o1.p = o2; <span class="comment">// o1 tham chiáº¿u Ä‘áº¿n o2</span></span><br><span class="line">  o2.p = o1; <span class="comment">// o2 tham chiáº¿u Ä‘áº¿n o1\. </span></span><br><span class="line">            <span class="comment">// 2 thanh niÃªn nÃ y táº¡o thÃ nh 1 vÃ²ng trÃ²n tham chiáº¿u.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f();</span><br></pre></td></tr></table></figure><p><img src="https://cdn-images-1.medium.com/max/1000/1*GF3p99CQPZkX3UkgyVKSHw.png" alt=""></p><h2 id="Thuat-toan-Danh-dau-va-don-dep-Mark-and-sweep"><a href="#Thuat-toan-Danh-dau-va-don-dep-Mark-and-sweep" class="headerlink" title="Thuáº­t toÃ¡n ÄÃ¡nh dáº¥u vÃ  dá»n dáº¹p (Mark-and-sweep)"></a>Thuáº­t toÃ¡n ÄÃ¡nh dáº¥u vÃ  dá»n dáº¹p (Mark-and-sweep)</h2><p>Äá»ƒ xÃ¡c Ä‘á»‹nh xem object cÃ³ cÃ²n cáº§n thiáº¿t khÃ´ng thÃ¬ thuáº­t toÃ¡n nÃ y thá»­ xem object Ä‘Ã³ cÃ³ thá»ƒ truy cáº­p tá»›i hay khÃ´ng.</p><p>Thuáº­t toÃ¡n <strong>Mark-and-sweep</strong> cÃ³ 3 bÆ°á»›c:</p><ol><li><strong>Roots</strong>: NhÃ¬n chung, <em>roots</em> lÃ  nhá»¯ng biáº¿n toÃ n cá»¥c (global) Ä‘Æ°á»£c tham chiáº¿u Ä‘áº¿n trong code. Vá»›i Javascript, má»™t biáº¿n toÃ n cá»¥c cÃ³ vai trÃ² nhÆ° 1 <em>root</em> chÃ­nh lÃ  object <strong>window</strong>. Trong Node.js thÃ¬ nÃ³ gá»i lÃ  <strong>global</strong>. Danh sÃ¡ch hoÃ n chá»‰nh cÃ¡c <em>roots</em> Ä‘Æ°á»£c xÃ¢y dá»±ng bá»Ÿi GC.</li><li>Thuáº­t toÃ¡n sáº½ Ä‘iá»u tra táº¥t cáº£ cÃ¡c <em>roots</em> vÃ  con chÃ¡u (children) cá»§a nÃ³ rá»“i Ä‘Ã¡nh dáº¥u chÃºng lÃ  Ä‘ang hoáº¡t Ä‘á»™ng (active) (nghÄ©a lÃ , chÃºng khÃ´ng pháº£i rÃ¡c). Thá»© gÃ¬ mÃ  khÃ´ng pháº£i con chÃ¡u cá»§a root, root khÃ´ng truy xuáº¥t Ä‘áº¿n Ä‘Æ°á»£c thÃ¬ Ä‘á»u bá»‹ coi lÃ  <em>rÃ¡c</em>.</li><li>Cuá»‘i cÃ¹ng, GC sáº½ giáº£i phÃ³ng cÃ¡c vÃ¹ng nhá»› khÃ´ng Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u <em>active</em> vÃ  tráº£ bá»™ nhá»› láº¡i cho há»‡ Ä‘iá»u hÃ nh.</li></ol><p><img src="https://cdn-images-1.medium.com/max/1000/1*WVtok3BV0NgU95mpxk9CNg.gif" alt=""></p><p>Thuáº­t toÃ¡n nÃ y tá»‘t hÆ¡n thuáº­t toÃ¡n trÆ°á»›c vÃ¬ â€œÄ‘á»‘i tÆ°á»£ng khÃ´ng cÃ³ tham chiáº¿uâ€ dáº«n tá»›i trÆ°á»ng há»£p Ä‘á»‘i tÆ°á»£ng khÃ´ng thá»ƒ truy cáº­p, á»Ÿ hÆ°á»›ng ngÆ°á»£c láº¡i thÃ¬ nÃ³ giáº£i quyáº¿t Ä‘Æ°á»£c váº¥n Ä‘á» cá»§a tham chiáº¿u vÃ²ng trÃ²n.</p><p>NÄƒm 2012, táº¥t cáº£ trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i Ä‘á»u tÃ­ch há»£p sáºµn bá»™ GC Mark-and-sweep. Nhá»¯ng cáº£i tiáº¿n dÃ nh cho bá»™ Javascript GC (nhÆ° GC Tháº¿ há»‡ (Generational)/ Gia tÄƒng (Incremental)/ Äá»“ng thá»i (Concurrent)/ Song song (Parallel)) trong nhá»¯ng nÄƒm gáº§n Ä‘Ã¢y Ä‘á»u lÃ  nhá»¯ng nÃ¢ng cáº¥p cá»§a thuáº­t toÃ¡n Mark-and-sweep, nhÆ°ng khÃ´ng pháº£i lÃ  cáº£i tiáº¿n thuáº­t toÃ¡n GC, cÅ©ng khÃ´ng pháº£i quyáº¿t Ä‘á»‹nh xem 1 object cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c hay lÃ  khÃ´ng.</p><p><a href="https://en.wikipedia.org/wiki/Tracing_garbage_collection" target="_blank" rel="noopener">Trong bÃ i viáº¿t nÃ y</a>, báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu chi tiáº¿t hÆ¡n vá» quÃ¡ trÃ¬nh truy tÃ¬m rÃ¡c, nÃ³ cÅ©ng bao gá»“m luÃ´n cáº£ thuáº­t toÃ¡n Mark-and-sweep vÃ  cÃ¡ch tá»‘i Æ°u hÃ³a cá»§a nÃ³.</p><h2 id="Tham-chieu-vong-tron-chi-la-muoi"><a href="#Tham-chieu-vong-tron-chi-la-muoi" class="headerlink" title="Tham chiáº¿u vÃ²ng trÃ²n chá»‰ lÃ  muá»—i"></a>Tham chiáº¿u vÃ²ng trÃ²n chá»‰ lÃ  muá»—i</h2><p>Trong vÃ­ dá»¥ Ä‘áº§u tiÃªn, sau khi hÃ m Ä‘Æ°á»£c tráº£ vá», 2 object Ä‘á»u khÃ´ng Ä‘Æ°á»£c tham chiáº¿u Ä‘áº¿n bá»Ÿi má»™t object cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c tá»« Ä‘á»‘i tÆ°á»£ng toÃ n cá»¥c. Má»™t láº½ dÄ© nhiÃªn, thÃ¬ chÃºng sáº½ bá»‹ GC Ä‘Ã¡nh dáº¥u vÃ  dá»n sáº¡ch sáº½.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*FbbOG9mcqWZtNajjDO6SaA.png" alt=""></p><p>Máº·c dÃ¹ giá»¯a 2 object Ä‘á»u cÃ³ tham chiáº¿u láº«n nhau nhÆ°ng chÃºng khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c tá»« <em>root</em></p><h2 id="Hanh-vi-phan-truc-quan-cua-GC"><a href="#Hanh-vi-phan-truc-quan-cua-GC" class="headerlink" title="HÃ nh vi pháº£n trá»±c quan cá»§a GC"></a>HÃ nh vi pháº£n trá»±c quan cá»§a GC</h2><p>Máº·c dÃ¹ GC ráº¥t tiá»‡n lá»£i nhÆ°ng chÃºng cÅ©ng Ä‘i kÃ¨m vá»›i nhá»¯ng khuyáº¿t Ä‘iá»ƒm. Má»™t trong sá»‘ Ä‘Ã³ lÃ  sá»± <em>khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c</em>. NÃ³i cÃ¡ch khÃ¡c, GC lÃ  khÃ´ng thá»ƒ Ä‘oÃ¡n trÆ°á»›c Ä‘Æ°á»£c. Ta khÃ´ng thá»ƒ biáº¿t rÃµ khi nÃ o thÃ¬ GC Ä‘Æ°á»£c thá»±c thi. CÃ³ nghÄ©a lÃ  trong má»™t vÃ i trÆ°á»ng há»£p chÆ°Æ¡ng trÃ¬nh sá»­ dá»¥ng nhiá»u bá»™ nhá»› hÆ¡n sá»‘ lÆ°á»£ng mÃ  chÃºng cáº§n. Trong trÆ°á»ng há»£p khÃ¡c, nhá»¯ng thá»i Ä‘iá»ƒm táº¡m dá»«ng ngáº¯n háº¡n (short-pauses) cÃ³ thá»ƒ Ä‘Ã¡ng Ä‘Æ°á»£c chÃº Ã½ trong má»™t sá»‘ á»©ng dá»¥ng Ä‘áº·c biá»‡t nháº¡y cáº£m.<br>Máº·c dÃ¹ <em>khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c</em> nghÄ©a lÃ  khÃ´ng biáº¿t khi nÃ o GC sáº½ cháº¡y, Ä‘a sá»‘ GC Ä‘á»u dÃ¹ng chung má»™t mÃ´ hÃ¬nh thu tháº­p trong quÃ¡ trÃ¬nh cáº¥p phÃ¡t. Náº¿u nhÆ° cáº¥p phÃ¡t khÃ´ng cháº¡y, háº§u nhÆ° GC cÅ©ng khÃ´ng cháº¡y. Cáº§n cÃ¢n nháº¯c trÆ°á»ng há»£p sau:</p><ol><li>Cáº¥p phÃ¡t má»™t sá»‘ lÆ°á»£c bá»™ nhá»› lá»›n.</li><li>Äa sá»‘ cÃ¡c pháº§n tá»­ nÃ y (hoáº·c toÃ n bá»™) Ä‘á»u Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  khÃ´ng thá»ƒ truy cáº­p (Giáº£ sá»­ chÃºng ta vÃ´ hiá»‡u hÃ³a má»™t tham chiáº¿u Ä‘ang trá» Ä‘áº¿n bá»™ nhá»› cache mÃ  chÃºng ta khÃ´ng cáº§n ná»¯a.)</li><li>KhÃ´ng cÃ³ cáº¥p phÃ¡t nÃ o Ä‘Æ°á»£c thá»±c thi ná»¯a.</li></ol><p>Trong trÆ°á»ng há»£p nÃ y, Ä‘a sá»‘ cÃ¡c GC sáº½ khÃ´ng cháº¡y báº¥t ká»³ má»™t thu gom nÃ o. NÃ³i cÃ¡ch khÃ¡c, máº·c dÃ¹ cÃ³ nhá»¯ng tham chiáº¿u khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c Ä‘ang tá»“n táº¡i nhÆ°ng chÃºng láº¡i khÃ´ng Ä‘Æ°á»£c GC â€œÄ‘á»ƒ máº¯tâ€ Ä‘áº¿n. ÄÃ¢y khÃ´ng pháº£i lÃ  má»™t loáº¡i rÃ² rá»‰ nghiÃªm trá»ng nhÆ°ng dÄ© nhiÃªn nÃ³ váº«n sá»­ dá»¥ng bá»™ nhá»› nhiá»u hÆ¡n bÃ¬nh thÆ°á»ng.</p><h1 id="Ro-ri-bo-nho-la-gi"><a href="#Ro-ri-bo-nho-la-gi" class="headerlink" title="RÃ² rá»‰ bá»™ nhá»› lÃ  gÃ¬ ?"></a>RÃ² rá»‰ bá»™ nhá»› lÃ  gÃ¬ ?</h1><p>Náº¿u báº¡n Ä‘á»c háº¿t nhá»¯ng pháº§n á»Ÿ trÃªn thÃ¬ cÅ©ng dá»… hiá»ƒu thÃ´i, rÃ² rá»‰ bá»™ nhá»› lÃ  nhá»¯ng vÃ¹ng nhá»› Ä‘Æ°á»£c cáº¥p phÃ¡t vÃ  sá»­ dá»¥ng trong chÆ°Æ¡ng trÃ¬nh nhÆ°ng sau Ä‘Ã³, khi khÃ´ng cÃ²n dÃ¹ng ná»¯a, chÃºng váº«n khÃ´ng Ä‘Æ°á»£c giáº£i phÃ³ng vÃ  tráº£ vá» cho há»‡ Ä‘iá»u hÃ nh hoáº·c lÃ  kho chá»©a bá»™ nhá»›.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*0B-dAUOH7NrcCDP6GhKHQw.jpeg" alt=""></p><p>CÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh cÃ³ nhiá»u cÃ¡ch khÃ¡c nhau Ä‘á»ƒ quáº£n lÃ½ bá»™ nhá»›. Tuy nhiÃªn, má»™t vÃ¹ng nhá»› cá»¥ thá»ƒ Ä‘Æ°á»£c dÃ¹ng hay khÃ´ng thá»±c sá»± lÃ  <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management#Release_when_the_memory_is_not_needed_anymore" target="_blank" rel="noopener">váº¥n Ä‘á» khÃ³ Ä‘oÃ¡n</a>. NÃ³i cÃ¡ch khÃ¡c, chá»‰ cÃ³ developer má»›i biáº¿t khi nÃ o thÃ¬ má»™t vÃ¹ng nhá»› nÃªn Ä‘Æ°á»£c giáº£i phÃ³ng vÃ  tráº£ láº¡i cho há»‡ Ä‘iá»u hÃ nh.</p><p>Nhá»¯ng ngÃ´n ngá»¯ láº­p trÃ¬nh cung cáº¥p cÃ¡c tÃ­nh nÄƒng giÃºp developer lÃ m viá»‡c nÃ y. Trong khi má»™t sá»‘ ngÃ´n ngá»¯ khÃ¡c muá»‘n developer hiá»ƒu tÆ°á»ng táº­n vá» viá»‡c khi nÃ o thÃ¬ 1 vÃ¹ng nhá»› khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng ná»¯a. Wikipedia cÃ³ bÃ i viáº¿t hay vá» viá»‡c quáº£n lÃ½ bá»™ nhá»› <a href="https://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29" target="_blank" rel="noopener">tá»± Ä‘á»™ng</a> vÃ  <a href="https://en.wikipedia.org/wiki/Manual_memory_management" target="_blank" rel="noopener">báº±ng tay</a>, báº¡n cÃ³ thá»ƒ xem qua.</p><h2 id="4-loai-ro-ri-pho-bien-trong-Javascript"><a href="#4-loai-ro-ri-pho-bien-trong-Javascript" class="headerlink" title="4 loáº¡i rÃ² rá»‰ phá»• biáº¿n trong Javascript"></a>4 loáº¡i rÃ² rá»‰ phá»• biáº¿n trong Javascript</h2><h3 id="1-Bien-toan-cuc"><a href="#1-Bien-toan-cuc" class="headerlink" title="1. Biáº¿n toÃ n cá»¥c"></a>1. Biáº¿n toÃ n cá»¥c</h3><p>Javascript xá»­ lÃ½ nhá»¯ng biáº¿n khÃ´ng Ä‘Æ°á»£c khai bÃ¡o má»™t cÃ¡ch khÃ¡ thÃº vá»‹: khi má»™t biáº¿n khÃ´ng Ä‘Æ°á»£c khai bÃ¡o Ä‘Æ°á»£c tham chiáº¿u Ä‘áº¿n thÃ¬ má»™t biáº¿n má»›i sáº½ Ä‘Æ°á»£c táº¡o ra trong object toÃ n cá»¥c (global). TrÃªn trÃ¬nh duyá»‡t thÃ¬ tÃªn cá»§a nÃ³ lÃ  <strong>window</strong>, nghÄ©a lÃ  Ä‘oáº¡n nÃ y</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    bar = <span class="string">"some text"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€¦tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.bar = <span class="string">"some text"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Giáº£ sá»­ má»¥c Ä‘Ã­ch cá»§a bar chá»‰ Ä‘á»ƒ tham chiáº¿u Ä‘áº¿n 1 biáº¿n trong hÃ m foo thÃ¬ má»™t biáº¿n toÃ n cá»¥c dÆ° thá»«a lÃºc nÃ y Ä‘Ã£ Ä‘Æ°á»£c táº¡o ra bá»Ÿi vÃ¬ ta Ä‘á»‹nh nghÄ©a bar mÃ  khÃ´ng dÃ¹ng var. á» vÃ­ dá»¥ trÃªn, nÃ³ khÃ´ng gÃ¢y ra nhiá»u tá»•n háº¡i, nhÆ°ng dÄ© nhiÃªn báº¡n cÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng ra bá»‘i cáº£nh Ä‘Ã¡ng lo ngáº¡i hÆ¡n nhiá»u. VÃ­ dá»¥ nhÆ° gÃ¡n 1 object phá»©c táº¡p trong bar cháº³ng háº¡n.</p><p>Thá»‰nh thoáº£ng báº¡n cÅ©ng cÃ³ thá»ƒ vÃ´ tÃ¬nh táº¡o biáº¿n toÃ n cá»¥c báº±ng this:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.var1 = <span class="string">"potential accidental global"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// trong hÃ m foo() á»Ÿ Ä‘Ã¢y thÃ¬ "this" Ä‘ang trá» tá»›i biáº¿n toÃ n cá»¥c </span></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure><p>Báº¡n cÃ³ thá»ƒ trÃ¡nh trÆ°á»ng há»£p Ä‘Ã¡ng tiáº¿c nÃ y báº±ng cÃ¡ch thÃªm dÃ²ng use strict vÃ o Ä‘áº§u file Javascript, nÃ³ sáº½, nÃ³i nÃ´m na, lÃ  báº­t cháº¿ Ä‘á»™ â€œnghiÃªm tÃºcâ€ lÃªn khi phÃ¢n tÃ­ch cÃº phÃ¡p (parse) code JS vÃ  sáº½ ngÄƒn cháº·n trÆ°á»ng há»£p vÃ´ tÃ¬nh táº¡o biáº¿n toÃ n cá»¥c.</p><p>Nhá»¯ng biáº¿n toÃ n cá»¥c ngoÃ i dá»± tÃ­nh nhÆ° trÃªn rÃµ rÃ ng lÃ  1 váº¥n Ä‘á», tuy nhiÃªn, thÆ°á»ng thÃ¬ code cá»§a báº¡n sáº½ bá»‹ â€œnhiá»…m Ä‘á»™câ€ bá»Ÿi nhá»¯ng biáº¿n toÃ n cá»¥c tÆ°á»ng minh mÃ  nhá»¯ng biáº¿n Ä‘Ã³ láº¡i khÃ´ng thá»ƒ thu tháº­p bá»Ÿi GC. Äáº·c biá»‡t chÃº Ã½ Ä‘áº¿n cÃ¡c biáº¿n toÃ n cá»¥c thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ táº¡m thá»i vÃ  xá»­ lÃ½ 1 sá»‘ lÆ°á»£ng lá»›n thÃ´ng tin. Sá»­ dá»¥ng biáº¿n toÃ n cá»¥c Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u náº¿u báº¡n <strong>pháº£i</strong> lÃ m tháº¿, nhÆ°ng nhá»› ká»¹ lÃ  gÃ¡n nÃ³ báº±ng null hoáº·c gÃ¡n láº¡i 1 giÃ¡ trá»‹ khÃ¡c khi Ä‘Ã£ xong viá»‡c vá»›i nÃ³.</p><h3 id="2-Timers-hoac-callbacks-bi-bo-quen"><a href="#2-Timers-hoac-callbacks-bi-bo-quen" class="headerlink" title="2. Timers hoáº·c callbacks bá»‹ bá» quÃªn"></a>2. Timers hoáº·c callbacks bá»‹ bá» quÃªn</h3><p>Láº§n nÃ y ta láº¥y setInterval lÃ m vÃ­ dá»¥ vÃ¬ nÃ³ thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng trong JS.</p><p>Nhá»¯ng thÆ° viá»‡n cÃ³ dÃ¹ng callback cung cáº¥p observer vÃ  cÃ¡c cÃ´ng cá»¥ tÆ°Æ¡ng tá»± thÆ°á»ng Ä‘áº£m báº£o tham chiáº¿u Ä‘áº¿n callback sáº½ khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c má»™t khi instance cá»§a nÃ³ khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c. VÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y khÃ´ng pháº£i hiáº¿m:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serverData = loadData();</span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> renderer = <span class="built_in">document</span>.getElementById(<span class="string">'renderer'</span>);</span><br><span class="line">    <span class="keyword">if</span>(renderer) &#123;</span><br><span class="line">        renderer.innerHTML = <span class="built_in">JSON</span>.stringify(serverData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">5000</span>); <span class="comment">// hÃ m sáº½ Ä‘Æ°á»£c thá»±c thi sau má»—i 5 giÃ¢y.</span></span><br></pre></td></tr></table></figure><p>Äoáº¡n code trÃªn cho tháº¥y háº­u quáº£ cá»§a viá»‡c sá»­ dá»¥ng timer cÃ³ tham chiáº¿u Ä‘áº¿n node hay dá»¯ liá»‡u cÅ©, khÃ´ng cÃ²n dÃ¹ng ná»¯a.</p><p>Object renderer cÃ³ thá»ƒ Ä‘Æ°á»£c thay tháº¿ hoáº·c gá»¡ bá» á»Ÿ Ä‘Ã¢u Ä‘Ã³ trong quÃ¡ trÃ¬nh thá»±c thi, Ä‘iá»u nÃ y lÃ m cho hÃ m callback trong setInterval trá»Ÿ nÃªn thá»«a thÃ£i. Náº¿u Ä‘iá»u nÃ y xáº£y ra, dÃ¹ cho callback hay nhá»¯ng thá»© bÃªn trong cÃ³ Ä‘á»§ Ä‘iá»u kiá»‡n Ä‘á»ƒ Ä‘Æ°á»£c dá»n dáº¹p thÃ¬ trÆ°á»›c háº¿t cÃ¡i interval Ä‘Ã³ pháº£i dá»«ng láº¡i trÆ°á»›c Ä‘Ã£ (bá»i vÃ¬ nÃ³ váº«n Ä‘ang hoáº¡t Ä‘á»™ng mÃ ). DÄ© nhiÃªn náº¿u nhÆ° serverData Ä‘ang chá»©a hay Ä‘ang xá»­ lÃ½ cáº£ 1 Ä‘á»‘ng dá»¯ liá»‡u thÃ¬ cÅ©ng khÃ´ng thá»ƒ bá»‹ thu dá»n Ä‘Æ°á»£c.</p><p>Khi sá»­ dá»¥ng observer, báº¡n cáº§n Ä‘áº£m báº£o pháº£i cÃ³ má»™t cÃ¢u lá»‡nh tÆ°á»ng minh Ä‘á»ƒ gá»¡ bá» chÃºng má»—i khi xong viá»‡c (DÃ¹ lÃ  observer Ä‘Ã³ khÃ´ng cáº§n dÃ¹ng ná»¯a hay object khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c).</p><p>May máº¯n thay, Ä‘a sá»‘ cÃ¡c trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i Ä‘á»u lÃ m giÃºp báº¡n viá»‡c Ä‘Ã³ rá»“i: chÃºng sáº½ tá»± Ä‘á»™ng thu tháº­p cÃ¡c observer má»—i khi object trong Ä‘Ã³ trá»Ÿ nÃªn khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c ká»ƒ cáº£ náº¿u nhÆ° báº¡n quÃªn gá»¡ cÃ¡c listener. TrÆ°á»›c Ä‘Ã¢y, má»™t sá»‘ trÃ¬nh duyá»‡t khÃ´ng lÃ m Ä‘Æ°á»£c Ä‘iá»u nÃ y (IE6 cháº³ng háº¡n).</p><p>NhÆ°ng cÃ¡ch tá»‘t nháº¥t váº«n lÃ  gá»¡ bá» observer khi Ä‘Ã£ xong viá»‡c vá»›i nÃ³. Báº¡n xem vÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">'launch-button'</span>);</span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onClick</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">   counter++;</span><br><span class="line">   element.innerHtml = <span class="string">'text '</span> + counter;</span><br><span class="line">&#125;</span><br><span class="line">element.addEventListener(<span class="string">'click'</span>, onClick);</span><br><span class="line"><span class="comment">// Do stuff </span></span><br><span class="line">element.removeEventListener(<span class="string">'click'</span>, onClick);</span><br><span class="line">element.parentNode.removeChild(element);</span><br><span class="line"><span class="comment">// Giá» thÃ¬ "element" Ä‘Ã£ Ä‘Æ°á»£c Ä‘Æ°a ra khá»i pháº¡m vi thá»±c thi,</span></span><br><span class="line"><span class="comment">// Cáº£ "element" vÃ  "onClick" sáº½ Ä‘Æ°á»£c dá»n dáº¹p ká»ƒ cáº£ trÃªn cÃ¡c trÃ¬nh duyá»‡t cÅ©</span></span><br></pre></td></tr></table></figure><p>Báº¡n khÃ´ng cÃ n pháº£i gá»i hÃ m removeEventListener trÆ°á»›c khi lÃ m cho node khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c vÃ¬ cÃ¡c trÃ¬nh duyá»‡t hiá»‡n Ä‘áº¡i há»— trá»£ GC cÃ³ thá»ƒ tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh vÃ  xá»­ lÃ½ chÃºng má»™t cÃ¡ch thÃ­ch há»£p.</p><p>Náº¿u báº¡n dÃ¹ng jQuery APIs (cÃ³ nhiá»u thÆ° viá»‡n vÃ  frameworks khÃ¡c cÅ©ng há»— trá»£), báº¡n cÅ©ng cÃ³ thá»ƒ gá»¡ bá» cÃ¡c listener trÆ°á»›c khi node bá»‹ Ä‘Æ°a vÃ o â€œdÄ© vÃ£ngâ€ vÃ  khÃ´ng dÃ¹ng ná»¯a. Nhá»¯ng thÆ° viá»‡n cÅ©ng Ä‘áº£m báº£o khÃ´ng cÃ³ rÃ² rá»‰ bá»™ nhá»› ká»ƒ cáº£ khi á»©ng dá»¥ng cá»§a báº¡n cháº¡y trÃªn nhá»¯ng trÃ¬nh duyá»‡t cÅ©.</p><h3 id="3-Closures"><a href="#3-Closures" class="headerlink" title="3. Closures"></a>3. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" target="_blank" rel="noopener">Closures</a></h3><p>Má»™t pháº§n quan trá»ng cá»§a Javascript chÃ­nh lÃ  closure: má»™t hÃ m con cÃ³ thá»ƒ truy xuáº¥t Ä‘áº¿n biáº¿n cá»§a hÃ m bÃªn ngoÃ i nÃ³. Trong quÃ¡ tÃ¬nh triá»ƒn khai chi tiáº¿t mÃ´i trÆ°á»ng thá»±c thi (runtime) cá»§a JS thÃ¬ cÃ³ thá»ƒ xáº£y ra tÃ¬nh tráº¡ng rÃ² rá»‰ bá»™ nhá»› vá»›i closure nhÆ° sau:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> theThing = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> replaceThing = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> originalThing = theThing;</span><br><span class="line">  <span class="keyword">var</span> unused = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (originalThing) <span class="comment">// má»™t tham chiáº¿u Ä‘áº¿n 'originalThing'</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"hi"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  theThing = &#123;</span><br><span class="line">    longStr: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1000000</span>).join(<span class="string">'*'</span>),</span><br><span class="line">    someMethod: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"message"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">setInterval(replaceThing, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>Má»™t khi replaceThing Ä‘Æ°á»£c gá»i, theThing sáº½ trá»Ÿ thÃ nh má»™t object má»›i chá»©a 1 máº£ng ráº¥t lá»›n vÃ  1 closure someMethod. Tuy nhiÃªn, originalThing Ä‘Æ°á»£c tham chiáº¿u bá»Ÿi 1 closure mÃ  nÃ³ láº¡i náº±m trong biáº¿n unused (chÃ­nh lÃ  biáº¿n theThing tá»« lá»i gá»i Ä‘áº¿n replaceThing trÆ°á»›c Ä‘Ã³). Nhá»› ráº±ng á»Ÿ Ä‘Ã¢y má»™t khi <strong>pháº¡m vi (scope) cá»§a closure Ä‘Æ°á»£c táº¡o ra cho closure trong cÃ¹ng parent scope thÃ¬ scope Ä‘Ã³ Ä‘Æ°á»£c dÃ¹ng chung</strong>.</p><p>Trong trÆ°á»ng há»£p nÃ y, scope táº¡o ra cho closure someMethod Ä‘Æ°á»£c chia sáº» vá»›i unused. unused cÃ³ tham chiáº¿u Ä‘áº¿n originalThing. Máº·c dÃ¹ unused khÃ´ng bao giá» Ä‘Æ°á»£c dÃ¹ng, someMehod cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng thÃ´ng qua theThing bÃªn ngoÃ i scope cá»§a replaceThing (vÃ­ dá»¥: á»Ÿ 1 nÆ¡i toÃ n cá»¥c nÃ o Ä‘Ã³). VÃ  khi someMethod chia sáº» closure vá»›i unused, tham chiáº¿u Ä‘áº¿n originalThing trong unused Ã©p nÃ³ pháº£i á»Ÿ trong tráº¡ng thÃ¡i hoáº¡t Ä‘á»™ng (toÃ n bá»™ scope chia sáº» giá»¯a 2 closure). Äiá»u nÃ y ngÄƒn cháº·n GC hoáº¡t Ä‘á»™ng.</p><p>Trong vÃ­ dá»¥ trÃªn, scope Ä‘Æ°á»£c táº¡o ra cho closure someMethod Ä‘Æ°á»£c chia sáº» vá»›i unused, trong khi unused tham chiáº¿u tá»›i originalThing. someMethod cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i thÃ´ng qua theThing bÃªn ngoÃ i scope cá»§a replaceThing, máº·c dÃ¹ sá»± tháº­t lÃ  unused khÃ´ng bao giá» Ä‘Æ°á»£c sá»­ dá»¥ng. RÃµ rÃ ng unused tham chiáº¿u Ä‘áº¿n originalThing yÃªu cáº§u nÃ³ pháº£i giá»¯ tráº¡ng thÃ¡i Ä‘ang hoáº¡t Ä‘á»™ng bá»Ÿi vÃ¬ someMethod chia sáº» closure scope vá»›i unused.</p><p>Táº¥t cáº£ nhá»¯ng Ä‘iá»u nÃ y cÃ³ thá»ƒ lÃ m bá»™ nhá»› bá»‹ rÃ² rá»‰ Ä‘Ã¡ng ká»ƒ. Báº¡n cÃ³ thá»ƒ tháº¥y biá»ƒu Ä‘á»“ sá»­ dá»¥ng bá»™ nhá»› dÃ¢ng lÃªn cao ngáº¥t khi Ä‘oáº¡n code trÃªn bá»‹ láº·p Ä‘i láº·p láº¡i. KÃ­ch thÆ°á»›c cá»§a nÃ³ khÃ´ng bá»‹ giáº£m Ä‘i khi GC hoáº¡t Ä‘á»™ng. Má»™t danh sÃ¡ch liÃªn káº¿t cÃ¡c closure Ä‘Æ°á»£c táº¡o ra (root cá»§a nÃ³ lÃ  theThing) vÃ  má»—i closure scope láº¡i chÆ°a má»™t tham chiáº¿u giÃ¡n tiáº¿p tá»›i máº£ng khá»•ng lá»“.</p><p>Váº¥n Ä‘á» nÃ y Ä‘Æ°á»£c tÃ¬m tháº¥y bá»Ÿi Meteor team vÃ  há» cÃ³ <a href="https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156" target="_blank" rel="noopener">1 bÃ i viáº¿t cá»¥ thá»ƒ mÃ´ táº£ vá» nÃ³ á»Ÿ Ä‘Ã¢y</a>.</p><h3 id="4-Tham-chieu-ngoai-DOM"><a href="#4-Tham-chieu-ngoai-DOM" class="headerlink" title="4. Tham chiáº¿u ngoÃ i DOM"></a>4. Tham chiáº¿u ngoÃ i DOM</h3><p>CÃ³ nhá»¯ng trÆ°á»ng há»£p mÃ  developer lÆ°u trá»¯ DOM node bÃªn trong cáº¥u trÃºc dá»¯ liá»‡u. Giáº£ sá»­ báº¡n muá»‘n cáº­p nháº­t má»™t cÃ¡ch nhanh chÃ³ng dá»¯ liá»‡u cá»§a nhiá»u row trong 1 table. Náº¿u báº¡n lÆ°u tham chiáº¿u Ä‘áº¿n má»—i DOM row trong 1 dictionary hay máº£ng, sáº½ cÃ³ 2 tham chiáº¿u Ä‘áº¿n cÃ¹ng 1 pháº§n tá»­ DOM: 1 lÃ  tá»« cÃ¢y DOME, vÃ  1 lÃ  tá»« dictionary. Náº¿u báº¡n chá»n lá»±a xÃ³a bá» nhá»¯ng row nÃ y, báº¡n cÅ©ng pháº£i nhá»› lÃ m cho 2 tham chiáº¿u trÃªn khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elements = &#123;</span><br><span class="line">    button: <span class="built_in">document</span>.getElementById(<span class="string">'button'</span>),</span><br><span class="line">    image: <span class="built_in">document</span>.getElementById(<span class="string">'image'</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doStuff</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    elements.image.src = <span class="string">'http://example.com/image_name.png'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeImage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// CÃ¡i áº£nh lÃ  1 node con trá»±c tiáº¿p cá»§a body</span></span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(<span class="built_in">document</span>.getElementById(<span class="string">'image'</span>));</span><br><span class="line">    <span class="comment">// á» thá»i Ä‘iá»ƒm nÃ y ta váº«n cÃ³ 1 tham chiáº¿u Ä‘áº¿n #button trong </span></span><br><span class="line">    <span class="comment">// biáº¿n toÃ n cá»¥c "element". NÃ³i cÃ¡ch khÃ¡c, "button" váº«n cÃ²n náº±m</span></span><br><span class="line">    <span class="comment">// trong bá»™ nhá»› vÃ  GC khÃ´ng thá»ƒ dá»n dáº¹p nÃ³ Ä‘Æ°á»£c.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Cáº§n pháº£i xem xÃ©t ká»¹ lÆ°á»¡ng khi tham chiáº¿u Ä‘áº¿n node con hay node lÃ¡ bÃªn trong cÃ¢y DOME. Náº¿u báº¡n giá»¯ tham chiáº¿u Ä‘áº¿n 1 table cell (tháº» <td>) trong code vÃ  chá»n xÃ³a table khá»i DOM tuy nhiÃªn váº«n giá»¯ tham chiáº¿u Ä‘áº¿n cell Ä‘Ã³, báº¡n cÃ³ thá»ƒ sáº½ pháº£i Ä‘á»‘i máº·t vá»›i 1 vá»¥ rÃ² rá»‰ lá»›n. Báº¡n nghÄ© ráº±ng GC sáº½ giáº£i phÃ³ng táº¥t cáº£ má»i thá»© ngoáº¡i trá»« cell Ä‘Ã³. Tuy nhiÃªn, Ä‘iá»u nÃ y khÃ´ng dá»… dÃ ng nhÆ° váº­y. Bá»Ÿi vÃ¬ cell lÃ  1 node con cá»§a table vÃ  nhá»¯ng node con thÃ¬ cÃ³ tham chiáº¿u Ä‘áº¿n parent cá»§a chÃºng, vÃ¬ tháº¿ 1 tham chiáº¿u Ä‘áº¿n 1 cell cÃ³ thá»ƒ giá»¯ cáº£ 1 table lá»›n trong bá»™ nhá»›.</td></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Máº¥y hÃ´m trÆ°á»›c chÃºng ta Ä‘Ã£ báº¯t Ä‘áº§u series bÃ i viáº¿t Ä‘á»¥c khoÃ©t vá» Javascript vÃ  cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o, báº±ng cÃ¡ch hiá»ƒu vá» nhá»¯ng thÃ nh pháº§n cÆ¡ báº£n vÃ  cÃ¡ch chÃºng tÆ°Æ¡ng tÃ¡c vá»›i nhau thÃ¬ chÃºng ta cÃ³ thá»ƒ viáº¿t code tá»‘t hÆ¡n vÃ  &lt;em&gt;ngon&lt;/em&gt; hÆ¡n.&lt;/p&gt;
&lt;p&gt;BÃ i Ä‘áº§u tiÃªn lÃ  tá»•ng quan vá» series, cung cáº¥p cÃ¡i nhÃ¬n toÃ n cáº£nh vá» engine, runtime &amp;amp; callstack. BÃ i thá»© 2 lÃ  má»™t cÃ¡i nhÃ¬n cá»¥ thá»ƒ hÆ¡n vá» nhá»¯ng thÃ nh pháº§n bÃªn trong cá»§a bá»™ engine V8 cá»§a Google vÃ  má»™t sá»‘ máº¹o váº·t Ä‘á»ƒ tá»‘i Æ°u Javascript code.&lt;/p&gt;
&lt;p&gt;á» bÃ i thá»© 3 nÃ y, chÃºng ta sáº½ tháº£o luáº­n vá» má»™t váº¥n Ä‘á» khÃ´ng kÃ©m pháº§n quan trá»ng nhÆ°ng láº¡i thÆ°á»ng bá»‹ cÃ¡c dev bá» qua do sá»± phá»©c táº¡p ngÃ y cÃ ng gia tÄƒng cá»§a cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh thÆ°á»ng dÃ¹ng: quáº£n lÃ½ bá»™ nhá»›. ChÃºng ta cÅ©ng sáº½ tÃ¬m hiá»ƒu má»™t sá»‘ máº¹o Ä‘á»ƒ cÃ³ thá»ƒ xá»­ lÃ½ nhá»¯ng trÆ°á»ng há»£p rÃ² rÃ¬ bá»™ nhá»› cá»§a Javascript mÃ  team SesstionStack Ä‘Ã£ Ã¡p dá»¥ng Ä‘á»ƒ trÃ¡nh bá»‹ rÃ² rá»‰ vÃ  khÃ´ng lÃ m tá»‘n bá»™ nhá»› cá»§a webapp.&lt;br&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://nthung2112.github.io/tags/javascript/"/>
    
  </entry>
  
</feed>
